<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBSHRRDB LMS v2.0 | Enterprise Learning System</title>
    <link rel="icon" href="assets/bbsydp_logo.png" type="image/png">

    <!-- Core Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                indigo: { 50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95', 950: '#2e1065' },
                                intel: { 50: '#ecfeff', 100: '#cffafe', 200: '#a5f3fc', 300: '#67e8f9', 400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63', 950: '#083344' },
                                slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#020617' }
                            },
                            fontFamily: {
                                sans: ['Outfit', 'Inter', 'sans-serif'],
                            },
                            borderRadius: {
                                '3xl': '24px',
                                '4xl': '32px',
                            }
                        }
                    }
                }
            } else {
                console.error("Tailwind CSS failed to load. Check internet connection.");
            }
        });
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Standard UMD Alias
        window.jsPDF = window.jspdf ? window.jspdf.jsPDF : window.jsPDF;
    </script>
    <script src="signature.js"></script>

    <script>
        // --- TEXT ENCODING UTILITIES ---
        // Helper to fix corrupted UTF-16 surrogates (Mojibake)
        window.fixEncoding = (str) => {
            if (!str) return str;
            
            let fixed = str;
            // console.log("FixEncoding Input:", str); // Debug

            // 1. Explicit Replacements for known patterns (based on user feedback)
            // Ø=ÜØ -> 📘 (Blue Book)
            fixed = fixed.replace(/Ø=ÜØ/g, '\uD83D\uDCD8');
            // Ø=ÜM -> 👍 (Thumbs Up)
            fixed = fixed.replace(/Ø=ÜM/g, '\uD83D\uDC4D');
            // Ø<ß  -> 🎓 (Graduation Cap)
            fixed = fixed.replace(/Ø<ß/g, '\uD83C\uDF93'); 
            
            // 2. Generic Regex for "Double-Encoded" Surrogates
            // Pattern: High(D8-DB) Byte2 Low(DC-DF) Byte4
            fixed = fixed.replace(/([\u00D8-\u00DB])([\s\S])([\u00DC-\u00DF])([\s\S])/g, (match, h1, h2, l1, l2) => {
                try {
                    const high = (h1.charCodeAt(0) << 8) | h2.charCodeAt(0);
                    const low = (l1.charCodeAt(0) << 8) | l2.charCodeAt(0);
                    if (high >= 0xD800 && high <= 0xDBFF && low >= 0xDC00 && low <= 0xDFFF) {
                        return String.fromCharCode(high, low);
                    }
                    return match;
                } catch (e) {
                    return match;
                }
            });

            return fixed;
        };

        // Helper to render text with emojis as an image (for PDF)
        window.textToImage = (text, fontSize, color, maxWidth, scaleFactor = 4, fontWeight = 'bold') => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            const font = `${fontWeight} ${fontSize}px "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif`;
            ctx.font = font;
            
            // Text Wrapping Logic
            const words = text.split(' ');
            let lines = [];
            let currentLine = words[0];

            if (maxWidth) {
                for (let i = 1; i < words.length; i++) {
                    const word = words[i];
                    const width = ctx.measureText(currentLine + " " + word).width;
                    if (width < maxWidth) {
                        currentLine += " " + word;
                    } else {
                        lines.push(currentLine);
                        currentLine = word;
                    }
                }
                lines.push(currentLine);
            } else {
                lines.push(text);
            }

            // Calculate Dimensions
            const lineHeight = fontSize * 1.4;
            const width = maxWidth || (Math.ceil(ctx.measureText(text).width) + 4);
            const height = Math.ceil(lines.length * lineHeight);

            // Set High-DPI Canvas Size
            canvas.width = width * scaleFactor;
            canvas.height = height * scaleFactor;
            
            // Scale Context
            ctx.scale(scaleFactor, scaleFactor);
            
            // Render
            ctx.font = font;
            ctx.fillStyle = color || '#000000';
            ctx.textBaseline = 'middle';
            
            lines.forEach((line, index) => {
                ctx.fillText(line, 2, (index * lineHeight) + (lineHeight / 2));
            });

            return { dataUrl: canvas.toDataURL('image/png'), width, height };
        };

        // Helper to process text for PDF reports (Fixes encoding AND replaces emojis with images)
        window.processTextForReport = (text) => {
            if (!text) return '';
            let processed = window.fixEncoding(text);
            
            // Regex for emojis (broad range to catch most emojis)
            // Uses unicode property escapes if supported, otherwise simple range
            const emojiRegex = /(\p{Emoji_Presentation}|\p{Extended_Pictographic})/gu;
            
            try {
                processed = processed.replace(emojiRegex, (match) => {
                    // Generate image for the emoji
                    const imgData = window.textToImage(match, 14, '#000000'); // Match report font size roughly
                    return `<img src="${imgData.dataUrl}" style="width: ${imgData.width}px; height: ${imgData.height}px; vertical-align: middle; display: inline-block;" alt="emoji" />`;
                });
            } catch (e) {
                console.warn("Emoji replacement failed:", e);
                // Fallback: return text with just encoding fixed
            }
            
            // Replace newlines with break tags
            processed = processed.replace(/\n/g, '<br>');
            return processed;
        };

        // UI Helpers (Inlined for reliability)

        // GLOBAL SIDEBAR TOGGLE HELPERS

        // DESKTOP SIDEBAR TOGGLE
        window.toggleSidebarCollapse = function () {
            const sidebar = document.getElementById('main-sidebar');
            const content = document.querySelector('.content-main');
            const icon = document.getElementById('collapse-icon');

            if (sidebar) {
                sidebar.classList.toggle('collapsed');
                const isCollapsed = sidebar.classList.contains('collapsed');

                // Save state
                localStorage.setItem('sidebarCollapsed', isCollapsed);

                // Adjust Content
                if (content) {
                    if (isCollapsed) content.classList.add('expanded');
                    else content.classList.remove('expanded');
                }

                // Rotate Icon
                if (icon) {
                    icon.style.transform = isCollapsed ? 'rotate(180deg)' : 'rotate(0deg)';
                }
            }
        };

        // Initialize Desktop State
        document.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth > 768) {
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                const sidebar = document.getElementById('main-sidebar');
                const content = document.querySelector('.content-main');
                const icon = document.getElementById('collapse-icon');

                if (isCollapsed && sidebar) {
                    sidebar.classList.add('collapsed');
                    if (content) content.classList.add('expanded');
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }
            }
        });

        // MOBILE SIDEBAR TOGGLE
        window.toggleMobileSidebar = function () {
            const sidebar = document.getElementById('main-sidebar');
            const overlay = document.getElementById('mobile-overlay');
            // const iconMenu = document.getElementById('icon-menu-mobile');
            // const iconClose = document.getElementById('icon-close-mobile');

            if (sidebar && overlay) {
                sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('active');

                // Logic:
                // 1. Open -> Hide Page Logo & Hamburger Button (Sidebar takes over)
                // 2. Close -> Show Page Logo & Hamburger Button

                const isOpen = sidebar.classList.contains('mobile-open');
                const pageLogo = document.getElementById('mobile-logo-container');
                const hamburgerBtn = document.getElementById('mobile-menu-btn');

                if (isOpen) {
                    if (pageLogo) pageLogo.classList.add('opacity-0');
                    if (hamburgerBtn) hamburgerBtn.classList.add('opacity-0', 'pointer-events-none');
                    // FORCE EXPANDED STATE ON MOBILE
                    sidebar.classList.remove('collapsed');
                } else {
                    if (pageLogo) pageLogo.classList.remove('opacity-0');
                    if (hamburgerBtn) hamburgerBtn.classList.remove('opacity-0', 'pointer-events-none');
                }
            } else {
                console.error("Sidebar or Overlay not found for mobile toggle");
            }
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --plus-indigo: #6366f1;
            --plus-indigo-glow: rgba(99, 102, 241, 0.15);
            --plus-cyan: #22d3ee;
            --plus-bg: #f8fafc;
            --plus-card: #ffffff;
            --plus-border: rgba(99, 102, 241, 0.1);
            --plus-text: #0f172a;
            --plus-text-muted: #64748b;
        }



        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--plus-bg);
            /* Education Icon Pattern Background */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%236366f1' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: var(--plus-text);
            line-height: 1.5;
            font-size: 13px;
            transition: background 0.3s ease;
            overflow-y: scroll;
            /* Force scrollbar */
        }

        /* Global Premium Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
            border: 2px solid var(--plus-bg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #334155;
            border-color: #0f172a;
        }

        .v-card {
            background-color: var(--plus-card);
            border: 1px solid var(--plus-border);
            border-radius: 20px;
            box-shadow: 0 4px 20px -2px rgba(99, 102, 241, 0.05);
            /* Colored Premium Shadow */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .v-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -5px var(--plus-indigo-glow);
            border-color: var(--plus-indigo);
        }

        .sidebar {
            width: 260px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background-color: rgba(255, 255, 255, 0.85);
            /* Glassmorphism Base */
            backdrop-filter: blur(20px);
            /* Frosted Effect */
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(226, 232, 240, 0.6);
            z-index: 1000;
            padding: 24px 12px;
            overflow: visible !important;
            transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            /* Bouncy Spring Effect */
            will-change: width;
        }

        /* Core Utilities */

        /* Mobile Nav Active State (Strict Override) */
        .mobile-nav-btn .active-line,
        .mobile-nav-btn .active-light {
            display: none;
        }

        .mobile-nav-btn.active .active-line {
            display: block;
        }

        /* Design A Glow Effect */
        .mobile-nav-btn.active .active-light {
            display: block;
            background: linear-gradient(to bottom, rgba(26, 115, 232, 0.15) 0%, rgba(26, 115, 232, 0) 100%);
        }

        .mobile-nav-btn.active i,
        .mobile-nav-btn.active svg {
            color: #1a73e8 !important;
            stroke: #1a73e8 !important;
            fill: none !important;
            /* Transparent inside */
            transform: translateY(-2px);
            /* Slight bump up */
        }

        .mobile-nav-btn.active span {
            color: #1a73e8 !important;
            font-weight: 700;
        }

        /* Dark Mode overrides */
        .dark .mobile-nav-btn.active i {
            color: #6366f1;
        }

        /* Indigo-500 */
        .dark .mobile-nav-btn.active span {
            color: #6366f1;
        }

        /* .hidden override removed to allow responsive modifiers */


        /* New Logout Button (Compact) */
        .Btn {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition-duration: .3s;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.199);
            background-color: rgb(255, 65, 65);
        }

        /* plus sign */
        .sign {
            width: 100%;
            transition-duration: .3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sign svg {
            width: 14px;
        }

        .sign svg path {
            fill: white;
        }

        /* text */
        .text {
            position: absolute;
            right: 0%;
            width: 0%;
            opacity: 0;
            color: white;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition-duration: .3s;
        }

        /* hover effect on button width */
        .Btn:hover {
            width: 90px;
            border-radius: 40px;
            transition-duration: .3s;
        }

        /* OVERRIDE: Prevent expansion in Collapsed Mode */
        .sidebar.collapsed .Btn:hover {
            width: 32px !important;
            border-radius: 50% !important;
        }

        .Btn:hover .sign {
            width: 30%;
            transition-duration: .3s;
            padding-left: 15px;
        }

        /* OVERRIDE: Keep sign centered in Collapsed Mode */
        .sidebar.collapsed .Btn:hover .sign {
            width: 100% !important;
            padding-left: 0 !important;
        }

        /* hover effect button's text */
        .Btn:hover .text {
            opacity: 1;
            width: 70%;
            transition-duration: .3s;
            padding-right: 10px;
        }

        /* OVERRIDE: Keep text hidden in Collapsed Mode */
        .sidebar.collapsed .Btn:hover .text {
            opacity: 0 !important;
            width: 0% !important;
            padding-right: 0 !important;
        }

        /* button click effect*/
        .Btn:active {
            transform: translate(2px, 2px);
        }

        /* Desktop Sidebar Base */
        .sidebar {
            width: 280px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Mobile Responsive Sidebar */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 260px !important;
                /* Always full width when open on mobile */
                z-index: 9999;
                box-shadow: 10px 0 25px rgba(0, 0, 0, 0.2);

                /* FORCE SOLID BACKGROUND for Mobile */
                background: #ffffff !important;
                background-image: none !important;
                background-color: #ffffff !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }

            /* Dark Mode Override */
            html.dark .sidebar,
            .dark .sidebar {
                background: #1e293b !important;
                background-image: none !important;
                background-color: #1e293b !important;
            }

            .sidebar.mobile-open {
                transform: translateX(0) !important;
            }

            /* Ensure text contrast on mobile */
            .sidebar .nav-item span,
            .sidebar h1,
            .sidebar p {
                color: #0f172a;
                /* Slate-900 */
            }

            .dark .sidebar .nav-item span,
            .dark .sidebar h1,
            .dark .sidebar p {
                color: #f1f5f9;
                /* Slate-100 */
            }

            /* FORCE VISIBILITY OF CONTENT ON MOBILE regardless of collapsed state */
            .sidebar.collapsed .hide-on-collapse,
            .sidebar.collapsed span:not(.badge),
            .sidebar.collapsed h1,
            .sidebar.collapsed p,
            .sidebar.collapsed .text-\[9px\] {
                opacity: 1 !important;
                visibility: visible !important;
                width: auto !important;
                height: auto !important;
                margin: 0 !important;
                /* Adjust if needed */
                padding: 0 !important;
                position: static !important;
                overflow: visible !important;
            }

            /* Un-center the logo on mobile if it was centered by collapsed rules */
            .sidebar.collapsed .mb-8 {
                justify-content: flex-start !important;
            }

            .sidebar.collapsed .logo-container {
                margin: 0 !important;
            }

            /* Reset Nav Item Styling on Mobile */
            .sidebar.collapsed .nav-item {
                width: 100% !important;
                justify-content: flex-start !important;
                padding: 12px !important;
                margin-bottom: 4px !important;
            }

            .sidebar.collapsed .nav-item i {
                margin-right: 12px !important;
            }

            /* Overlay backdrop for mobile (Invisible but clickable) */
            #mobile-overlay {
                display: none;
                position: fixed;
                inset: 0;
                background: transparent;
                /* No dark tint */
                backdrop-filter: none;
                /* No blur */
                z-index: 9000;
                pointer-events: none !important;
                /* Allow clicks to pass through to the specific high-z-index button */
            }

            #mobile-overlay.active {
                display: block;
            }

            /* Mobile Header Container (as per instruction) */
            .md\:hidden {
                position: relative;
                z-index: 9050;
            }

            /* Content takes full width on mobile */
            .content-main,
            .content-main.expanded {
                margin-left: 0 !important;
                width: 100% !important;
                padding: 16px !important;
            }

            /* Hide the desktop toggle pill on mobile */
            #main-sidebar>button.absolute {
                display: none !important;
            }
        }

        /* Minimal Collapsed State */
        .sidebar.collapsed {
            width: 80px;
            padding: 24px 12px;
            align-items: center;
        }

        /* Logo Centering */
        /* Logo Centering */
        .sidebar.collapsed .mb-8 {
            margin-bottom: 32px;
            justify-content: center;
            width: 100%;
            padding-left: 0;
            /* Removing padding to center correctly */
        }


        /* Hide Logo Text container specifically */


        .sidebar.collapsed .logo-container {
            margin: 0 auto;
        }

        .sidebar.collapsed .nav-item {
            justify-content: center;
            width: 44px;
            height: 44px;
            padding: 0;
            margin: 0 auto 8px auto;
            /* Center with auto margins */
            border-radius: 12px;
        }

        .sidebar.collapsed .nav-item i {
            margin-right: 0;
            width: 22px;
            height: 22px;
        }

        /* Clean Active State for Collapsed */
        .sidebar.collapsed .nav-item.active {
            background: var(--plus-indigo) !important;
            color: white !important;
            box-shadow: 0 4px 12px var(--plus-indigo-glow);
        }

        /* Remove the side-bar indicator from previous step */
        .sidebar.collapsed .nav-item.active::before {
            display: none;
        }

        /* Tooltip style remains */
        .sidebar.collapsed .nav-item:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: #0f172a;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            z-index: 5000;
            pointer-events: none;
            opacity: 0;
            animation: fadeIn 0.2s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* STRICTLY Hide all text in collapsed mode */
        .hide-on-collapse,
        .sidebar span:not(.badge),
        .sidebar h1,
        .sidebar p,
        .sidebar .text-\[9px\] {
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        .sidebar.collapsed .hide-on-collapse,
        .sidebar.collapsed span:not(.badge),
        .sidebar.collapsed h1,
        .sidebar.collapsed p,
        .sidebar.collapsed .text-\[9px\] {
            opacity: 0 !important;
            visibility: hidden !important;
            width: 0 !important;
            height: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            /* Remove from flow completely */
        }

        .sidebar.collapsed #profile-card-container {
            padding: 0;
            border: none;
            width: 100%;
            margin-top: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Vertical alignment */
            flex-direction: column;
            /* Stack avatar and logout */
            gap: 16px;
            /* Space between avatar and logout */
        }

        /* Show specialized logout button only in collapsed mode */
        .sidebar.collapsed #collapsed-logout-btn-new {
            display: flex !important;
        }

        /* Resize Avatar in Collapsed Mode */
        .sidebar.collapsed #sidebar-mini-avatar {
            width: 40px !important;
            height: 40px !important;
            font-size: 14px !important;
            border-width: 2px !important;
        }

        .sidebar.collapsed #sidebar-overlay-status {
            /* The green dot */
            width: 10px;
            height: 10px;
            bottom: 0;
            right: 0;
        }

        .dark .sidebar {
            background-color: rgba(15, 23, 42, 0.85);
            /* Dark Mode Glass */
            border-right: 1px solid rgba(30, 41, 59, 0.6);
        }

        .content-main {
            margin-left: 260px;
            padding: 24px;
            min-height: 100vh;
            background-color: var(--plus-bg);
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: margin-left 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            /* Smooth Transition */
        }

        .content-main.expanded {
            margin-left: 80px;
        }

        .content-main {
            transition: margin-left 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .content-wrapper {
            width: 100%;
            max-width: 1400px;
            /* Wider container for better screen usage */
            margin: 0 auto;
            padding: 0 16px;
            /* Added padding to prevent content from touching edges on mobile */
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 6px;
            border-radius: 12px;
            font-weight: 700;
            color: var(--plus-text-muted);
            font-size: 0.8rem;
            letter-spacing: 0.02em;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: rgba(99, 102, 241, 0.08);
            color: var(--plus-indigo);
            transform: translateX(4px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--plus-indigo) 0%, #4f46e5 100%);
            color: #ffffff !important;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .btn-command {
            background: linear-gradient(135deg, var(--plus-indigo) 0%, #4338ca 100%);
            color: white;
            padding: 14px 28px;
            border-radius: 18px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-size: 0.7rem;
            box-shadow: 0 10px 15px -3px var(--plus-indigo-glow);
            transition: all 0.3s ease;
        }

        .btn-command:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px var(--plus-indigo-glow);
            filter: brightness(1.1);
        }

        .glow-border {
            position: relative;
        }

        .glow-border::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(45deg, var(--plus-indigo), transparent, var(--plus-cyan));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .glow-border:hover::after {
            opacity: 1;
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
                box-shadow: 20px 0 50px rgba(0, 0, 0, 0.1);
            }

            .content-main {
                margin-left: 0;
                padding: 16px;
                /* Reduced mobile padding */
            }
        }

        .chat-bubble {
            box-shadow: 0 4px 15px -3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .chat-bubble:hover {
            transform: scale(1.01);
        }

        .online-indicator {
            position: relative;
        }

        .online-indicator::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid var(--plus-card);
            bottom: 0;
            right: 0;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            /* Firefox */
            scrollbar-color: rgba(99, 102, 241, 0.2) transparent;
            /* Firefox */
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.2);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--plus-indigo);
        }

        /* Tabs Styling from Uiverse.io by Pradeepsaranbishnoi */
        .task-tabs-container {
            display: inline-flex;
            position: relative;
            background-color: #fff;
            box-shadow: 0 0 1px 0 rgba(24, 94, 224, 0.15), 0 6px 12px 0 rgba(24, 94, 224, 0.15);
            padding: 0.75rem;
            border-radius: 99px;
            margin: 0 auto;
            /* Center horizontally */
            width: fit-content;
        }

        .task-tabs-container * {
            z-index: 2;
        }

        input[type="radio"] {
            display: none;
        }

        .tab {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 30px;
            width: auto;
            min-width: 80px;
            padding: 0 1rem;
            font-size: .8rem;
            color: black;
            font-weight: 500;
            border-radius: 99px;
            cursor: pointer;
            transition: color 0.15s ease-in;
            position: relative;
        }

        .dark .tabs {
            background-color: #0f172a;
            /* Slate 900 */
            box-shadow: 0 0 1px 0 rgba(255, 255, 255, 0.1), 0 6px 12px 0 rgba(0, 0, 0, 0.3);
        }

        .dark .tab {
            color: #94a3b8;
            /* Slate 400 */
        }

        .notification {
            display: flex;
            align-items: center;
            justify-content: center;
            width: .8rem;
            height: .8rem;
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 9px;
            border-radius: 50%;
            background-color: #e6eef9;
            color: #185ee0;
            transition: 0.15s ease-in;
        }

        .dark .notification {
            background-color: #1e293b;
            color: #60a5fa;
        }

        input[type="radio"]:checked+label {
            color: #185ee0;
        }

        .dark input[type="radio"]:checked+label {
            color: #38bdf8;
            /* Sky 400 */
        }

        input[type="radio"]:checked+label>.notification {
            background-color: #185ee0;
            color: #fff;
        }

        .dark input[type="radio"]:checked+label>.notification {
            background-color: #38bdf8;
            color: #000;
        }

        /* Glider specific positioning for 4 items */
        .glider {
            position: absolute;
            display: flex;
            height: 30px;
            background-color: #e6eef9;
            z-index: 1;
            border-radius: 99px;
            transition: 0.25s ease-out;
            left: 0.75rem;
            /* Initial padding */
        }

        .dark .glider {
            background-color: #1e293b;
        }

        /* Dynamic Glider Calculation based on nth-of-type is tricky with variable widths. 
           We will use JS to move the glider for perfect fit, or fixed widths if simple. 
           For this specific request, I will simplify to use the CSS sibling selector assuming fixed widths 
           or just rely on the background highlighting the text as per design mostly.
           
           Actually, the requested CSS relies on fixed widths/transforms. 
           I will adapt it to work with 4 items: All, Pending, Completed, Expired.
        */

        input[id="radio-1"]:checked~.glider {
            transform: translateX(0);
            width: 80px;
        }

        input[id="radio-2"]:checked~.glider {
            transform: translateX(100%);
            width: 100px;
        }

        /* Adjust these based on content */
        /* To make this robust, I'll use a simpler background-active class approach for the specific active tab logic or inline styles via JS if needed. 
           But let's stick close to the requested CSS style. */

        /* Re-engineering slightly for robustness: */
        .tabs {
            gap: 4px;
        }

        .tab {
            min-width: unset;
            padding: 6px 16px;
            width: auto;
        }

        .glider {
            display: none;
        }

        /* Using active state classes instead for cleaner integration */

        input[type="radio"]:checked+label {
            background-color: #e6eef9;
            color: #185ee0;
        }

        .dark input[type="radio"]:checked+label {
            background-color: #1e293b;
            color: #38bdf8;
        }



        .filter-btn:hover:not(.active) {
            opacity: 0.8;
            background: rgba(99, 102, 241, 0.1);
        }

        /* MOBILE IMPROVEMENTS */
        #sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 900;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        #sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile Responsive Tweaks */
        @media (max-width: 640px) {
            h3 {
                font-size: 1.1rem !important;
            }

            .v-card {
                box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.05);
                /* Lighter shadow on mobile */
            }
        }

        /* Loader CSS from Uiverse.io by Nawsome */
        .loader {
            --background: linear-gradient(135deg, #23C4F8, #275EFE);
            --shadow: rgba(39, 94, 254, 0.28);
            --text: #6C7486;
            --page: rgba(255, 255, 255, 0.36);
            --page-fold: rgba(255, 255, 255, 0.52);
            --duration: 3s;
            width: 200px;
            height: 140px;
            position: relative;
        }

        @media (max-width: 640px) {
            .loader {
                transform: scale(0.75);
            }

            /* Add padding to body to prevent content from being hidden behind bottom nav */
            body {
                padding-bottom: 80px;
            }
        }

        /* Mobile Nav Animations managed via Tailwind group modifiers now */

        .dark .loader {
            --text: #94a3b8;
        }

        .loader:before,
        .loader:after {
            --r: -6deg;
            content: "";
            position: absolute;
            bottom: 8px;
            width: 120px;
            top: 80%;
            box-shadow: 0 16px 12px var(--shadow);
            transform: rotate(var(--r));
        }

        .loader:before {
            left: 4px;
        }

        .loader:after {
            --r: 6deg;
            right: 4px;
        }

        .loader div {
            width: 100%;
            height: 100%;
            border-radius: 13px;
            position: relative;
            z-index: 1;
            perspective: 600px;
            box-shadow: 0 4px 6px var(--shadow);
            background-image: var(--background);
        }

        .loader div ul {
            margin: 0;
            padding: 0;
            list-style: none;
            position: relative;
        }

        .loader div ul li {
            --r: 180deg;
            --o: 0;
            --c: var(--page);
            position: absolute;
            top: 10px;
            left: 10px;
            transform-origin: 100% 50%;
            color: var(--c);
            opacity: var(--o);
            transform: rotateY(var(--r));
            -webkit-animation: var(--duration) ease infinite;
            animation: var(--duration) ease infinite;
        }

        .loader div ul li:nth-child(2) {
            --c: var(--page-fold);
            -webkit-animation-name: page-2;
            animation-name: page-2;
        }

        .loader div ul li:nth-child(3) {
            --c: var(--page-fold);
            -webkit-animation-name: page-3;
            animation-name: page-3;
        }

        .loader div ul li:nth-child(4) {
            --c: var(--page-fold);
            -webkit-animation-name: page-4;
            animation-name: page-4;
        }

        .loader div ul li:nth-child(5) {
            --c: var(--page-fold);
            -webkit-animation-name: page-5;
            animation-name: page-5;
        }

        .loader div ul li svg {
            width: 90px;
            height: 120px;
            display: block;
        }

        .loader div ul li:first-child {
            --r: 0deg;
            --o: 1;
        }

        .loader div ul li:last-child {
            --o: 1;
        }

        .loader span {
            display: block;
            left: 0;
            right: 0;
            top: 100%;
            margin-top: 20px;
            text-align: center;
            color: var(--text);
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        @keyframes page-2 {
            0% {
                transform: rotateY(180deg);
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            35%,
            100% {
                opacity: 0;
            }

            50%,
            100% {
                transform: rotateY(0deg);
            }
        }

        @keyframes page-3 {
            15% {
                transform: rotateY(180deg);
                opacity: 0;
            }

            35% {
                opacity: 1;
            }

            50%,
            100% {
                opacity: 0;
            }

            65%,
            100% {
                transform: rotateY(0deg);
            }
        }

        @keyframes page-4 {
            30% {
                transform: rotateY(180deg);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            65%,
            100% {
                opacity: 0;
            }

            80%,
            100% {
                transform: rotateY(0deg);
            }
        }

        @keyframes page-5 {
            45% {
                transform: rotateY(180deg);
                opacity: 0;
            }

            65% {
                opacity: 1;
            }

            80%,
            100% {
                opacity: 0;
            }

            95%,
            100% {
                transform: rotateY(0deg);
            }
        }

        /* --- MOBILE RESPONSIVENESS SUITE --- */

        /* Smooth Sidebar with Backdrop Blur */
        .sidebar {
            overflow-y: auto;
            scrollbar-width: none;
            /* Firefox */
        }

        .sidebar::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
                /* Slightly wider for better mobile usability */
                z-index: 2000;
            }

            #sidebar-overlay {
                z-index: 1999;
            }

            .content-main {
                padding-top: 80px;
                /* Space for sticky header */
            }

            header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 100;
                background: rgba(248, 250, 252, 0.8);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid var(--plus-border);
                padding: 12px 16px;
                margin-bottom: 0 !important;
            }

            .dark header {
                background: rgba(11, 17, 32, 0.8);
            }
        }

        /* Task Tabs Horizontal Scroll */
        @media (max-width: 640px) {
            .task-tabs-container {
                width: 100%;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 0.5rem;
                display: flex;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                border-radius: 12px;
            }

            .task-tabs-container::-webkit-scrollbar {
                display: none;
            }

            .task-tabs-container .tab {
                flex-shrink: 0;
                min-width: unset;
                padding: 4px 12px;
            }

            /* Stack greeting banner */
            #view-dashboard .flex-col.md\:flex-row {
                text-align: center;
                align-items: center;
            }

            #view-dashboard .text-right {
                text-align: center;
            }

            /* Table Optimization */
            .overflow-x-auto table {
                min-width: 600px;
                /* Force scroll instead of squish */
            }

            /* Stats Grid optimization */
            .grid-cols-1.sm\:grid-cols-2 {
                grid-template-columns: 1fr;
            }

            /* Improved Modal for Mobile */
            .modal-dialog {
                margin: 1rem;
                display: flex;
                align-items: flex-end;
                /* Bottom sheet style on mobile */
                min-height: calc(100% - 2rem);
            }

            @media (min-width: 576px) {
                .modal-dialog {
                    align-items: center;
                    margin: 1.75rem auto;
                }
            }

            .modal-content {
                border-radius: 2rem 2rem 0 0;
                /* Rounded top corners for bottom sheet */
            }

            @media (min-width: 576px) {
                .modal-content {
                    border-radius: 2rem;
                }
            }

            .modal-body {
                padding: 1.5rem !important;
            }

            .modal-header {
                padding: 1.5rem 1.5rem 0.5rem !important;
            }
        }

        /* Mobile Bottom Nav Bar */
        .mobile-bottom-nav {
            display: none;
        }

        @media (max-width: 1024px) {
            .mobile-bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 70px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid var(--plus-border);
                display: flex;
                justify-content: space-around;
                align-items: center;
                z-index: 40;
                padding-bottom: env(safe-area-inset-bottom);
                box-shadow: 0 -10px 25px -5px rgba(0, 0, 0, 0.05);
            }

            .dark .mobile-bottom-nav {
                background: rgba(11, 17, 32, 0.95);
                border-top-color: rgba(255, 255, 255, 0.05);
            }

            .mobile-nav-btn {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 4px;
                color: var(--plus-text-muted);
                transition: all 0.2s ease;
            }

            .mobile-nav-btn i {
                width: 20px;
                height: 20px;
                transition: transform 0.2s ease;
            }

            .mobile-nav-btn span {
                font-size: 8px;
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            .mobile-nav-btn.active {
                color: var(--plus-indigo);
            }

            .mobile-nav-btn.active i {
                transform: translateY(-2px);
                fill: currentColor;
            }

            .content-main {
                padding-bottom: 90px;
                /* Space for bottom nav */
            }
        }

        /* Adjustments for ultra-small screens */
        @media (max-width: 380px) {
            #page-title {
                font-size: 1.25rem !important;
            }

            #header-user-name {
                display: none;
            }

            .header-info-text {
                display: none;
            }
        }

        /* Card Pulse Animation for highlight */
        @keyframes pulse-border {
            0% {
                border-color: var(--plus-border);
            }

            50% {
                border-color: var(--plus-indigo);
            }

            100% {
                border-color: var(--plus-border);
            }
        }

        .highlight-card {
            animation: pulse-border 2s infinite;
        }
    </style>

    <style>
        /* ===== LIVE EDITOR WIDTH FIX ===== */
        .content-view {
            width: 100% !important;
            height: 100% !important;
        }
    </style>


    <style>
        /* ===== HARD FIX: FORCE CONTENT VISIBILITY ===== */
        .content-main {
            align-items: stretch !important;
        }

        .content-view {

            width: 100% !important;
            min-height: 400px !important;
        }
    </style>


    <style>
        /* ===== SAFE SPA VIEW FIX ===== */
        .content-view {
            width: 100%;
        }

        /* FORCE MOBILE OVERRIDES AT THE END TO WIN SPECIFICITY WARS */
        /* FORCE MOBILE OVERRIDES AT THE END TO WIN SPECIFICITY WARS */
        @media (max-width: 768px) {
            #main-sidebar {
                width: 260px !important;
                /* Default expanded width */
                transform: translateX(-100%);
                /* Default closed position */
                transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
                z-index: 9999;
            }

            /* When Mobile Menu is Open: Show Sidebar */
            #main-sidebar.mobile-open {
                transform: translateX(0) !important;
            }

            /* SUPPORT COLLAPSED STATE ON MOBILE */
            #main-sidebar.collapsed {
                width: 80px !important;
            }

            /* If Collapsed, we MUST hide text again. We revert the previous forced visibility rules. */
            /* Standard .hide-on-collapse rules will apply normally because we removed the overrides. */

            /* Fix nav items alignment when collapsed */
            #main-sidebar.collapsed .nav-item {
                justify-content: center !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
            }

            /* Ensure close button (X) is visible but adapts */
            /* We need to ensure the header layout supports 80px width */
            /* Header Layout Fix for Collapsed Mobile State */
            /* Header Layout Fix for Collapsed Mobile State */
            /* Header Layout Fix for Collapsed Mobile State: Vertical Stack */
            #main-sidebar.collapsed .px-2.mb-8 {
                position: relative;
                height: auto !important;
                display: flex !important;
                flex-direction: column-reverse !important;
                /* Button Top, Logo Bottom */
                align-items: center !important;
                justify-content: flex-end !important;
                gap: 12px !important;
                /* Space between X and Logo */
                margin-top: 10px !important;
                margin-bottom: 30px !important;
            }

            /* Logo Wrapper (Bottom) */
            #main-sidebar.collapsed .px-2.mb-8>div:first-child {
                opacity: 1 !important;
                width: 100% !important;
                justify-content: center !important;
            }

            /* Ensure text is hidden */
            #main-sidebar.collapsed .px-2.mb-8>div:first-child .hide-on-collapse {
                display: none !important;
            }

            /* X Button (Top) */
            #main-sidebar.collapsed .px-2.mb-8>button {
                position: static !important;
                transform: none !important;
                right: auto;
                top: auto;
                background-color: transparent !important;
                box-shadow: none !important;
                padding: 4px;
                /* Make icon red/prominent if desired, or keep default */
            }

            /* Dark mode text/icon colors are inherited */

            /* Dark mode adjustment for button bg */
            .dark #main-sidebar.collapsed .px-2.mb-8>button {
                background-color: rgba(30, 41, 59, 0.8);
            }

            /* SMART TOGGLE VISIBILITY ON MOBILE */
            /* 1. Default: Hide the toggle button on mobile (so it doesn't float when closed) */
            #desktop-toggle-btn {
                display: none !important;
            }

            /* 2. When Sidebar is OPEN: Show it (to allow collapsing) */
            #main-sidebar.mobile-open #desktop-toggle-btn {
                display: flex !important;
            }
        }
    </style>



</head>

<body class="bg-slate-50 dark:bg-[#0b1120] text-slate-950 dark:text-slate-100 font-sans">

    <!-- GLOBAL LOADER -->
    <div id="global-loader" class="fixed inset-0 bg-white dark:bg-[#0b1120] z-[9999] flex items-center justify-center">
        <div class="loader">
            <div>
                <ul>
                    <li>
                        <svg fill="currentColor" viewBox="0 0 90 120">
                            <path
                                d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                            </path>
                        </svg>
                    </li>
                    <li>
                        <svg fill="currentColor" viewBox="0 0 90 120">
                            <path
                                d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                            </path>
                        </svg>
                    </li>
                    <li>
                        <svg fill="currentColor" viewBox="0 0 90 120">
                            <path
                                d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                            </path>
                        </svg>
                    </li>
                    <li>
                        <svg fill="currentColor" viewBox="0 0 90 120">
                            <path
                                d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                            </path>
                        </svg>
                    </li>
                </ul>
            </div>
            <span>Loading</span>
        </div>
    </div>



    <!-- LOGOUT LOADER (Professional Overlay) -->
    <div id="logout-loader"
        class="hidden fixed inset-0 z-[10000] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#1e293b] p-8 rounded-3xl shadow-2xl border border-slate-100 dark:border-slate-800 flex flex-col items-center animate-in zoom-in duration-300">
            <!-- Sleek Spinner -->
            <div class="mb-6 relative">
                <div class="w-16 h-16 rounded-full border-4 border-slate-100 dark:border-slate-700"></div>
                <div
                    class="w-16 h-16 rounded-full border-4 border-indigo-500 border-t-transparent border-l-transparent absolute top-0 left-0 animate-spin">
                </div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i data-lucide="log-out" class="w-6 h-6 text-indigo-500"></i>
                </div>
            </div>

            <h4 class="text-lg font-black text-slate-900 dark:text-white uppercase tracking-tighter mb-1">Signing Out
            </h4>
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">Securely Clearing Session...</p>
        </div>
    </div>

    <!-- 1. AUTHENTICATION -->
    <div id="auth-wrapper"
        class="hidden min-h-screen flex items-center justify-center p-4 bg-slate-50 dark:bg-[#0b1120]">
        <div
            class="v-card w-full max-w-[380px] px-8 pb-8 pt-2 shadow-2xl bg-white dark:bg-[#1e293b] animate-in fade-in zoom-in duration-500">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-32 h-32 mt-0 -mb-10">
                    <img src="assets/bbsydp_logo.png" alt="BBSHRRDB Logo" class="w-full h-full object-contain">
                </div>
                <h1 class="font-black text-2xl tracking-tighter uppercase leading-none text-slate-800 dark:text-white">
                    BBSHRRDB <span class="text-indigo-500">LMS</span> <sup
                        class="text-[10px] text-indigo-500 bg-indigo-50 dark:bg-indigo-900/30 px-1.5 py-0.5 rounded-lg border border-indigo-100 dark:border-indigo-800 ml-1">v2.0</sup>
                </h1>
                <p class="text-slate-500 dark:text-slate-400 mt-2 font-bold uppercase tracking-widest text-[8px]">
                    Enterprise Learning Portal</p>

            </div>

            <div id="auth-tabs"
                class="flex p-1 bg-slate-100 dark:bg-[#0b1120] rounded-xl mb-6 border dark:border-slate-800">
                <button onclick="switchAuth('student')" id="tab-student"
                    class="flex-1 py-2.5 rounded-lg text-[9px] font-black uppercase tracking-widest transition-all bg-white dark:bg-[#1e293b] shadow-sm text-indigo-600 dark:text-indigo-400">Student</button>
                <button onclick="switchAuth('admin')" id="tab-admin"
                    class="flex-1 py-2.5 rounded-lg text-[9px] font-black uppercase tracking-widest transition-all text-slate-500">Admin</button>
            </div>

            <form id="auth-form" onsubmit="window.handleAuthSubmit(event)" class="space-y-4">
                <div id="auth-error"
                    class="hidden text-rose-500 text-[10px] font-bold uppercase tracking-[0.05em] text-center bg-rose-50 dark:bg-rose-950/30 p-3 rounded-lg border border-rose-100 dark:border-rose-900/40">
                </div>
                <div id="name-field" class="hidden space-y-1.5">
                    <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Full Name</label>
                    <input type="text" id="auth-name"
                        class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-[#0b1120] border border-slate-200 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-semibold text-sm text-slate-900 dark:text-slate-100"
                        placeholder="Enter your full name">
                </div>
                <!-- Profile Picture Upload (Optional) -->
                <div id="avatar-field" class="hidden space-y-1.5 animate-in fade-in slide-in-from-top-2">
                    <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Profile Picture
                        <span class="text-slate-300 font-bold opacity-50">(Optional)</span></label>
                    <div class="relative group">
                        <input type="file" id="auth-avatar" accept="image/*"
                            class="w-full text-xs font-bold text-slate-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-xl file:border-0 file:text-[10px] file:font-black file:uppercase file:tracking-widest file:bg-indigo-50 file:text-indigo-600 hover:file:bg-indigo-100 dark:file:bg-indigo-900/30 dark:file:text-indigo-400 cursor-pointer bg-slate-50 dark:bg-[#0b1120] rounded-xl border border-slate-200 dark:border-slate-800">
                    </div>
                </div>
                <div class="space-y-1.5">
                    <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Email
                        Address</label>
                    <input type="email" id="auth-email" required
                        class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-[#0b1120] border border-slate-200 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-semibold text-sm text-slate-900 dark:text-slate-100"
                        placeholder="name@example.com">
                </div>
                <div class="space-y-1.5">
                    <div class="flex justify-between items-center">
                        <label
                            class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Password</label>
                        <a href="#" onclick="handleForgotPassword(event)"
                            class="text-[8px] font-black uppercase tracking-widest text-indigo-600">Forgot?</a>
                    </div>
                    <div class="relative">
                        <input type="password" id="auth-pass" required
                            class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-[#0b1120] border border-slate-200 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-semibold text-sm text-slate-900 dark:text-slate-100 pr-12"
                            placeholder="********">
                        <button type="button" onclick="window.togglePasswordVisibility()"
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-indigo-600 transition-colors focus:outline-none">
                            <i id="icon-eye" data-lucide="eye" class="w-5 h-5"></i>
                            <i id="icon-eye-off" data-lucide="eye-off" class="w-5 h-5 hidden"></i>
                        </button>
                    </div>
                </div>

                <!-- Remember Me Removed -->

                <button type="submit" id="auth-btn"
                    class="w-full btn-command text-white py-3.5 rounded-xl transition-all flex items-center justify-center gap-2 mt-2">
                    <span>Sign In</span>
                    <i data-lucide="log-in" class="w-3.5 h-3.5"></i>
                </button>

                <p id="auth-footer"
                    class="text-center text-[9px] font-black uppercase tracking-widest text-slate-400 mt-6">
                    New here? <button onclick="customToggleMode()" class="text-indigo-500 hover:underline">Create
                        Account</button>
                </p>
            </form>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- 2. DASHBOARD LAYOUT -->
    <div id="dashboard-layout" class="hidden">

        <!-- Mobile Overlay Backdrop (Click to close disabled as requested) -->
        <div id="mobile-overlay"></div>

        <!-- Sidebar -->
        <aside id="main-sidebar"
            class="sidebar flex flex-col transition-all duration-300 bg-gradient-to-b from-white to-slate-50 dark:from-[#1e293b] dark:to-[#0f172a]">
            <!-- Modern Vertical Floating Toggle (Centered) -->
            <!-- Modern Vertical Floating Toggle (Centered) -->
            <!-- Modern Vertical Floating Toggle (Centered) -->
            <button onclick="window.toggleSidebarCollapse()" id="desktop-toggle-btn"
                class="absolute -right-3 top-1/2 -translate-y-1/2 z-[9999] flex items-center justify-center w-6 h-12 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-full shadow-lg text-slate-400 hover:text-indigo-500 hover:scale-110 transition-all cursor-pointer group hover:shadow-indigo-500/20 active:scale-95 duration-300">
                <i id="collapse-icon" data-lucide="chevron-left"
                    class="w-3 h-3 transition-transform duration-500 group-hover:scale-125"></i>
            </button>

            <!-- Header with Toggle -->
            <!-- Header with Toggle -->
            <div class="px-2 mb-8 flex items-center justify-between">
                <!-- Left: Logo & Text -->
                <!-- Left: Logo & Text -->
                <div class="flex items-center gap-3">
                    <div class="logo-container w-14 h-14 flex-shrink-0 flex items-center justify-center">
                        <img src="assets/bbsydp_logo.png" alt="BBSHRRDB Logo" class="w-full h-full object-contain">
                    </div>
                    <div
                        class="hide-on-collapse flex flex-col justify-center overflow-hidden transition-all duration-300">
                        <h1
                            class="font-black text-lg tracking-tighter uppercase leading-none flex items-center gap-1 text-slate-800 dark:text-white">
                            BBSHRRDB <span
                                class="text-[8px] bg-indigo-600 text-white px-1 py-0.5 rounded ml-1 align-top">v2.0</span>
                        </h1>
                        <p
                            class="text-[8px] font-bold tracking-[0.15em] text-indigo-500 uppercase mt-0.5 leading-tight">
                            Enterprise Portal
                        </p>
                    </div>
                </div>

                <!-- Right: Mobile Close Button (X) -->
                <button onclick="window.toggleMobileSidebar()"
                    class="md:hidden p-2 rounded-lg text-slate-400 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <nav class="flex-1 space-y-1">
                <div
                    class="text-[9px] font-black text-slate-400 uppercase tracking-widest px-4 mb-2 mt-2 hide-on-collapse">
                    Menu</div>

                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-item w-full active"
                    data-tooltip="Dashboard">
                    <i data-lucide="layout-grid" class="w-5 h-5"></i> <span class="hide-on-collapse">Dashboard</span>
                </button>
                <button onclick="switchTab('tasks')" id="nav-tasks" class="nav-item w-full" data-tooltip="My Tasks">
                    <i data-lucide="clipboard-list" class="w-5 h-5"></i> <span class="hide-on-collapse">My Tasks</span>
                </button>
                <button onclick="switchTab('resources')" id="nav-resources" class="nav-item w-full"
                    data-tooltip="Resources">
                    <i data-lucide="folder-open" class="w-5 h-5"></i> <span class="hide-on-collapse">Resources</span>
                </button>
                <button onclick="switchTab('leaderboard')" id="nav-leaderboard" class="nav-item w-full"
                    data-tooltip="Leaderboard">
                    <i data-lucide="trophy" class="w-5 h-5"></i> <span class="hide-on-collapse">Leaderboard</span>
                </button>
                <button onclick="switchTab('arcade')" id="nav-arcade" class="nav-item w-full" data-tooltip="Arcade">
                    <i data-lucide="gamepad-2" class="w-5 h-5"></i> <span class="hide-on-collapse">Play Arcade</span>
                </button>
                <button onclick="switchTab('exam')" id="nav-exam" class="nav-item w-full" data-tooltip="Online Test">
                    <i data-lucide="clipboard-check" class="w-5 h-5"></i> <span class="hide-on-collapse">Online
                        Test</span>
                </button>
                <button onclick="switchTab('playground')" id="nav-playground" class="nav-item w-full"
                    data-tooltip="Live Editor">
                    <i data-lucide="code-2" class="w-5 h-5"></i> <span class="hide-on-collapse">Live Editor</span>
                </button>



                <!-- Admin items -->
                <div id="admin-nav" class="hidden pt-6 mt-6 border-t border-slate-100 dark:border-slate-800">
                    <div
                        class="text-[9px] font-black text-slate-400 uppercase tracking-widest px-6 mb-2 hide-on-collapse">
                        Admin Panel
                    </div>
                    <button onclick="switchTab('grading')" class="nav-item w-full" data-tooltip="Grade Tasks">
                        <i data-lucide="award" class="w-5 h-5"></i> <span class="hide-on-collapse">Grade Tasks</span>
                    </button>
                    <button onclick="switchTab('users')" class="nav-item w-full" data-tooltip="Students">
                        <i data-lucide="users" class="w-5 h-5"></i> <span class="hide-on-collapse">Students</span>
                    </button>
                    <button onclick="switchTab('feedback')" class="nav-item w-full relative" data-tooltip="Feedback">
                        <i data-lucide="message-square" class="w-5 h-5"></i> <span
                            class="hide-on-collapse">Feedback</span>
                        <span id="feedback-notification"
                            class="hidden absolute top-2 right-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm animate-pulse">0</span>
                    </button>
                </div>
            </nav>

            <!-- Mobile Only Profile & Logout (Sidebar Bottom) -->
            <!-- Mobile Only Profile & Logout (Sidebar Bottom) -->
            <div
                class="mt-auto px-4 pb-6 pt-4 border-t border-slate-100 dark:border-slate-800 md:hidden animate-in fade-in slide-in-from-bottom-4 duration-500 mobile-profile-section">
                <style>
                    /* Custom Collapse Logic for Mobile Footer */
                    .sidebar.collapsed .hide-on-collapse {
                        display: none !important;
                    }

                    .sidebar.collapsed .mobile-profile-section {
                        padding-left: 0;
                        padding-right: 0;
                    }
                </style>
                <div class="flex flex-col items-center gap-4">
                    <!-- Profile Section -->
                    <div class="flex flex-col items-center gap-2 cursor-pointer group w-full"
                        onclick="switchTab('profile')">
                        <div class="relative">
                            <div
                                class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 text-white flex items-center justify-center font-black overflow-hidden border-2 border-white dark:border-slate-700 shadow-lg group-hover:scale-105 transition-transform">
                                <span class="mobile-avatar-initial text-sm">U</span>
                                <img id="mobile-sidebar-avatar" src="" class="w-full h-full object-cover hidden">
                            </div>
                            <div
                                class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-500 border-2 border-white dark:border-[#0b1120] rounded-full">
                            </div>
                        </div>

                        <!-- Text Info: Hidden when Collapsed -->
                        <div class="text-center hide-on-collapse min-w-0 w-full transition-all duration-300 origin-top">
                            <h4
                                class="text-xs font-black text-slate-900 dark:text-slate-200 leading-tight mobile-user-name truncate group-hover:text-indigo-500 transition-colors">
                                User</h4>
                            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-0.5 truncate">
                                Account Settings</p>
                        </div>
                    </div>

                    <!-- Logout Button -->
                    <div class="shrink-0 pt-2">
                        <button onclick="handleLogout()" class="Btn" title="Logout">
                            <div class="sign"><svg viewBox="0 0 512 512">
                                    <path
                                        d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                    </path>
                                </svg></div>
                            <div class="text">Logout</div>
                        </button>
                    </div>
                </div>
            </div>

        </aside>

        <main class="content-main">
            <div class="content-wrapper">
                <!-- Mobile Header (Visible only on mobile) -->
                <!-- Mobile Header (Visible only on mobile) -->
                <div class="md:hidden flex items-center justify-start gap-4 mb-6 relative z-[9050]">
                    <!-- 1. Hamburger Button (Left) -->
                    <button id="mobile-menu-btn" onclick="window.toggleMobileSidebar?.()"
                        class="p-2 rounded-lg bg-white dark:bg-slate-800 shadow-sm border border-slate-100 dark:border-slate-700 text-slate-600 dark:text-slate-300 active:scale-95 transition-all duration-300"
                        style="z-index: 9001;">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>

                    <!-- 2. Logo Container (Right of Button) -->
                    <div id="mobile-logo-container" class="flex items-center gap-3 transition-opacity duration-300">
                        <img src="assets/bbsydp_logo.png" class="w-10 h-10 object-contain">
                        <span class="font-black text-slate-800 dark:text-white uppercase tracking-tighter">BBSHRRDB
                            v2.0</span>
                    </div>
                </div>

                <!-- v2.0 Welcome Banner -->
                <div id="v2-banner"
                    class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 rounded-2xl p-6 text-white mb-8 relative overflow-hidden shadow-xl shadow-indigo-500/20 group animate-in slide-in-from-top-4 duration-700">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                        <i data-lucide="sparkles" class="w-32 h-32"></i>
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-2">
                            <span
                                class="px-2 py-1 rounded-lg bg-white/20 backdrop-blur-md text-[9px] font-black uppercase tracking-widest border border-white/10">New
                                Update</span>
                            <span class="text-[10px] font-bold text-indigo-100 uppercase tracking-wide">Introducing
                                v2.0</span>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-black tracking-tight mb-2">Welcome to the Future of
                            Learning</h2>
                        <p class="text-indigo-100 text-sm font-medium max-w-xl mb-6">Experience the all-new Enterprise
                            Portal with enhanced performance, gamified learning, and a premium interface designed for
                            your success.</p>

                        <div class="flex items-center gap-3">
                            <button onclick="$('#v2-banner').slideUp()"
                                class="px-5 py-2.5 bg-white text-indigo-600 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-indigo-50 transition-colors shadow-lg shadow-black/5">Dismiss</button>
                            <button onclick="switchTab('arcade')"
                                class="px-5 py-2.5 bg-indigo-500/30 text-white border border-white/20 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-white/10 transition-colors">Try
                                Arcade</button>

                        </div>
                    </div>
                </div>
                <!-- Top Navigation Bar -->
                <header class="flex justify-between items-center mb-6 gap-4 hidden md:flex">
                    <div class="flex items-center gap-4">
                        <!-- Toggle for Desktop Sidebar -->
                        <!-- Logo for Desktop -->
                        <div class="flex items-center gap-3">
                            <img src="assets/bbsydp_logo.png" alt="Logo" class="w-10 h-10 lg:hidden object-contain">
                            <div>
                                <h2 class="text-xl md:text-2xl font-black tracking-tighter uppercase leading-none"
                                    id="page-title">
                                    Dashboard</h2>
                                <div class="flex items-center gap-2 mt-1 font-bold hidden sm:flex">
                                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                                    <span
                                        class="text-[8px] text-slate-400 uppercase tracking-widest leading-none">System
                                        Online</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-2 sm:gap-4">
                        <!-- Quick Actions -->
                        <div class="flex items-center gap-2 sm:gap-4">
                            <!-- Quick Actions -->

                            <div class="h-8 w-px bg-slate-200 dark:bg-slate-800 hidden sm:block"></div>

                            <div class="relative">
                                <button id="admin-notif-btn" onclick="toggleNotifications(event)"
                                    class="hidden relative p-2.5 rounded-xl text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all group">
                                    <i data-lucide="bell"
                                        class="w-5 h-5 group-hover:text-indigo-500 transition-colors"></i>
                                    <span id="notif-badge"
                                        class="hidden absolute -top-1 -right-1 w-4 h-4 bg-rose-500 rounded-full border-2 border-white dark:border-[#0b1120] text-[8px] font-black text-white items-center justify-center"></span>
                                </button>
                                <!-- Notification Dropdown -->
                                <div id="notification-dropdown"
                                    class="hidden absolute right-0 top-12 w-80 bg-white dark:bg-[#1e293b] rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-800 z-[50] overflow-hidden animate-in fade-in zoom-in-95 duration-200 origin-top-right">
                                    <div
                                        class="p-4 border-b border-slate-100 dark:border-slate-800/50 flex justify-between items-center">
                                        <h4
                                            class="font-black text-xs uppercase tracking-tight text-slate-900 dark:text-slate-200">
                                            Notifications</h4>
                                        <button onclick="markAllRead()"
                                            class="text-[9px] font-bold text-indigo-500 hover:underline uppercase tracking-widest">Mark
                                            read</button>
                                    </div>
                                    <div id="notification-list"
                                        class="max-h-[300px] overflow-y-auto custom-scrollbar p-2 space-y-1">
                                        <!-- Notifications Injected Here -->
                                    </div>
                                    <div class="p-2 border-t border-slate-100 dark:border-slate-800/50 text-center">
                                        <button onclick="switchTab('grading'); toggleNotifications();"
                                            class="text-[9px] font-bold text-slate-400 hover:text-indigo-500 uppercase tracking-widest w-full py-2 transition-colors">View
                                            Pending Tasks</button>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Global Arcade Toggle (Admin Only) -->
                        <button id="arcade-toggle-btn"
                            class="hidden relative p-2.5 rounded-xl ml-2 transition-all group"
                            onclick="toggleGlobalArcadeAccess()" title="Toggle Student Arcade Access">
                            <i data-lucide="gamepad-2" class="w-5 h-5 transition-colors"></i>
                            <span class="absolute -top-1 -right-1 flex h-3 w-3">
                                <span
                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75 hidden"
                                    id="arcade-ping"></span>
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500 hidden"
                                    id="arcade-dot"></span>
                            </span>
                        </button>

                        <button onclick="openCreateTaskModal()" id="create-task-btn"
                            class="hidden btn-command px-4 py-2.5 rounded-xl ml-2 text-[10px] flex items-center gap-2">
                            <i data-lucide="plus-circle" class="w-3.5 h-3.5"></i> <span class="hidden sm:inline">Add
                                Task</span>
                        </button>

                        <!-- Profile & Logout Group -->
                        <div
                            class="flex items-center gap-3 pl-2 sm:pl-4 sm:border-l border-slate-200 dark:border-slate-800">
                            <!-- Profile Info & Avatar (Click to go to profile) -->
                            <div class="flex items-center gap-3 group cursor-pointer" onclick="switchTab('profile')">
                                <div class="text-right hidden sm:block">
                                    <p
                                        class="text-[8px] font-black uppercase text-slate-400 tracking-widest leading-none mb-1">
                                        Welcome Back</p>
                                    <h4 class="text-xs font-black text-slate-900 dark:text-slate-200 leading-none tracking-tight"
                                        id="header-user-name">User</h4>
                                </div>
                                <div class="relative">
                                    <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-black overflow-hidden border-2 border-white dark:border-slate-700 shadow-md ring-2 ring-transparent group-hover:ring-indigo-500/30 transition-all"
                                        id="header-avatar-container">
                                        <span id="header-initial">U</span>
                                    </div>
                                    <div
                                        class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-500 border-2 border-white dark:border-[#0b1120] rounded-full">
                                    </div>
                                </div>
                            </div>

                            <!-- UIverse Logout Button -->
                            <button onclick="handleLogout()" class="Btn ml-2" title="Logout">
                                <div class="sign"><svg viewBox="0 0 512 512">
                                        <path
                                            d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
                                        </path>
                                    </svg></div>
                                <div class="text">Logout</div>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- 1. Strategy Overview -->


                <!-- Chat View Removed -->

                <div id="view-dashboard" class="content-view animate-in fade-in duration-500">




                    <!-- Professional Greeting Banner -->

                    <div class="mb-8 relative overflow-hidden rounded-3xl shadow-2xl shadow-indigo-500/20 border border-white/10"
                        style="background-color: #4b44d4;">
                        <!-- Background Pattern -->
                        <div class="absolute inset-0 opacity-10"
                            style="background-image: radial-gradient(#6366f1 1px, transparent 1px); background-size: 20px 20px;">
                        </div>
                        <div
                            class="absolute -right-10 -top-10 w-64 h-64 bg-indigo-600 rounded-full blur-[100px] opacity-20">
                        </div>

                        <div
                            class="relative z-10 p-6 md:p-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                            <div>
                                <p class="text-[10px] font-black uppercase tracking-[0.2em] text-[#e5e7eb] mb-2">
                                    Workspace Dashboard</p>
                                <h2 class="text-2xl md:text-4xl font-black text-[#f9fafb] tracking-tighter leading-none"
                                    id="dynamic-greeting-text">
                                    Welcome Back
                                </h2>
                                <p class="text-xs text-[#e5e7eb] font-medium mt-2 max-w-md">Ready to build something
                                    amazing today? Check your pending tasks regarding Python & Web Development.</p>
                            </div>
                            <div class="text-center md:text-right w-full md:w-auto">
                                <h3 class="text-2xl md:text-3xl font-black text-[#f9fafb] tracking-tight"
                                    id="live-clock">
                                    00:00</h3>
                                <p class="text-[10px] font-bold uppercase tracking-widest text-[#e5e7eb]"
                                    id="live-date">...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden Legacy Alert (Logic Preserved) -->
                    <div id="student-alerts" class="hidden mb-6"></div>



                    <!-- NEW: Notice Board (Global) -->
                    <div id="announcement-section"
                        class="w-full mb-6 hidden animate-in slide-in-from-top-5 duration-500">
                        <!-- Ticker for High Priority -->
                        <div id="urgent-ticker"
                            class="w-full bg-rose-500 text-white text-xs font-bold uppercase tracking-widest py-2 px-4 rounded-xl mb-4 hidden shadow-lg shadow-rose-500/30 flex items-center gap-3 overflow-hidden">
                            <i data-lucide="megaphone" class="w-4 h-4 shrink-0 animate-pulse"></i>
                            <div class="overflow-hidden w-full">
                                <p id="ticker-text" class="whitespace-nowrap animate-marquee">IMPORTANT: System
                                    maintenance scheduled for tonight at 11 PM.</p>
                            </div>
                        </div>

                        <div class="v-card p-6 border-l-4 border-indigo-500 relative overflow-hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3
                                    class="text-lg font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200 flex items-center gap-2">
                                    <i data-lucide="bell" class="w-5 h-5 text-indigo-500"></i> Announcements
                                </h3>
                                <button onclick="refreshNotices()"
                                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 text-slate-400"></i>
                                </button>
                            </div>

                            <!-- Notices List -->
                            <div id="notice-list" class="space-y-3 max-h-48 overflow-y-auto custom-scrollbar pr-2">
                                <div class="text-center py-8 text-slate-400 text-xs font-bold uppercase tracking-wide">
                                    No new announcements.
                                </div>
                            </div>

                            <!-- Admin Post Button -->
                            <div id="admin-notice-actions"
                                class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-800 hidden">
                                <button onclick="openNoticeModal()"
                                    class="w-full py-2.5 bg-slate-100 dark:bg-slate-800 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 text-slate-500 hover:text-indigo-600 dark:text-slate-400 dark:hover:text-indigo-400 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all">
                                    + Post New Notice
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Live Widget -->
                    <div id="admin-live-widget" class="hidden w-full mb-6 animate-in slide-in-from-top-5">
                         <div class="v-card p-4 border-l-4 border-emerald-500 bg-emerald-50/50 dark:bg-emerald-900/10 flex items-center justify-between cursor-pointer hover:bg-emerald-100/50 transition-colors" onclick="showOnlineStudentsModal()">
                             <div class="flex items-center gap-4">
                                 <div class="relative">
                                     <span class="absolute top-0 right-0 w-3 h-3 bg-emerald-500 rounded-full animate-ping"></span>
                                     <div class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 flex items-center justify-center">
                                         <i data-lucide="users" class="w-5 h-5"></i>
                                     </div>
                                 </div>
                                 <div>
                                     <h4 class="text-sm font-black uppercase text-emerald-700 dark:text-emerald-400 tracking-wider">Live Activity</h4>
                                     <p class="text-xs font-bold text-emerald-600/80 dark:text-emerald-500/80"><span id="dashboard-online-count">0</span> Students Online Now</p>
                                 </div>
                             </div>
                             <div class="text-emerald-500">
                                 <i data-lucide="chevron-right" class="w-5 h-5"></i>
                             </div>
                         </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <!-- Stat 1: Pending Tasks (Gradient) -->
                        <div
                            class="v-card p-5 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300 border-0 shadow-lg bg-gradient-to-br from-indigo-500 to-indigo-600">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-8 -mt-8 blur-2xl group-hover:bg-white/20 transition-all">
                            </div>

                            <div class="relative z-10 flex flex-col h-full justify-between">
                                <div class="flex justify-between items-start mb-4">
                                    <div
                                        class="p-2.5 bg-white/20 rounded-xl backdrop-blur-sm text-white border border-white/10">
                                        <i data-lucide="target" class="w-5 h-5"></i>
                                    </div>
                                    <span
                                        class="text-[9px] font-black text-indigo-100 bg-indigo-500/40 px-2 py-1 rounded-lg uppercase tracking-widest">Active</span>
                                </div>
                                <div>
                                    <h3 class="text-3xl font-black text-white tracking-tighter mb-1" id="stat-active">0
                                    </h3>
                                    <p class="text-[9px] font-bold text-indigo-100 uppercase tracking-widest opacity-80"
                                        id="stat-label-1">Pending Tasks</p>
                                </div>
                            </div>
                        </div>

                        <!-- Stat 2: Completed Tasks (Gradient) -->
                        <div
                            class="v-card p-5 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300 border-0 shadow-lg bg-gradient-to-br from-emerald-500 to-emerald-600">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-8 -mt-8 blur-2xl group-hover:bg-white/20 transition-all">
                            </div>

                            <div class="relative z-10 flex flex-col h-full justify-between">
                                <div class="flex justify-between items-start mb-4">
                                    <div
                                        class="p-2.5 bg-white/20 rounded-xl backdrop-blur-sm text-white border border-white/10">
                                        <i data-lucide="shield-check" class="w-5 h-5"></i>
                                    </div>
                                    <span
                                        class="text-[9px] font-black text-emerald-100 bg-emerald-500/40 px-2 py-1 rounded-lg uppercase tracking-widest">Achieved</span>
                                </div>
                                <div>
                                    <h3 class="text-3xl font-black text-white tracking-tighter mb-1"
                                        id="stat-completed">0</h3>
                                    <p class="text-[9px] font-bold text-emerald-100 uppercase tracking-widest opacity-80"
                                        id="stat-label-2">Completed Tasks</p>
                                </div>
                            </div>
                        </div>
                        <!-- Stat 3: Avg Grade (Gradient) -->
                        <div
                            class="v-card p-5 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300 border-0 shadow-lg bg-gradient-to-br from-violet-500 to-purple-600 sm:col-span-2 lg:col-span-1">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-8 -mt-8 blur-2xl group-hover:bg-white/20 transition-all">
                            </div>

                            <div class="relative z-10 flex flex-col h-full justify-between">
                                <div class="flex justify-between items-start mb-4">
                                    <div
                                        class="p-2.5 bg-white/20 rounded-xl backdrop-blur-sm text-white border border-white/10">
                                        <i data-lucide="bar-chart-2" class="w-5 h-5"></i>
                                    </div>
                                    <span
                                        class="text-[9px] font-black text-violet-100 bg-violet-500/40 px-2 py-1 rounded-lg uppercase tracking-widest">Performance</span>
                                </div>
                                <div>
                                    <h3 class="text-3xl font-black text-white tracking-tighter mb-1" id="stat-score">0%
                                    </h3>
                                    <p class="text-[9px] font-bold text-violet-100 uppercase tracking-widest opacity-80"
                                        id="stat-label-3">Average Grade</p>
                                </div>
                            </div>
                        </div>
                        <!-- NEW GAMIFICATION STAT -->
                        <!-- NEW GAMIFICATION STAT (Gradient) -->
                        <div id="student-level-ui"
                            class="v-card p-5 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300 border-0 shadow-lg bg-gradient-to-br from-amber-400 to-orange-500 hidden sm:col-span-2 lg:col-span-1">

                            <div
                                class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-3xl group-hover:bg-white/20 transition-all">
                            </div>

                            <div class="relative z-10 flex flex-col h-full justify-between">
                                <div class="flex justify-between items-start mb-3">
                                    <div
                                        class="p-2.5 bg-white/20 rounded-xl backdrop-blur-sm text-white border border-white/10">
                                        <i data-lucide="crown" class="w-5 h-5"></i>
                                    </div>
                                    <span
                                        class="text-[9px] font-bold text-amber-900/60 uppercase tracking-wide">Rank</span>
                                </div>
                                <div>
                                    <h3 class="text-2xl font-black text-white tracking-tighter mb-2" id="rank-name">
                                        Rookie</h3>
                                    <div class="w-full h-1.5 bg-black/10 rounded-full overflow-hidden">
                                        <div id="xp-bar" class="h-full bg-white w-0 transition-all duration-1000"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> <!-- End of Stats Grid -->



                    <!-- DAILY QUESTS WIDGET (NEW) -->


                    <!-- Bottom Grid (Activities & Analytics) -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Recent Activity -->
                        <div class="v-card p-6 min-h-[300px] flex flex-col">
                            <div class="flex justify-between items-center mb-6">
                                <h3
                                    class="font-black text-xs uppercase tracking-tighter text-slate-900 dark:text-slate-200 flex items-center gap-2">
                                    <i data-lucide="activity" class="w-4 h-4 text-indigo-500"></i> Recent Activities
                                </h3>
                                <button onclick="switchTab('tasks')"
                                    class="text-[9px] font-black uppercase text-indigo-500 tracking-widest hover:underline">View
                                    All Tasks</button>
                            </div>
                            <div id="recent-activity-list" class="space-y-4 flex-1">
                                <!-- Activities injected here -->
                                <div
                                    class="text-center py-10 text-slate-400 text-[10px] font-bold uppercase tracking-widest">
                                    Loading activity history...
                                </div>
                            </div>
                        </div>

                        <!-- Performance Chart -->
                        <div class="v-card p-6 min-h-[300px] flex flex-col">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h3
                                        class="font-black text-xs uppercase tracking-tighter text-slate-900 dark:text-slate-200">
                                        Perf. Analytics</h3>
                                    <p class="text-[8px] font-bold text-slate-400 uppercase tracking-[0.2em] mt-1">Live
                                        Statistical Data</p>
                                </div>
                                <span
                                    class="px-2 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 text-[8px] font-black uppercase tracking-widest rounded-lg animate-pulse">Live
                                    Tracking</span>
                            </div>
                            <div class="flex-1 flex items-center justify-center">
                                <canvas id="performanceChart" class="max-h-[200px] w-full"></canvas>
                            </div>
                        </div>
                    </div>
                </div> <!-- End of view-dashboard -->

                <!-- ONLINE EXAM SECTION -->
                <div id="view-exam" class="content-view hidden animate-in fade-in duration-500">
                    <!-- Header -->
                    <div class="mb-8 relative overflow-hidden rounded-3xl shadow-2xl shadow-indigo-500/20 border border-white/10"
                        style="background-color: #4b44d4;">
                        <div class="absolute inset-0 opacity-10"
                            style="background-image: radial-gradient(#6366f1 1px, transparent 1px); background-size: 20px 20px;">
                        </div>
                        <div
                            class="absolute -right-10 -top-10 w-64 h-64 bg-indigo-600 rounded-full blur-[100px] opacity-20">
                        </div>
                        <div
                            class="relative z-10 p-6 md:p-8 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div>
                                <p class="text-[10px] font-black uppercase tracking-[0.2em] text-[#e5e7eb] mb-2">
                                    Evaluation</p>
                                <h2
                                    class="text-2xl md:text-4xl font-black text-[#f9fafb] tracking-tighter leading-none">
                                    Online HTML Certification</h2>
                                <p class="text-xs text-[#e5e7eb] font-medium mt-2 max-w-md">100 Questions | 40% Passing
                                    Criteria | One-Time Attempt</p>
                            </div>
                            <div id="exam-status-badge"
                                class="px-4 py-2 rounded-full border bg-emerald-500/20 text-emerald-500 border-emerald-500/20 text-xs font-black uppercase tracking-widest backdrop-blur-md">
                                CHECKING STATUS...
                            </div>
                        </div>
                    </div>

                    <!-- ADMIN PANEL -->
                    <div id="exam-admin-panel" class="hidden mb-8">
                        <div
                            class="v-card p-6 border-l-4 border-indigo-500 flex flex-col sm:flex-row items-center justify-between gap-4">
                            <div>
                                <h3
                                    class="text-lg font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight">
                                    Exam Control Center</h3>
                                <p class="text-xs text-slate-500 font-bold mt-1">Manage exam availability for all
                                    students.</p>
                            </div>
                            <button id="exam-toggle-btn" onclick="toggleExamStatus()"
                                class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/30 flex items-center gap-2">
                                <i data-lucide="power" class="w-4 h-4"></i> Enable Exam
                            </button>
                        </div>

                        <!-- Admin Results Table -->
                        <div id="exam-admin-results" class="mt-8 v-card p-0 overflow-hidden hidden">
                            <div
                                class="p-6 border-b border-slate-50 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50">
                                <h3 class="text-sm font-black uppercase tracking-widest text-slate-500">Student Results
                                </h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-400 uppercase bg-slate-50 dark:bg-slate-800/50">
                                        <tr>
                                            <th class="px-6 py-4 font-black">Student</th>
                                            <th class="px-6 py-4 font-black">Score</th>
                                            <th class="px-6 py-4 font-black">Status</th>
                                            <th class="px-6 py-4 font-black">Date</th>
                                            <th class="px-6 py-4 font-black text-right">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="exam-results-body"
                                        class="divide-y divide-slate-50 dark:divide-slate-800">
                                        <!-- Rows injected by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- STUDENT AREA -->
                    <div id="exam-student-area" class="hidden">

                        <!-- 1. Locked Screen -->
                        <div id="exam-locked-screen" class="hidden text-center py-20">
                            <div
                                class="w-24 h-24 mx-auto bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mb-6 animate-pulse">
                                <i data-lucide="lock" class="w-10 h-10 text-slate-400"></i>
                            </div>
                            <h3 class="text-2xl font-black text-slate-900 dark:text-slate-200 mb-2">Exam Locked</h3>
                            <p class="text-slate-500 font-medium">The administrator has not enabled the exam
                                yet.<br>Please check back later.</p>
                        </div>

                        <!-- 2. Start Screen -->
                        <div id="exam-start-screen" class="hidden text-center py-12">
                            <div
                                class="max-w-2xl mx-auto v-card p-8 border-t-4 border-indigo-500 relative overflow-hidden">
                                <!-- Background Decoration -->
                                <div
                                    class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-indigo-500/5 rounded-full blur-3xl">
                                </div>
                                <div
                                    class="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-purple-500/5 rounded-full blur-3xl">
                                </div>

                                <div
                                    class="w-24 h-24 mx-auto bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-indigo-500/20 transform rotate-3">
                                    <i data-lucide="award" class="w-12 h-12 text-white"></i>
                                </div>
                                <h3 class="text-3xl font-black text-slate-900 dark:text-slate-200 mb-2">HTML
                                    Certification Exam</h3>
                                <p class="text-slate-500 dark:text-slate-400 mb-8 max-w-lg mx-auto">Prove your skills in
                                    HTML5 structure, semantic tags, and modern web standards.</p>

                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 text-left">
                                    <div
                                        class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div
                                                class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400">
                                                <i data-lucide="list-checks" class="w-4 h-4"></i>
                                            </div>
                                            <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">
                                                Questions</p>
                                        </div>
                                        <p class="text-2xl font-black text-slate-700 dark:text-slate-300 ml-1">100</p>
                                    </div>
                                    <div
                                        class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div
                                                class="p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400">
                                                <i data-lucide="target" class="w-4 h-4"></i>
                                            </div>
                                            <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">
                                                Passing</p>
                                        </div>
                                        <p class="text-2xl font-black text-emerald-500 ml-1">40%</p>
                                    </div>
                                    <div
                                        class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div
                                                class="p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg text-rose-600 dark:text-rose-400">
                                                <i data-lucide="timer" class="w-4 h-4"></i>
                                            </div>
                                            <p class="text-[10px] uppercase font-black text-slate-400 tracking-widest">
                                                Duration</p>
                                        </div>
                                        <p class="text-2xl font-black text-rose-500 ml-1">60 <span
                                                class="text-sm text-slate-400 font-bold">Mins</span></p>
                                    </div>
                                </div>

                                <div
                                    class="bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/30 rounded-xl p-5 mb-8 text-left flex items-start gap-4">
                                    <div
                                        class="p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-500 shrink-0">
                                        <i data-lucide="alert-circle" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-amber-700 dark:text-amber-400 text-sm mb-1">Important
                                            Instructions</h4>
                                        <ul
                                            class="text-xs text-amber-600/80 dark:text-amber-500/80 space-y-1 list-disc list-inside font-medium">
                                            <li>You have only <strong>one attempt</strong> for this exam.</li>
                                            <li>Timer starts immediately after clicking Start.</li>
                                            <li>Do not refresh or close the browser window.</li>
                                        </ul>
                                    </div>
                                </div>

                                <button onclick="startExam()"
                                    class="group w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl font-bold shadow-xl shadow-indigo-500/30 transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-3">
                                    <span>Start Certification Exam</span>
                                    <i data-lucide="arrow-right"
                                        class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 3. Exam Interface -->
                        <div id="exam-interface" class="hidden max-w-4xl mx-auto">
                            <!-- Progress Header -->
                            <div
                                class="bg-white dark:bg-[#1e293b] rounded-2xl p-6 mb-6 sticky top-4 z-40 shadow-xl border border-slate-100 dark:border-slate-800">
                                <div
                                    class="flex flex-col md:flex-row justify-between items-end md:items-center mb-4 gap-4">
                                    <div class="flex items-center gap-4">
                                        <div
                                            class="w-12 h-12 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center font-black text-xl border border-indigo-200 dark:border-indigo-800/50">
                                            Q
                                        </div>
                                        <div>
                                            <p
                                                class="text-[10px] font-black uppercase text-slate-400 tracking-widest mb-0.5">
                                                Question</p>
                                            <h3
                                                class="text-2xl font-black text-slate-800 dark:text-white flex items-baseline gap-1">
                                                <span id="current-q-num">1</span>
                                                <span class="text-slate-400 text-sm font-bold">/ 100</span>
                                            </h3>
                                        </div>
                                    </div>

                                    <div class="flex items-center gap-3">
                                        <div class="hidden md:block text-right">
                                            <p
                                                class="text-[10px] font-black uppercase text-slate-400 tracking-widest mb-0.5">
                                                Time Remaining</p>
                                            <div class="text-xs font-bold text-slate-500 dark:text-slate-400">HTML
                                                Certification</div>
                                        </div>
                                        <div id="exam-timer-display"
                                            class="font-mono text-xl font-black text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-800 px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex items-center gap-2">
                                            <i data-lucide="timer" class="w-4 h-4 text-slate-400"></i>
                                            <span>60:00</span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="relative w-full h-2 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                    <div id="exam-progress-bar"
                                        class="absolute top-0 left-0 h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300 rounded-full"
                                        style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- Question Card -->
                            <div class="v-card p-8 mb-8 min-h-[400px] flex flex-col">
                                <h2 id="question-text"
                                    class="text-xl md:text-2xl font-bold text-slate-800 dark:text-slate-200 mb-8 leading-relaxed">
                                    Loading Question...
                                </h2>

                                <div id="options-container" class="grid grid-cols-1 gap-4 mb-8">
                                    <!-- Options Injected Here -->
                                </div>

                                <div
                                    class="mt-auto flex justify-between items-center pt-8 border-t border-slate-50 dark:border-slate-800">
                                    <button id="btn-prev" onclick="prevQuestion()"
                                        class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                        Previous
                                    </button>
                                    <button id="btn-next" onclick="nextQuestion()"
                                        class="px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-500/30 transition-all">
                                        Next Question
                                    </button>
                                    <button id="btn-submit" onclick="submitExam()"
                                        class="hidden px-8 py-3 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/30 transition-all">
                                        Submit Exam
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 4. Result Card -->
                        <div id="exam-result-card" class="hidden text-center py-12 animate-in zoom-in duration-300">
                            <div class="max-w-md mx-auto v-card p-10 border-t-8 border-indigo-500 shadow-2xl">
                                <div id="result-icon-container"
                                    class="w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-6">
                                    <!-- Icon injected -->
                                </div>

                                <p class="text-slate-400 font-bold uppercase text-xs tracking-widest mb-8">Final Score
                                </p>

                                <div class="text-6xl font-black mb-8 tracking-tighter" id="result-score">
                                    0%
                                </div>

                                <button id="btn-download-cert" onclick="downloadCertificate()"
                                    class="hidden w-full mb-4 py-4 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-bold shadow-xl shadow-emerald-500/30 transition-all flex items-center justify-center gap-3">
                                    <i data-lucide="download" class="w-5 h-5"></i>
                                    <span>Download Professional Certificate</span>
                                </button>

                                <button onclick="switchTab('dashboard')"
                                    class="w-full py-3 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl font-bold transition-colors">
                                    Return Home
                                </button>
                            </div>
                        </div>

                    </div>
                </div>




                <!-- 2. Tasks View -->

                <div id="view-tasks" class="content-view hidden animate-in slide-in-from-bottom-4 duration-500">
                    <!-- Advanced Filter Bar -->
                    <div class="w-full mb-8 text-center">
                        <div class="max-w-md mx-auto mb-6 relative"> <!-- SEARCH BAR -->
                            <i data-lucide="search" class="absolute left-4 top-3.5 w-4 h-4 text-slate-400"></i>
                            <input type="text" id="task-search" oninput="filterTasks(window.currentTaskFilter || 'all')"
                                placeholder="Search tasks..."
                                class="w-full pl-10 pr-4 py-3 bg-white dark:bg-[#1e293b] border border-slate-100 dark:border-slate-800 rounded-xl text-sm font-bold shadow-sm outline-none focus:ring-2 focus:ring-indigo-500 transition-all text-slate-900 dark:text-slate-200">
                        </div>
                        <div class="task-tabs-container mx-auto">
                            <input type="radio" id="radio-1" name="tabs" checked onchange="filterTasks('all')">
                            <label class="tab" for="radio-1">All Tasks</label>

                            <input type="radio" id="radio-2" name="tabs" onchange="filterTasks('pending')">
                            <label class="tab" for="radio-2">Pending</label>

                            <input type="radio" id="radio-3" name="tabs" onchange="filterTasks('completed')">
                            <label class="tab" for="radio-3">Completed</label>

                            <input type="radio" id="radio-4" name="tabs" onchange="filterTasks('expired')">
                            <label class="tab" for="radio-4">Expired</label>
                        </div>
                    </div>
                    <div id="task-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Tasks -->
                    </div>
                </div>

                <!-- 3. Intelligence View -->
                <div id="view-resources" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <!-- Resource Header & Filter -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                        <div>
                            <h3
                                class="text-xl font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200">
                                Learning Library</h3>
                            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Curated
                                materials
                                for your growth</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                            <div class="relative">
                                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-slate-400"></i>
                                <input type="text" id="resource-search" placeholder="Search resources..."
                                    class="w-full sm:w-64 pl-10 pr-4 py-2 bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-slate-900 dark:text-slate-200">
                            </div>
                            <button onclick="openCreateResourceModal()" id="add-resource-btn"
                                class="hidden btn-command px-4 py-2 rounded-xl text-[9px] flex items-center gap-2 whitespace-nowrap">
                                <i data-lucide="plus" class="w-3.5 h-3.5"></i> Add Material
                            </button>
                        </div>

                        <!-- New Centered Filter Tabs for Resources -->
                        <div class="w-full mt-4 mb-8 text-center">
                            <div class="task-tabs-container">
                                <input type="radio" id="res-radio-1" name="res-tabs" checked
                                    onchange="filterResources('all')">
                                <label class="tab" for="res-radio-1">All</label>

                                <input type="radio" id="res-radio-2" name="res-tabs"
                                    onchange="filterResources('video')">
                                <label class="tab" for="res-radio-2">Videos</label>

                                <input type="radio" id="res-radio-3" name="res-tabs" onchange="filterResources('doc')">
                                <label class="tab" for="res-radio-3">Docs</label>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Resource Grid -->
                    <div id="resource-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Injected via JS -->
                    </div>
                </div>

                <!-- 4. LEADERBOARD VIEW -->
                <div id="view-leaderboard" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="v-card overflow-hidden">
                        <div
                            class="p-5 bg-gradient-to-br from-indigo-600 to-indigo-800 text-white flex justify-between items-center">
                            <div>
                                <h3 class="text-xl font-black uppercase tracking-tighter leading-none mb-1">
                                    Student
                                    Ranking
                                </h3>
                                <p class="text-indigo-100/70 text-[8px] font-black uppercase tracking-widest">
                                    Best
                                    Performers</p>
                            </div>
                            <div
                                class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-md">
                                <i data-lucide="trophy" class="w-5 h-5 text-white"></i>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left font-bold text-xs">
                                <thead
                                    class="bg-slate-50 dark:bg-[#1e293b] text-[9px] font-black uppercase text-slate-400 dark:text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800">
                                    <tr>
                                        <th class="px-5 py-3">Rank</th>
                                        <th class="px-5 py-3">Student</th>
                                        <th class="px-5 py-3 text-center hidden sm:table-cell">Tasks</th>
                                        <th class="px-5 py-3 text-center">Grade</th>
                                        <th class="px-5 py-3 text-right">Progress</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboard-body" class="divide-y divide-slate-100 dark:divide-slate-800/50">
                                    <!-- Rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <!-- NEW: Code Arcade View -->
                <div id="view-arcade" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3
                                class="text-xl font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200">
                                Code
                                Arcade</h3>
                            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Level
                                up your
                                skills</p>
                            <button id="back-to-menu-btn" onclick="exitArcadeGame()"
                                class="hidden mt-4 px-5 py-2.5 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:border-indigo-500 text-slate-500 hover:text-indigo-600 font-black text-[10px] uppercase tracking-widest transition-all flex items-center gap-2 shadow-sm w-fit">
                                <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Menu
                            </button>
                        </div>
                    </div>

                    <!-- LOCKED STATE OVERLAY -->
                    <div id="arcade-locked" class="v-card p-16 text-center animate-in zoom-in duration-300 hidden">
                        <div
                            class="w-24 h-24 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 relative">
                            <i data-lucide="lock" class="w-10 h-10 text-slate-400"></i>
                            <div
                                class="absolute -bottom-1 -right-1 w-8 h-8 bg-rose-500 rounded-full flex items-center justify-center border-4 border-white dark:border-[#0b1120]">
                                <i data-lucide="x" class="w-4 h-4 text-white font-bold"></i>
                            </div>
                        </div>
                        <h2
                            class="text-2xl font-black text-slate-900 dark:text-slate-200 uppercase tracking-tighter mb-2">
                            Section Locked</h2>
                        <p class="text-slate-500 font-medium max-w-sm mx-auto mb-8 text-sm">This section is
                            currently
                            locked
                            by the administrator. Please request access to unlock the coding games.</p>
                    </div>

                    <!-- Game Selection Grid -->
                    <div id="arcade-menu"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 hidden">
                        <!-- Game 1: HTML Tag Master -->
                        <div class="v-card group relative overflow-hidden cursor-pointer hover:border-orange-500 transition-all hover:shadow-xl hover:shadow-orange-500/10"
                            onclick="startArcadeGame('html_master')">
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                            <div class="p-6 relative z-10">
                                <div
                                    class="w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center mb-4 text-2xl font-black shadow-sm">
                                    &lt;/&gt;
                                </div>
                                <h4
                                    class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">
                                    HTML Tag Master</h4>
                                <p class="text-[10px] font-bold text-slate-400 mb-4 uppercase tracking-wide">
                                    Race
                                    against
                                    the clock to identify the correct HTML tags.</p>
                                <span
                                    class="px-3 py-1.5 rounded-lg bg-orange-50 text-orange-600 text-[9px] font-black uppercase tracking-widest">Start
                                    Game</span>
                            </div>
                        </div>

                        <!-- Game 2: CSS Selector Speedrun -->
                        <div class="v-card group relative overflow-hidden cursor-pointer hover:border-cyan-500 transition-all hover:shadow-xl hover:shadow-cyan-500/10"
                            onclick="startArcadeGame('css_speed')">
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                            <div class="p-6 relative z-10">
                                <div
                                    class="w-12 h-12 bg-cyan-100 text-cyan-600 rounded-xl flex items-center justify-center mb-4 text-2xl font-black shadow-sm">
                                    #
                                </div>
                                <h4
                                    class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">
                                    CSS Speedrun</h4>
                                <p class="text-[10px] font-bold text-slate-400 mb-4 uppercase tracking-wide">
                                    Select
                                    the
                                    correct CSS property to fix the layout.</p>
                                <span
                                    class="px-3 py-1.5 rounded-lg bg-cyan-50 text-cyan-600 text-[9px] font-black uppercase tracking-widest">Start
                                    Game</span>
                            </div>
                        </div>

                        <!-- Game 3: Code Drag Master (New) -->
                        <div class="v-card group relative overflow-hidden cursor-pointer hover:border-purple-500 transition-all hover:shadow-xl hover:shadow-purple-500/10"
                            onclick="startArcadeGame('drag_master')">
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                            <div class="p-6 relative z-10">
                                <div
                                    class="w-12 h-12 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center mb-4 text-2xl font-black shadow-sm">
                                    <i data-lucide="move" class="w-6 h-6"></i>
                                </div>
                                <h4
                                    class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">
                                    Code Drag Master</h4>
                                <p class="text-[10px] font-bold text-slate-400 mb-4 uppercase tracking-wide">
                                    Drag
                                    code
                                    blocks
                                    to their correct descriptions.</p>
                                <span
                                    class="px-3 py-1.5 rounded-lg bg-purple-50 text-purple-600 text-[9px] font-black uppercase tracking-widest">Start
                                    Game</span>
                            </div>
                        </div>

                        <!-- Game 4: JS Logic Lab (New) -->
                        <div class="v-card group relative overflow-hidden cursor-pointer hover:border-yellow-500 transition-all hover:shadow-xl hover:shadow-yellow-500/10"
                            onclick="startArcadeGame('js_logic')">
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-yellow-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                            <div class="p-6 relative z-10">
                                <div
                                    class="w-12 h-12 bg-yellow-100 text-yellow-600 rounded-xl flex items-center justify-center mb-4 text-2xl font-black shadow-sm">
                                    <i data-lucide="braces" class="w-6 h-6"></i>
                                </div>
                                <h4
                                    class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">
                                    JS Logic Lab</h4>
                                <p class="text-[10px] font-bold text-slate-400 mb-4 uppercase tracking-wide">
                                    Predict
                                    the output of JavaScript snippets.</p>
                                <span
                                    class="px-3 py-1.5 rounded-lg bg-yellow-50 text-yellow-600 text-[9px] font-black uppercase tracking-widest">Start
                                    Game</span>
                            </div>
                        </div>

                        <!-- Game 5: Syntax Balloons (New Adventure) -->
                        <div class="v-card group relative overflow-hidden cursor-pointer hover:border-sky-500 transition-all hover:shadow-xl hover:shadow-sky-500/10"
                            onclick="startArcadeGame('syntax_balloons')">
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-sky-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                            </div>
                            <div class="p-6 relative z-10">
                                <div
                                    class="w-12 h-12 bg-sky-100 text-sky-600 rounded-xl flex items-center justify-center mb-4 text-2xl font-black shadow-sm">
                                    <i data-lucide="aperture" class="w-6 h-6"></i>
                                </div>
                                <h4
                                    class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">
                                    Syntax Balloons</h4>
                                <p class="text-[10px] font-bold text-slate-400 mb-4 uppercase tracking-wide">
                                    Pop the
                                    correct code bubbles! HTML, CSS, & JS.</p>
                                <span
                                    class="px-3 py-1.5 rounded-lg bg-sky-50 text-sky-600 text-[9px] font-black uppercase tracking-widest">Start
                                    Learning</span>
                            </div>
                        </div>

                    </div>

                    <!-- Game Interface (Hidden by default) -->
                    <div id="game-stage" class="hidden mt-2">
                        <div class="v-card p-6 w-full max-w-5xl mx-auto flex flex-col relative overflow-hidden shadow-2xl border-2 border-indigo-50 dark:border-slate-800"
                            id="game-container">
                            <!-- Game content loaded here -->
                        </div>
                    </div>
                </div> <!-- END view-arcade -->



                <!-- 5. Admin Review Center -->
                <!-- EXAM VIEW -->
                <div id="view-exam" class="content-view hidden animate-in fade-in duration-500">
                    <!-- Header -->
                    <div class="mb-8">
                        <h2 class="text-3xl font-black text-slate-800 dark:text-white uppercase tracking-tighter">Online
                            Examination</h2>
                        <p class="text-slate-500 font-bold uppercase tracking-widest text-xs">HTML Certification Test
                        </p>
                    </div>

                    <!-- Admin Panel (Hidden for students) -->
                    <div id="exam-admin-panel"
                        class="hidden mb-8 p-6 bg-slate-900 rounded-3xl text-white relative overflow-hidden">
                        <div class="relative z-10 flex justify-between items-center">
                            <div>
                                <h3 class="text-xl font-black uppercase tracking-tight mb-2">Exam Control Center</h3>
                                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Manage exam
                                    availability</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <span id="exam-status-badge"
                                    class="px-3 py-1 rounded-lg bg-rose-500/20 text-rose-400 font-black uppercase text-[10px] tracking-widest border border-rose-500/20">LOCKED</span>
                                <button onclick="toggleExamStatus()" id="exam-toggle-btn"
                                    class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold uppercase tracking-widest transition-all">Enable
                                    Exam</button>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Results Table (Hidden for students) -->
                    <div id="exam-admin-results" class="hidden v-card p-6 mb-8">
                        <h3 class="font-black text-lg text-slate-800 dark:text-white uppercase tracking-tight mb-4">
                            Student Results</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr
                                        class="border-b border-slate-100 dark:border-slate-800 text-[10px] font-black uppercase tracking-widest text-slate-400">
                                        <th class="p-3">Student</th>
                                        <th class="p-3">Score</th>
                                        <th class="p-3">Status</th>
                                        <th class="p-3">Date</th>
                                    </tr>
                                </thead>
                                <tbody id="exam-results-body"
                                    class="text-sm font-medium text-slate-600 dark:text-slate-300">
                                    <!-- Results injected here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Student Interface -->
                    <div id="exam-student-area">
                        <!-- 1. Locked Screen -->
                        <div id="exam-locked-screen" class="hidden text-center py-20">
                            <div
                                class="w-24 h-24 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-400">
                                <i data-lucide="lock" class="w-10 h-10"></i>
                            </div>
                            <h3 class="text-xl font-black text-slate-800 dark:text-white uppercase tracking-tight mb-2">
                                Exam Locked</h3>
                            <p class="text-slate-500 text-sm font-medium max-w-md mx-auto">The exam is currently not
                                available. Please wait for the administrator to enable it.</p>
                            <button onclick="fetchExamStatus()"
                                class="mt-6 px-6 py-3 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-indigo-100 transition-colors">Refresh
                                Status</button>
                        </div>

                        <!-- 2. Start Screen (Instructions) -->
                        <div id="exam-start-screen" class="hidden max-w-2xl mx-auto v-card p-8 text-center">
                            <div
                                class="w-20 h-20 bg-indigo-100 dark:bg-indigo-900/20 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="book-open" class="w-8 h-8"></i>
                            </div>
                            <h2
                                class="text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tight mb-4">
                                HTML Final Exam</h2>
                            <div class="text-left bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl mb-8 space-y-3">
                                <p
                                    class="flex items-center gap-3 text-sm font-medium text-slate-600 dark:text-slate-400">
                                    <i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-500"></i> 100 Multiple
                                    Choice Questions
                                </p>
                                <p
                                    class="flex items-center gap-3 text-sm font-medium text-slate-600 dark:text-slate-400">
                                    <i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-500"></i> One attempt
                                    only
                                </p>
                                <p
                                    class="flex items-center gap-3 text-sm font-medium text-slate-600 dark:text-slate-400">
                                    <i data-lucide="check-circle-2" class="w-4 h-4 text-emerald-500"></i> Passing Score:
                                    40%
                                </p>
                                <p
                                    class="flex items-center gap-3 text-sm font-medium text-slate-600 dark:text-slate-400">
                                    <i data-lucide="alert-circle" class="w-4 h-4 text-rose-500"></i> Do not refresh the
                                    page during the exam.
                                </p>
                            </div>
                            <button onclick="startExam()"
                                class="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-black uppercase tracking-widest shadow-lg shadow-indigo-500/30 transition-all transform hover:scale-[1.02]">Start
                                Examination</button>
                        </div>

                        <!-- 3. Active Exam Interface -->
                        <div id="exam-interface" class="hidden max-w-3xl mx-auto">
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-xs font-black uppercase tracking-widest text-slate-400">Question <span
                                        id="current-q-num">1</span>/100</span>
                                <div class="h-2 w-32 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                    <div id="exam-progress-bar"
                                        class="h-full bg-indigo-500 w-0 transition-all duration-300"></div>
                                </div>
                            </div>

                            <div class="v-card p-8 mb-6 min-h-[300px] flex flex-col justify-center">
                                <h3 id="question-text"
                                    class="text-xl font-bold text-slate-800 dark:text-white mb-8 leading-relaxed">
                                    Loading question...</h3>
                                <div id="options-container" class="space-y-3">
                                    <!-- Options injected here -->
                                </div>
                            </div>

                            <div class="flex justify-between">
                                <button onclick="prevQuestion()" id="btn-prev"
                                    class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-50">Previous</button>
                                <button onclick="nextQuestion()" id="btn-next"
                                    class="px-8 py-3 bg-indigo-600 text-white rounded-xl font-black uppercase tracking-widest shadow-lg shadow-indigo-500/30 hover:bg-indigo-700">Next</button>
                                <button onclick="submitExam()" id="btn-submit"
                                    class="hidden px-8 py-3 bg-emerald-500 text-white rounded-xl font-black uppercase tracking-widest shadow-lg shadow-emerald-500/30 hover:bg-emerald-600">Submit
                                    Exam</button>
                            </div>
                        </div>

                        <!-- 4. Result Card -->
                        <div id="exam-result-card"
                            class="hidden max-w-md mx-auto v-card p-8 text-center animate-in zoom-in duration-500">
                            <div id="result-icon-container"
                                class="w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                                <!-- Icon injected via JS -->
                            </div>
                            <h2 id="result-title" class="text-3xl font-black uppercase tracking-tighter mb-2">Result
                            </h2>
                            <div class="text-5xl font-black text-slate-800 dark:text-white mb-2" id="result-score">0%
                            </div>
                            <p id="result-message"
                                class="text-slate-500 font-bold uppercase tracking-widest text-xs mb-8">Status</p>
                            <button onclick="switchTab('dashboard')"
                                class="px-8 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-slate-700">Back
                                to Dashboard</button>
                        </div>
                    </div>
                </div>

                <div id="view-grading" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                        <div>
                            <h3
                                class="text-xl font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200">
                                Grading
                                Center</h3>
                            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Review
                                and
                                grade
                                student tasks</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div
                                class="px-4 py-2 bg-white dark:bg-[#1e293b] rounded-xl border border-slate-100 dark:border-slate-800 shadow-sm flex items-center gap-2">
                                <i data-lucide="filter" class="w-3 h-3 text-slate-400"></i>
                                <select onchange="renderGrading(window.allSubmissions)" id="grading-filter"
                                    class="bg-transparent text-[9px] font-black uppercase tracking-widest outline-none text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <option value="all">Check All Student's</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="grading-list" class="space-y-4 pb-10">
                        <!-- Submissions Injected -->
                    </div>
                </div>

                <!-- 6. Admin Student Directory -->
                <div id="view-users" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="v-card overflow-hidden">
                        <div
                            class="p-4 border-b border-slate-100 dark:border-slate-800/50 flex flex-col md:flex-row gap-3 items-center justify-between">
                            <div class="relative w-full md:max-w-xs">
                                <i data-lucide="search"
                                    class="absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400 w-3.5 h-3.5"></i>
                                <input type="text" id="user-search" placeholder="Search..."
                                    class="w-full pl-10 pr-4 py-2 rounded-lg bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800/50 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-bold text-[10px] transition-all text-slate-900 dark:text-slate-100">
                            </div>
                            <div class="flex items-center gap-4">
                                <span id="online-student-count" class="text-[10px] font-black uppercase tracking-widest text-emerald-500 hidden sm:block cursor-pointer hover:underline" onclick="showOnlineStudentsModal()">0 Online</span>
                                <span id="total-student-count"
                                    class="text-[10px] font-black uppercase tracking-widest text-slate-400 hidden sm:block">0
                                    Records</span>
                                <div class="flex gap-2">
                                    <button onclick="window.approveAllUsers()"
                                        class="px-4 py-2.5 rounded-lg bg-emerald-500 text-white shadow-lg shadow-emerald-500/20 hover:bg-emerald-600 transition-all text-[8px] font-black uppercase tracking-widest flex items-center gap-1.5 hover:scale-105 active:scale-95">
                                        <i data-lucide="check-circle-2" class="w-3 h-3"></i> Approve All
                                    </button>
                                    <button onclick="downloadAllReports()"
                                        class="btn-command px-4 py-2.5 rounded-lg text-[8px] flex items-center gap-1.5 hover:scale-105 active:scale-95 transition-transform">
                                        <i data-lucide="download" class="w-3 h-3"></i> Export All
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left font-bold">
                                <thead
                                    class="bg-slate-50 dark:bg-[#1e293b] text-[9px] font-black uppercase text-slate-400 dark:text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800">
                                    <tr>
                                        <th class="px-5 py-3">Student Name</th>
                                        <th class="px-5 py-3 text-center hidden sm:table-cell">Tasks</th>
                                        <th class="px-5 py-3 text-center">Grade</th>
                                        <th class="px-5 py-3 text-center">Arcade</th>
                                        <th class="px-6 py-3 text-center">Status</th>
                                        <th class="px-5 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="user-table-body"
                                    class="divide-y divide-slate-100 dark:divide-slate-800/50 text-[11px]">
                                    <!-- Row Injected -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <!-- Selected Private Chat (Hidden by default, will reuse global chat container if needed) -->
                <!-- Removing the dedicated inbox view as requested -->

                <!-- 7. Admin Feedback View -->
                <div id="view-feedback" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="v-card overflow-hidden">
                        <div
                            class="p-4 border-b border-slate-100 dark:border-slate-800/50 flex flex-col md:flex-row gap-3 items-center justify-between">
                            <div>
                                <h3
                                    class="text-xl font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200">
                                    Student Feedback</h3>
                                <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Review student
                                    opinions</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <span id="total-feedback-count"
                                    class="text-[10px] font-black uppercase tracking-widest text-slate-400 hidden sm:block">0
                                    Records</span>
                                <button onclick="renderFeedback()"
                                    class="px-4 py-2.5 rounded-lg bg-indigo-500 text-white shadow-lg shadow-indigo-500/20 hover:bg-indigo-600 transition-all text-[8px] font-black uppercase tracking-widest flex items-center gap-1.5 hover:scale-105 active:scale-95">
                                    <i data-lucide="refresh-cw" class="w-3 h-3"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left font-bold">
                                <thead
                                    class="bg-slate-50 dark:bg-[#1e293b] text-[9px] font-black uppercase text-slate-400 dark:text-slate-500 tracking-widest border-b border-slate-100 dark:border-slate-800">
                                    <tr>
                                        <th class="px-5 py-3">Student Name</th>
                                        <th class="px-5 py-3 text-center">Rating</th>
                                        <th class="px-5 py-3 text-center">Quality</th>
                                        <th class="px-5 py-3 text-center">Usability</th>
                                        <th class="px-5 py-3">Comments</th>
                                        <th class="px-5 py-3 text-right">Date</th>
                                        <th class="px-5 py-3 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="feedback-table-body"
                                    class="divide-y divide-slate-100 dark:divide-slate-800/50 text-[11px]">
                                    <!-- Row Injected -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 8. Profile View -->
                <div id="view-profile" class="content-view hidden animate-in slide-in-from-bottom-5 duration-500">
                    <div class="max-w-2xl mx-auto">
                        <div class="v-card overflow-hidden">
                            <div
                                class="p-8 border-b border-slate-100 dark:border-slate-800 flex flex-col sm:flex-row items-center gap-6">
                                <input type="file" id="profile-upload" class="hidden" accept="image/*">
                                <div class="relative group cursor-pointer" onclick="$('#profile-upload').click()">
                                    <div class="w-24 h-24 bg-indigo-600 rounded-full flex items-center justify-center text-3xl font-black text-white shadow-xl shadow-indigo-500/30 overflow-hidden ring-4 ring-white dark:ring-slate-800"
                                        id="profile-avatar-display">
                                        <span id="profile-initial-lg">?</span>
                                    </div>
                                    <div
                                        class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i data-lucide="camera" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div
                                        class="absolute bottom-1 right-1 bg-indigo-500 text-white p-1 rounded-full border-2 border-white dark:border-slate-800">
                                        <i data-lucide="edit-2" class="w-3 h-3"></i>
                                    </div>
                                </div>

                                <div class="text-center sm:text-left">
                                    <h3 class="text-2xl font-black text-slate-900 dark:text-slate-200 uppercase tracking-tighter mb-1"
                                        id="profile-page-name">
                                        My Account</h3>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">
                                        Update
                                        your personal profile & avatar</p>
                                    <p class="text-[8px] text-indigo-500 font-bold uppercase tracking-widest mt-2 hidden"
                                        id="upload-status">Uploading...</p>
                                </div>
                            </div>
                            <div class="p-8">
                                <form id="profile-form" class="space-y-6">
                                    <div class="space-y-2">
                                        <label
                                            class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Full
                                            Name</label>
                                        <div class="relative">
                                            <i data-lucide="user"
                                                class="absolute left-4 top-3.5 w-4 h-4 text-slate-400"></i>
                                            <input type="text" id="profile-name" required
                                                class="w-full pl-10 pr-4 py-3 bg-slate-50 dark:bg-slate-950 border border-transparent dark:border-slate-800 rounded-xl text-sm font-bold text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <label
                                            class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Email
                                            Address</label>
                                        <div class="relative opacity-70">
                                            <i data-lucide="mail"
                                                class="absolute left-4 top-3.5 w-4 h-4 text-slate-400"></i>
                                            <input type="email" id="profile-email" disabled
                                                class="w-full pl-10 pr-4 py-3 bg-slate-100 dark:bg-slate-900/50 border border-transparent dark:border-slate-800/50 rounded-xl text-sm font-bold text-slate-500 cursor-not-allowed">
                                        </div>
                                        <p class="text-[9px] text-slate-400 italic px-1">Email cannot be
                                            changed
                                            directly.</p>
                                    </div>


                                    <div id="trophy-section"
                                        class="pt-6 border-t border-slate-100 dark:border-slate-800">
                                        <h4
                                            class="text-xs font-black uppercase tracking-widest text-slate-900 dark:text-slate-200 mb-4 flex items-center gap-2">
                                            <i data-lucide="trophy" class="w-4 h-4 text-amber-500"></i>
                                            Trophy Case
                                        </h4>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="badges-grid">
                                            <!-- Badges will be injected here via JS -->
                                            <div class="col-span-full text-center py-8">
                                                <div
                                                    class="w-8 h-8 rounded-full border-2 border-slate-100 dark:border-slate-800 border-t-indigo-500 animate-spin mx-auto mb-2">
                                                </div>
                                                <span
                                                    class="text-[9px] font-bold uppercase tracking-widest text-slate-400">Loading
                                                    Achievements...</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="pt-6 border-t border-slate-100 dark:border-slate-800">
                                        <h4
                                            class="text-xs font-black uppercase tracking-widest text-slate-900 dark:text-slate-200 mb-4">
                                            Security</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="space-y-2">
                                                <label
                                                    class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">New
                                                    Password</label>
                                                <div class="relative">
                                                    <i data-lucide="lock"
                                                        class="absolute left-4 top-3.5 w-4 h-4 text-slate-400"></i>
                                                    <input type="password" id="profile-new-pass"
                                                        class="w-full pl-10 pr-4 py-3 bg-slate-50 dark:bg-[#0b1120] border-0 rounded-xl text-sm font-bold text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 outline-none transition-all placeholder:font-normal placeholder:text-slate-400"
                                                        placeholder="Minimum 6 chars">
                                                </div>
                                            </div>
                                            <div class="space-y-2">
                                                <label
                                                    class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Confirm
                                                    Password</label>
                                                <div class="relative">
                                                    <i data-lucide="check-circle-2"
                                                        class="absolute left-4 top-3.5 w-4 h-4 text-slate-400"></i>
                                                    <input type="password" id="profile-confirm-pass"
                                                        class="w-full pl-10 pr-4 py-3 bg-slate-50 dark:bg-[#0b1120] border-0 rounded-xl text-sm font-bold text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 outline-none transition-all placeholder:font-normal placeholder:text-slate-400"
                                                        placeholder="Re-enter password">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pt-4 flex justify-end">
                                        <button type="submit"
                                            class="btn-command px-8 py-3 rounded-xl shadow-lg shadow-indigo-500/20 text-xs flex items-center gap-2">
                                            <i data-lucide="save" class="w-4 h-4"></i> Save Changes
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Achievements Section -->

                    </div>
                </div>

                <!-- 9. LIVE CODE PLAYGROUND (CodePen Style) -->
                <div id="view-playground"
                    class="content-view hidden animate-in slide-in-from-bottom-5 duration-500 w-full min-h-[70vh] flex flex-col bg-[#131417] relative z-10 overflow-hidden rounded-t-2xl shadow-2xl border-t border-l border-r border-[#444857]">

                    <!-- Top Bar (CodePen Header) -->
                    <div
                        class="h-16 bg-[#1e1f26] border-b border-[#131417] flex items-center justify-between px-4 shrink-0 z-20">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-black rounded-md flex items-center justify-center">
                                <i data-lucide="codepen" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-bold text-sm tracking-tight leading-none"></h3>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-[10px] text-slate-400 font-medium">BBSHRRDB
                                        Editor</span>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex items-center gap-2">
                            <button onclick="toggleEditorPanel('css')" id="btn-toggle-css"
                                class="px-3 py-2 bg-[#2c303a] hover:bg-[#5a5f73] text-white rounded-[4px] font-bold text-[10px] transition-colors border border-[#444857] active:bg-[#264de4]/20 opacity-50 grayscale"
                                title="Toggle CSS">
                                <span class="text-[#38bdf8]">CSS</span>
                            </button>
                            <button onclick="toggleEditorPanel('js')" id="btn-toggle-js"
                                class="px-3 py-2 bg-[#2c303a] hover:bg-[#5a5f73] text-white rounded-[4px] font-bold text-[10px] transition-colors border border-[#444857] active:bg-[#f0db4f]/20 opacity-50 grayscale"
                                title="Toggle JS">
                                <span class="text-[#facc15]">JS</span>
                            </button>
                            <div class="h-4 w-px bg-[#444857] mx-1"></div>
                            <button onclick="clearCode()"
                                class="px-4 py-2 bg-[#bd3434] hover:bg-[#ef4444] text-white rounded-[4px] font-bold text-xs transition-colors flex items-center gap-2 shadow-sm shadow-red-500/10">
                                <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                Clear
                            </button>

                        </div>
                    </div>

                    <!-- Split View Container -->
                    <div class="flex-1 flex flex-col min-h-0">

                        <!-- Top Half: Editors (CodePen Panel Style) -->
                        <div
                            class="flex-1 flex flex-col lg:flex-row min-h-[50%] lg:min-h-[40%] bg-[#131417] overflow-y-auto lg:overflow-visible">

                            <!-- HTML Panel -->
                            <div id="panel-html"
                                class="flex-1 flex flex-col border-b lg:border-b-0 lg:border-r border-[#2c303a] min-h-0 transition-all duration-300">
                                <div
                                    class="bg-[#1e1f26] border-b border-[#2c303a] py-2 px-3 flex items-center justify-between select-none h-9">
                                    <span
                                        class="text-[11px] font-black text-[#aaaaaa] uppercase tracking-wide flex items-center gap-2">
                                        <div class="w-3 h-3 bg-[#e34c26] rounded-[2px] shadow-sm"></div>
                                        HTML
                                    </span>
                                    <div class="flex gap-1">
                                        <div class="w-1.5 h-1.5 bg-[#444857] rounded-full"></div>
                                        <div class="w-1.5 h-1.5 bg-[#444857] rounded-full"></div>
                                    </div>
                                </div>
                                <textarea id="code-html" oninput="runCodeDebounced()"
                                    class="flex-1 w-full bg-[#131417] text-gray-300 p-3 font-mono text-[13px] leading-relaxed resize-none outline-none focus:bg-[#16171b] transition-colors min-h-[120px] lg:min-h-0"
                                    spellcheck="false" placeholder="<!-- Write HTML here -->">
</textarea>
                            </div>

                            <!-- CSS Panel -->
                            <div id="panel-css"
                                class="flex-1 flex flex-col border-b lg:border-b-0 lg:border-r border-[#2c303a] min-h-0 transition-all duration-300 hidden">
                                <div
                                    class="bg-[#1e1f26] border-b border-[#2c303a] py-2 px-3 flex items-center justify-between select-none h-9">
                                    <span
                                        class="text-[11px] font-black text-[#aaaaaa] uppercase tracking-wide flex items-center gap-2">
                                        <div class="w-3 h-3 bg-[#264de4] rounded-[2px] shadow-sm"></div> CSS
                                    </span>
                                </div>
                                <textarea id="code-css" oninput="runCodeDebounced()"
                                    class="flex-1 w-full bg-[#131417] text-gray-300 p-3 font-mono text-[13px] leading-relaxed resize-none outline-none focus:bg-[#16171b] transition-colors min-h-[120px] lg:min-h-0"
                                    spellcheck="false" placeholder="/* Write CSS here */"></textarea>
                            </div>

                            <!-- JS Panel -->
                            <div id="panel-js" class="flex-1 flex flex-col min-h-0 transition-all duration-300 hidden">
                                <div
                                    class="bg-[#1e1f26] border-b border-[#2c303a] py-2 px-3 flex items-center justify-between select-none h-9">
                                    <span
                                        class="text-[11px] font-black text-[#aaaaaa] uppercase tracking-wide flex items-center gap-2">
                                        <div class="w-3 h-3 bg-[#f0db4f] rounded-[2px] shadow-sm"></div> JS
                                    </span>
                                </div>
                                <textarea id="code-js" oninput="runCodeDebounced()"
                                    class="flex-1 w-full bg-[#131417] text-gray-300 p-3 font-mono text-[13px] leading-relaxed resize-none outline-none focus:bg-[#16171b] transition-colors min-h-[120px] lg:min-h-0"
                                    spellcheck="false" placeholder="// Write JS here"></textarea>
                            </div>
                        </div>

                        <!-- Resizer Handle (Visual only for now) -->
                        <div
                            class="h-2 bg-[#131417] border-t border-b border-[#2c303a] cursor-row-resize flex items-center justify-center hover:bg-[#444857] transition-colors">
                            <div class="w-8 h-1 rounded-full bg-[#444857]"></div>
                        </div>

                        <!-- Bottom Half: Preview -->
                        <div class="flex-1 bg-white relative">
                            <iframe id="code-preview" class="absolute inset-0 w-full h-full border-0"></iframe>
                        </div>
                    </div>

                    <!-- Footer / Status Bar -->
                    <div class="h-6 bg-[#1e1f26] border-t border-[#2c303a] flex items-center justify-between px-3">
                        <span class="text-[10px] text-[#888888] font-mono">Console</span>
                        <span class="text-[10px] text-[#888888] font-mono">Auto-Save: Enabled</span>
                    </div>
                </div>

                <!-- Global Footer -->
                <!-- Premium Footer -->
                <footer class="mt-auto py-6 px-4 md:px-8">
                    <div
                        class="bg-white dark:bg-[#1e293b] border border-slate-200 dark:border-slate-800 rounded-2xl p-4 md:p-5 flex flex-col md:flex-row items-center justify-between gap-4 shadow-sm relative overflow-hidden group">

                        <!-- Decorative Gradient Pulse -->
                        <div
                            class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-indigo-500 via-purple-500 to-indigo-500 opacity-50 group-hover:opacity-100 transition-opacity">
                        </div>

                        <!-- Left: System Identity -->
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center p-2 border border-indigo-100 dark:border-indigo-900/30">
                                <img src="assets/bbsydp_logo.png" class="w-full h-full object-contain">
                            </div>
                            <div class="flex flex-col">
                                <span
                                    class="text-xs font-black text-slate-800 dark:text-slate-100 uppercase tracking-tight leading-none mb-1">BBSHRRDB
                                    LMS <span class="text-indigo-500 text-[10px] ml-1">v2.0</span></span>
                                <span
                                    class="text-[9px] font-bold text-slate-400 uppercase tracking-wider leading-none">©
                                    <span class="dynamic-year">2025</span> Super Systech Computers Umerkot</span>
                            </div>
                        </div>

                        <!-- Right: Creator Identity & Status -->
                        <div class="flex flex-col md:flex-row items-center gap-3 md:gap-6">

                            <div class="flex flex-col items-center md:items-end">
                                <div class="text-[8px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-0.5">
                                    Designed & Developed By</div>
                                <div class="flex items-center gap-1.5">
                                    <span
                                        class="text-[11px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest">Mukesh
                                        Kumar</span>
                                    <i data-lucide="badge-check"
                                        class="w-3.5 h-3.5 text-indigo-500 fill-indigo-100 dark:fill-indigo-900/50"></i>
                                </div>
                            </div>

                            <div class="hidden md:block w-px h-8 bg-slate-100 dark:bg-slate-800"></div>

                            <div
                                class="flex items-center gap-2 px-3 py-1.5 bg-emerald-50 dark:bg-emerald-500/10 rounded-lg border border-emerald-100 dark:border-emerald-500/20">
                                <div class="relative flex h-2 w-2">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                </div>
                                <span
                                    class="text-[9px] font-black uppercase text-emerald-600 dark:text-emerald-400 tracking-wider">Online</span>
                            </div>
                        </div>

                    </div>
                </footer>

                <!-- Spacer for Mobile Nav -->
                <div class="h-20 lg:hidden"></div>
        </main>
        <!-- Mobile Bottom Navigation -->

    </div>

    <!-- MODALS -->

    <!-- Image Crop Modal -->
    <div class="modal fade" id="cropModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-4">
                    <h5 class="modal-title font-black text-sm tracking-tight text-slate-900 dark:text-slate-100">Adjust
                        Profile Picture</h5>
                    <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0 bg-slate-900">
                    <div class="h-[400px] w-full flex items-center justify-center">
                        <img id="crop-image" src="" class="max-w-full max-h-full block">
                    </div>
                </div>
                <div class="modal-footer border-t border-slate-100 dark:border-slate-800 p-3 flex justify-between">
                    <button type="button" class="btn-command px-4 py-2 rounded-lg text-xs"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="crop-confirm-btn"
                        class="btn-command px-6 py-2 rounded-lg text-xs bg-indigo-600 text-white shadow-lg shadow-indigo-500/20">
                        <i data-lucide="check" class="w-3 h-3 inline mr-1"></i> Crop & Upload
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Resource Modal (Admin) -->
    <div class="modal fade" id="createResourceModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-6 pb-0">
                    <h5 class="modal-title font-black text-lg tracking-tight text-slate-900 dark:text-slate-100">Upload
                        Learning Material</h5>
                    <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-6">
                    <form id="resource-upload-form" class="space-y-4">
                        <div>
                            <label
                                class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Title</label>
                            <input type="text" id="res-title" required
                                class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold"
                                placeholder="e.g. React Fundamentals">
                        </div>
                        <div>
                            <label
                                class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Description
                                / Subtitle</label>
                            <input type="text" id="res-desc"
                                class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold"
                                placeholder="Short description">
                        </div>
                        <div>
                            <label
                                class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Category</label>
                            <select id="res-category"
                                class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold">
                                <option value="video">Video Tutorial</option>
                                <option value="doc">Document / PDF</option>
                                <option value="link">External Link</option>
                            </select>
                        </div>

                        <div
                            class="p-4 bg-slate-50 dark:bg-[#0b1120] rounded-xl border border-dashed border-slate-200 dark:border-slate-800">
                            <label
                                class="text-[9px] font-black uppercase tracking-widest text-slate-400 mb-2 block">Upload
                                File (Cloudinary)</label>
                            <input type="file" id="res-file"
                                class="w-full text-xs font-bold text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-[9px] file:font-black file:bg-indigo-50 file:text-indigo-600 hover:file:bg-indigo-100"
                                accept=".pdf,.mp4,.jpg,.png,.zip">
                            <p
                                class="text-[8px] font-black text-emerald-500 uppercase tracking-widest mt-2 flex items-center gap-1">
                                <i data-lucide="cloud" class="w-3 h-3"></i> Guaranteed Storage: Cloudinary
                            </p>
                        </div>

                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-slate-100 dark:border-slate-800"></div>
                            </div>
                            <div class="relative flex justify-center text-[10px] uppercase font-bold">
                                <span class="bg-white dark:bg-[#1e293b] px-2 text-slate-400">Or External URL</span>
                            </div>
                        </div>

                        <div>
                            <input type="url" id="res-link"
                                class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold"
                                placeholder="https://youtube.com/...">
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-6 pt-0">
                    <button type="submit" form="resource-upload-form" id="upload-res-btn"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all transform hover:scale-[1.02]">
                        Add Resource
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: CREATE NOTICE MODAL -->
    <div class="modal fade" id="createNoticeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-6 pb-0">
                    <h5 class="modal-title font-black text-lg text-indigo-500 uppercase tracking-tight">Post Notice</h5>
                    <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-6 space-y-4">
                    <div>
                        <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Title</label>
                        <input type="text" id="notice-title"
                            class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold focus:ring-2 focus:ring-indigo-500 outline-none"
                            placeholder="e.g. Schedule Change">
                    </div>
                    <div>
                        <label
                            class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Priority</label>
                        <div class="flex gap-4 mt-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="notice-priority" value="normal" checked
                                    class="accent-indigo-500">
                                <span class="text-xs font-bold text-slate-600 dark:text-slate-300">Normal</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="notice-priority" value="urgent" class="accent-rose-500">
                                <span class="text-xs font-bold text-rose-500">Urgent (Ticker)</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label
                            class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-1">Content</label>
                        <textarea id="notice-content" rows="3"
                            class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-xl text-xs font-bold focus:ring-2 focus:ring-indigo-500 outline-none"
                            placeholder="Details..."></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0 p-6 pt-0">
                    <button onclick="submitNotice()"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-indigo-500/20 transition-all transform hover:scale-[1.02]">
                        Post Notice
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-6 pb-0">
                    <h5
                        class="modal-title font-black text-lg text-slate-900 dark:text-slate-100 uppercase tracking-tight">
                        Recovery</h5>
                    <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-6">
                    <div id="forgot-ui-content">
                        <p class="text-xs text-slate-500 mb-4 font-bold">Enter your registered email address. We'll send
                            you
                            a secure link to reset your password.</p>
                        <form onsubmit="submitForgotPassword(event)" class="space-y-4">
                            <div>
                                <input type="email" id="forgot-email" required
                                    class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border-0 rounded-xl text-sm font-bold"
                                    placeholder="name@example.com">
                            </div>
                            <button type="submit" id="forgot-btn"
                                class="w-full btn-command py-3 rounded-xl text-xs">Send
                                Recovery Link</button>
                            <div id="forgot-msg"
                                class="text-center mt-3 text-[10px] font-black uppercase tracking-widest hidden"></div>
                        </form>
                    </div>
                    <div id="forgot-ui-success" class="hidden text-center py-6 animate-in zoom-in duration-300">
                        <div
                            class="w-16 h-16 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="mail-check" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-slate-900 dark:text-slate-200 font-black uppercase tracking-tight text-lg mb-2">
                            Check Your Inbox</h3>
                        <p class="text-xs text-slate-500 font-bold px-4">We've sent a recovery link to your email
                            address.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal (Triggered by Link) -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-6 pb-0">
                    <h5 class="modal-title font-black text-lg text-indigo-500 uppercase tracking-tight">Set New Password
                    </h5>
                </div>
                <div class="modal-body p-6">
                    <div id="reset-ui-content">
                        <p class="text-xs text-slate-500 mb-4 font-bold">Welcome back! Please choose a new secure
                            password
                            for your account.</p>
                        <form onsubmit="submitResetPassword(event)" class="space-y-4">
                            <div>
                                <input type="password" id="reset-new-pass" required minlength="6"
                                    class="w-full p-3 bg-slate-50 dark:bg-[#0b1120] border-0 rounded-xl text-sm font-bold"
                                    placeholder="New Password (min 6 chars)">
                            </div>
                            <button type="submit" id="reset-pass-btn"
                                class="w-full btn-command py-3 rounded-xl text-xs shadow-lg shadow-indigo-500/20">Update
                                Password</button>
                            <div id="reset-msg"
                                class="text-center mt-3 text-[10px] font-black uppercase tracking-widest hidden"></div>
                        </form>
                    </div>
                    <div id="reset-ui-success" class="hidden text-center py-6 animate-in zoom-in duration-300">
                        <div
                            class="w-16 h-16 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="check-circle-2" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-slate-900 dark:text-slate-200 font-black uppercase tracking-tight text-lg mb-2">
                            Password Updated</h3>
                        <p class="text-xs text-slate-500 font-bold mb-4">Login refreshing in 3 seconds...</p>
                        <div class="flex justify-center"><i data-lucide="loader-2"
                                class="w-5 h-5 animate-spin text-indigo-500"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div class="modal fade" id="createTaskModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content v-card border-0 shadow-2xl p-2 overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-5 pb-0">
                    <h5 class="modal-title font-black text-xl tracking-tight text-slate-900 dark:text-slate-100">Create
                        New
                        Task</h5>
                    <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-5 pt-4">
                    <form id="create-task-form" class="space-y-4">
                        <div class="space-y-1.5">
                            <label class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Task
                                Title</label>
                            <input type="text" id="new-task-title" required
                                class="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-sm font-semibold"
                                placeholder="e.g., JavaScript Project">
                        </div>
                        <div class="space-y-1.5">
                            <label
                                class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Description</label>
                            <textarea id="new-task-desc" required
                                class="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-sm font-semibold"
                                rows="3" placeholder="Enter task details..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1.5">
                                <label
                                    class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Deadline</label>
                                <input type="datetime-local" id="new-task-date"
                                    class="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-[11px] font-semibold">
                            </div>
                            <div class="space-y-1.5">
                                <label
                                    class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Reference</label>
                                <div
                                    class="relative w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-800 flex items-center justify-between">
                                    <span id="ref-file-name" class="text-[10px] text-slate-500 truncate pr-2">Attach
                                        file</span>
                                    <input type="file" id="new-task-ref"
                                        class="absolute inset-0 opacity-0 cursor-pointer"
                                        onchange="$('#ref-file-name').text(this.files[0].name)">
                                    <i data-lucide="paperclip" class="w-3.5 h-3.5 text-slate-400"></i>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1">Hints
                                (Optional)</label>
                            <input type="text" id="new-task-hints"
                                class="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-[11px] font-semibold"
                                placeholder="Helpful tips...">
                        </div>
                        <button type="submit" id="task-submit-btn" class="w-full btn-command mt-2">Create Task</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail/Submit Modal -->
    <div class="modal fade" id="taskDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content v-card border-0 shadow-2xl overflow-hidden bg-white dark:bg-[#1e293b]">
                <div class="modal-header border-0 p-8 pb-0 flex flex-col items-start gap-4">
                    <div class="flex justify-between w-full items-start">
                        <div
                            class="inline-flex items-center gap-2 px-3 py-1 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-400 rounded-full text-[10px] font-black uppercase tracking-widest mb-2">
                            <i data-lucide="info" class="w-3 h-3"></i> Task Info
                        </div>
                        <button type="button" class="btn-close dark:btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div>
                        <h5 class="modal-title font-black text-3xl text-slate-900 dark:text-slate-200"
                            id="detail-title">
                            Task Detail</h5>
                        <p class="text-sm text-slate-500 font-medium mt-2 flex items-center gap-2">
                            <i data-lucide="timer" class="w-4 h-4 text-indigo-500"></i> Time Remaining: <span
                                id="detail-time-container"
                                class="text-slate-900 dark:text-slate-100 font-bold">--</span>
                        </p>
                        <!-- Tags Container -->
                        <div id="detail-tags" class="flex flex-wrap gap-2 mt-3"></div>
                    </div>
                </div>
                <div class="modal-body p-8 pt-6">
                    <div class="prose prose-sm dark:prose-invert text-slate-600 dark:text-slate-400 mb-6 p-6 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-100 dark:border-slate-800 whitespace-pre-wrap leading-relaxed shadow-inner"
                        id="detail-desc"></div>

                    <div id="detail-guidance" class="hidden mb-8 space-y-4">
                        <div
                            class="p-5 rounded-2xl bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-900/50">
                            <div class="flex items-center gap-2 mb-2 text-amber-700 dark:text-amber-400">
                                <i data-lucide="lightbulb" class="w-4 h-4"></i>
                                <span class="text-[10px] font-black uppercase tracking-widest">Teacher's Hint</span>
                            </div>
                            <p class="text-xs text-amber-800 dark:text-amber-300 font-medium italic" id="detail-hints">
                            </p>
                        </div>
                    </div>

                    <!-- Submit Section -->
                    <div id="submission-section">
                        <form id="submit-form" class="space-y-6">
                            <input type="hidden" id="submit-id">
                            <div
                                class="group relative bg-slate-50 dark:bg-slate-800/30 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-3xl p-10 text-center hover:border-indigo-500 transition-all cursor-pointer overflow-hidden">
                                <div
                                    class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity">
                                </div>
                                <input type="file" id="submit-file" required
                                    class="absolute inset-0 opacity-0 cursor-pointer z-10"
                                    onchange="$('#file-name').text(this.files[0].name)">
                                <div class="relative z-0">
                                    <div
                                        class="w-16 h-16 bg-white dark:bg-slate-800 shadow-xl rounded-2xl flex items-center justify-center text-indigo-600 mx-auto mb-4 group-hover:scale-110 transition-transform">
                                        <i data-lucide="upload-cloud" class="w-8 h-8"></i>
                                    </div>
                                    <p class="font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight">
                                        Upload
                                        Your File</p>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-2"
                                        id="file-name">Allowed: PDF, ZIP, IMG (max 5mb)</p>
                                </div>
                            </div>
                            <button type="submit" class="w-full btn-command">Submit Task</button>
                        </form>
                    </div>

                    <!-- Status Messages -->
                    <div id="admin-view-msg"
                        class="hidden p-8 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-3xl text-center border border-blue-100 dark:border-blue-900/50">
                        <i data-lucide="shield-check" class="w-10 h-10 mx-auto mb-4 opacity-50"></i>
                        <h4 class="font-black text-lg">Admin View</h4>
                        <p class="text-sm mt-1 font-medium italic">You are currently viewing this task as a teacher.</p>
                        <button onclick="openEditFromDetail()"
                            class="btn-command mt-6 px-8 py-3 rounded-xl mx-auto flex items-center justify-center gap-2">
                            <i data-lucide="edit-3" class="w-4 h-4"></i> Edit Task Details
                        </button>
                    </div>

                    <!-- Graded Result -->
                    <div id="result-section" class="hidden text-center py-10 animate-in zoom-in duration-500">
                        <div
                            class="w-20 h-20 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 dark:text-emerald-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl shadow-emerald-500/10">
                            <i data-lucide="check" class="w-10 h-10"></i>
                        </div>
                        <h3 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase tracking-tighter">
                            Task Graded</h3>
                        <div class="flex items-center justify-center gap-4 my-8">
                            <div
                                class="p-8 bg-slate-50 dark:bg-slate-800/80 rounded-[32px] border border-slate-100 dark:border-slate-800 shadow-inner">
                                <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">
                                    Your Grade</p>
                                <div class="text-6xl font-black text-indigo-500 tracking-tighter"><span
                                        id="result-grade">0</span><span class="text-2xl text-slate-400">/100</span>
                                </div>
                            </div>
                        </div>
                        <div
                            class="max-w-md mx-auto p-6 bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 italic text-slate-500 mb-8 font-medium">
                            "<span id="result-feedback"></span>"
                        </div>
                        <button onclick="downloadReport()"
                            class="px-4 py-2 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl border border-indigo-100 dark:border-indigo-800 text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 mx-auto hover:bg-indigo-100 transition-colors shadow-sm">
                            <i data-lucide="file-text" class="w-3.5 h-3.5"></i> PDF Report
                        </button>
                    </div>

                    <!-- 🗣️ DISCUSSION HUB (NEW) -->
                    <div class="mt-12 pt-12 border-t border-slate-100 dark:border-slate-800">
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-10 h-10 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500">
                                <i data-lucide="message-square" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h4 class="text-sm font-black uppercase tracking-tighter">Discussion Hub</h4>
                                <p class="text-[8px] text-slate-400 font-bold uppercase tracking-widest">Real-time Task
                                    Support</p>
                            </div>
                        </div>

                        <div id="comments-container"
                            class="space-y-4 max-h-[300px] overflow-y-auto mb-6 pr-2 custom-scrollbar flex flex-col">
                            <div
                                class="text-center py-8 text-slate-400 text-[9px] font-bold uppercase tracking-widest italic opacity-50">
                                Loading discussion...</div>
                        </div>

                        <div class="relative group">
                            <textarea id="comment-input" rows="1"
                                class="w-full p-4 pr-16 bg-slate-50 dark:bg-[#0b1120] border border-slate-100 dark:border-slate-800 rounded-2xl text-[11px] font-medium outline-none focus:ring-2 focus:ring-indigo-500 transition-all resize-none text-slate-900 dark:text-slate-100"
                                placeholder="Type a message or ask a question..."></textarea>
                            <button onclick="postComment()"
                                class="absolute right-3 bottom-2.5 p-2 bg-indigo-600 text-white rounded-xl shadow-lg shadow-indigo-500/20 hover:scale-105 active:scale-95 transition-all">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- SAFE ICON LOADER ---
        window.safeCreateIcons = () => {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        };

        const SUPABASE_URL = "https://oaycnrsbrgancgrxhztd.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9heWNucnNicmdhbmNncnhoenRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNjIyMzIsImV4cCI6MjA4MTczODIzMn0.Md8TTNA7nY504_STka-04BM9WAoVZ32J_-JCirAGgC4";
        // Initialize Supabase Client
        let client; // Renamed from 'supabase' to 'client' to match original usage
        window.SUPABASE_AVAILABLE = false;

        try {
            // FIX: Check for 'supabase' global namespace from CDN (v2)
            if (typeof supabase !== 'undefined' && supabase.createClient) {
                client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                window.client = client; // Make globally available
                window.SUPABASE_AVAILABLE = true;
                console.log("Supabase (v2) initialized successfully via namespace.");
            } else if (typeof createClient !== 'undefined') {
                // Fallback for older versions or direct imports
                client = createClient(SUPABASE_URL, SUPABASE_KEY);
                window.client = client; // Make globally available
                window.SUPABASE_AVAILABLE = true;
                console.log("Supabase initialized via global createClient.");
            } else {
                console.warn("Supabase library not loaded. Starting in offline mode (Guest).");
                window.client = null; // Prevent ReferenceError
            }
        } catch (e) {
            console.error("Supabase init failed:", e);
            window.client = null; // Prevent ReferenceError
        }
        const { jsPDF } = window.jspdf || { jsPDF: null };

        // NEW: Capture Recovery Mode IMMEDIATELY before hash is cleared
        window.isRecoveryMode = window.location.hash && window.location.hash.includes('type=recovery');
        if (window.isRecoveryMode) console.log("Global Recovery Flag Set: TRUE");

        let currentUser = null, userProfile = null, syncInterval = null, performanceChart = null;
        // Expose to window for external scripts (like chat.js)
        window.currentUser = currentUser;
        window.userProfile = userProfile;
        let activeTab = 'dashboard', currentTask = null, currentSub = null, editingTaskId = null;
        let isInitializing = false;
        window.tempInputState = {};
        window.allSubmissions = []; window.allTasks = [];

        // --- UI NAVIGATION ---
        window.toggleSidebar = () => {
            const aside = $('aside');
            const overlay = $('#sidebar-overlay');

            if (aside.hasClass('-translate-x-full')) {
                aside.removeClass('-translate-x-full').addClass('translate-x-0');
                overlay.addClass('show');
            } else {
                aside.removeClass('translate-x-0').addClass('-translate-x-full');
                overlay.removeClass('show');
            }
        };

        // Close sidebar on tab switch (mobile only)
        function closeSidebarOnMobile() {
            if (window.innerWidth <= 1024) {
                $('.sidebar').removeClass('open');
                $('#sidebar-overlay').removeClass('show');
            }
        }

        // --- THEME ENGINE ---


        // --- AUTH LOGIC ---
        window.switchAuth = (role) => {
            // Persist selection to prevent refresh mismatches
            localStorage.setItem('last_auth_tab', role);

            $('#auth-form').data('role', role);
            $('#auth-error').addClass('hidden').text('');

            // Modern classes for auth tabs (matching the UI design)
            const activeClass = "bg-white dark:bg-[#1e293b] shadow-sm text-indigo-600 dark:text-indigo-400";
            const inactiveClass = "text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300";

            if (role === 'admin') {
                $('#tab-admin').addClass(activeClass).removeClass(inactiveClass);
                $('#tab-student').removeClass(activeClass).addClass(inactiveClass);
            } else {
                $('#tab-student').addClass(activeClass).removeClass(inactiveClass);
                $('#tab-admin').removeClass(activeClass).addClass(inactiveClass);
            }
        };

        // --- SESSION MANAGEMENT ---
        async function checkSession() {
            if (isInitializing) return;

            // Safety Check for Offline Mode
            if (!client || !client.auth) {
                console.warn("Offline Mode: Skipping session check.");
                finishInitialization(false);
                return;
            }

            try {
                const { data: { session } } = await client.auth.getSession();
                if (session) {
                    await handleUserSession(session.user);
                } else {
                    finishInitialization(false);
                }
            } catch (err) {
                console.error("Session check failed:", err);
                finishInitialization(false);
            }
        }

        async function handleUserSession(user) {
            // If recovery mode, skip login logic and stay on auth screen
            if (window.isRecoveryMode) {
                console.log("Recovery Mode Detected: Skipping Dashboard Init");
                finishInitialization(false);
                return;
            }

            if (!user) { finishInitialization(false); return; }

            // PROMISE-BASED LOCK: Request Coalescing
            if (window.sessionInitPromise) {
                console.log("[Session] Joining existing initialization process...");
                return window.sessionInitPromise;
            }

            window.sessionInitPromise = (async () => {
                isInitializing = true;
                let loadedFromCache = false;

                try {
                    // Check cache availability for this user ID
                    const cachedParams = localStorage.getItem('supabase_profile_cache');

                    if (cachedParams) {
                        try {
                            const parsed = JSON.parse(cachedParams);
                            if (parsed.uid === user.id) {
                                console.log("[Session] Instant load from cache.");
                                currentUser = user;
                                userProfile = parsed;
                                // CRITICAL FIX: Update global window variables immediately
                                window.currentUser = currentUser;
                                window.userProfile = userProfile;
                                initDashboard(); // UI is now visible!
                                loadedFromCache = true;
                            }
                        } catch (e) { localStorage.removeItem('supabase_profile_cache'); }
                    }

                    // DEFINE the fresh fetch promise
                    // DEFINE the fresh fetch promise
                    let fetchProfilePromise;
                    if (client) {
                        fetchProfilePromise = client.from('profiles').select('*').eq('uid', user.id).maybeSingle();
                    } else {
                        // Offline Mock Promise
                        console.warn("Offline Mode: Skipping background profile sync.");
                        fetchProfilePromise = Promise.resolve({ data: null, error: { message: "Offline" } });
                    }

                    // CRITICAL OPTIMIZATION:
                    // If we loaded from cache, DO NOT WAIT for the network. Let it run in background.
                    if (loadedFromCache) {
                        console.log("[Session] Cache hit. Detaching fresh fetch to background.");
                        fetchProfilePromise.then(async ({ data: profile, error }) => {
                            if (!profile || error) return; // Silent fail if DB issue, cache is good enough for now

                            // Check for critical changes preventing access
                            if (profile.role !== userProfile.role || profile.status === 'pending') {
                                // If critical status changed, force reload
                                localStorage.setItem('supabase_profile_cache', JSON.stringify(profile));
                                location.reload();
                                return;
                            }

                            // Update cache silently
                            localStorage.setItem('supabase_profile_cache', JSON.stringify(profile));
                            console.log("[Session] Background profile sync complete.");
                        });
                        return; // EXIT FUNCTION IMMEDIATELY -> Promises resolves -> Loader unlocks
                    }

                    // If NOT cached, we MUST wait for the fetch, but with a TIMEOUT to prevent hanging
                    // Create a timeout promise that rejects after 5 seconds
                    // Create a timeout promise that rejects after 15 seconds (increased from 5s)
                    const timeoutPromise = new Promise((_, reject) =>
                        setTimeout(() => reject(new Error("Network Timeout: Profile fetch took too long. Please check your internet connection.")), 15000)
                    );

                    let profileData;
                    try {
                        profileData = await Promise.race([fetchProfilePromise, timeoutPromise]);
                    } catch (timeoutErr) {
                        console.warn("[Session] Profile sync timed out. Proceeding with limited access or error.");
                        throw timeoutErr; // Let the catch block handle it (logout/error message)
                    }

                    const { data: profile, error } = profileData;

                    if (error) throw error;

                    if (!profile) {
                        console.warn("[Session] Profile not found (User Deleted).");
                        await client.auth.signOut();
                        localStorage.removeItem('supabase_profile_cache');
                        throw new Error("Access Revoked: Your account has been deleted by an administrator.");
                    } else {
                        // ROLE CHECK with Auto-Correction
                        const intendedRole = $('#tab-student').hasClass('bg-white') ? 'student' : 'admin';

                        if (profile.role !== intendedRole) {
                            console.log(`[Session] Role mismatch detected. Auto-switching to ${profile.role} view.`);
                            if (window.switchAuth) window.switchAuth(profile.role);
                        }

                        if (profile.status === 'pending') {
                            console.warn("[Security] Account Pending Approval");
                            await client.auth.signOut();
                            localStorage.removeItem('supabase_profile_cache');
                            throw new Error("Account is pending Admin Approval. Please contact your administrator.");
                        }

                        // Success: Update Cache
                        localStorage.setItem('supabase_profile_cache', JSON.stringify(profile));

                        currentUser = user;
                        userProfile = profile;

                        // CRITICAL FIX: Expose variables globally for chat.js
                        window.currentUser = currentUser;
                        window.userProfile = userProfile;

                        // Initialize Chat if available
                        if (window.initChat) {
                            console.log("Initializing Chat System...");
                            window.initChat();
                        }

                        initDashboard();
                    }

                } catch (err) {
                    console.error("Session Sync Error:", err);

                    if (!loadedFromCache) {
                        currentUser = null;
                        userProfile = null;
                        finishInitialization(false);

                        const btn = $('#auth-btn');
                        btn.prop('disabled', false);
                        // Restore button text based on current mode
                        const originalText = $('#name-field').hasClass('hidden') ? 'Sign In' : 'Create Account';
                        btn.find('span').text(originalText);

                        if ($('#auth-wrapper').is(':visible')) {
                            $('#auth-error').text(err.message).removeClass('hidden');
                        } else {
                            showToast(err.message);
                        }
                    }
                } finally {
                    // CRITICAL: Always clear the lock so subsequent attempts can proceed
                    isInitializing = false;
                    window.sessionInitPromise = null;
                }
            })();

            return window.sessionInitPromise;
        }

        function finishInitialization(isLoggedIn) {
            $('#global-loader').fadeOut(300);
            if (isLoggedIn) {
                $('#auth-wrapper').addClass('hidden');
                $('#dashboard-layout').removeClass('hidden').css('display', 'flex');

                // Show Mobile Nav
                $('#mobile-nav-bar').removeClass('hidden');

                // Init Daily Quests
            } else {
                $('#dashboard-layout').addClass('hidden');
                $('#mobile-nav-bar').addClass('hidden'); // Hide Mobile Nav
                $('#auth-wrapper').removeClass('hidden');
                // Ensure credentials are shown when returning to auth screen
                if (window.populateRememberedCredentials) window.populateRememberedCredentials();
                window.safeCreateIcons(); // Force refresh icons for eye button
            }
        }

        if (client && client.auth) {
            client.auth.onAuthStateChange(async (event, session) => {
                console.log("Supabase Auth Event:", event);
                if (event === 'PASSWORD_RECOVERY') {
                    // Show Reset Password Modal
                    setTimeout(() => new bootstrap.Modal(document.getElementById('resetPasswordModal')).show(), 500);
                } else if (event === 'SIGNED_IN' && session) {
                    await handleUserSession(session.user);
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    userProfile = null;
                    isInitializing = false;
                    finishInitialization(false);
                }
            });
        } else {
            console.warn("Supabase Auth not available. Auto-login disabled.");
            // Force finish init to remove loader if offline
            setTimeout(() => finishInitialization(false), 100);
        }

        $(document).ready(() => {
            const savedRole = localStorage.getItem('last_auth_tab') || 'student';
            switchAuth(savedRole);

            // Explicitly check for Recovery Hash to ensure Modal opens
            if (window.isRecoveryMode) {
                console.log("Manual Recovery detection triggered.");
                setTimeout(() => {
                    const modalEl = document.getElementById('resetPasswordModal');
                    if (modalEl) new bootstrap.Modal(modalEl).show();
                }, 1000);
            }

            checkSession();
            // Safety timeout
            setTimeout(() => {
                if ($('#global-loader').is(':visible')) {
                    console.warn("Initialization taking longer than expected... Resetting locks.");
                    // CRITICAL: Clear the lock so user can try again manually
                    window.sessionInitPromise = null;
                    isInitializing = false;
                    finishInitialization(!!currentUser);
                }
            }, 12000);
        });

        // --- TOGGLE MODE OVERRIDE ---
        window.customToggleMode = () => {
            const nameField = $('#name-field');
            const avatarField = $('#avatar-field');
            const btn = $('#auth-btn');
            const footer = $('#auth-footer');
            const isSwitchingToSignup = nameField.hasClass('hidden');

            console.log("Custom Toggle Triggered. Switching to Signup?", isSwitchingToSignup);

            if (isSwitchingToSignup) {
                // SWITCH TO SIGNUP
                nameField.removeClass('hidden');
                avatarField.removeClass('hidden');

                btn.find('span').text('Create Account');
                // Icon Logic
                btn.find('svg, i').remove();
                btn.append('<i data-lucide="user-plus" class="w-3.5 h-3.5"></i>');

                footer.html('Already have an account? <button onclick="customToggleMode()" class="text-indigo-500 hover:underline">Sign In</button>');
            } else {
                // SWITCH TO LOGIN
                nameField.addClass('hidden');
                avatarField.addClass('hidden');

                btn.find('span').text('Sign In');
                // Icon Logic
                btn.find('svg, i').remove();
                btn.append('<i data-lucide="log-in" class="w-3.5 h-3.5"></i>');

                // Clear inputs
                $('#auth-name').val('');
                $('#auth-avatar').val('');

                footer.html('New here? <button onclick="customToggleMode()" class="text-indigo-500 hover:underline">Create Account</button>');
            }
            lucide.createIcons();
        };

        window.handleAuthSubmit = async (e) => {
            e.preventDefault();
            console.log("[Global] Auth Submit Detected");

            const btn = $('#auth-btn');
            const originalText = btn.find('span').text();
            const errorElement = $('#auth-error');
            const email = $('#auth-email').val();
            const pass = $('#auth-pass').val();
            const name = $('#auth-name').val(); // Capture name early
            const fileInput = document.getElementById('auth-avatar');

            errorElement.addClass('hidden').text('');
            btn.prop('disabled', true).find('span').text('Verifying...');

            if (!client) {
                // OFFLINE LOGIN BYPASS
                console.warn("Offline Mode: Attempting local login bypass.");
                const role = localStorage.getItem('last_auth_tab') || 'student';
                const mockUser = { id: 'offline-user-id', email: email || 'offline@local' };
                const mockProfile = {
                    uid: 'offline-user-id',
                    name: name || 'Guest User',
                    email: email || 'offline@local',
                    role: role,
                    status: 'approved',
                    avatar_url: null
                };

                // Inject into cache so handleUserSession picks it up
                localStorage.setItem('supabase_profile_cache', JSON.stringify(mockProfile));

                showToast("Login Successful!", "success");
                await handleUserSession(mockUser);
                finishInitialization(true); // Force UI switch
                isInitializing = false;
                return;
            }

            try {
                if (originalText === 'Create Account') {
                    // SIGNUP FLOW
                    if (!name) throw new Error("Full Name is required.");

                    let data, error;
                    // SignUp
                    // We MUST pass metadata (Name) because your Supabase Database Triggers likely require it.
                    // Without this, the database rejects the new user (500 Error).
                    const signUpResult = await client.auth.signUp({
                        email,
                        password: pass,
                        options: { data: { name: name } }
                    });

                    if (signUpResult.error && signUpResult.error.message.toLowerCase().includes('already registered')) {
                        // Check for Partial Deletion (Zombie User) because SQL Script wasn't run
                        const { data: loginData, error: loginError } = await client.auth.signInWithPassword({ email, password: pass });

                        if (!loginError && loginData.user) {
                            const { data: existingProfile } = await client.from('profiles').select('uid').eq('uid', loginData.user.id).single();
                            if (!existingProfile) {
                                // Profile is missing - Allow Re-creation
                                console.log("Recovering Zombie Account");
                                data = { user: loginData.user };
                                error = null;
                            } else {
                                throw signUpResult.error; // Normal duplicate error
                            }
                        } else {
                            throw signUpResult.error; // Password mismatch or other error
                        }
                    } else {
                        data = signUpResult.data;
                        error = signUpResult.error;
                    }

                    if (error) throw error;

                    const userId = data.user.id;
                    let avatarUrl = null;

                    // Upload Avatar Logic
                    if (fileInput && fileInput.files && fileInput.files.length > 0) {
                        try {
                            const file = fileInput.files[0];
                            const fileExt = file.name.split('.').pop();
                            const fileName = `${userId}-${Math.random().toString(36).substring(7)}.${fileExt}`;

                            // Attempt Upload to Supabase
                            const { error: uploadError } = await client.storage
                                .from('avatars')
                                .upload(fileName, file);

                            if (!uploadError) {
                                const { data: { publicUrl } } = client.storage
                                    .from('avatars')
                                    .getPublicUrl(fileName);
                                avatarUrl = publicUrl;
                            } else {
                                console.warn("Cloud Upload Failed (Bucket might be missing). Using Local Fallback.");
                                // Fallback: Convert to Base64 and save locally
                                const getBase64 = (f) => new Promise((resolve) => {
                                    const reader = new FileReader();
                                    reader.readAsDataURL(f);
                                    reader.onload = () => resolve(reader.result);
                                    reader.onerror = () => resolve(null);
                                });

                                const base64Data = await getBase64(file);
                                if (base64Data) {
                                    localStorage.setItem(`cached_avatar_${userId}`, base64Data);
                                }
                            }
                        } catch (uploadErr) {
                            console.warn("Avatar upload exception:", uploadErr);
                        }
                    }

                    // Create or Update Profile (Upsert ensures data sync)
                    const { error: profileError } = await client.from('profiles').upsert({
                        uid: userId,
                        name: name,
                        email,
                        role: 'student',
                        status: 'pending',
                        avatar_url: avatarUrl
                    }, { onConflict: 'uid' });

                    if (profileError) throw profileError;

                    showToast("Account created! Waiting for Admin Approval.", "success");
                    await client.auth.signOut();
                    $('#auth-error').removeClass('hidden').text("Registration Successful! Please wait for Admin Approval before logging in.");

                    // Switch back to Login View
                    // Reset UI manually since toggleMode checks classes
                    customToggleMode();
                    btn.prop('disabled', false);
                } else {
                    // Standard Login
                    const { data, error } = await client.auth.signInWithPassword({ email, password: pass });
                    if (error) throw error;

                    // EXPLICIT MODE: Immediately handle the user session
                    // This prevents sticking on "Verifying..." if onAuthStateChange is slow/missed.
                    if (data?.user) {
                        await handleUserSession(data.user);
                    }
                }
            } catch (err) {
                console.error("Auth Error:", err);
                let msg = err.message;
                // Specific handling for the 500 Trigger Error (Duplicate Key / Zombie Profile)
                if (msg.includes('500') || (err.status === 500) || msg.includes('Database error')) {
                    msg = "Database Error (500). An old Profile is likely blocking registration. Please run the 'fix_signup_error.sql' script in your Supabase Dashboard.";
                }
                errorElement.text(msg).removeClass('hidden');
                btn.prop('disabled', false).find('span').text(originalText);
            }
        };

        // --- AUTOMATED PROGRESS ANALYSIS SYSTEM ---
        window.runAutoProgressAnalysis = async () => {
            console.log("Running Auto-Progress Analysis...");
            if (!window.allSubmissions || !window.allUsersCache) return;

            // 1. Calculate Averages
            const stats = {};
            window.allSubmissions.filter(s => s.status === 'graded').forEach(s => {
                if (!stats[s.student_id]) stats[s.student_id] = { total: 0, count: 0, name: s.student_name };
                stats[s.student_id].total += s.grade;
                stats[s.student_id].count++;
            });

            // 2. Identify Top Performers (> 85% Average)
            const topPerformers = [];
            Object.keys(stats).forEach(uid => {
                const avg = stats[uid].total / stats[uid].count;
                if (avg >= 85 && stats[uid].count >= 2) { // Minimum 2 tasks
                    topPerformers.push({ id: uid, name: stats[uid].name, avg: Math.round(avg) });
                }
            });

            // 3. Check & Notify (Simulated Backend Job)
            // We use the Notice system with a private tag mechanism.
            // Check if we already notified them recently (Client-side check for now)
            const today = new Date().toDateString();
            const lastRun = localStorage.getItem('last_progress_analysis');

            if (lastRun === today) {
                console.log("Analysis already ran today.");
                return;
            }

            // In a real backend, this would happen on server. Here Admin client does it.
            for (const student of topPerformers) {
                // Check if notice exists
                const { data: existing } = await client.from('notices')
                    .select('id')
                    .ilike('title', `@${student.name}%`)
                    .gt('created_at', new Date(Date.now() - 86400000 * 7).toISOString()); // Last 7 days

                if (!existing || existing.length === 0) {
                    // Insert Commendation
                    await client.from('notices').insert({
                        title: `@${student.name} - Outstanding Progress!`,
                        content: `Congratulations! Your performance is exceptional with an average score of ${student.avg}%. Keep up the fantastic work!`,
                        priority: 'normal',
                        created_by: currentUser.id,
                        is_active: true
                    });
                    showToast(`Auto-Commendation sent to ${student.name}`);
                }
            }
            localStorage.setItem('last_progress_analysis', today);
        };




        // --- NOTICE BOARD LOGIC ---
        window.openNoticeModal = () => {
            new bootstrap.Modal(document.getElementById('createNoticeModal')).show();
        };

        window.submitNotice = async () => {
            const title = $('#notice-title').val();
            const content = $('#notice-content').val();
            const priority = $('input[name="notice-priority"]:checked').val();

            if (!title) return showToast("Title is required.");

            try {
                const { error } = await client.from('notices').insert({
                    title: title,
                    content: content || '',
                    priority: priority,
                    created_by: currentUser.id
                });

                if (error) throw error;
                showToast("Notice Posted Successfully!", "success");

                const modal = bootstrap.Modal.getInstance(document.getElementById('createNoticeModal'));
                if (modal) modal.hide();

                fetchNotices(); // Refresh list

            } catch (err) {
                showToast("Failed to post notice: " + err.message);
            }
        };

        window.refreshNotices = () => {
            const icon = $('#refreshNotices i');
            icon.addClass('animate-spin');
            fetchNotices().then(() => setTimeout(() => icon.removeClass('animate-spin'), 1000));
        };

        window.fetchNotices = async () => {
            try {
                const { data: notices, error } = await client.from('notices')
                    .select('*')
                    .eq('is_active', true)
                    .order('created_at', { ascending: false });

                if (error) {
                    // Fail silently if table doesn't exist yet
                    console.warn("Notice fetch warning (table might be missing):", error);
                    return;
                }

                renderNotices(notices || []);

            } catch (e) {
                console.error("Error fetching notices:", e);
            }
        };

        window.renderNotices = (notices) => {
            const list = $('#notice-list');
            list.empty();
            let hasUrgent = false;

            // Personalized Filtering
            const relevantNotices = notices.filter(n => {
                const title = n.title || '';

                // Admin sees EVERYTHING to monitor the system
                if (userProfile.role === 'admin') return true;

                // If it starts with @, it's a private message.
                // Only show if it matches @[MyName]
                if (title.startsWith('@')) {
                    if (title.toLowerCase().startsWith(`@${userProfile.name.toLowerCase()}`)) return true;
                    return false; // Hide other people's private messages
                }
                return true; // Show global notices
            });

            if (!relevantNotices || relevantNotices.length === 0) {
                list.html('<div class="text-center py-8 text-slate-400 text-xs font-bold uppercase tracking-wide">No new announcements.</div>');
                $('#urgent-ticker').addClass('hidden');
                return;
            }

            relevantNotices.forEach(n => {
                const isUrgent = n.priority === 'urgent';
                const isPersonal = n.title.startsWith('@');

                if (isUrgent && !hasUrgent && !isPersonal) {
                    $('#ticker-text').text(n.title + ": " + (n.content || ""));
                    $('#urgent-ticker').removeClass('hidden');
                    hasUrgent = true;
                }

                const date = new Date(n.created_at).toLocaleDateString();
                const badge = isUrgent
                    ? `<span class="px-2 py-0.5 rounded bg-rose-100 text-rose-600 text-[9px] font-black uppercase">Urgent</span>`
                    : `<span class="px-2 py-0.5 rounded bg-slate-100 text-slate-500 text-[9px] font-black uppercase">Info</span>`;

                list.append(`
                    <div class="p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-indigo-200 transition-colors">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="text-xs font-bold text-slate-900 dark:text-slate-200 line-clamp-1">${n.title}</h4>
                            <span class="text-[8px] font-bold text-slate-400">${date}</span>
                        </div>
                        <p class="text-[10px] text-slate-500 font-medium line-clamp-2 leading-relaxed mb-2">${n.content || ''}</p>
                        ${badge}
                    </div>
                `);
            });

            if (!hasUrgent) $('#urgent-ticker').addClass('hidden');
        };

        // --- FORGOT PASSWORD LOGIC ---
        window.handleForgotPassword = (e) => {
            if (e) e.preventDefault();
            new bootstrap.Modal(document.getElementById('forgotPasswordModal')).show();
        };

        window.submitForgotPassword = async (e) => {
            e.preventDefault();
            const btn = $('#forgot-btn');
            const msgEl = $('#forgot-msg');
            const email = $('#forgot-email').val();

            msgEl.addClass('hidden').removeClass('text-rose-500');

            if (!email) return;

            btn.prop('disabled', true).text('Sending Link...');
            try {
                console.log("Sending reset to:", email);
                const { error } = await client.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin
                });
                if (error) throw error;

                // Switch to Success UI
                $('#forgot-ui-content').addClass('hidden');
                $('#forgot-ui-success').removeClass('hidden');
                lucide.createIcons();

            } catch (err) {
                msgEl.text("Error: " + err.message).addClass('text-rose-500').removeClass('hidden');
            } finally {
                btn.prop('disabled', false).text('Send Recovery Link');
            }
        };

        // --- NOTICE BOARD LOGIC ---
        window.openNoticeModal = () => {
            new bootstrap.Modal(document.getElementById('createNoticeModal')).show();
        };

        window.submitNotice = async () => {
            const title = $('#notice-title').val();
            const content = $('#notice-content').val();
            const priority = $('input[name="notice-priority"]:checked').val();

            if (!title) return showToast("Title is required.");

            try {
                const { error } = await client.from('notices').insert({
                    title: title,
                    content: content || '',
                    priority: priority,
                    created_by: currentUser.id
                });

                if (error) throw error;
                showToast("Notice Posted Successfully!", "success");

                const modal = bootstrap.Modal.getInstance(document.getElementById('createNoticeModal'));
                if (modal) modal.hide();

                fetchNotices(); // Refresh list

            } catch (err) {
                showToast("Failed to post notice: " + err.message);
            }
        };

        window.refreshNotices = () => {
            const icon = $('#refreshNotices i');
            icon.addClass('animate-spin');
            fetchNotices().then(() => setTimeout(() => icon.removeClass('animate-spin'), 1000));
        };

        window.fetchNotices = async () => {
            try {
                const { data: notices, error } = await client.from('notices')
                    .select('*')
                    .eq('is_active', true)
                    .order('created_at', { ascending: false });

                if (error) {
                    // Fail silently if table doesn't exist yet
                    console.warn("Notice fetch warning (table might be missing):", error);
                    return;
                }

                renderNotices(notices || []);

            } catch (e) {
                console.error("Error fetching notices:", e);
            }
        };

        window.renderNotices = (notices) => {
            const list = $('#notice-list');
            list.empty();
            let hasUrgent = false;

            if (!notices || notices.length === 0) {
                list.html('<div class="text-center py-8 text-slate-400 text-xs font-bold uppercase tracking-wide">No new announcements.</div>');
                $('#urgent-ticker').addClass('hidden');
                return;
            }

            notices.forEach(n => {
                const isUrgent = n.priority === 'urgent';
                if (isUrgent && !hasUrgent) {
                    $('#ticker-text').text(n.title + ": " + (n.content || ""));
                    $('#urgent-ticker').removeClass('hidden');
                    hasUrgent = true;
                }

                const date = new Date(n.created_at).toLocaleDateString();
                const badge = isUrgent
                    ? `<span class="px-2 py-0.5 rounded bg-rose-100 text-rose-600 text-[9px] font-black uppercase">Urgent</span>`
                    : `<span class="px-2 py-0.5 rounded bg-slate-100 text-slate-500 text-[9px] font-black uppercase">Info</span>`;

                list.append(`
                    <div class="p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-indigo-200 transition-colors">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="text-xs font-bold text-slate-900 dark:text-slate-200 line-clamp-1">${n.title}</h4>
                            <span class="text-[8px] font-bold text-slate-400">${date}</span>
                        </div>
                        <p class="text-[10px] text-slate-500 font-medium line-clamp-2 leading-relaxed mb-2">${n.content || ''}</p>
                        ${badge}
                    </div>
                `);
            });

            if (!hasUrgent) $('#urgent-ticker').addClass('hidden');
        };

        // --- PASSWORD RESET (LOGGED IN) ---
        window.submitResetPassword = async (e) => {
            e.preventDefault();
            const btn = $('#reset-pass-btn');
            const msgEl = $('#reset-msg');
            const pass = $('#reset-new-pass').val();

            msgEl.addClass('hidden').removeClass('text-rose-500');

            if (pass.length < 6) {
                msgEl.text("Password must be at least 6 characters").addClass('text-rose-500').removeClass('hidden');
                return;
            }

            btn.prop('disabled', true).text('Updating...');
            try {
                const { error } = await client.auth.updateUser({ password: pass });
                if (error) throw error;

                await client.auth.signOut(); // Ensure fresh login

                // Switch to Success UI (Professional View)
                $('#reset-ui-content').addClass('hidden');
                $('#reset-ui-success').removeClass('hidden');
                lucide.createIcons();

                // Delay reload so user sees the message
                setTimeout(() => {
                    window.location.href = window.location.pathname;
                }, 3000);

            } catch (err) {
                msgEl.text("Update Failed: " + err.message).addClass('text-rose-500').removeClass('hidden');
                btn.prop('disabled', false).text('Update Password');
            }
        };

        window.toggleMode = () => {
            $('#auth-error').addClass('hidden').text('');
            const isReg = $('#auth-btn span').text() === "Create Account";
            if (isReg) {
                $('#name-field').addClass('hidden');
                $('#auth-tabs').removeClass('hidden');
                $('#auth-btn span').text('Sign In');
                $('#auth-footer').html('New here? <button onclick="toggleMode()" class="text-indigo-500 font-black uppercase tracking-widest text-[9px] hover:underline">Create Account</button>');
            } else {
                switchAuth('student');
                $('#name-field').removeClass('hidden');
                $('#auth-tabs').addClass('hidden');
                $('#auth-btn span').text('Create Account');
                $('#auth-footer').html('Already have an account? <button onclick="toggleMode()" class="text-indigo-500 font-black uppercase tracking-widest text-[9px] hover:underline">Sign In</button>');
            }
        };

        // [Moved to $(document).ready]

        window.togglePasswordVisibility = () => {
            const passInput = document.getElementById('auth-pass');
            const iconEye = document.getElementById('icon-eye');
            const iconEyeOff = document.getElementById('icon-eye-off');

            if (passInput.type === 'password') {
                passInput.type = 'text';
                // Show "Eye Off", Hide "Eye"
                iconEye.classList.add('hidden');
                iconEyeOff.classList.remove('hidden');
            } else {
                passInput.type = 'password';
                // Show "Eye", Hide "Eye Off"
                iconEye.classList.remove('hidden');
                iconEyeOff.classList.add('hidden');
            }
        };

        window.checkAndShowEncouragement = () => {
            const tasks = window.allTasks || [];
            const subs = window.allSubmissions || [];
            if (!tasks.length) return;

            // Only for students
            if (!userProfile || userProfile.role !== 'student') return;

            const mySubs = subs.filter(s => s.student_id === currentUser.id);
            const total = tasks.length;
            const completed = mySubs.filter(s => s.status === 'graded').length;
            const progressPct = total ? Math.round((completed / total) * 100) : 0;
            const gradedSubs = mySubs.filter(s => s.status === 'graded');
            const avgScore = gradedSubs.length ? gradedSubs.reduce((a, b) => a + (parseInt(b.grade) || 0), 0) / gradedSubs.length : 0;

            // Session check to avoid spam
            if (sessionStorage.getItem('encouragementShown')) return;

            let msg = "";
            let type = "success";

            // Progressive encouragement logic
            if (progressPct >= 80) {
                msg = `Outstanding! You've completed ${progressPct}% of the course. You are unstoppable!`;
            } else if (progressPct >= 50) {
                msg = `Halfway There! You've completed ${progressPct}% of your tasks. Great momentum!`;
            } else if (avgScore >= 90) {
                msg = `High Performer Alert! Your average score is ${Math.round(avgScore)}%. Excellent work!`;
            } else if (completed >= 3) {
                msg = "Good Start! You're making steady progress. Keep going!";
                type = "info";
            }

            if (msg) {
                // Show a nice toast notification
                // Using existing showToast function
                if (typeof showToast === 'function') {
                    showToast(msg, type);
                } else {
                    console.log("Encouragement:", msg);
                }

                // If it's a big achievement, throw confetti
                if ((progressPct >= 80 || avgScore >= 90) && typeof confetti === 'function') {
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                }

                sessionStorage.setItem('encouragementShown', 'true');
            }
        };

        // GLOBAL TOAST FUNCTION
        window.showToast = function (msg, type = 'success') {
            const bgClass = type === 'error' ? 'bg-rose-600' : 'bg-slate-900 dark:bg-[#1e293b]';
            const icon = type === 'error' ? 'alert-circle' : 'bell';

            const toast = $(`<div class="fixed bottom-10 right-10 ${bgClass} text-white px-8 py-4 rounded-2xl shadow-2xl z-[5000] font-black uppercase text-[10px] tracking-widest animate-in slide-in-from-bottom-5 border border-white/10 backdrop-blur-xl flex items-center gap-3"><i data-lucide="${icon}" class="w-4 h-4 text-white"></i>${msg}</div>`);
            $('body').append(toast);
            lucide.createIcons();
            setTimeout(() => toast.fadeOut(() => toast.remove()), 3000);
        };

        function initDashboard() {
            // OPTIMIZATION: Render "shell" and cached content IMMEDIATELY before hiding loader

            // 1. Basic Text & Profile Info
            $('#user-name').text(userProfile.name);
            $('#header-user-name').text(userProfile.name);
            $('#user-role').text(userProfile.role.toUpperCase());

            // Sidebar Mini-Profile Update
            $('#sidebar-mini-name').text(userProfile.name);
            $('#sidebar-mini-role').text(userProfile.role);

            // 2. Avatar Rendering
            const initial = userProfile.name.charAt(0).toUpperCase();
            $('#header-initial').text(initial);
            $('#profile-initial-lg').text(initial);

            // Avatar Prioritization: Cloud -> Local Fallback -> Initials
            const cachedAvatar = localStorage.getItem(`cached_avatar_${userProfile.uid || userProfile.id}`);
            const finalAvatar = userProfile.avatar_url || cachedAvatar;

            if (finalAvatar) {
                const imgTag = `<img src="${finalAvatar}" class="w-full h-full object-cover">`;
                $('#header-avatar-container').html(imgTag);
                $('#profile-avatar-display').html(imgTag);
                $('#sidebar-mini-avatar').html(imgTag);
            } else {
                $('#header-avatar-container').html(`<span id="header-initial">${initial}</span>`);
                $('#profile-avatar-display').html(`<span id="profile-initial-lg">${initial}</span>`);
                $('#sidebar-mini-avatar').text(initial);
            }

            // 3. Navigation & Mode Setup
            if (userProfile.role === 'admin') {
                $('#nav-dashboard, #nav-grading, #nav-users, #nav-leaderboard').removeClass('hidden');
                $('#admin-nav').removeClass('hidden');
                $('#nav-tasks').removeClass('hidden').html('<i data-lucide="clipboard-list" class="w-5 h-5"></i> <span class="hide-on-collapse">Manage Tasks</span>');
                $('#nav-arcade, #nav-playground').addClass('hidden');
            } else {
                $('#nav-dashboard, #nav-tasks, #nav-leaderboard, #nav-resources, #profile-tab, #nav-arcade, #nav-playground').removeClass('hidden');
                $('#nav-tasks').html('<i data-lucide="clipboard-list" class="w-5 h-5"></i> <span class="hide-on-collapse">My Tasks</span>');
                $('#admin-nav').addClass('hidden');
            }

            // 4. Load Cached Data & Render Charts (CRITICAL FOR INSTANT FEEL)
            switchTab('dashboard');
            startSync(); // This calls loadCachedData() internally
            initChart();

            // 5. Daily Streak Logic (Local Storage - Fast)
            const today = new Date().toDateString();
            const lastLogin = localStorage.getItem('last_login_date');
            let streak = parseInt(localStorage.getItem('login_streak') || 0);

            if (lastLogin !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (lastLogin === yesterday.toDateString()) streak++;
                else streak = 1;

                localStorage.setItem('last_login_date', today);
                localStorage.setItem('login_streak', streak);

                if (streak > 1) {
                    showToast(`${streak} Day Streak! Keep it up!`);
                    confetti({ particleCount: 50, spread: 50, origin: { y: 0.1 } });
                }
            }

            // Render Streak Badge immediately
            if ($('#streak-badge').length === 0) {
                const streakHtml = `
                    <div id="streak-badge" class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-orange-50 dark:bg-orange-900/10 border border-orange-100 dark:border-orange-500/20 rounded-xl mr-2 animate-in fade-in zoom-in duration-500">
                        <div class="p-1 bg-white dark:bg-orange-900/30 rounded-lg shadow-sm">
                            <i data-lucide="flame" class="w-3.5 h-3.5 text-orange-500 fill-orange-500 animate-pulse"></i>
                        </div>
                        <div class="flex flex-col leading-none">
                            <span class="text-[8px] font-black uppercase text-orange-400 tracking-wider mb-0.5">Day Streak</span>
                            <span class="text-xs font-black text-orange-600 dark:text-orange-400">${streak} Day${streak !== 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;
                $('#header-user-name').closest('.flex.items-center.gap-3').parent().prepend(streakHtml);
            } else {
                $('#streak-badge').find('span:last').text(`${streak} Day${streak !== 1 ? 's' : ''}`);
            }

            // 6. Live Clock (Instant)
            const updateClock = () => {
                const now = new Date();
                const hours = now.getHours();
                const greeting = hours < 12 ? "Good Morning" : hours < 18 ? "Good Afternoon" : "Good Evening";
                $('#live-clock').text(now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true }));
                $('#live-date').text(now.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'short' }));
                $('#dynamic-greeting-text').text(`${greeting}, ${userProfile.name.split(' ')[0]}`);

                // SYNC MOBILE SIDEBAR PROFILE
                $('.mobile-user-name').text(userProfile.name);
                if (userProfile.avatar_url) {
                    $('#mobile-sidebar-avatar').attr('src', userProfile.avatar_url).removeClass('hidden');
                    $('.mobile-avatar-initial').addClass('hidden');
                } else {
                    $('.mobile-avatar-initial').text(userProfile.name.charAt(0)).removeClass('hidden');
                    $('#mobile-sidebar-avatar').addClass('hidden');
                }
            };
            updateClock();
            setInterval(updateClock, 1000);

            // 7. Initialize Icons ONCE globally for the initial view
            lucide.createIcons();

            // 8. FINAL STEP: Hide Loader NOW.
            // result: User sees fully rendered dashboard instantly.
            finishInitialization(true);
            isInitializing = false;

            // --- DEFERRED / BACKGROUND TASKS ---
            // These fetch fresh data but assume UI is already usable
            if (typeof fetchArcadeConfig === 'function') fetchArcadeConfig();
            if (typeof syncArcadeProgress === 'function') syncArcadeProgress();
            fetchNotices();
            fetchAchievements();
            if (window.setupRealtime) window.setupRealtime();



            // Re-define Award Badge (abbreviated)
            window.awardBadge = async (badgeKey) => {
                if (userProfile.role !== 'student') return;
                if (!BADGES[badgeKey]) return;
                try {
                    const { error } = await client.from('user_achievements').upsert(
                        { user_id: currentUser.id, badge_key: badgeKey },
                        { onConflict: 'user_id, badge_key', ignoreDuplicates: true }
                    );
                    if (!error) {
                        // Only show toast if it was a new insertion (difficult to know with upsert/ignore, 
                        // but we can check local cache or just rely on the fact that existing ones won't throw error)
                        // Ideally we check if it existed before, but for now we just suppress the error.
                        // We will rely on fetchAchievements to update the UI correctly.
                        fetchAchievements();
                    }
                } catch (e) { }
            };

            // Define Badges Const
            const BADGES = {
                'first_login': { title: 'First Steps', icon: 'footprints', desc: 'Logged in for the first time.' },
                'profile_pic': { title: 'Identity', icon: 'camera', desc: 'Updated profile picture.' },
                'arcade_win': { title: 'Arcade Champion', icon: 'trophy', desc: 'Won an arcade game level.' },
                'streak_3': { title: 'On Fire', icon: 'flame', desc: 'Reached a 3-day login streak.' },
                'code_runner': { title: 'Scripter', icon: 'code-2', desc: 'Ran code in the Live Editor.' }
            };

            async function fetchAchievements() {
                try {
                    const { data: userBadges, error } = await client.from('user_achievements').select('badge_key');
                    if (error) throw error;
                    const earnedKeys = new Set(userBadges.map(b => b.badge_key));
                    renderBadges(earnedKeys);
                    if (!earnedKeys.has('first_login')) awardBadge('first_login');
                    if (streak >= 3 && !earnedKeys.has('streak_3')) awardBadge('streak_3');
                } catch (e) { renderBadges(new Set()); }
            }

            function renderBadges(earnedKeys) {
                const grid = $('#achievements-grid');
                grid.empty();
                Object.entries(BADGES).forEach(([key, badge]) => {
                    const isUnlocked = earnedKeys.has(key);
                    const opacity = isUnlocked ? 'opacity-100' : 'opacity-40 grayscale';
                    const bg = isUnlocked ? 'bg-indigo-50 dark:bg-indigo-900/20 border-indigo-200 dark:border-indigo-800' : 'bg-slate-50 dark:bg-slate-900/50 border-slate-100 dark:border-slate-800';
                    const iconColor = isUnlocked ? 'text-indigo-500' : 'text-slate-400';
                    grid.append(`
                        <div class="p-4 ${bg} rounded-xl border flex flex-col items-center justify-center ${opacity} transition-all duration-500 group relative hover:scale-[1.02]">
                            <i data-lucide="${badge.icon}" class="w-8 h-8 ${iconColor} mb-2"></i>
                            <span class="text-[9px] font-black uppercase ${isUnlocked ? 'text-indigo-600 dark:text-indigo-300' : 'text-slate-400'} text-center">${badge.title}</span>
                            ${!isUnlocked ? '<i data-lucide="lock" class="absolute top-2 right-2 w-3 h-3 text-slate-300"></i>' : ''}
                        </div>
                    `);
                });
                lucide.createIcons();
            }

            // Check and show encouragement notification for students
            if (userProfile && userProfile.role === 'student') {
                setTimeout(() => {
                    checkAndShowEncouragement();
                }, 1500); // Show after dashboard loads
            }
        }



        window.handleLogout = async () => {
            // 1. Trigger Full Screen Professional Loader
            $('#logout-loader').removeClass('hidden').addClass('flex');
            lucide.createIcons();

            try {
                // No race condition - await completion
                await client.auth.signOut();
            } catch (err) {
                console.warn("Logout error:", err);
            } finally {
                // Explicitly clear Supabase tokens
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('sb-') && key.endsWith('-auth-token')) {
                        localStorage.removeItem(key);
                    }
                });

                // Clear app-specific caches
                localStorage.removeItem('supabase_profile_cache');
                localStorage.removeItem('cached_tasks');
                localStorage.removeItem('cached_subs');

                // Clear cookies
                document.cookie.split(";").forEach((c) => {
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                });

                // Immediate reload without arbitrary delay
                window.location.reload();
            }
        };

        // --- INSTANT LOAD CACHE SYSTEM ---
        function loadCachedData() {
            const cachedTasks = localStorage.getItem('cached_tasks');
            const cachedSubs = localStorage.getItem('cached_subs');

            if (cachedTasks && cachedSubs) {
                const tasks = JSON.parse(cachedTasks);
                const subs = JSON.parse(cachedSubs);

                window.allTasks = tasks;
                window.allSubmissions = subs;

                console.log("? Instant Load from Cache triggered");
                renderStats(tasks, subs);
                if (activeTab === 'tasks') renderTasks(tasks, subs);
                if (activeTab === 'leaderboard') renderLeaderboard(subs);
                if (userProfile.role === 'admin' && activeTab === 'grading') renderGrading(subs);
            }
        }

        function startSync() {
            // Instant load before network fetch
            loadCachedData();
            fetchData();
            syncInterval = setInterval(fetchData, 5000);
        }

        // NEW: AJAX Version of fetchData
        async function fetchData() {
            // Use Supabase Client SDK instead of raw AJAX for better stability & auth handling
            const { data: { session } } = await client.auth.getSession();
            if (!session) return;

            try {
                const [tasksRes, subsRes] = await Promise.all([
                    client.from('tasks').select('*').order('deadline', { ascending: true }),
                    client.from('submissions').select('*')
                ]);

                if (tasksRes.error) throw tasksRes.error;
                if (subsRes.error) throw subsRes.error;

                const tasks = tasksRes.data;
                const subs = subsRes.data;

                window.allTasks = tasks;
                window.allSubmissions = subs;

                // SAVE TO CACHE FOR NEXT LOAD
                localStorage.setItem('cached_tasks', JSON.stringify(tasks));
                localStorage.setItem('cached_subs', JSON.stringify(subs));

                renderStats(tasks, subs);
                if (activeTab === 'tasks') renderTasks(tasks, subs);
                if (activeTab === 'leaderboard') renderLeaderboard(subs);
                if (userProfile.role === 'admin') {
                    if (activeTab === 'grading') renderGrading(subs);
                    // fetchUsers is called separately when needed/tab switches, to save bandwidth
                    if (activeTab === 'users') fetchUsers();

                    // Update feedback notification badge
                    checkFeedbackCount();
                }
            } catch (err) {
                console.error("Data Sync Error:", err);
                // Reduce noise, only alert on critical failures that persist
            }
            // Live Chart Update
            if (activeTab === 'dashboard' && performanceChart) updateChart();
        }
        function renderStats(tasks, subs) {
            const isStudent = userProfile.role === 'student';

            if (isStudent) {
                const mySubs = subs.filter(s => s.student_id === currentUser.id);
                const total = tasks.length;
                const completed = mySubs.filter(s => s.status === 'graded').length;
                const progressPct = total ? Math.round((mySubs.length / total) * 100) : 0;
                const avgScore = mySubs.filter(s => s.status === 'graded').reduce((a, b) => a + (parseInt(b.grade) || 0), 0) / (mySubs.filter(s => s.status === 'graded').length || 1);

                const pendingCount = tasks.filter(t => {
                    const isSubmitted = mySubs.some(s => s.task_id === t.id);
                    // Also check if it's graded - if so, it's definitely not pending
                    const isGraded = mySubs.some(s => s.task_id === t.id && s.status === 'graded');
                    const isExpired = t.deadline && new Date().getTime() > new Date(t.deadline).getTime();
                    return !isGraded && !isSubmitted && !isExpired;
                }).length;
                $('#stat-label-1').text("Pending Tasks"); $('#stat-active').text(pendingCount);
                $('#stat-label-2').text("Completed"); $('#stat-completed').text(completed);
                $('#stat-label-3').text("Avg. Grade"); $('#stat-score').text(Math.round(avgScore) + '%');

                // --- 1. Pending Tasks Popup Logic ---
                if (pendingCount > 0 && !sessionStorage.getItem('pendingAlertShown')) {
                    sessionStorage.setItem('pendingAlertShown', 'true');
                    // Create and show modal dynamically
                    const modalId = 'pending-task-modal-' + Date.now();
                    const modalHtml = `
                        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content border-0 rounded-3xl shadow-2xl bg-white dark:bg-[#0f172a] overflow-hidden">
                                     <!-- Clean Header Strip -->
                                     <div class="h-1.5 w-full bg-gradient-to-r from-indigo-500 to-purple-600"></div>

                                     <div class="p-8 pb-6">
                                        <div class="flex items-start gap-5">
                                            <!-- Icon Box -->
                                            <div class="w-14 h-14 rounded-2xl bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 flex items-center justify-center shrink-0">
                                                 <i data-lucide="clipboard-list" class="w-7 h-7"></i>
                                            </div>
                                            
                                            <div class="flex-1">
                                                <h3 class="text-xl font-black text-slate-900 dark:text-white uppercase tracking-tight leading-none mb-2">Attention Required</h3>
                                                <p class="text-xs text-slate-500 dark:text-slate-400 font-medium leading-relaxed">
                                                    You have <span class="text-indigo-600 dark:text-indigo-400 font-bold">${pendingCount} pending task${pendingCount > 1 ? 's' : ''}</span> waiting for your submission. Consistent effort is the key to mastery!
                                                </p>
                                            </div>
                                        </div>

                                        <!-- Mini Progress Preview -->
                                        <div class="mt-8 mb-6 p-4 rounded-xl bg-slate-50 dark:bg-[#1e293b] border border-slate-100 dark:border-slate-800/50">
                                            <div class="flex justify-between items-end mb-2">
                                                <span class="text-[9px] font-black uppercase tracking-widest text-slate-400">Current Progress</span>
                                                <span class="text-[10px] font-bold text-slate-700 dark:text-slate-300">${progressPct}% Complete</span>
                                            </div>
                                            <div class="h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                                                <div class="h-full bg-indigo-500 rounded-full" style="width: ${progressPct}%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3">
                                             <button data-bs-dismiss="modal" class="py-3.5 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 text-[10px] font-black uppercase tracking-widest hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                                                Remind Later
                                             </button>
                                             <button onclick="switchTab('tasks'); bootstrap.Modal.getInstance(document.getElementById('${modalId}')).hide();" class="py-3.5 rounded-xl bg-indigo-600 text-white text-[10px] font-black uppercase tracking-widest hover:bg-indigo-700 shadow-lg shadow-indigo-500/30 transition-all flex items-center justify-center gap-2">
                                                View Tasks <i data-lucide="arrow-right" class="w-3.5 h-3.5"></i>
                                             </button>
                                        </div>
                                     </div>
                                </div>
                            </div>
                        </div>`;
                    $('body').append(modalHtml);
                    const modalEl = document.getElementById(modalId);
                    const modal = new bootstrap.Modal(modalEl);
                    modalEl.addEventListener('shown.bs.modal', () => lucide.createIcons());
                    modal.show();
                }

                // --- 2. Motivational Banner Logic ---
                $('#student-alerts').removeClass('hidden');
                let msg = "Every step counts! Keep pushing forward to reach your goals.";
                let accentColor = "indigo";

                if (progressPct < 30) {
                    msg = "Beginnings are always hardest. Believe in yourself and tackle those tasks!";
                    accentColor = "rose"; // Warning/Urgency
                } else if (progressPct >= 30 && progressPct < 60) {
                    msg = "You're making solid progress! Consistency is the key to mastery. Keep it up!";
                    accentColor = "indigo"; // Steady
                } else if (progressPct >= 60 && progressPct < 90) {
                    msg = "You are doing amazing! You're well on your way to becoming an expert.";
                    accentColor = "violet"; // High achievement
                } else if (progressPct >= 90) {
                    msg = "Outstanding! You are a true champion. Limitless potential!";
                    accentColor = "emerald"; // Success
                }
                // Level System Logic
                const totalXP = mySubs.filter(s => s.status === 'graded').reduce((a, b) => a + (parseInt(b.grade) || 0), 0);
                const level = Math.floor(totalXP / 100) + 1;
                const xpProgress = totalXP % 100;
                const ranks = ["Newbie", "Apprentice", "Novice", "Scholar", "Expert", "Master", "Legend"];
                const rankName = ranks[Math.min(level - 1, ranks.length - 1)];

                if (userProfile.role === 'student') {
                    $('#student-level-ui').removeClass('hidden').addClass('flex');
                    $('#rank-name').text(`${rankName} (Lvl ${level})`);

                    // Simple animation for the bar
                    setTimeout(() => {
                        $('#xp-bar').css('width', `${xpProgress}%`);
                        $('#xp-bar-bg').css('transform', `scaleY(${xpProgress / 100})`);
                    }, 500);
                } else {
                    $('#student-level-ui').addClass('hidden');
                }

                $('#student-alert-msg').text(msg);
                $('#student-alerts > div').removeClass('border-l-indigo-500 border-l-rose-500 border-l-cyan-500 bg-indigo-500/5 bg-rose-500/5 bg-cyan-500/5').addClass(`border-l-${accentColor}-500 bg-${accentColor}-500/5`);

                // Recent Activity
                const list = $('#recent-activity-list').empty();
                const cutoff = new Date(new Date().getTime() - 24 * 60 * 60 * 1000);
                const recentSubs = mySubs.filter(s => new Date(s.submitted_at) > cutoff).slice(0, 4);

                if (!recentSubs.length) list.html('<div class="text-center py-10 text-slate-400 font-black uppercase tracking-widest text-[9px] italic border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-3xl">No recent activity (24h)</div>');
                recentSubs.forEach(s => {
                    const isGraded = s.status === 'graded';
                    list.append(`
                        <div class="flex items-center gap-4 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 hover:border-indigo-500/50 transition-all group">
                            <div class="w-12 h-12 rounded-xl ${isGraded ? 'bg-emerald-500/10 text-emerald-500' : 'bg-indigo-500/10 text-indigo-500'} flex items-center justify-center transition-transform group-hover:scale-105 shadow-sm">
                                <i data-lucide="${isGraded ? 'check-circle' : 'clock'}" class="w-5 h-5"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-[10px] font-black text-slate-900 dark:text-indigo-400 truncate uppercase tracking-tight leading-none mb-1.5">${s.task_title}</p>
                                <p class="text-[8px] text-slate-400 font-black uppercase tracking-[0.15em] leading-none">${s.status}</p>
                            </div>
                            ${isGraded ? `<div class="font-black text-base text-indigo-500 tracking-tighter">${s.grade}%</div>` : ''}
                        </div>
                    `);
                });
            } else {
                // ADMIN DASHBOARD LOGIC

                // DEDUPLICATION LOGIC:
                // We must group by (student_id + task_id) and keep only the LATEST submission.
                const uniqueSubsMap = new Map();
                subs.forEach(s => {
                    const key = `${s.student_id}_${s.task_id}`;
                    const existing = uniqueSubsMap.get(key);
                    // If no entry exists, or this one is newer, update it
                    if (!existing || new Date(s.submitted_at) > new Date(existing.submitted_at)) {
                        uniqueSubsMap.set(key, s);
                    }
                });
                const uniqueSubs = Array.from(uniqueSubsMap.values());

                // FIX: Filter only ACTIVE tasks (not expired) for the count
                const activeTasksCount = tasks.filter(t => {
                     // Active = No deadline OR Deadline is in the future
                     return !t.deadline || new Date(t.deadline) > new Date();
                }).length;

                $('#stat-label-1').text("Active Tasks"); $('#stat-active').text(activeTasksCount);

                // Stat 2: Total unique verified submissions (Graded or Pending)
                $('#stat-label-2').text("Total Submissions");
                $('#stat-completed').text(uniqueSubs.length);

                // Stat 3: Pending Review (Only if latest status is 'submitted')
                const pending = uniqueSubs.filter(s => s.status === 'submitted').length;

                $('#stat-label-3').text("Pending Review"); $('#stat-score').text(pending);
                $('#student-alerts').addClass('hidden');

                // Intelligent Notification Logic (Watermark System):
                const watermark = parseInt(localStorage.getItem('notification_watermark') || '0');
                window.lastPendingCountVal = pending; // Store for markAllRead

                // 1. Trigger: Only un-clear if we have MORE items than our watermark (suppressed count)
                if (pending > watermark) {
                    localStorage.setItem('notifications_cleared', 'false');
                }

                // 2. Adaptation: If items are removed (graded), lower the watermark 
                // so that incoming new items (even if total count is same as old watermark) trigger a notif.
                if (pending < watermark) {
                    localStorage.setItem('notification_watermark', pending);
                }

                // Legacy support cleanup
                localStorage.removeItem('last_pending_count');

                // Update Notification Badge
                const badge = $('#notif-badge');
                const isCleared = localStorage.getItem('notifications_cleared') === 'true';

                if (pending > 0 && !isCleared) {
                    badge.removeClass('hidden').addClass('flex items-center justify-center');
                    badge.text(pending > 9 ? '9+' : pending);
                } else {
                    badge.addClass('hidden').removeClass('flex');
                }

                // Global Recent Activity for Admins (Deduplicated)
                const list = $('#recent-activity-list').empty();
                const cutoff = new Date(new Date().getTime() - 24 * 60 * 60 * 1000);

                // Sort unique subs by date desc AND filter last 24h
                const latest = uniqueSubs
                    .filter(s => new Date(s.submitted_at) > cutoff)
                    .sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at))
                    .slice(0, 4);

                if (!latest.length) list.html('<div class="text-center py-10 text-slate-400 font-black uppercase tracking-widest text-[9px] italic border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-3xl">No student activity (24h)</div>');
                latest.forEach(s => {
                    const isGraded = s.status === 'graded';
                    list.append(`
                        <div class="flex items-center gap-4 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-800 hover:border-indigo-500/50 transition-all group cursor-pointer" onclick="switchTab('grading')">
                            <div class="w-10 h-10 rounded-xl ${isGraded ? 'bg-emerald-500/10 text-emerald-500' : 'bg-amber-500/10 text-amber-500'} flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="w-4 h-4"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-[10px] font-black text-slate-900 dark:text-indigo-400 truncate uppercase tracking-tight leading-none mb-1.5">${s.student_name}</p>
                                <p class="text-[8px] text-slate-400 font-black uppercase tracking-[0.15em] leading-none">Submitted: ${s.task_title}</p>
                            </div>
                            <div class="text-[7px] font-black bg-indigo-50 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-300 px-2 py-1 rounded-md uppercase tracking-tighter">${s.status}</div>
                        </div>
                    `);
                });
            }
            lucide.createIcons();
        }

        window.filterTasks = (type) => {
            // Update Radio UI (useful if called programmatically)
            if (type === 'all') $('#radio-1').prop('checked', true);
            else if (type === 'pending') $('#radio-2').prop('checked', true);
            else if (type === 'completed') $('#radio-3').prop('checked', true);
            else if (type === 'expired') $('#radio-4').prop('checked', true);

            window.currentTaskFilter = type;
            renderTasks(window.allTasks, window.allSubmissions, type);
        };

        function renderTasks(tasks, subs, filter = 'all') {
            // ADMIN: Hide filters, show all
            if (userProfile.role === 'admin') {
                $('.task-tabs-container').parent().addClass('hidden');
                filter = 'all';
            } else {
                $('.task-tabs-container').parent().removeClass('hidden');
            }

            const container = $('#task-grid').empty();
            let filteredTasks = tasks;

            // 0. Auto-Hide Old Tasks (Clutter Reduction)
            // Hides tasks created >7 days ago from the main 'All' view, unless searched/filtered specifically
            if (filter === 'all') {
                const cleanupDate = new Date();
                cleanupDate.setDate(cleanupDate.getDate() - 7);
                filteredTasks = tasks.filter(t => new Date(t.created_at) > cleanupDate);
            }

            // 1. Status Filter
            if (filter === 'pending') {
                filteredTasks = tasks.filter(t => {
                    const isSubmitted = subs.find(s => s.student_id === currentUser?.id && s.task_id === t.id);
                    const isExpired = t.deadline && new Date().getTime() > new Date(t.deadline).getTime();
                    return !isSubmitted && !isExpired;
                });
            } else if (filter === 'completed') {
                filteredTasks = tasks.filter(t => subs.find(s => s.student_id === currentUser?.id && s.task_id === t.id));
            } else if (filter === 'expired') {
                filteredTasks = tasks.filter(t => t.deadline && new Date().getTime() > new Date(t.deadline).getTime());
            }

            // 2. Search Filter
            const query = $('#task-search').val()?.toLowerCase() || '';
            if (query) {
                filteredTasks = filteredTasks.filter(t => t && t.title && (t.title.toLowerCase().includes(query) || (t.description && t.description.toLowerCase().includes(query))));
            }

            // 3. Empty State
            if (filteredTasks.length === 0) {
                container.html(`
                    <div class="col-span-full py-16 text-center animate-in fade-in zoom-in duration-500">
                        <div class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="clipboard-x" class="w-8 h-8 text-slate-400"></i>
                        </div>
                        <h3 class="text-lg font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200 mb-1">No Tasks Found</h3>
                        <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Try adjusting your filters.</p>
                    </div>
                `);
                lucide.createIcons();
                return;
            }

            filteredTasks.forEach(t => {
                if (!t) return;
                let taskCardContent = '';
                const isExpired = t.deadline ? (new Date().getTime() > new Date(t.deadline).getTime()) : false;

                if (userProfile.role === 'admin') {
                    // --- ADMIN VIEW (Simplified) ---
                    // Calculate stats for this task (DEDUPLICATED)
                    const uniqueTaskSubsMap = new Map();
                    subs.filter(s => s.task_id === t.id).forEach(s => {
                        const existing = uniqueTaskSubsMap.get(s.student_id);
                        if (!existing || new Date(s.submitted_at) > new Date(existing.submitted_at)) {
                            uniqueTaskSubsMap.set(s.student_id, s);
                        }
                    });
                    const uniqueTaskSubs = Array.from(uniqueTaskSubsMap.values());

                    const submissionCount = uniqueTaskSubs.filter(s => s.status === 'submitted' || s.status === 'graded').length;
                    const gradedCount = uniqueTaskSubs.filter(s => s.status === 'graded').length;
                    const avgScore = gradedCount ? Math.round(uniqueTaskSubs.filter(s => s.status === 'graded').reduce((a, b) => a + b.grade, 0) / gradedCount) : 0;

                    taskCardContent = `
                        <div class="v-card p-5 group transition-transform hover:-translate-y-1 bg-white dark:bg-[#1e293b] animate-in fade-in slide-in-from-bottom-4 border dark:border-slate-800 relative overflow-hidden">
                             <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-100 transition-opacity">
                                <i data-lucide="layout-grid" class="w-12 h-12 text-indigo-500"></i>
                             </div>
                            
                             <div class="flex justify-between items-start mb-4 gap-3 relative z-10">
                                <span class="px-3 py-1 rounded-lg text-[7px] font-black uppercase tracking-[0.15em] bg-slate-100 dark:bg-slate-800 text-slate-500 shadow-sm">ID: ${t.id.substring(0, 6)}</span>
                                <div class="text-[7px] font-black text-indigo-500 uppercase tracking-[0.15em] flex items-center gap-1 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1.5 rounded-lg">
                                    <i data-lucide="calendar" class="w-2.5 h-2.5"></i> ${t.deadline ? new Date(t.deadline).toLocaleString([], { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'No Date'}
                                </div>
                            </div>
                            
                            <h4 class="font-black text-lg text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter leading-none relative z-10 pr-8 line-clamp-1">${window.fixEncoding(t.title || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</h4>
                            <p class="text-[9px] text-slate-500 dark:text-slate-400 line-clamp-1 mb-4 font-medium leading-relaxed tracking-tight uppercase relative z-10">${window.fixEncoding(t.description || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>
                            
                            <!-- Admin Stats Grid -->
                            <div class="grid grid-cols-3 gap-2 mb-6 relative z-10">
                                <div class="p-2 bg-slate-50 dark:bg-slate-900 rounded-lg text-center border border-slate-100 dark:border-slate-800">
                                    <div class="text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5">Total</div>
                                    <div class="text-sm font-black text-slate-900 dark:text-slate-200">${submissionCount}</div>
                                </div>
                                <div class="p-2 bg-slate-50 dark:bg-slate-900 rounded-lg text-center border border-slate-100 dark:border-slate-800">
                                    <div class="text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5">Graded</div>
                                    <div class="text-sm font-black text-indigo-500">${gradedCount}</div>
                                </div>
                                <div class="p-2 bg-slate-50 dark:bg-slate-900 rounded-lg text-center border border-slate-100 dark:border-slate-800">
                                    <div class="text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5">Avg %</div>
                                    <div class="text-sm font-black text-emerald-500">${avgScore}%</div>
                                </div>
                            </div>

                            <div class="flex gap-3 pt-4 border-t border-slate-100 dark:border-slate-800 relative z-10">
                                <button onclick="window.openDetail('${t.id}')" class="flex-1 py-2.5 rounded-lg bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 text-[8px] font-black uppercase tracking-widest hover:bg-indigo-100 dark:hover:bg-indigo-900/40 transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="eye" class="w-3 h-3"></i> View
                                </button>
                                <button onclick="openEditTaskModal('${t.id}')" class="flex-1 py-2.5 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 text-[8px] font-black uppercase tracking-widest hover:bg-emerald-100 dark:hover:bg-emerald-900/40 transition-all flex items-center justify-center gap-2">
                                    <i data-lucide="edit-2" class="w-3 h-3"></i> Edit
                                </button>
                                <button onclick="deleteTask('${t.id}')" class="flex-1 py-2.5 rounded-lg bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 text-[8px] font-black uppercase tracking-widest hover:bg-rose-100 dark:hover:bg-rose-900/40 transition-all flex items-center justify-center gap-2">
                                     <i data-lucide="trash-2" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>`;
                } else {
                    // --- STUDENT VIEW (Simplified for "Details Kam Dikhao") ---
                    const sub = subs.find(s => s.student_id === currentUser?.id && s.task_id === t.id);
                    let badgeClass = sub ? (sub.status === 'graded' ? 'bg-emerald-500 text-white shadow-emerald-500/20' : 'bg-cyan-500 text-white shadow-cyan-500/20') : (isExpired ? 'bg-rose-500 text-white shadow-rose-500/20' : 'bg-indigo-600 text-white shadow-indigo-500/20');
                    let badgeText = sub ? (sub.status === 'graded' ? `SCORE: ${sub.grade}%` : 'SUBMITTED') : (isExpired ? 'EXPIRED' : 'ACTIVE');

                    taskCardContent = `
                        <div class="v-card p-5 group cursor-pointer border hover:border-indigo-500 hover:shadow-xl transition-all duration-500 bg-white dark:bg-[#1e293b] animate-in fade-in slide-in-from-bottom-4 glow-border" onclick="openDetail('${t.id}')">
                            <div class="flex justify-between items-start mb-4 gap-3">
                                <span class="px-3 py-1 rounded-lg text-[7px] font-black uppercase tracking-[0.15em] ${badgeClass} shadow-md transition-transform group-hover:scale-105">${badgeText}</span>
                                <div class="text-[7px] font-black text-slate-400 uppercase tracking-[0.15em] flex items-center gap-1 bg-slate-50 dark:bg-[#2d3748] px-2 py-1.5 rounded-lg shadow-inner whitespace-nowrap">
                                    <i data-lucide="calendar" class="w-2.5 h-2.5 text-indigo-500"></i> ${t.deadline ? new Date(t.deadline).toLocaleDateString() : 'No Deadline'}
                                </div>
                            </div>
                            <h4 class="font-black text-lg text-slate-900 dark:text-indigo-400 mb-2 group-hover:text-indigo-500 transition-colors uppercase tracking-tighter leading-none break-words line-clamp-1">${window.fixEncoding(t.title)}</h4>
                            <p class="text-[9px] text-slate-500 dark:text-slate-400 mb-4 font-medium leading-relaxed tracking-tight line-clamp-2 w-full h-8 overflow-hidden">${window.fixEncoding(t.description || '').split('<br><strong>Reference Asset:')[0].replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>
                            
                            <!-- Simplified: Tags & Reference Indicator Hidden in List View for cleaner Look -->

                            <div class="w-full h-1.5 bg-slate-100 dark:bg-[#0b1120] rounded-full overflow-hidden shadow-inner flex items-center px-0.5 mt-auto">
                                <div class="h-1 bg-gradient-to-r from-indigo-500 to-cyan-400 rounded-full transition-all duration-[1.5s]" style="width: ${sub ? '100%' : '30%'}"></div>
                            </div>
                        </div>`;
                }
                container.append(taskCardContent);
            });
            lucide.createIcons();
        }

        function renderLeaderboard(subs) {
            const container = $('#leaderboard-body').empty();

            if (!subs || !subs.length) {
                container.html(`
                    <tr>
                        <td colspan="5" class="py-8 text-center text-slate-400 text-[10px] font-black uppercase tracking-widest italic">
                            No active students found on the leaderboard.
                        </td>
                    </tr>
                `);
                return;
            }

            const students = Array.from(new Set(subs.map(s => s.student_id)));
            const rankings = students.map(sid => {
                // User Request: Only count GRADED tasks for Leaderboard visibility & ranking
                // User Request: Count unique tasks only (ignore resubmissions)

                const myGradedSubs = subs.filter(s => s.student_id === sid && s.status === 'graded');

                // Deduplicate by task_id: Keep the one with the HIGHEST grade
                const uniqueTasksMap = new Map();
                myGradedSubs.forEach(s => {
                    const existing = uniqueTasksMap.get(s.task_id);
                    if (!existing || s.grade > existing.grade) {
                        uniqueTasksMap.set(s.task_id, s);
                    }
                });

                const uniqueGradedSubs = Array.from(uniqueTasksMap.values());
                const count = uniqueGradedSubs.length;

                // If count is 0, this student won't show up (filtered later)
                const avg = count > 0 ? Math.round(uniqueGradedSubs.reduce((a, b) => a + b.grade, 0) / count) : 0;

                // Robust name finding
                const studentSub = subs.find(s => s.student_id === sid);
                const sName = studentSub && studentSub.student_name ? studentSub.student_name : 'Unknown Student';

                return {
                    name: sName,
                    count: count,
                    avg: avg
                };
            })
                .filter(r => r.count > 0) // Hide students with NO graded tasks
                .sort((a, b) => b.avg - a.avg || b.count - a.count); // Rank by Marks (Avg) FIRST, then Quantity

            const totalTasks = window.allTasks ? window.allTasks.length : 0;

            rankings.forEach((r, i) => {
                const badgeColor = i === 0 ? 'bg-amber-100 text-amber-600' : (i === 1 ? 'bg-slate-300 text-slate-600' : (i === 2 ? 'bg-orange-100 text-orange-600' : 'bg-slate-50 text-slate-400'));
                const progress = totalTasks > 0 ? Math.round((r.count / totalTasks) * 100) : 0;

                container.append(`
                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1e293b]/50 transition-colors border-b border-slate-50 dark:border-slate-800/50 group">
                        <td class="px-6 py-4">
                            <div class="w-8 h-8 rounded-lg ${i < 3 ? 'bg-indigo-600 text-white font-black shadow-lg shadow-indigo-500/20' : 'bg-slate-100 dark:bg-[#2d3748] text-slate-400 font-bold'} flex items-center justify-center text-[10px] tracking-tighter">#0${i + 1}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-black text-slate-900 dark:text-indigo-400 uppercase tracking-tight text-xs flex items-center gap-2">
                                ${i < 3 ? `<i data-lucide="trophy" class="w-3.5 h-3.5 ${i === 0 ? 'text-amber-500' : (i === 1 ? 'text-slate-400' : 'text-orange-500')}"></i>` : ''}
                                ${r.name}
                            </div>
                        </td>
                        <td class="px-6 py-4 font-black text-slate-400 text-[9px] uppercase tracking-widest text-center hidden sm:table-cell">${r.count} / ${totalTasks} Tasks</td>
                        <td class="px-6 py-4 text-center"><span class="px-3 py-1 bg-indigo-50 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-300 rounded-lg font-black text-xs shadow-sm">${r.avg}%</span></td>
                        <td class="px-6 py-4">
                            <div class="w-24 ml-auto flex flex-col items-end gap-1">
                                <div class="w-full h-1.5 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-cyan-500 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <span class="text-[8px] font-black text-cyan-500">${progress}% Complete</span>
                            </div>
                        </td>
                    </tr>
                `);
            });
            lucide.createIcons();
        }

        // Helper to force download for Cloudinary raw files
        function formatDownloadUrl(url) {
            if (!url) return "#";
            if (url.includes("cloudinary.com") && url.includes("/raw/upload/")) {
                return url.replace("/raw/upload/", "/raw/upload/fl_attachment/");
            }
            return url;
        }

        // Helper to parse submission content (String vs JSON)
        function parseSubmission(content) {
            try {
                if (content.trim().startsWith('{')) return JSON.parse(content);
            } catch (e) { }
            return { file: content }; // Legacy fallback
        }

        // --- TASK DETAIL MODAL LOGIC (FIXED) ---
        window.openDetail = async (tid) => {
            if (!tid) return;
            const taskIdStr = String(tid);

            // Find task using string comparison
            const t = window.allTasks.find(x => String(x.id) === taskIdStr);
            if (!t) {
                console.error("Task not found for ID:", tid);
                return;
            }
            window.currentTask = t;
            console.log("Opening details for:", t.id, t.title);

            $('#detail-title').text(t.title);
            // Render Description: Handle Mixed Content (User Text + System HTML)
            const descEl = $('#detail-desc');
            let rawDesc = t.description || 'No description provided.';
            const refMarker = '<br><strong>Reference Asset:</strong>';

            // Helper to unescape ONLY if double-escaped (e.g. from DB)
            const decodeHtml = (html) => {
                const txt = document.createElement("textarea");
                txt.innerHTML = html;
                return txt.value;
            };

            // Check if content is escaped in DB (contains &lt;)
            const isEscaped = rawDesc.includes('&lt;');
            // If escaped, we assume the whole string is escaped including the refMarker.
            // But refMarker might be encoded as &lt;br&gt; or <br> depending on save method.

            if (rawDesc.includes(refMarker) || (isEscaped && rawDesc.includes('&lt;br&gt;&lt;strong&gt;Reference Asset:'))) {
                // Determine split point
                const marker = rawDesc.includes(refMarker) ? refMarker : '&lt;br&gt;&lt;strong&gt;Reference Asset:';
                const parts = rawDesc.split(marker);

                let userPart = parts[0];
                let sysPart = marker + parts.slice(1).join(marker); // Reconstruct system part

                // If DB was escaped, we need to unescape the User Part so .text() doesn't double-escape it
                if (isEscaped) userPart = decodeHtml(userPart);

                // System Part is HTML. If it was escaped, we MUST unescape it to make it clickable.
                if (isEscaped) sysPart = decodeHtml(sysPart);

                descEl.empty().text(userPart).append(sysPart);
            } else {
                // No reference asset. Just render as text to preserve code tags.
                // If DB is escaping it, we unescape first.
                if (isEscaped) rawDesc = decodeHtml(rawDesc);
                descEl.text(rawDesc);
            }

            // Render Tags
            const tags = (t.tags && (Array.isArray(t.tags) ? t.tags : (typeof t.tags === 'string' ? t.tags.split(',') : []))) || [];
            if (tags.length > 0) {
                const tagsHtml = tags.map(tag =>
                    `<span class="px-2.5 py-1 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-[10px] font-black uppercase tracking-widest text-indigo-600 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-800">${tag.trim()}</span>`
                ).join('');
                $('#detail-tags').html(tagsHtml).removeClass('hidden');
            } else {
                $('#detail-tags').empty().addClass('hidden');
            }
            $('#detail-hints').html((t.hints || "No Teacher Hints Provided.").replace(/\n/g, '<br>'));

            // SHOW LOADER IN FOOTER
            // This prevents the "New Form" from flashing or appearing falsely while we check the DataBase
            const footer = $('#submission-section');
            
            // TRACKING: Update Activity
            if (typeof window.updateActivity === 'function') {
                const taskTitle = t.title ? t.title.substring(0, 15) + (t.title.length > 15 ? '...' : '') : 'Task';
                window.updateActivity(`Viewing Task: ${taskTitle}`);
            }

            footer.html(`
                <div class="py-10 text-center flex flex-col items-center justify-center animate-in fade-in">
                    <i data-lucide="loader-2" class="w-6 h-6 text-indigo-500 animate-spin mb-3"></i>
                    <p class="text-[9px] font-black uppercase tracking-[0.2em] text-indigo-400">Verifying Submission...</p>
                </div>
            `).removeClass('hidden');
            lucide.createIcons();

            // ROBUST SUBMISSION FINDER (Async)
            const findSub = async () => {
                // 1. Try Local Cache First (Fastest)
                if (window.allSubmissions) {
                    const cached = window.allSubmissions.find(s =>
                        s.student_id === currentUser?.id &&
                        String(s.task_id) === taskIdStr
                    );
                    if (cached) return cached;
                }

                // 2. Direct DB Fetch (Fallback)
                // This guarantees we find it if it exists in Supabase
                if (currentUser) {
                    try {
                        // Create a timeout promise for this specific check
                        const timeoutCheck = new Promise((_, reject) =>
                            setTimeout(() => reject(new Error("Sub check timeout")), 5000)
                        );

                        const { data, error } = await Promise.race([
                            client.from('submissions')
                                .select('*')
                                .eq('task_id', taskIdStr)
                                .eq('student_id', currentUser.id)
                                .maybeSingle(),
                            timeoutCheck
                        ]);

                        if (error) console.warn("Submission Check Error:", error);
                        if (data) {
                            // Sync to cache so we don't fetch again next time
                            if (window.allSubmissions) window.allSubmissions.push(data);
                            return data;
                        }
                    } catch (err) {
                        console.error("Network Error during submission check:", err);
                    }
                }
                return null;
            };

            const sub = await findSub();
            window.currentSub = sub; // Store for global access

            if (t.hints) $('#detail-guidance').removeClass('hidden'); else $('#detail-guidance').addClass('hidden');

            // Timer Logic
            if (window.detailTimer) clearInterval(window.detailTimer);
            if (t.deadline) {
                const deadline = new Date(t.deadline).getTime();
                window.detailTimer = setInterval(() => {
                    const now = new Date().getTime();
                    const dist = deadline - now;
                    if (dist < 0) {
                        $('#detail-time-container').text("EXPIRED").addClass('text-rose-500');
                    } else {
                        const days = Math.floor(dist / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const mins = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
                        $('#detail-time-container').text(`${days}d ${hours}h ${mins}m`).removeClass('text-rose-500');
                    }
                }, 1000);
            } else {
                $('#detail-time-container').text("No Deadline");
            }



            // ADMIN VIEW IN MODAL
            if (userProfile.role === 'admin') {
                footer.html(`
                    <div class="p-6 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-100 dark:border-indigo-800 text-center">
                        <i data-lucide="shield-check" class="w-8 h-8 text-indigo-500 mx-auto mb-2"></i>
                        <p class="text-xs font-bold text-indigo-800 dark:text-indigo-300">Admin Mode Preview</p>
                        <p class="text-[9px] text-indigo-400 uppercase tracking-widest mt-1">This is how students see the task.</p>
                    </div>`);
            }
            // STUDENT VIEW IN MODAL
            else if (sub) {
                // Already Submitted View -> Use the Helper Function
                if (sub.status === 'graded') {
                    // Graded View (Keep separate as it has feedback/score)
                    const feedbackHtml = `
                        <div class="mt-4 p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl border border-emerald-100 dark:border-emerald-800">
                            <h6 class="font-black text-emerald-700 dark:text-emerald-400 uppercase tracking-widest text-[9px] mb-1">Teacher Feedback</h6>
                            <p class="text-xs text-emerald-900 dark:text-emerald-100 italic">"${sub.feedback}"</p>
                            <div class="mt-2 font-black text-2xl text-emerald-600">${sub.grade}/100</div>
                         <button onclick="downloadReport('${sub.task_id}')" class="mt-3 w-full py-2 bg-white border border-emerald-200 text-emerald-600 hover:bg-emerald-50 rounded-lg text-xs font-bold uppercase tracking-widest flex items-center justify-center gap-2 transition-all">
                            <i data-lucide="file-down" class="w-4 h-4"></i> PDF Report
                        </button>
                    </div>`;

                    footer.html(`
                    <div class="text-center py-6">
                        <div class="w-12 h-12 mx-auto bg-emerald-100 dark:bg-emerald-900/30 text-emerald-500 rounded-full flex items-center justify-center mb-3">
                            <i data-lucide="check-circle" class="w-6 h-6"></i>
                        </div>
                        <h4 class="font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight">Assignment Graded</h4>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mb-4">Status: <span class="text-emerald-500">GRADED</span></p>
                        ${feedbackHtml}
                    </div>`);
                } else {
                    // Pending Result - Show Status Card which has the "Resubmit" button
                    footer.html(window.renderStatusCard(sub));
                }
            } else {
                // Submission Form for Student (Not Submitted Yet OR Resubmitting via toggle)
                if (typeof window.renderSubmitForm === 'function') {
                    window.renderSubmitForm(tid);
                } else {
                    footer.html('<div class="p-4 text-center text-rose-500">Error loading form.</div>');
                }
            }

            new bootstrap.Modal(document.getElementById('taskDetailModal')).show();
            fetchComments(tid);
            lucide.createIcons();
        };

        window.renderGrading = (subs) => {
            // Prevent UI refresh if admin is currently typing
            if ($('#grading-list input:focus, #grading-list textarea:focus').length > 0) return;

            // PRESERVE STATE
            const openAccordions = [];
            $('#grading-list [id^="grading-"]').each(function () {
                if (!$(this).hasClass('hidden')) {
                    openAccordions.push($(this).attr('id'));
                }
            });

            const container = $('#grading-list').empty();

            if (!subs || !subs.length) {
                container.html('<div class="p-16 text-center text-slate-400 font-black uppercase tracking-[0.2em] text-[10px] italic">Status: No submissions found.</div>');
                return;
            }

            // Group by Student
            const studentsDict = {};
            subs.forEach(s => {
                if (!studentsDict[s.student_id]) {
                    studentsDict[s.student_id] = {
                        name: s.student_name,
                        id: s.student_id,
                        submissions: []
                    };
                }
                studentsDict[s.student_id].submissions.push(s);
            });

            const students = Object.values(studentsDict).sort((a, b) => a.name.localeCompare(b.name));

            students.forEach(student => {
                // 1. Identify Graded Tasks First
                const gradedSet = new Set();
                student.submissions
                    .filter(s => s.status === 'graded')
                    .forEach(s => gradedSet.add(s.task_id));
                const gradedCount = gradedSet.size;

                // 2. Calculate Pending (Excluding tasks that are already graded)
                const pendingSet = new Set();
                student.submissions
                    .filter(s => s.status === 'submitted') // Only pending
                    .filter(s => !gradedSet.has(s.task_id)) // CRITICAL: If graded, don't count as pending
                    .sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at))
                    .forEach(s => pendingSet.add(s.task_id));

                const pendingCount = pendingSet.size;
                const accordionId = `grading-${student.id}`;

                // Check if this card was previously open
                const isOpen = openAccordions.includes(accordionId);

                // Card Header with Dynamic State
                const cardHtml = `
                    <div class="bg-white dark:bg-[#1e293b] rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden animate-in fade-in slide-in-from-bottom-2">
                        <div class="p-5 flex items-center justify-between cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors select-none" onclick="$('#${accordionId}').toggleClass('hidden'); $(this).find('.chevron').toggleClass('rotate-180')">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center font-black text-lg border border-indigo-200 dark:border-indigo-800/50">
                                    ${student.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h5 class="font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight leading-none mb-1.5 text-sm">${student.name}</h5>
                                    <div class="text-[9px] font-bold uppercase tracking-widest text-slate-400 flex items-center gap-3">
                                        <span class="${pendingCount > 0 ? 'text-amber-500 bg-amber-50 dark:bg-amber-900/20 px-2 py-0.5 rounded border border-amber-100 dark:border-amber-900/30' : 'text-slate-400'}">${pendingCount} Pending</span>
                                        <span class="text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-0.5 rounded border border-emerald-100 dark:border-emerald-900/30">${gradedCount} Graded</span>
                                    </div>
                                </div>
                            </div>
                            <div class="w-8 h-8 flex items-center justify-center rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-400 transition-transform duration-300 chevron ${isOpen ? 'rotate-180' : ''}">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                        </div>
                        
                        <div id="${accordionId}" class="${isOpen ? '' : 'hidden'} border-t border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-[#0b1120]/30 divide-y divide-slate-100 dark:divide-slate-800">
                           <!-- Submissions will go here --> 
                        </div>
                    </div>`;

                const $card = $(cardHtml);
                const $list = $card.find(`#${accordionId}`);

                // Add Submissions to the list
                const rawPending = student.submissions
                    .filter(s => s.status !== 'graded')
                    .filter(s => !gradedSet.has(s.task_id)) // Hide if already graded
                    .sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at));

                const sortedSubs = [];
                const seenTasks = new Set();
                rawPending.forEach(s => {
                    if (!seenTasks.has(s.task_id)) {
                        seenTasks.add(s.task_id);
                        sortedSubs.push(s);
                    }
                });

                // Add valid submissions
                if (sortedSubs.length > 0) {
                    sortedSubs.forEach(s => {
                        const isGraded = s.status === 'graded'; // Should be false here due to filters, but kept for robustness
                        const subHtml = `
                             <div class="p-6 flex flex-col lg:flex-row gap-6 items-start ${isGraded ? 'opacity-70 hover:opacity-100 bg-slate-50 dark:bg-slate-900/20' : 'bg-white dark:bg-[#1e293b]'} transition-all">
                                <div class="flex-1 w-full">
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-[8px] ${isGraded ? 'text-emerald-500 bg-emerald-100 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-900/40' : 'text-amber-600 bg-amber-100 dark:bg-amber-900/30 border-amber-200 dark:border-amber-900/40'} border px-2 py-1 rounded inline-flex items-center gap-1.5 font-black uppercase tracking-[0.15em]">
                                            <i data-lucide="${isGraded ? 'check-circle' : 'clock'}" class="w-3 h-3"></i> ${isGraded ? 'GRADED' : 'PENDING REVIEW'}
                                        </p>
                                        <div class="text-[9px] text-slate-400 font-bold uppercase tracking-widest flex items-center gap-1.5">
                                            <i data-lucide="calendar" class="w-3 h-3"></i> ${new Date(s.submitted_at).toLocaleDateString()}
                                        </div>
                                    </div>
                                    
                                    <h6 class="font-black text-slate-900 dark:text-slate-200 text-base uppercase tracking-tight mb-2 leading-none">${s.task_title}</h6>
                                    
                                    <div class="flex flex-wrap gap-2 mb-4 mt-3">
                                         ${(() => {
                                const data = parseSubmission(s.content);
                                let html = '';
                                if (data.file) html += `<a href="${formatDownloadUrl(data.file)}" target="_blank" class="px-4 py-2 rounded-xl bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 text-[9px] font-black uppercase tracking-widest flex items-center gap-2 hover:border-indigo-500 hover:text-indigo-500 transition-all text-slate-600 dark:text-slate-400"><i data-lucide="file" class="w-3.5 h-3.5"></i> Download File</a>`;
                                if (data.github) html += `<a href="${data.github}" target="_blank" class="px-4 py-2 rounded-xl bg-slate-900 text-white border-2 border-slate-900 text-[9px] font-black uppercase tracking-widest flex items-center gap-2 hover:bg-slate-800 transition-all"><i data-lucide="github" class="w-3.5 h-3.5"></i> View Code</a>`;
                                if (data.live) html += `<a href="${data.live}" target="_blank" class="px-4 py-2 rounded-xl bg-emerald-500 text-white border-2 border-emerald-500 text-[9px] font-black uppercase tracking-widest flex items-center gap-2 hover:bg-emerald-600 transition-all"><i data-lucide="globe" class="w-3.5 h-3.5"></i> Live Demo</a>`;
                                return html || '<span class="px-3 py-1.5 rounded-lg bg-rose-50 text-rose-500 border border-rose-100 text-[8px] font-black uppercase tracking-widest">No Assets</span>';
                            })()}
                                    </div>
                                </div>
                                
                                <div class="w-full lg:w-auto flex flex-col gap-3 min-w-[240px]">
                                    ${!isGraded ? `
                                    <div class="bg-indigo-50 dark:bg-indigo-900/10 p-4 rounded-xl border border-indigo-100 dark:border-indigo-900/20">
                                        <div class="flex gap-2 mb-2">
                                            <input type="number" id="grade-${s.id}" class="w-20 p-2 text-center bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-black outline-none focus:ring-2 focus:ring-indigo-500 dark:text-slate-200 placeholder:font-normal" placeholder="0-100">
                                            <button onclick="window.submitGrade('${s.id}')" class="flex-1 btn-command px-4 py-2 rounded-lg text-[9px] shadow-none">Submit Grade</button>
                                        </div>
                                        <textarea id="feedback-${s.id}" class="w-full p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-[10px] font-bold outline-none focus:ring-2 focus:ring-indigo-500 resize-none dark:text-slate-200" placeholder="Write feedback for student..." rows="2"></textarea>
                                    </div>
                                    ` : ''}
                                </div>
                             </div>
                             `;
                        $list.append(subHtml);
                    });

                    container.append($card);
                }
            });
            lucide.createIcons();
        };

        async function fetchUsers() {
            // Select all fields to ensure status, avatar_url, and email are available
            console.log("Fetching users...");
            const { data: users, error } = await client.from('profiles').select('*').order('created_at', { ascending: false });

            if (error) {
                console.error("fetchUsers Error:", error);
                showToast("Failed to fetch students. Check console.");
            } else {
                const studentCount = users ? users.filter(u => u.role === 'student').length : 0;
                console.log(`Fetched ${users ? users.length : 0} total users. ${studentCount} are students.`);
            }

            const { data: progress } = await client.from('user_arcade_progress').select('*');

            window.allUsersCache = users || [];
            window.allArcadeProgress = progress || [];
            renderUsers(window.allUsersCache);
        }

        function renderUsers(users) {
            const container = $('#user-table-body').empty();
            const query = $('#user-search').val().toLowerCase();

            users.filter(u => u.role === 'student' && (u.name.toLowerCase().includes(query) || (u.email && u.email.toLowerCase().includes(query)))).forEach(u => {
                // ROBUST ID CHECK: Use uid or id
                const userId = u.uid || u.id;

                // Real-time Online Check
                const isOnline = window.onlineUsers && window.onlineUsers.some(ou => ou.user_id === userId);

                const uSubsRaw = window.allSubmissions.filter(s => s.student_id === userId);

                // DEDUPLICATE: Map task_id -> latest submission
                const uniqueSubsMap = new Map();
                uSubsRaw.forEach(s => {
                    const existing = uniqueSubsMap.get(s.task_id);
                    if (!existing || new Date(s.submitted_at) > new Date(existing.submitted_at)) {
                        uniqueSubsMap.set(s.task_id, s);
                    }
                });
                const uSubs = Array.from(uniqueSubsMap.values());

                const gradedSubs = uSubs.filter(s => s.status === 'graded');
                const avg = gradedSubs.length ? Math.round(gradedSubs.reduce((a, b) => a + b.grade, 0) / gradedSubs.length) : 0;

                // Get Arcade Progress 
                const prog = window.allArcadeProgress ? window.allArcadeProgress.find(p => p.user_id === userId) : null;
                const htmlLvl = prog?.html_level || '-';
                const cssLvl = prog?.css_level || '-';
                const jsLvl = prog?.js_level || '-';

                // Fallback for avatar: DB -> Local Cache (Same Device) -> Initials
                const localCache = localStorage.getItem(`cached_avatar_${userId}`);
                const dbAvatar = u.avatar_url;

                // Strict check: if dbAvatar is "null", "undefined", or empty/whitespace, treat as null.
                const isValidDb = dbAvatar && dbAvatar !== "null" && dbAvatar !== "undefined" && dbAvatar.trim() !== "";
                const isValidLocal = localCache && localCache !== "null" && localCache !== "undefined" && localCache.trim() !== "";

                const avatar = isValidDb ? dbAvatar : (isValidLocal ? localCache : `https://ui-avatars.com/api/?name=${encodeURIComponent(u.name)}&background=random`);
                // Default status if null
                const status = u.status || 'active';

                const levelBadge = (lvl, color) => {
                    const displayLvl = (lvl === '-') ? 'easy' : lvl;
                    const short = displayLvl.charAt(0).toUpperCase();
                    return `<span class="inline-flex items-center justify-center w-5 h-5 rounded text-[8px] font-black uppercase bg-${color}-100 dark:bg-${color}-900/30 text-${color}-600 dark:text-${color}-400 border border-${color}-200 dark:border-${color}-800/50" title="${displayLvl}">${short}</span>`;
                };

                container.append(`
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-colors border-b border-slate-50 dark:border-slate-800/50 text-xs ${isOnline ? 'bg-emerald-50/30 dark:bg-emerald-900/10' : ''}">
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                                <div class="relative w-8 h-8 shrink-0">
                                    <div class="w-8 h-8 rounded-full overflow-hidden border border-slate-200 dark:border-slate-700 shadow-sm">
                                        <img src="${avatar}" class="w-full h-full object-cover" alt="${u.name}" onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(u.name)}&background=random';">
                                    </div>
                                    ${isOnline ? '<span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 border-2 border-white dark:border-slate-900 rounded-full animate-pulse" title="Online Now"></span>' : ''}
                                </div>
                                <div class="min-w-0">
                                    <div class="font-black text-slate-900 dark:text-indigo-400 uppercase tracking-tight text-sm mb-0.5 truncate">${u.name}</div>
                                    <div class="text-[8px] text-slate-400 font-bold uppercase tracking-widest flex items-center gap-1.5 truncate">
                                        <i data-lucide="mail" class="w-2.5 h-2.5 text-indigo-500"></i> ${u.email || 'No Email'}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center hidden sm:table-cell">
                        <div class="flex flex-col items-center justify-center gap-1">
                                <div class="flex items-center gap-2">
                                    <span class="text-[9px] font-black uppercase tracking-widest text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 px-1.5 py-0.5 rounded border border-emerald-100 dark:border-emerald-900/30" title="Completed/Submitted">
                                        ${uSubs.length} Done
                                    </span>
                                    <span class="text-[9px] font-black uppercase tracking-widest text-slate-400 bg-slate-50 dark:bg-slate-800 px-1.5 py-0.5 rounded border border-slate-100 dark:border-slate-700" title="Not Attempted">
                                        ${Math.max(0, (window.allTasks ? window.allTasks.length : 0) - uSubs.length)} Pending
                                    </span>
                                </div>
                             </div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="font-black text-slate-900 dark:text-slate-200 text-xs">${avg}%</div>
                        </td>
                        <td class="px-4 py-4 text-center">
                            <div class="flex gap-1 justify-center">
                                ${levelBadge(htmlLvl, 'orange')}
                                ${levelBadge(cssLvl, 'cyan')}
                                ${levelBadge(jsLvl, 'yellow')}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-3 py-1 rounded-lg text-[8px] font-black uppercase tracking-[0.15em] shadow-sm ${status === 'approved' || status === 'active' || status === 'online' ? 'bg-emerald-500 text-white' : 'bg-amber-500 text-white'}">${status === 'online' ? 'approved' : status}</span>
                        </td>
                        <td class="px-6 py-4 text-right space-x-1 whitespace-nowrap flex justify-end gap-1">
                             ${status === 'pending' ? `<button onclick="approveUser('${userId}')" class="p-2 text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10 rounded-lg transition-all"><i data-lucide="shield-check" class="w-4 h-4"></i></button>` : ''}
                            <button onclick="window.adminResetPassword('${userId}', '${(u.name || "").replace(/'/g, "\\'")}')" class="p-2 text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-500/10 rounded-lg transition-all" title="Reset Credentials"><i data-lucide="key-round" class="w-4 h-4"></i></button>
                            <button onclick="window.adminResetExam('${userId}', '${(u.name || "").replace(/'/g, "\\'")}')" class="p-2 text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 rounded-lg transition-all" title="Reset Exam"><i data-lucide="rotate-ccw" class="w-4 h-4"></i></button>
                            <button onclick="generateResult('${userId}')" class="p-2 text-teal-500 hover:bg-teal-50 dark:hover:bg-teal-500/10 rounded-lg transition-all" title="Intelligence Report"><i data-lucide="file-bar-chart-2" class="w-4 h-4"></i></button>
                            <button onclick="deleteUser('${userId}')" class="p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-500/10 rounded-lg transition-all" title="Purge Record"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </td >
                    </tr >
                    `);
            });
            lucide.createIcons();
        }

        // --- FEEDBACK LOGIC ---
        // NEW: Check for feedback count for admin notification
        async function checkFeedbackCount() {
            // Only admins need this
            if (!userProfile || userProfile.role !== 'admin') return;

            try {
                // Count only UNREAD feedback
                const { count, error } = await client
                    .from('feedback')
                    .select('*', { count: 'exact', head: true })
                    .eq('is_read', false);

                if (!error) {
                    const badge = document.getElementById('feedback-notification');
                    if (badge) {
                        if (count > 0) {
                            badge.textContent = count;
                            badge.classList.remove('hidden');
                        } else {
                            badge.classList.add('hidden');
                        }
                    }
                }
            } catch (e) {
                console.warn("Feedback count check failed", e);
            }
        }

        // Mark feedback as read when viewing details
        window.viewFeedbackDetails = async (id) => {
            // 1. Open Window Immediately (UX priority)
            window.open(`feedback_details.html?id=${id}`, '_blank', 'width=800,height=900');

            // 2. Mark as Read in Background
            try {
                const { error } = await client
                    .from('feedback')
                    .update({ is_read: true })
                    .eq('id', id);

                if (!error) {
                    // 3. Update Badge immediately
                    checkFeedbackCount();

                    // 4. Update row visual style immediately (Optimistic UI)
                    const dot = document.getElementById(`dot-${id}`);
                    if (dot) dot.remove();

                    const row = document.getElementById(`row-${id}`);
                    if (row) {
                        row.classList.remove('bg-slate-50/50', 'dark:bg-slate-800/50', 'font-bold');
                    }

                } else {
                    console.error("Supabase Update Error:", error);
                    // If permission error, alert user (useful for debugging)
                    if (error.code === '42501') {
                        alert("Permission Denied: Cannot mark feedback as read. Please run the Fix SQL.");
                    }
                }
            } catch (e) {
                console.error("Error marking feedback read:", e);
            }
        };

        async function fetchFeedback() {
            console.log("Fetching feedback...");
            const { data: feedback, error } = await client.from('feedback')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error("fetchFeedback Error:", error);
                showToast("Failed to fetch feedback.");
            } else {
                renderFeedbackTable(feedback || []);
                $('#total-feedback-count').text(`${feedback ? feedback.length : 0} Records`);
            }
        }

        window.renderFeedback = fetchFeedback;

        // Helper to fetch image as base64 (for PDF)
        const fetchImage = async (url) => {
            if (!url) return null;
            try {
                // If it's already base64, return it
                if (url.startsWith('data:')) return url;
                
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });
            } catch (e) {
                console.warn("Image fetch failed", e);
                return null;
            }
        };

        // --- PROFESSIONAL REPORT GENERATION ---
        window.generateResult = async (userId) => {
            const user = window.allUsersCache.find(u => (u.uid || u.id) === userId);
            if (!user) return showToast("User not found");

            // Fetch Profile Image (Async)
            let profileImgData = null;
            const profileUrl = user.avatar_url || user.profile_pic || user.profileImage;
            if (profileUrl) {
                try {
                    profileImgData = await fetchImage(profileUrl);
                } catch(e) { console.warn("Profile image fetch failed", e); }
            }

            // Deduplicate submissions (keep highest grade) and filter valid grades
            const rawSubmissions = window.allSubmissions.filter(s => s.student_id === userId && s.status === 'graded' && s.grade != null && s.grade !== '');
            const uniqueTasksMap = new Map();
            
            rawSubmissions.forEach(s => {
                const existing = uniqueTasksMap.get(s.task_id);
                const sGrade = parseFloat(s.grade) || 0;
                const existingGrade = existing ? (parseFloat(existing.grade) || 0) : -1;
                
                if (!existing || sGrade > existingGrade) {
                    uniqueTasksMap.set(s.task_id, s);
                }
            });

            const submissions = Array.from(uniqueTasksMap.values()).sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at));
            const progress = window.allArcadeProgress ? window.allArcadeProgress.find(p => p.user_id === userId) : null;

            // Calculate Stats
            const totalGraded = submissions.length;
            const avgGrade = totalGraded > 0
                ? Math.round(submissions.reduce((a, b) => a + (parseInt(b.grade) || 0), 0) / totalGraded)
                : 0;

            const pdfLib = window.jsPDF || window.jspdf?.jsPDF;
            if (!pdfLib) return showToast("PDF Library not loaded");

            const doc = new pdfLib();

            // Verify autoTable plugin is available
            if (typeof doc.autoTable !== 'function') {
                console.error("AutoTable plugin not loaded properly");
                return showToast("PDF AutoTable plugin not loaded. Please refresh the page.");
            }

            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();

            // --- 1. HEADER & BRANDING ---
            // Header Background Strip (Light Blue-Gray) - Increased height for better layout
            doc.setFillColor(241, 245, 249); // Slate 100
            doc.rect(0, 0, pageWidth, 50, 'F');

            // Logo (Left) - Professional Small Size
            if (window.bbsydpLogo) {
                try {
                    // Reduced to 18mm height for subtle professional look
                    // Auto-width (0) preserves aspect ratio
                    const logoH = 18;
                    
                    // Vertically centered in 50px header: (50 - 18) / 2 = 16
                    doc.addImage(window.bbsydpLogo, 'PNG', 14, 16, 0, logoH); 
                } catch (e) { 
                    console.warn("Logo error", e); 
                    doc.addImage(window.bbsydpLogo, 'PNG', 14, 16, 18, 18);
                }
            }

            // Organization Text (Right of logo)
            const textX = 55; // Moved right to prevent overlap with wide logo
            
            // Line 1: Organization Prefix
            doc.setFont("helvetica", "bold");
            doc.setFontSize(10);
            doc.setTextColor(71, 85, 105); // Slate 600
            doc.text("BENAZIR BHUTTO SHAHEED", textX, 19); // Shifted down for centering
            
            // Line 2: Main Board Name
            doc.setFontSize(14);
            doc.setTextColor(15, 23, 42); // Slate 900
            doc.text("Human Resource Research & Development Board", textX, 27);

            // Line 3: Government Affiliation
            doc.setFontSize(9);
            doc.setTextColor(100, 116, 139); // Slate 500
            doc.setFont("helvetica", "normal");
            doc.text("Government of Sindh", textX, 34);

            // Title Strip (Indigo Gradient Effect)
            doc.setFillColor(79, 70, 229); // Indigo 600
            doc.rect(0, 50, pageWidth, 14, 'F'); // Adjusted Y position
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont("helvetica", "bold");
            doc.text("STUDENT PERFORMANCE REPORT", pageWidth / 2, 59, { align: "center" }); // Adjusted Y position

            // --- 2. STUDENT BIO-DATA SECTION ---
            let yPos = 75; // Adjusted starting Y for content
            doc.setFont("helvetica", "bold");
            doc.setFontSize(11);
            doc.setTextColor(70);
            doc.text("STUDENT PROFILE", 14, yPos);
            doc.setLineWidth(0.5);
            doc.setDrawColor(200);
            doc.line(14, yPos + 2, 196, yPos + 2);

            yPos += 10;
            const avatarSize = 24;

            // Avatar - Show student's profile image or initial
            if (profileImgData) {
                try {
                    doc.addImage(profileImgData, 'PNG', 14, yPos, avatarSize, avatarSize);
                    // Border for avatar
                    doc.setDrawColor(226, 232, 240);
                    doc.setLineWidth(0.5);
                    doc.rect(14, yPos, avatarSize, avatarSize);
                } catch (e) {
                    // Fallback to initial if image fails
                    doc.setDrawColor(220);
                    doc.setFillColor(245);
                    doc.roundedRect(14, yPos, avatarSize, avatarSize, 3, 3, 'FD');
                    doc.setFontSize(20);
                    doc.setTextColor(150);
                    doc.text(user.name.charAt(0).toUpperCase(), 14 + (avatarSize / 2), yPos + 16, { align: "center" });
                }
            } else {
                // Avatar Placeholder with initial
                doc.setDrawColor(220);
                doc.setFillColor(245);
                doc.roundedRect(14, yPos, avatarSize, avatarSize, 3, 3, 'FD');
                doc.setFontSize(20);
                doc.setTextColor(150);
                doc.text(user.name.charAt(0).toUpperCase(), 14 + (avatarSize / 2), yPos + 16, { align: "center" });
            }

            // Info Grid
            doc.setFontSize(10);
            const leftColX = 45;
            const rightColX = 135; // Moved right to prevent overlap with long emails
            const rowHeight = 7;

            // Row 1
            doc.setTextColor(100); doc.setFont("helvetica", "normal");
            doc.text("Full Name:", leftColX, yPos + 6);
            doc.setTextColor(0); doc.setFont("helvetica", "bold");
            doc.text(user.name, leftColX + 25, yPos + 6);

            doc.setTextColor(100); doc.setFont("helvetica", "normal");
            doc.text("Student ID:", rightColX, yPos + 6);
            doc.setTextColor(0); doc.setFont("helvetica", "bold");
            doc.text((user.uid || user.id).substring(0, 8).toUpperCase(), rightColX + 25, yPos + 6);

            // Row 2
            doc.setTextColor(100); doc.setFont("helvetica", "normal");
            doc.text("Email:", leftColX, yPos + 6 + rowHeight);
            doc.setTextColor(0); doc.setFont("helvetica", "bold");
            doc.text(user.email || "N/A", leftColX + 25, yPos + 6 + rowHeight);

            doc.setTextColor(100); doc.setFont("helvetica", "normal");
            doc.text("Report Date:", rightColX, yPos + 6 + rowHeight);
            doc.setTextColor(0); doc.setFont("helvetica", "bold");
            doc.text(new Date().toLocaleDateString(), rightColX + 25, yPos + 6 + rowHeight);

            // Row 3 (Role)
            doc.setTextColor(100); doc.setFont("helvetica", "normal");
            doc.text("Program:", leftColX, yPos + 6 + (rowHeight * 2));
            doc.setTextColor(0); doc.setFont("helvetica", "bold");
            doc.text("Web Development With Python", leftColX + 25, yPos + 6 + (rowHeight * 2));

            yPos += 35;

            // --- 3. PERFORMANCE SUMMARY (Visual Cards) ---
            doc.setFont("helvetica", "bold");
            doc.setFontSize(11);
            doc.setTextColor(70);
            doc.text("PERFORMANCE METRICS", 14, yPos);
            doc.line(14, yPos + 2, 196, yPos + 2);
            yPos += 8;

            // Draw 3 Cards
            const cardW = 55;
            const cardH = 25;
            const gap = 8;
            let cardX = 14;

            // Function to draw card with colored accent
            const drawStatCard = (label, value, subtext, colorV) => {
                // Card background
                doc.setFillColor(255, 255, 255);
                doc.setDrawColor(226, 232, 240); // Slate 200
                doc.setLineWidth(0.5);
                doc.roundedRect(cardX, yPos, cardW, cardH, 3, 3, 'FD');

                // Colored left accent bar
                doc.setFillColor(colorV[0], colorV[1], colorV[2]);
                doc.roundedRect(cardX, yPos, 3, cardH, 3, 3, 'F');

                // Label
                doc.setFontSize(8);
                doc.setTextColor(100, 116, 139); // Slate 500
                doc.setFont("helvetica", "bold");
                doc.text(label.toUpperCase(), cardX + (cardW / 2), yPos + 8, { align: "center" });

                // Value
                doc.setFontSize(16);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(colorV[0], colorV[1], colorV[2]);
                doc.text(String(value), cardX + (cardW / 2), yPos + 17, { align: "center" });

                // Subtext
                if (subtext) {
                    doc.setFontSize(7);
                    doc.setTextColor(148, 163, 184); // Slate 400
                    doc.setFont("helvetica", "normal");
                    doc.text(subtext, cardX + (cardW / 2), yPos + 22, { align: "center" });
                }
                cardX += cardW + gap;
            };

            drawStatCard("Tasks Completed", totalGraded, "Verified Submissions", [79, 70, 229]); // Indigo
            drawStatCard("Average Grade", avgGrade + "%", "Overall Score", [16, 185, 129]); // Emerald

            // Arcade Level Summary
            let arcadeSummary = "No Data";
            if (progress) {
                const h = progress.html_level || '-';
                const c = progress.css_level || '-';
                const j = progress.js_level || '-';
                arcadeSummary = `H:${h} | C:${c} | J:${j}`;
            }
            drawStatCard("Arcade Rank", (window.allArcadeProgress?.find(p => p.user_id === userId)?.rank_name || "Novice"), arcadeSummary, [245, 158, 11]); // Amber

            yPos += 35;

            // --- 4. SUBMISSION TABLE ---
            doc.autoTable({
                startY: yPos,
                head: [['Task Title', 'Submission Date', 'Status', 'Grade', 'Feedback/Remarks']],
                body: submissions.map(s => [
                    window.fixEncoding(s.task_title || "Unknown Task"),
                    new Date(s.submitted_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }),
                    "GRADED",
                    s.grade + "%",
                    window.fixEncoding(s.feedback || "-")
                ]),
                theme: 'striped',
                headStyles: {
                    fillColor: [79, 70, 229], // Indigo 600
                    textColor: 255,
                    fontSize: 9,
                    fontStyle: 'bold',
                    halign: 'center'
                },
                bodyStyles: {
                    fontSize: 8,
                    textColor: [51, 65, 85], // Slate 700
                    cellPadding: 4
                },
                alternateRowStyles: {
                    fillColor: [248, 250, 252] // Slate 50
                },
                columnStyles: {
                    0: { cellWidth: 55, fontStyle: 'bold', halign: 'left' },
                    1: { cellWidth: 30, halign: 'center' },
                    2: { cellWidth: 25, halign: 'center', textColor: [16, 185, 129] }, // Green for status
                    3: { cellWidth: 20, halign: 'center', fontStyle: 'bold', textColor: [79, 70, 229] }, // Indigo for grade
                    4: { cellWidth: 'auto', halign: 'left' }
                },
                margin: { top: 20, left: 14, right: 14 },
                
                // HOOKS FOR EMOJI RENDERING
                didParseCell: function(data) {
                    // Check Body Cells in Title (0) and Feedback (4) columns
                    if (data.section === 'body' && (data.column.index === 0 || data.column.index === 4)) {
                        const text = Array.isArray(data.cell.text) ? data.cell.text.join(' ') : data.cell.text;
                        
                        // Check for Emojis (Surrogates) or Non-ASCII
                        if (/[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(text) || /[^\x00-\x7F]/.test(text)) {
                            data.cell.customText = text;
                            
                            // Hide the original text by setting color to match background (or transparent-ish)
                            // Note: We keep the text so autoTable calculates row height correctly!
                            data.cell.styles.textColor = data.cell.styles.fillColor || [255, 255, 255]; 
                        }
                    }
                },
                didDrawCell: function(data) {
                    if (data.cell.customText) {
                        try {
                            const text = data.cell.customText;
                            const ptSize = data.cell.styles.fontSize;
                            const pxSize = ptSize * 1.333; // Convert pt to px
                            
                            // Get color (force dark slate for readability)
                            // We ignore the hidden text color and use our own
                            const colorStyle = '#334155';

                            // Get Cell Width (converted to pixels for canvas)
                            // data.cell.width is in mm (default jsPDF unit)
                            // 1 mm = 3.7795 px (approx 96 DPI)
                            const availableWidthMm = data.cell.width - data.cell.padding('left') - data.cell.padding('right');
                            const cellWidthPx = availableWidthMm * 3.78;

                            // Generate Image with Wrapping and High DPI (Scale 4)
                            // We use the pixel width calculated from mm to ensure 1:1 visual scaling
                            let weight = data.cell.styles.fontStyle || 'normal';
                            if (weight === 'bolditalic') weight = 'italic bold';
                            
                            const imgObj = window.textToImage(text, pxSize, colorStyle, cellWidthPx, 4, weight);
                            
                            // Dimensions for PDF (mm)
                            // We want to fill the available width in the cell
                            
                            // Calculate height based on aspect ratio
                            const ratio = imgObj.height / imgObj.width;
                            const drawHeight = availableWidthMm * ratio;
                            
                            // Position
                            const x = data.cell.x + data.cell.padding('left');
                            const y = data.cell.y + data.cell.padding('top'); // Align top
                            
                            // Draw Image
                            data.doc.addImage(imgObj.dataUrl, 'PNG', x, y, availableWidthMm, drawHeight);
                            
                        } catch(e) {
                            console.error("Error rendering emoji cell", e);
                        }
                    }
                },

                didDrawPage: function (data) {
                    // Footer logic if table spans multiple pages
                }
            });

            // --- 4.5 INSTRUCTOR REMARKS (UPDATED) ---
            let remarksY = doc.lastAutoTable.finalY + 15;

            // Check if we need space for remarks
            if (remarksY > pageHeight - 70) {
                doc.addPage();
                remarksY = 40;
            }

            // Section Header
            doc.setFont("helvetica", "bold");
            doc.setFontSize(11);
            doc.setTextColor(79, 70, 229); // Indigo 600
            doc.text("INSTRUCTOR REMARKS", 14, remarksY);

            remarksY += 8;

            // Generate remarks based on average grade (WITH EMOJIS)
            let instructorRemarks = "";
            if (avgGrade >= 90) {
                instructorRemarks = "Outstanding performance! 🌟 The student has demonstrated exceptional understanding and mastery of the concepts. Keep up the excellent work and continue to challenge yourself with advanced topics. 🚀";
            } else if (avgGrade >= 80) {
                instructorRemarks = "Excellent work! ✨ The student shows strong grasp of the material and consistent effort. Continue this momentum and focus on refining advanced skills for even better results. 💪";
            } else if (avgGrade >= 70) {
                instructorRemarks = "Good progress! 👍 The student is performing well and shows solid understanding. With more practice and attention to detail, performance can reach the next level. 📈";
            } else if (avgGrade >= 60) {
                instructorRemarks = "Satisfactory performance. The student demonstrates basic understanding but needs to focus more on core concepts. Additional practice and review of fundamentals is recommended. 📚";
            } else if (avgGrade >= 50) {
                instructorRemarks = "Needs improvement. ⚠️ The student should dedicate more time to studying and seek help when needed. Regular practice and consultation with instructors will help improve performance.";
            } else {
                instructorRemarks = "Requires immediate attention. 🚨 The student is struggling with the material and needs significant support. Please schedule one-on-one sessions and focus on building foundational skills.";
            }

            // Render Remarks as Image (for Emoji support)
            try {
                 const pxSize = 9 * 1.333; // 9pt to px
                 const colorStyle = '#5C4033'; // Amber 900
                 const maxWidthMm = pageWidth - 40; // 210 - 40 = 170mm approx
                 const maxWidthPx = maxWidthMm * 3.78; // mm to px

                 // Generate High-Res Image of Text
                 const imgObj = window.textToImage(instructorRemarks, pxSize, colorStyle, maxWidthPx, 4, 'normal');
                 
                 // Calculate dimensions
                 const ratio = imgObj.height / imgObj.width;
                 const drawHeight = maxWidthMm * ratio;
                 const remarksBoxHeight = Math.max(25, drawHeight + 10);

                 // Remarks Box with light background
                 doc.setFillColor(254, 252, 232); // Amber 50
                 doc.setDrawColor(251, 191, 36); // Amber 400
                 doc.setLineWidth(0.5);
                 doc.roundedRect(14, remarksY, pageWidth - 28, remarksBoxHeight, 2, 2, 'FD');

                 // Draw Image
                 doc.addImage(imgObj.dataUrl, 'PNG', 18, remarksY + 5, maxWidthMm, drawHeight);

                 remarksY += remarksBoxHeight + 5;

            } catch(e) {
                 console.error("Remarks rendering failed", e);
                 // Fallback to text (No Emojis)
                 doc.setFont("helvetica", "normal");
                 doc.setFontSize(9);
                 const remarksLines = doc.splitTextToSize(instructorRemarks.replace(/[^\x00-\x7F]/g, ""), pageWidth - 40); // Strip emojis for fallback
                 const remarksBoxHeight = Math.max(25, (remarksLines.length * 4) + 10);

                 doc.setFillColor(254, 252, 232); // Amber 50
                 doc.setDrawColor(251, 191, 36); // Amber 400
                 doc.setLineWidth(0.5);
                 doc.roundedRect(14, remarksY, pageWidth - 28, remarksBoxHeight, 2, 2, 'FD');

                 // Draw remarks text with proper wrapping
                 doc.setTextColor(92, 64, 51); // Amber 900
                 doc.text(remarksLines, 18, remarksY + 6);

                 remarksY += remarksBoxHeight + 5;
            }

            // --- 5. FOOTER & SIGNATURE ---
            let finalY = remarksY + 10;

            // Check if we need a new page for signature
            if (finalY > pageHeight - 50) {
                doc.addPage();
                finalY = 40;
            }

            // Separator line
            doc.setDrawColor(203, 213, 225); // Slate 300
            doc.setLineWidth(0.5);
            doc.line(14, finalY, pageWidth - 14, finalY);

            finalY += 10;

            // Signature section
            if (window.adminSignature) {
                try {
                    // Right aligned signature
                    doc.addImage(window.adminSignature, 'PNG', pageWidth - 60, finalY, 40, 15);
                    doc.setLineWidth(0.5);
                    doc.setDrawColor(148, 163, 184); // Slate 400
                    doc.line(pageWidth - 60, finalY + 17, pageWidth - 20, finalY + 17);

                    doc.setFontSize(9);
                    doc.setTextColor(15, 23, 42); // Slate 900
                    doc.setFont("helvetica", "bold");
                    doc.text("Authorized Signature", pageWidth - 40, finalY + 30, { align: "center" });

                    doc.setFontSize(7);
                    doc.setTextColor(100, 116, 139); // Slate 500
                    doc.setFont("helvetica", "normal");
                    doc.text("BBSHRRDB Administration", pageWidth - 40, finalY + 36, { align: "center" });
                } catch (e) { console.warn("Signature error", e); }
            }

            // Left side: Document metadata
            doc.setFontSize(7);
            doc.setTextColor(100, 116, 139); // Slate 500
            doc.setFont("helvetica", "normal");
            doc.text("Document ID: " + Date.now().toString(36).toUpperCase(), 14, finalY + 15);
            doc.text("Generated: " + new Date().toLocaleString('en-US'), 14, finalY + 20);
            doc.text("System: BBSHRRDB LMS v2.0", 14, finalY + 25);

            finalY += 50;

            // Disclaimer box with light background
            doc.setFillColor(248, 250, 252); // Slate 50
            doc.roundedRect(14, finalY, pageWidth - 28, 12, 2, 2, 'F');

            doc.setFontSize(8);
            doc.setTextColor(100, 116, 139); // Slate 500
            doc.setFont("helvetica", "italic");
            doc.text("This document is electronically generated and serves as an official performance record.", pageWidth / 2, finalY + 5, { align: "center" });
            doc.text("For verification, please contact BBSHRRDB Administration.", pageWidth / 2, finalY + 9, { align: "center" });

            // Generate filename with date
            const reportDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format
            const sanitizedName = user.name.replace(/\s+/g, '_');
            doc.save(`BBSHRRDB_Performance_Report_${sanitizedName}_${reportDate}.pdf`);
        };

        window.downloadReport = (taskId) => {
            const currentUser = window.userProfile;
            if (!currentUser) return;

            const sub = window.allSubmissions.find(s => s.task_id == taskId && s.student_id === (currentUser.uid || currentUser.id));

            if (!sub) {
                showToast("Submission details not found.");
                return;
            }

            // Use html2canvas via jsPDF.html() to support emojis
            const { jsPDF } = window.jspdf;
            // Use 'pt' units for easier HTML-to-PDF mapping
            const doc = new jsPDF('p', 'pt', 'a4');

            // Create a temporary container for the report
            const reportContainer = document.createElement('div');
            // A4 width is approx 595pt. We use slightly less for margins if needed, 
            // but here we'll set a fixed width and let jsPDF scale it.
            reportContainer.style.width = '550pt'; 
            reportContainer.style.padding = '30pt';
            reportContainer.style.backgroundColor = '#ffffff';
            // Important: Use fonts that support emojis on the OS
            reportContainer.style.fontFamily = "'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', 'Outfit', sans-serif";
            reportContainer.style.position = 'absolute';
            reportContainer.style.left = '-9999px';
            reportContainer.style.top = '0';
            
            // Build HTML Content
            const gradeColor = '#10b981'; // Emerald 500
            const titleColor = '#4f46e5'; // Indigo 600
            // Apply Mojibake Fix to Feedback and Title
            const feedbackText = sub.feedback ? window.fixEncoding(sub.feedback).replace(/\n/g, '<br>') : "No feedback provided.";
            const taskTitle = window.fixEncoding(sub.task_title);

            reportContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 20pt; border-bottom: 2pt solid #e2e8f0; padding-bottom: 10pt;">
                    <h1 style="color: ${titleColor}; font-size: 22pt; font-weight: bold; margin: 0;">Task Performance Report</h1>
                </div>

                <div style="margin-bottom: 20pt; font-size: 12pt; color: #1e293b; line-height: 1.6;">
                    <p style="margin: 5pt 0;"><strong>Student:</strong> ${currentUser.name}</p>
                    <p style="margin: 5pt 0;"><strong>Task:</strong> ${taskTitle}</p>
                    <p style="margin: 5pt 0;"><strong>Date:</strong> ${new Date(sub.submitted_at).toLocaleDateString()}</p>
                </div>

                <div style="margin-bottom: 20pt;">
                    <h2 style="font-size: 14pt; font-weight: bold; color: #1e293b; margin-bottom: 5pt;">Grade</h2>
                    <div style="font-size: 28pt; font-weight: bold; color: ${gradeColor};">${sub.grade}/100</div>
                </div>

                <div>
                    <h2 style="font-size: 14pt; font-weight: bold; color: #1e293b; margin-bottom: 10pt;">Feedback</h2>
                    <div style="font-size: 11pt; color: #334155; line-height: 1.5; white-space: pre-wrap;">${feedbackText}</div>
                </div>
                
                <div style="margin-top: 40pt; font-size: 9pt; color: #94a3b8; text-align: center; border-top: 1pt solid #e2e8f0; padding-top: 10pt;">
                    Generated by BBSHRRDB LMS
                </div>
            `;

            document.body.appendChild(reportContainer);

            doc.html(reportContainer, {
                callback: function (doc) {
                    doc.save(`Task_Report_${taskId}.pdf`);
                    document.body.removeChild(reportContainer);
                },
                x: 20,
                y: 20,
                width: 555, // Target width in PDF units (pt)
                windowWidth: 800, // Virtual window width for rendering
                html2canvas: {
                    scale: 4 // High resolution for crisp text and emojis
                }
            });
        };

        function renderFeedbackTable(feedbackList) {
            const container = $('#feedback-table-body').empty();

            if (!feedbackList || feedbackList.length === 0) {
                container.html('<tr><td colspan="7" class="px-6 py-8 text-center text-slate-400 font-bold uppercase tracking-widest text-xs">No feedback received yet.</td></tr>');
                return;
            }

            feedbackList.forEach(item => {
                const date = new Date(item.created_at).toLocaleDateString();

                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= item.rating) stars += '<i data-lucide="star" class="w-3 h-3 fill-amber-400 text-amber-400 inline"></i>';
                    else stars += '<i data-lucide="star" class="w-3 h-3 text-slate-300 inline"></i>';
                }

                const badgeClass = "px-2 py-1 rounded text-[9px] font-black uppercase tracking-widest border";
                let qBadge = `<span class="${badgeClass} bg-slate-100 text-slate-500 border-slate-200">${item.content_quality}</span>`;
                if (item.content_quality === 'excellent') qBadge = `<span class="${badgeClass} bg-emerald-50 text-emerald-600 border-emerald-200">${item.content_quality}</span>`;
                else if (item.content_quality === 'good') qBadge = `<span class="${badgeClass} bg-indigo-50 text-indigo-600 border-indigo-200">${item.content_quality}</span>`;
                else if (item.content_quality === 'average') qBadge = `<span class="${badgeClass} bg-amber-50 text-amber-600 border-amber-200">${item.content_quality}</span>`;
                else if (item.content_quality === 'poor') qBadge = `<span class="${badgeClass} bg-rose-50 text-rose-600 border-rose-200">${item.content_quality}</span>`;

                let uBadge = `<span class="${badgeClass} bg-slate-100 text-slate-500 border-slate-200">${item.usability}</span>`;
                if (item.usability === 'yes') uBadge = `<span class="${badgeClass} bg-emerald-50 text-emerald-600 border-emerald-200">Easy</span>`;
                else if (item.usability === 'somewhat') uBadge = `<span class="${badgeClass} bg-amber-50 text-amber-600 border-amber-200">Okay</span>`;
                else if (item.usability === 'no') uBadge = `<span class="${badgeClass} bg-rose-50 text-rose-600 border-rose-200">Hard</span>`;

                // Unread Indicator
                const unreadDot = (!item.is_read)
                    ? `<span id="dot-${item.id}" class="absolute top-1/2 left-2 -translate-y-1/2 w-2 h-2 bg-rose-500 rounded-full animate-pulse shadow-sm"></span>`
                    : '';
                const rowClass = (!item.is_read) ? "bg-slate-50/50 dark:bg-slate-800/50 font-bold" : "";

                container.append(`
                    <tr id="row-${item.id}" class="relative hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-colors border-b border-slate-50 dark:border-slate-800/50 text-xs ${rowClass}">
                        <td class="px-6 py-4 relative pl-8">
                            ${unreadDot}
                            <div class="font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight">${item.student_name || 'Anonymous'}</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex items-center justify-center gap-0.5">${stars}</div>
                        </td>
                        <td class="px-6 py-4 text-center">${qBadge}</td>
                        <td class="px-6 py-4 text-center">${uBadge}</td>
                        <td class="px-6 py-4 max-w-xs truncate" title="${item.comments || ''}">
                            <span class="text-slate-600 dark:text-slate-400 font-medium italic">"${item.comments || 'No comments'}"</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">${date}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                             <div class="flex items-center justify-end gap-2">
                                <button onclick="viewFeedbackDetails('${item.id}')" 
                                    class="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" title="View Details">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteFeedback('${item.id}')" 
                                    class="p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors" title="Delete Feedback">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `);
            });
            lucide.createIcons();
        }

        window.deleteFeedback = async (id) => {
            console.log("Delete requested for:", id);

            if (!confirm("Are you sure you want to delete this feedback? This action cannot be undone.")) return;

            try {
                // 1. Attempt Delete
                const { data, error } = await client
                    .from('feedback')
                    .delete()
                    .eq('id', id)
                    .select(); // IMPORTANT: Return the deleted data to verify RLS allowed it

                // 2. Check for Supabase Error
                if (error) {
                    console.error("Supabase Delete Error:", error);
                    if (error.code === '42501') {
                        alert("Permission Denied: You do not have permission to delete this. (RLS Policy)");
                    } else {
                        throw error;
                    }
                    return;
                }

                // 3. Check for Silent Failure (RLS hidden filtering)
                if (!data || data.length === 0) {
                    console.warn("Delete succeeded but no rows returned. RLS likely hid the row.");
                    alert("Delete Failed: The server ignored the request. This usually means the 'Delete Policy' is missing or you are not recognized as an Admin.");
                    return;
                }

                // 4. Success
                showToast("Feedback deleted successfully");

                // Optimistic UI Update
                const row = document.getElementById(`row-${id}`);
                if (row) row.remove();

                checkFeedbackCount();

                // Refresh data to be sure
                fetchFeedback();

            } catch (err) {
                console.error("Error deleting feedback:", err);
                alert("Error: " + (err.message || "Unknown error occurred"));
            }
        };

        window.toggleGlobalArcadeAccess = async () => {
            const isUnlocked = localStorage.getItem('global_arcade_unlock') === 'true';
            const newState = !isUnlocked;

            // 1. Optimistic UI Update (Immediate)
            localStorage.setItem('global_arcade_unlock', newState);
            if (newState) showToast("Arcade GLOBAL UNLOCK Enabled.");
            else showToast("Arcade GLOBAL LOCK Enabled.");
            switchTab(activeTab); // Refresh UI

            // 2. Database Update
            try {
                const { error } = await client.from('arcade_config').update({ is_unlocked: newState }).eq('id', 1);

                if (error) {
                    console.error("Arcade Config DB Update Failed:", error);
                    // Revert UI if DB fails? Or just retry? For now, we assume success or retry next time.
                    // If table doesn't exist, this might fail silently in UI but log error.
                    // Fallback to local is already done above.
                }
            } catch (e) {
                console.error("Arcade DB Error:", e);
                // Fallback for "First run" or "Table missing" scenario:
                // We keep the local setting derived from optimistic update.
            }
        };

        // New DB Sync Function
        async function fetchArcadeConfig() {
            try {
                const { data, error } = await client.from('arcade_config').select('is_unlocked').eq('id', 1).maybeSingle();
                if (data) {
                    const serverState = data.is_unlocked.toString();
                    // Always update local storage to match server truth
                    if (localStorage.getItem('global_arcade_unlock') !== serverState) {
                        localStorage.setItem('global_arcade_unlock', serverState);
                        console.log("[Arcade] Synced from DB:", serverState);

                        // Force UI Refresh to show correct lock/unlock status or button state
                        if (typeof switchTab === 'function') switchTab(activeTab);
                    }
                }
            } catch (e) { console.warn("[Arcade] Config sync failed (Table likely missing). Using local override."); }
        }

        function getTaskDeadlineDefault() {
            const date = new Date();
            date.setDate(date.getDate() + 1); // Set to tomorrow
            date.setHours(9, 30, 0, 0); // Set to 9:30 AM

            // Format to local ISO (YYYY-MM-DDTHH:mm)
            const pad = (n) => n.toString().padStart(2, '0');
            return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
        }

        window.openCreateTaskModal = () => {
            editingTaskId = null;
            $('#create-task-form')[0].reset();
            $('#new-task-date').val(getTaskDeadlineDefault());
            $('#ref-file-name').text('Attach a helpful file');
            $('#task-submit-btn').text('Create Task');
            bootstrap.Modal.getOrCreateInstance(document.getElementById('createTaskModal')).show();
        };

        window.openEditTaskModal = (id) => {
            const task = window.allTasks.find(t => t.id === id);
            if (!task) return;
            editingTaskId = id;
            $('#new-task-title').val(task.title);
            $('#new-task-desc').val(task.description);
            $('#new-task-hints').val(task.hints || '');
            $('#new-task-date').val('');
            if (task.deadline) {
                try {
                    const d = new Date(task.deadline);
                    const offset = d.getTimezoneOffset() * 60000;
                    const localISOTime = (new Date(d - offset)).toISOString().slice(0, 16);
                    $('#new-task-date').val(localISOTime);
                } catch (e) {
                    $('#new-task-date').val(task.deadline.substring(0, 16));
                }
            }
            $('#task-submit-btn').text('Update Task');
            bootstrap.Modal.getOrCreateInstance(document.getElementById('createTaskModal')).show();
        };

        window.openEditFromDetail = () => {
            const id = currentTask.id;
            bootstrap.Modal.getOrCreateInstance(document.getElementById('taskDetailModal')).hide();
            setTimeout(() => openEditTaskModal(id), 400); // Wait for hide animation
        };

        window.deleteTask = async (id) => {
            if (!confirm('Are you sure you want to delete this task?')) return;
            const { error } = await client.from('tasks').delete().eq('id', id);
            if (!error) {
                showToast('Task deleted successfully');
                loadCachedData();
            } else {
                showToast("Error deleting task: " + error.message, 'error');
            }
        };

        // Feedback Popup Logic
        window.showFeedbackPopup = async () => {
            // 1. Check if user is logged in and is a student
            if (!userProfile || userProfile.role !== 'student') return;

            // 2. Check LocalStorage Cache first (fast check)
            // We use 'uid' (UUID) to be consistent with feedback.html and auth.user.id
            if (localStorage.getItem(`feedback_submitted_${userProfile.uid}`) === 'true') {
                console.log("Feedback already submitted (Cached).");
                return;
            }

            // 3. Check Supabase DB (Robust check)
            try {
                const { data, error } = await client
                    .from('feedback')
                    .select('id')
                    .eq('student_id', userProfile.uid) // Use UUID to match feedback table
                    .maybeSingle(); // Returns null if not found, instead of error for 0 rows

                if (data) {
                    // Feedback exists
                    console.log("Feedback already found in DB. Skipping popup.");
                    localStorage.setItem(`feedback_submitted_${userProfile.uid}`, 'true'); // Update cache
                    return;
                }
            } catch (err) {
                console.error("Error checking feedback status:", err);
                // If error (e.g. offline), maybe skip to avoid annoying user? 
                // Or show it? Let's skip to be safe.
                return;
            }

            const modal = document.getElementById('feedback-modal');

            if (modal && modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.classList.add('flex'); // Enable flexbox for centering
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    const innerDiv = modal.querySelector('div');
                    if (innerDiv) {
                        innerDiv.classList.remove('scale-95');
                        innerDiv.classList.add('scale-100');
                    }
                }, 10);
            }
        };

        window.closeFeedbackModal = () => {
            const modal = document.getElementById('feedback-modal');
            if (modal) {
                modal.classList.add('opacity-0');
                const innerDiv = modal.querySelector('div');
                if (innerDiv) {
                    innerDiv.classList.remove('scale-100');
                    innerDiv.classList.add('scale-95');
                }
                setTimeout(() => {
                    modal.classList.remove('flex'); // Disable flexbox
                    modal.classList.add('hidden');
                }, 300);
            }
        };

        window.switchTab = (tabId) => {
            console.log("Switching to:", tabId);
            activeTab = tabId;

            // --- 1. PRE-SWITCH CLEANUP (Arcade & Game Logic) ---
            $('#game-stage').addClass('hidden');
            if (window.activeGameTimer) clearInterval(window.activeGameTimer);
            if (typeof window.gameActive !== 'undefined') window.gameActive = false;

            // --- 2. NAVIGATION STATE UPDATES ---
            // Desktop Sidebar
            $('.nav-item').removeClass('active');
            $(`#nav-${tabId}`).addClass('active');
            // Support onclick selector style
            $(`.nav-item[onclick*="${tabId}"]`).addClass('active');

            // Mobile Bottom Nav
            $('.mobile-nav-btn').removeClass('active');
            $(`#mob-nav-${tabId}`).addClass('active');

            // --- 3. VIEW SWITCHING ---
            // Hide all views
            document.querySelectorAll('.content-view').forEach(el => {
                el.style.display = 'none';
                el.classList.add('hidden');
            });
            $('.content-view').addClass('hidden'); // jQuery backup

            // Show Target View
            const targetEl = document.getElementById(`view-${tabId}`);
            if (targetEl) {
                targetEl.style.display = 'block';
                targetEl.classList.remove('hidden');

                // Animations
                const $target = $(targetEl);
                $target.removeClass('animate-in fade-in slide-in-from-bottom-5');
                void targetEl.offsetWidth; // trigger reflow
                $target.addClass('animate-in fade-in slide-in-from-bottom-5');
            } else {
                console.error("Target view not found:", tabId);
            }

            // Special Banner Handling
            if (tabId === 'dashboard') {
                $('#v2-banner').show().removeClass('hidden');
                // Show feedback popup for students (or everyone for now)
                if (typeof showFeedbackPopup === 'function') showFeedbackPopup();
            } else {
                $('#v2-banner').hide().addClass('hidden');
            }

            // --- 4. TITLE UPDATES ---
            const titles = {
                'chat': 'Messages',
                'dashboard': 'My Dashboard',
                'tasks': (userProfile && userProfile.role === 'admin') ? "Student Tasks" : "My Tasks",
                'resources': 'Learning Resources',
                'leaderboard': 'Leaderboard',
                'arcade': 'Arcade Arena',
                'grading': 'Task Grading (Admin)',
                'users': 'User Management',
                'feedback': 'Student Feedback',
                'profile': 'My Profile',
                'playground': 'Live Code Editor',
                'exam': 'Online Examination'
            };
            $('#page-title').text(titles[tabId] || 'BBSHRRDB LMS');

            // --- 5. MOBILE SIDEBAR HANDLING ---
            if (window.innerWidth < 1024) {
                $('#sidebar-overlay').removeClass('show');
                $('aside').removeClass('translate-x-0').addClass('-translate-x-full');

                // Ensure mobile-open class is also removed if used
                const sidebar = document.getElementById('main-sidebar');
                if (sidebar && sidebar.classList.contains('mobile-open')) {
                    if (typeof window.toggleMobileSidebar === 'function') window.toggleMobileSidebar();
                }
            }

            // --- 6. SCROLL TO TOP ---
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // --- 7. SPECIFIC TAB INITIALIZATIONS & LOGIC ---

            // TRACKING: Update Activity
            if (typeof window.updateActivity === 'function') {
                const activityMap = {
                    'dashboard': 'Dashboard',
                    'tasks': 'Viewing Tasks',
                    'resources': 'Resources',
                    'leaderboard': 'Checking Leaderboard',
                    'arcade': 'Gaming in Arcade',
                    'grading': 'Grading Tasks',
                    'users': 'Managing Users',
                    'profile': 'Editing Profile',
                    'playground': 'Coding in Playground',
                    'exam': 'Taking Exam'
                };
                window.updateActivity(activityMap[tabId] || 'Browsing LMS');
            }

            // Exam
            if (tabId === 'exam') {
                if (typeof initExamSystem === 'function') initExamSystem();
            }

            // Tasks
            if (tabId === 'tasks') {
                if (!window.allTasks || window.allTasks.length === 0) {
                    if (typeof renderSkeleton === 'function') renderSkeleton('task-grid', 6, 'card');
                }
                if (typeof filterTasks === 'function') filterTasks('all');
            }

            // Users
            if (tabId === 'users') {
                if (!window.allUsersCache || window.allUsersCache.length === 0) {
                    if (typeof renderSkeleton === 'function') renderSkeleton('user-table-body', 8, 'list');
                }
            }

            // Feedback
            if (tabId === 'feedback') {
                if (typeof renderFeedback === 'function') renderFeedback();
            }

            // Chat
            if (tabId === 'chat') {
                if (typeof initChat === 'function') initChat();
            } else {
                if (typeof cleanupChat === 'function') cleanupChat();
            }

            // Profile
            if (tabId === 'profile') {
                if (typeof renderProfileChart === 'function') renderProfileChart();

                if (userProfile) {
                    $('#profile-name').val(userProfile.name);
                    $('#profile-email').val(userProfile.email);
                    const initial = userProfile.name.charAt(0).toUpperCase();
                    if (userProfile.avatar_url) {
                        $('#profile-avatar-display').html(`<img src="${userProfile.avatar_url}" class="w-full h-full object-cover">`);
                    } else {
                        $('#profile-avatar-display').html(`<span id="profile-initial-lg">${initial}</span>`);
                    }
                    $('#user-role').html(`<span class="text-indigo-600 dark:text-indigo-400 font-black">${userProfile.role.toUpperCase()}</span>`);

                    // Toggle Achievements Visibility
                    if (userProfile.role === 'student') {
                        $('#trophy-section').removeClass('hidden');
                        if (window.renderBadges) window.renderBadges();
                    } else {
                        $('#trophy-section').addClass('hidden');
                    }
                }
            }

            // Performance
            if (tabId === 'performance') {
                if (typeof renderPerformanceChart === 'function') renderPerformanceChart();
            }

            // Dashboard
            if (tabId === 'dashboard') {
                if (userProfile && userProfile.role === 'student') {
                    setTimeout(() => {
                        if (typeof checkAndShowEncouragement === 'function') checkAndShowEncouragement();
                    }, 500);
                }
                if (typeof performanceChart !== 'undefined' && performanceChart) {
                    if (typeof updateChart === 'function') updateChart();
                }
            }

            // Resources
            if (tabId === 'resources') {
                if (window.fetchResources) window.fetchResources();
            }

            // Playground
            if (tabId === 'playground') {
                if (window.runCode) setTimeout(window.runCode, 100);
            }

            // Arcade
            if (tabId === 'arcade') {
                const isGlobalUnlocked = localStorage.getItem('global_arcade_unlock') === 'true';
                if (isGlobalUnlocked) {
                    $('#arcade-locked').addClass('hidden');
                    $('#arcade-menu').removeClass('hidden');
                } else {
                    $('#arcade-locked').removeClass('hidden');
                    $('#arcade-menu').addClass('hidden');
                }
                if (typeof window.syncArcadeProgress === 'function') window.syncArcadeProgress();
            }

            // --- 8. ADMIN UI UPDATES ---
            if (userProfile && userProfile.role === 'admin') {
                $('#create-task-btn, #admin-notif-btn, #add-resource-btn, #arcade-toggle-btn').removeClass('hidden');
                if (tabId === 'dashboard') $('#admin-notice-actions').removeClass('hidden');
                else $('#admin-notice-actions').addClass('hidden');

                const isUnlocked = localStorage.getItem('global_arcade_unlock') === 'true';
                const btn = $('#arcade-toggle-btn');
                const dot = $('#arcade-dot');
                const ping = $('#arcade-ping');

                if (isUnlocked) {
                    btn.removeClass('text-slate-400').addClass('text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20');
                    dot.removeClass('hidden'); ping.removeClass('hidden');
                } else {
                    btn.removeClass('text-emerald-500 bg-emerald-50 dark:bg-emerald-900/20').addClass('text-slate-400');
                    dot.addClass('hidden'); ping.addClass('hidden');
                }
            } else {
                $('#create-task-btn, #admin-notif-btn, #add-resource-btn, #arcade-toggle-btn, #admin-notice-actions').addClass('hidden');
            }

            // --- 9. GLOBAL UPDATES ---
            if (typeof fetchData === 'function') fetchData();

            // Fix for stuck modal backdrops
            $('.modal').on('hidden.bs.modal', function () {
                if ($('.modal.show').length === 0) {
                    $('.modal-backdrop').remove();
                    $('body').removeClass('modal-open').css('padding-right', '');
                }
            });

            if (typeof lucide !== 'undefined' && lucide.createIcons) lucide.createIcons();
        };

        window.deleteSubmission = async (id) => {
            if (!confirm('Are you sure you want to delete this submission?')) return;
            const { error } = await client.from('submissions').delete().eq('id', id);
            if (!error) {
                showToast('Submission deleted successfully');
                loadCachedData();
            } else {
                showToast("Error deleting submission: " + error.message, 'error');
            }
        };

        window.deleteResource = async (id) => {
            if (!confirm('Delete this resource?')) return;
            const { error } = await client.from('resources').delete().eq('id', id);
            if (!error) {
                showToast('Resource deleted');
                if (window.fetchResources) window.fetchResources();
            } else {
                console.error(error);
                showToast('Error deleting resource (Check DB/Console)', 'error');
            }
        };

        // MANUAL OVERLAY LOGIC (Bypassing Bootstrap)
        window.adminResetPassword = async (uid, name) => {
            const newPass = prompt(`Set new password for ${name || 'User'}: `);
            if (newPass) {
                if (newPass.length < 6) return alert("Password must be at least 6 characters.");

                try {
                    // Try RPC call first (Requires 'admin_reset_password' function in DB)
                    const { error } = await client.rpc('admin_reset_password', { 
                        target_user_id: uid, 
                        new_password: newPass 
                    });

                    if (error) {
                        console.warn("RPC Failed, trying fallback...", error);
                        throw error;
                    }

                    alert("Password updated successfully!");
                } catch (e) {
                    console.error("Password Reset Error:", e);
                    navigator.clipboard.writeText(newPass);
                    alert(`Password reset failed (Backend function missing?).\n\nNew Password: ${newPass}\n(Copied to clipboard)\n\nTech Note: Please run 'reset_password_function.sql' in Supabase SQL Editor.`);
                }
            }
        };

        window.adminResetExam = async (uid, name) => {
            if (!confirm(`Are you sure you want to RESET the exam for ${name}? \n\nThis will: \n1. Delete their exam result record. \n2. Allow them to retake the test.`)) return;

            try {
                // Delete from exam_results
                const { error } = await client.from('exam_results').delete().eq('student_id', uid);

                if (error) {
                    console.error("Exam Reset Error:", error);
                    if (error.code === '42501' || error.message.includes('row level security')) {
                        alert("PERMISSION ERROR: You cannot delete exam records yet.\n\nPlease run the 'fix_exam_permissions.sql' script in your Supabase SQL Editor to enable this feature.");
                    } else {
                        showToast('Failed to reset exam record: ' + error.message, 'error');
                    }
                } else {
                    showToast(`Exam reset successfully for ${name}.`);
                    // Refresh the user list to show updated status (e.g. pending instead of done)
                    if (window.fetchUsers) window.fetchUsers();
                }
            } catch (e) {
                console.error("Exam Reset Exception:", e);
                showToast('An unexpected error occurred.', 'error');
            }
        };

        window.setupRealtime = () => {
            // Task Comments Realtime
            client.channel('public:task_comments').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'task_comments' }, payload => {
                if (currentTask && payload.new.task_id === currentTask.id) fetchComments(currentTask.id);
            }).subscribe();

            // Submissions Realtime (Admin Notification)
            if (userProfile.role === 'admin') {
                client.channel('public:submissions').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'submissions' }, payload => {
                    window.notifyAdmin(payload.new);
                    fetchData(); // Refresh data immediately
                }).subscribe();
            }

            // --- PRESENCE (Enhanced for Online Tracking) ---
            const presenceChannel = client.channel('online-users', {
                config: { 
                    presence: { key: currentUser.id },
                    broadcast: { self: true } // Allow receiving own broadcasts for testing if needed
                }
            });

            // Activity Tracking State
            let lastActive = Date.now();
            let currentStatus = 'online'; // online, idle
            let currentActivity = 'Dashboard'; // Dashboard, Viewing Task X, etc.
            
            // Sync Helper
            const syncPresence = async () => {
                const newState = {
                    user_id: currentUser.id,
                    user_name: userProfile.name,
                    role: userProfile.role,
                    online_at: new Date().toISOString(),
                    status: currentStatus,
                    activity: currentActivity
                };
                await presenceChannel.track(newState);
            };

            // Activity Listeners (Reset Idle Timer)
            const resetIdleTimer = () => {
                lastActive = Date.now();
                if (currentStatus === 'idle') {
                    currentStatus = 'online';
                    syncPresence();
                }
            };
            ['mousemove', 'keydown', 'click', 'scroll'].forEach(evt => document.addEventListener(evt, resetIdleTimer));

            // Idle Check Loop (Every 1 min)
            setInterval(() => {
                if (Date.now() - lastActive > 5 * 60 * 1000) { // 5 Minutes
                    if (currentStatus !== 'idle') {
                        currentStatus = 'idle';
                        syncPresence();
                    }
                }
            }, 60000);

            // Export for Global Usage
            window.updateActivity = (activityName) => {
                if (currentActivity !== activityName) {
                    currentActivity = activityName;
                    syncPresence();
                }
            };

            presenceChannel.on('presence', { event: 'sync' }, () => {
                const state = presenceChannel.presenceState();
                window.onlineUsers = [];
                for (const key in state) {
                    window.onlineUsers.push(...state[key]);
                }
                
                // Admin Update Logic
                if (userProfile.role === 'admin') {
                    const students = window.onlineUsers.filter(u => u.role === 'student');
                    
                    // Update User List Count
                    const countEl = document.getElementById('online-student-count');
                    if (countEl) {
                        countEl.innerText = `${students.length} Online`;
                        $(countEl).removeClass('hidden');
                    }

                    // Update Dashboard Widget
                    const dashCount = document.getElementById('dashboard-online-count');
                    if (dashCount) {
                        dashCount.innerText = students.length;
                        $('#admin-live-widget').removeClass('hidden');
                    }
                        
                    // Initial Notification
                    if (!window.hasShownOnlineNotif && students.length > 0) {
                         window.hasShownOnlineNotif = true;
                         showToast(`${students.length} Students are currently Online`, 'success');
                    }

                    // Refresh Table to show Online indicators
                    if (window.allUsersCache) {
                        renderUsers(window.allUsersCache);
                    }
                    
                    // Live Update Modal if Open
                    if ($('#onlineUsersModal').hasClass('show')) {
                        window.showOnlineStudentsModal();
                    }
                }
            });

            presenceChannel.subscribe(async (status) => {
                if (status === 'SUBSCRIBED') {
                    await syncPresence();
                }
            });

            // Nudge Listener (Broadcast)
            presenceChannel.on('broadcast', { event: 'nudge' }, ({ payload }) => {
                if (payload.target_id === currentUser.id) {
                    // Play Alert Sound
                    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
                    audio.play().catch(e => {});
                    
                    // Show SweetAlert
                    Swal.fire({
                        title: '👋 Admin Nudge!',
                        text: 'Admin is requesting your attention. Please check your pending tasks.',
                        icon: 'info',
                        confirmButtonText: 'Okay, I am here!',
                        confirmButtonColor: '#6366f1',
                        timer: 10000,
                        timerProgressBar: true
                    }).then((result) => {
                        // Ack by resetting idle
                        resetIdleTimer();
                        
                        // Send Acknowledgement to Admin
                        if (result.isConfirmed) {
                             presenceChannel.send({
                                type: 'broadcast',
                                event: 'nudge-ack',
                                payload: { 
                                    user_name: userProfile.name,
                                    user_id: currentUser.id 
                                }
                            });
                        }
                    });
                }
            });

            // Nudge Acknowledgement Listener (For Admin)
            presenceChannel.on('broadcast', { event: 'nudge-ack' }, ({ payload }) => {
                 if (userProfile.role === 'admin') {
                      // Play subtle sound
                      const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3'); // Ping sound
                      audio.volume = 0.5;
                      audio.play().catch(e => {});

                      showToast(`✅ ${payload.user_name} acknowledged your nudge!`, 'success');
                 }
            });

            // Typing Indicators (Broadcast) - Only for Task Hub now
            presenceChannel.on('broadcast', { event: 'typing' }, ({ payload }) => {
                if (payload.target_id === currentTask?.id) {
                    $('#comments-container').append(`<div id="typing-tmp" class="text-[7px] font-black text-slate-400 italic mb-2 uppercase tracking-widest">${payload.user_name} is typing...</div>`);
                    setTimeout(() => $('#typing-tmp').remove(), 2000);
                }
            });

            window.broadcastTyping = (targetId = null) => {
                presenceChannel.send({ type: 'broadcast', event: 'typing', payload: { user_name: userProfile.name, target_id: targetId } });
            };

            // ARCADE GLOBAL SYNC (REALTIME)
            // Auto-Dismiss Update Banner
            setTimeout(() => {
                $('#v2-banner').fadeOut(500);
            }, 5000);

            // ARCADE GLOBAL SYNC (REALTIME DB)
            const arcadeChannel = client.channel('arcade-control');
            arcadeChannel.on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'arcade_config' }, payload => {
                // Ensure we catch the update for row id=1
                if (payload.new.id === 1) {
                    const isUnlocked = payload.new.is_unlocked;
                    const strState = isUnlocked.toString();

                    if (localStorage.getItem('global_arcade_unlock') !== strState) {
                        localStorage.setItem('global_arcade_unlock', strState);

                        // UI Update Logic
                        if (activeTab === 'arcade') {
                            if (isUnlocked) {
                                $('#arcade-locked').addClass('hidden');
                                $('#arcade-menu').removeClass('hidden');
                                showToast("Arcade Unlocked by Admin!");
                            } else {
                                $('#arcade-locked').removeClass('hidden');
                                $('#arcade-menu').addClass('hidden');
                                $('#game-stage').addClass('hidden'); // Also quit active game
                                showToast("Arcade Locked by Admin!");
                            }
                        }

                        // If Admin, reflect in Toggle Button (optional, but switchTab covers it)
                        // This ensures instant feedback even if not focusing on tab switch
                        if (userProfile.role === 'admin') {
                            const btn = $('#arcade-toggle-btn');
                            if (isUnlocked) {
                                btn.removeClass('bg-slate-800 text-slate-400 opacity-50').addClass('bg-emerald-500 text-white shadow-lg shadow-emerald-500/30').html('<i data-lucide="gamepad-2" class="w-5 h-5"></i>');
                            } else {
                                btn.removeClass('bg-emerald-500 text-white shadow-lg shadow-emerald-500/30').addClass('bg-slate-800 text-slate-400 opacity-50').html('<i data-lucide="lock" class="w-5 h-5"></i>');
                            }
                            lucide.createIcons();
                        }
                    }
                }
            }).subscribe();

            // Deprecated: Broadcast is now handled via DB updates
            window.broadcastArcadeState = (isUnlocked) => { /* No-op, managed by DB triggers */ };

            window.notifyAdmin = (sub) => {
                // Play Sound (Subtle)
                const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
                audio.volume = 0.5;
                audio.play().catch(e => console.log('Audio play failed', e));

                const toastId = 'notif-' + Date.now();
                const toastHTML = `
            <div id="${toastId}" class="fixed top-20 right-10 z-[6000] cursor-pointer" onclick="switchTab('grading')">
                <div class="bg-white dark:bg-[#1e293b] border-l-4 border-indigo-500 rounded-lg shadow-2xl p-4 flex items-start gap-4 animate-in slide-in-from-right-10 duration-500">
                    <div class="w-10 h-10 rounded-full bg-indigo-50 dark:bg-indigo-900/30 text-indigo-500 flex items-center justify-center shrink-0">
                        <i data-lucide="bell-ring" class="w-5 h-5"></i>
                    </div>
                    <div class="min-w-[200px]">
                        <h4 class="text-xs font-black uppercase text-indigo-500 tracking-wider mb-1">New Submission</h4>
                        <p class="text-[11px] font-bold text-slate-800 dark:text-slate-100 leading-tight mb-1">${sub.student_name}</p>
                        <p class="text-[9px] text-slate-400 uppercase tracking-wide truncate w-40">${sub.task_title}</p>
                    </div>
                </div>
            </div>`;

                $('body').append(toastHTML);
                lucide.createIcons();

                setTimeout(() => {
                    $(`#${toastId} `).fadeOut(500, function () { $(this).remove(); });
                }, 6000);
            };
        };

        window.sendGlobalMessage = async () => {
            const el = $('#global-chat-input');
            const content = el.val().trim();
            if (!content) return;
            el.val('');
            const { error } = await client.from('global_messages').insert([{ user_id: currentUser.id, user_name: userProfile.name, role: userProfile.role, content }]);
            if (error) {
                console.error("Insert Error:", error);
                alert("Message Failed: " + error.message);
                el.val(content); // Restore message
            }
        };

        $('#comment-input').on('keydown', () => broadcastTyping(currentTask?.id));


        window.showOnlineStudentsModal = () => {
            const students = window.onlineUsers ? window.onlineUsers.filter(u => u.role === 'student') : [];
            const list = $('#online-users-list').empty();
            
            if (students.length === 0) {
                list.html('<div class="text-center py-8 text-slate-400 font-bold uppercase tracking-widest text-xs">No students currently online</div>');
            } else {
                students.forEach(s => {
                    const onlineSince = s.online_at ? new Date(s.online_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Just now';
                    const isIdle = s.status === 'idle';
                    const activity = s.activity || 'Dashboard';
                    
                    list.append(`
                        <div class="flex items-center gap-3 p-3 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700">
                            <div class="relative w-8 h-8 rounded-full ${isIdle ? 'bg-amber-500/10 text-amber-500' : 'bg-emerald-500/10 text-emerald-500'} flex items-center justify-center">
                                <i data-lucide="${isIdle ? 'coffee' : 'wifi'}" class="w-4 h-4"></i>
                                <div class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-white dark:border-slate-800 ${isIdle ? 'bg-amber-500' : 'bg-emerald-500'}"></div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-0.5">
                                    <p class="text-xs font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight truncate">${s.user_name}</p>
                                    <span class="text-[8px] font-bold uppercase tracking-widest ${isIdle ? 'text-amber-500' : 'text-emerald-500'}">${isIdle ? 'IDLE' : 'ACTIVE'}</span>
                                </div>
                                <p class="text-[9px] text-indigo-500 font-bold uppercase tracking-wide truncate mb-0.5"><i data-lucide="eye" class="w-2.5 h-2.5 inline mr-0.5"></i> ${activity}</p>
                                <p class="text-[8px] text-slate-400 font-bold uppercase tracking-widest">Since ${onlineSince}</p>
                            </div>
                            <button onclick="nudgeStudent('${s.user_id}', '${s.user_name}')" class="w-8 h-8 rounded-full bg-indigo-50 dark:bg-indigo-900/30 text-indigo-500 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 flex items-center justify-center transition-colors" title="Nudge Student">
                                <i data-lucide="bell-ring" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `);
                });
            }
            
            lucide.createIcons();
            // Only show if not already shown (to avoid flicker during re-render)
            if (!$('#onlineUsersModal').hasClass('show')) {
                new bootstrap.Modal(document.getElementById('onlineUsersModal')).show();
            }
        };

        window.nudgeStudent = async (uid, name) => {
            const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            const channel = client.channel('online-users');
            
            // Send Broadcast
            await channel.send({
                type: 'broadcast',
                event: 'nudge',
                payload: { target_id: uid }
            });

            // Feedback
            const btn = $(event.currentTarget);
            const originalIcon = btn.html();
            btn.html('<div class="spinner-border spinner-border-sm text-indigo-500"></div>');
            setTimeout(() => {
                btn.html(originalIcon);
                showToast(`Nudged ${name}!`, 'success');
            }, 800);
        };

        window.toggleSidebarCollapse = () => {
            const sidebar = $('#main-sidebar');
            const content = $('.content-main');
            const icon = $('#collapse-icon');

            sidebar.toggleClass('collapsed');
            content.toggleClass('expanded');

            // Rotate Icon
            if (sidebar.hasClass('collapsed')) {
                icon.css('transform', 'rotate(180deg)');
                localStorage.setItem('sidebar_collapsed', 'true');
            } else {
                icon.css('transform', 'rotate(0deg)');
                localStorage.setItem('sidebar_collapsed', 'false');
            }
        };

        // Init State
        $(document).ready(() => {
            if (localStorage.getItem('sidebar_collapsed') === 'true') {
                window.toggleSidebarCollapse();
            }
        });

        window.renderSubmitForm = (taskId) => {
            // Check if this is an UPDATE (Resubmission)
            const isUpdate = window.currentSub && (window.currentSub.task_id == taskId || window.currentSub.task_id === String(taskId));

            // Pre-fill data if updating
            let existingGithub = '';
            let existingLive = '';
            if (isUpdate && window.currentSub.content) {
                try {
                    const parsed = JSON.parse(window.currentSub.content);
                    existingGithub = parsed.github || '';
                    existingLive = parsed.live || '';
                } catch (e) { }
            }

            const heading = isUpdate ? 'Replace / Update Submission' : 'Upload Submission';
            const btnText = isUpdate ? 'Update Task' : 'Submit Task';
            const fileLabel = isUpdate ? 'Upload New File (Replaces Old)' : 'Upload File';

            $('#submission-section').html(`
            <form id="submit-form" class="space-y-6">
                <input type="hidden" id="submit-id" value="${taskId}">
                    
                    <div class="mb-2 text-center">
                         <span class="text-[9px] font-black uppercase tracking-widest ${isUpdate ? 'text-amber-500' : 'text-slate-400'}">${heading}</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-4">
                            <div class="group relative bg-slate-50 dark:bg-slate-800/30 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-3xl p-6 text-center hover:border-indigo-500 transition-all cursor-pointer overflow-hidden h-full flex flex-col items-center justify-center">
                                <div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <input type="file" id="submit-file" class="absolute inset-0 opacity-0 cursor-pointer z-10" onchange="$('#file-name').text(this.files[0].name)">
                                    <div class="relative z-0">
                                        <div class="w-12 h-12 bg-white dark:bg-slate-800 shadow-xl rounded-2xl flex items-center justify-center text-indigo-600 mx-auto mb-2 group-hover:scale-110 transition-transform">
                                            <i data-lucide="${isUpdate ? 'refresh-cw' : 'upload-cloud'}" class="w-6 h-6"></i>
                                        </div>
                                        <p class="font-black text-slate-900 dark:text-slate-200 uppercase tracking-tight text-[10px]">${fileLabel}</p>
                                        <p class="text-[8px] text-slate-400 font-bold uppercase tracking-widest mt-1" id="file-name">Optional</p>
                                    </div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1 block">GitHub Repository URL</label>
                                <input type="url" id="submit-github" value="${existingGithub}" placeholder="https://github.com/username/project" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl text-xs font-bold outline-none focus:border-indigo-500 dark:text-slate-200 transition-colors">
                            </div>
                            <div>
                                <label class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1 block">Live Demo Link</label>
                                <input type="url" id="submit-live" value="${existingLive}" placeholder="https://my-project.vercel.app" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl text-xs font-bold outline-none focus:border-emerald-500 dark:text-slate-200 transition-colors">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="w-full btn-command">${btnText}</button>
                </form>`).removeClass('hidden');
            lucide.createIcons();
        };

        window.enableResubmission = () => {
            const taskId = currentTask.id;
            window.renderSubmitForm(taskId);
            if (currentSub) {
                const data = parseSubmission(currentSub.content);
                if (data.github) $('#submit-github').val(data.github);
                if (data.live) $('#submit-live').val(data.live);
                $('#submit-form button').text('Update Submission');
            }
        };



        // Reset for Create Mode
        $('#create-task-btn').on('click', () => {
            editingTaskId = null;
            $('#create-task-form')[0].reset();
            $('#createTaskModal .modal-title').text('Create New Task');
            $('#task-submit-btn').text('Create Task');
        });

        window.renderStatusCard = (sub) => {
            return `
            <div class="p-10 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 rounded-3xl text-center font-black uppercase tracking-[0.2em] text-[10px] border border-indigo-100 dark:border-indigo-900/50 flex flex-col items-center gap-4">
                <i data-lucide="check-circle-2" class="w-8 h-8 animate-in zoom-in duration-300"></i> 
                <div>
                    <p class="text-[8px] opacity-70 mb-1">SUBMISSION STATUS</p>
                    <p class="text-xs">RECEIVED: ${(sub.task_title || 'Task Submitted')}</p>
                </div>
                <p class="text-[8px] bg-indigo-100 dark:bg-indigo-500/20 px-4 py-2 rounded-full mt-2">Result Pending</p>
                <div class="flex gap-2 justify-center mt-3">
                    ${(() => {
                    const data = parseSubmission(sub.content);
                    let html = '';
                    if (data.file) html += `<a href="${formatDownloadUrl(data.file)}" target="_blank" class="text-[8px] font-black uppercase text-indigo-500 hover:underline flex items-center gap-1"><i data-lucide="file" class="w-2.5 h-2.5"></i> File</a>`;
                    if (data.github) html += `<a href="${data.github}" target="_blank" class="text-[8px] font-black uppercase text-slate-500 hover:text-indigo-500 flex items-center gap-1"><i data-lucide="github" class="w-2.5 h-2.5"></i> Code</a>`;
                    if (data.live) html += `<a href="${data.live}" target="_blank" class="text-[8px] font-black uppercase text-emerald-500 hover:underline flex items-center gap-1"><i data-lucide="globe" class="w-2.5 h-2.5"></i> Live</a>`;
                    return html;
                })()}
                </div>
                <button onclick="enableResubmission()" class="mt-4 px-6 py-2 bg-white dark:bg-indigo-950 text-indigo-500 border border-indigo-200 dark:border-indigo-800 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-indigo-50 dark:hover:bg-indigo-900/40 transition-all shadow-sm">
                    Resubmit / Replace
                </button>
            </div>`;
        };

        // Global variable to track who Admin is replying to
        window.replyTargetStub = null; // { id: 'uuid', name: 'Student Name' }

        window.fetchComments = async (taskId) => {
            // Fetch ALL comments for the task (Client-side filtering for context)
            const { data: comments } = await client.from('task_comments').select('*').eq('task_id', taskId).order('created_at', { ascending: true });

            if (!comments) { renderComments([]); return; }

            // Filter Logic
            // Filter Logic
            const filtered = comments.filter(c => {
                let contentObj;
                try {
                    contentObj = JSON.parse(c.content);
                    // Check if it has our protocol structure - if neither exists, it's legacy
                    if (contentObj.sid === undefined && contentObj.txt === undefined) throw new Error("Legacy");
                } catch (e) {
                    // Legacy or Plain Text
                    // If Admin sent it legacy, assume Broadcast (sid: null)
                    // If Student sent it legacy, assume it belongs to them (sid: c.user_id)
                    const isAdm = c.role === 'admin';
                    contentObj = {
                        txt: c.content,
                        sid: isAdm ? null : c.user_id
                    };
                }

                // Attach parsed obj to comment for render
                c._parsed = contentObj;

                if (userProfile.role === 'admin') return true; // Admin sees all

                // Student: See OWN messages OR Admin messages targeted at them OR General Admin Broadcasts
                if (c.user_id === currentUser.id) return true; // My sent items

                // Targeted at me (Robust check)
                if (contentObj.sid && String(contentObj.sid) === String(currentUser.id)) return true;

                // General Admin Message (Broadcast) - i.e., no specific target
                if (c.role === 'admin' && !contentObj.sid) return true;

                return false;
            });

            renderComments(filtered);
        };

        function renderComments(comments) {
            const container = $('#comments-container').empty();

            // Clear reply stub if re-rendering (optional, but cleaner)
            // if (window.replyTargetStub) cancelReply(); 

            if (!comments.length) {
                container.html('<div class="text-center py-8 text-slate-400 text-[9px] font-bold uppercase tracking-widest italic opacity-50">No messages found.</div>');
                return;
            }

            comments.forEach(c => {
                const isAdmin = c.role === 'admin';
                const isMe = c.user_id === currentUser.id;

                // Use pre-parsed content or safe parse
                const data = c._parsed || (() => { try { return JSON.parse(c.content) } catch (e) { return { txt: c.content, sid: c.user_id } } })();
                const text = data.txt || c.content; // Fallback

                // For Admin: Show who the message belongs to contextually if likely mixed
                // If I am admin, and this msg is from a student, show "Reply" action
                let actions = '';
                if (userProfile.role === 'admin' && !isMe) {
                    actions = `<button onclick="setReplyContext('${c.user_id}', '${c.user_name}')" class="ml-2 text-[8px] text-indigo-400 hover:text-indigo-600 font-bold uppercase tracking-wider opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1"><i data-lucide="reply" class="w-2.5 h-2.5"></i> Reply</button>`;
                }

                container.append(`
            <div class="flex flex-col ${isMe ? 'items-end' : 'items-start'} animate-in fade-in slide-in-from-bottom-2 mb-4 group w-full">
                        <div class="flex items-center gap-2 mb-1">
                             <span class="text-[9px] font-black uppercase px-1 ${isAdmin ? 'text-rose-500' : 'text-indigo-500'}">${c.user_name}</span>
                             ${actions}
                        </div>
                        <div class="max-w-[85%] p-3 rounded-2xl text-[10px] font-medium shadow-sm border border-slate-100 dark:border-slate-800 ${isMe ? 'bg-indigo-600 text-white border-transparent rounded-tr-none' : 'bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-tl-none'} break-words whitespace-pre-wrap">
                            ${text}
                        </div>
                        <span class="text-[6px] text-slate-400 font-bold mt-1 opacity-100 transition-opacity">${new Date(c.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                    </div>
            `);
            });
            container.scrollTop(container[0].scrollHeight);
            lucide.createIcons();
        }

        window.setReplyContext = (sid, name) => {
            window.replyTargetStub = { id: sid, name: name };
            const input = $('#comment-input');
            input.focus();

            // Show Reply UI Indicator
            if ($('#reply-indicator').length === 0) {
                $('<div id="reply-indicator" class="flex items-center justify-between px-4 py-2 bg-indigo-50 dark:bg-indigo-900/20 border-t border-indigo-100 dark:border-indigo-800 text-[9px] font-bold text-indigo-600 mx-4 mt-2 rounded-t-lg"></div>').insertBefore('#comment-input-area');
            }
            $('#reply-indicator').html(`<span>Replying to: ${name}</span> <button onclick="cancelReply()" class="text-rose-500 hover:underline">Cancel</button>`).removeClass('hidden');
        };

        window.cancelReply = () => {
            window.replyTargetStub = null;
            $('#reply-indicator').addClass('hidden');
        };

        window.postComment = async () => {
            const content = $('#comment-input').val().trim();
            if (!content) return;
            const taskId = currentTask.id;

            // Determine Target Thread
            // Student: Always their own thread (sid = currentUser.id)
            // Admin: Thread ID of the student they are replying to. If no reply context, it's a "General" message (sid = null)
            let sid = (userProfile.role === 'student') ? currentUser.id : (window.replyTargetStub ? window.replyTargetStub.id : null);

            // Payload Structure: { txt: "Message", sid: "StudentUUID" }
            const payload = JSON.stringify({
                txt: content,
                sid: sid
            });

            $('#comment-input').val('');
            if (window.cancelReply) window.cancelReply(); // Reset reply state

            const { error } = await client.from('task_comments').insert([{
                task_id: taskId,
                user_id: currentUser.id,
                user_name: userProfile.name,
                role: userProfile.role,
                content: payload
            }]);

            if (!error) fetchComments(taskId);
        };

        $(document).on('submit', '#submit-form', async (e) => {
            e.preventDefault();
            const btn = $('#submit-form button');
            btn.prop('disabled', true).text('PROCESSING...');

            const file = document.getElementById('submit-file').files[0];
            const github = $('#submit-github').val()?.trim();
            const live = $('#submit-live').val()?.trim();
            const taskId = $('#submit-id').val();

            if (!file && !github && !live) {
                showToast("Please upload a file OR provide a link.");
                btn.prop('disabled', false).text('Submit Task');
                return;
            }

            try {
                let cloudFileUrl = null;
                const CLOUD_NAME = "dlm3iaqjn";
                const UPLO_PRESET = "lms_assignments";

                if (file) {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', UPLO_PRESET);
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: 'POST', body: formData });
                    const uploadData = await response.json();
                    if (uploadData.error) throw new Error(uploadData.error.message);
                    cloudFileUrl = uploadData.secure_url;
                }

                // Construct JSON Content
                const submissionData = {
                    file: cloudFileUrl,
                    github: github || null,
                    live: live || null,
                    timestamp: new Date().toISOString() // Metadata
                };

                // Resolve Task Title safely
                const activeTask = window.currentTask || (window.allTasks ? window.allTasks.find(t => String(t.id) === String(taskId)) : null);
                const safeTitle = activeTask ? activeTask.title : 'Task Submission';

                let dbOp;
                // If we have a current submission for this task, UPDATE it
                if (window.currentSub && window.currentSub.task_id == taskId) {
                    if (window.currentSub.status === 'graded') {
                        throw new Error("Cannot resubmit a graded task.");
                    }
                    console.log("Updating existing submission:", window.currentSub.id);
                    dbOp = client.from('submissions').update({
                        content: JSON.stringify(submissionData),
                        status: 'submitted', // Ensure status is submitted (in case we add other statuses later)
                        submitted_at: new Date().toISOString()
                    }).eq('id', window.currentSub.id);
                } else {
                    // Create NEW submission
                    dbOp = client.from('submissions').insert([{
                        task_id: taskId,
                        task_title: safeTitle,
                        student_id: currentUser.id,
                        student_name: userProfile.name,
                        content: JSON.stringify(submissionData),
                        status: 'submitted',
                        submitted_at: new Date().toISOString()
                    }]);
                }

                const { error: dbErr } = await dbOp;

                if (dbErr) throw dbErr;

                // REFRESH DATA & UI
                // Update global state immediately for the status card to work if re-opened
                const fakeSub = {
                    ...submissionData,
                    task_title: safeTitle,
                    content: JSON.stringify(submissionData),
                    status: 'submitted'
                };

                // Force UI update manually to guarantee the form disappears
                $('#submission-section').html(window.renderStatusCard(fakeSub));
                lucide.createIcons();

                await fetchData(); // Refresh background data
                showToast("Work Submitted Successfully!");
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

                // openDetail(taskId); // No longer needed, manual update handles it cleaner

            } catch (err) {
                console.error("Submission Error:", err);
                alert("Error: " + err.message);
            } finally {
                btn.prop('disabled', false).text('Submit Task');
            }
        });



        // Global function to toggle manual resubmission
        window.enableResubmission = () => {
            // Simply render the form for the current task
            if (window.currentTask) {
                window.renderSubmitForm(window.currentTask.id);
            }
        };

        // --- PROFILE AVATAR CROP & UPLOAD ---
        let cropper;
        const cropImage = document.getElementById('crop-image');
        const cropModal = new bootstrap.Modal(document.getElementById('cropModal'));

        $('#profile-upload').on('change', function () {
            const file = this.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                cropImage.src = e.target.result;
                cropModal.show();
            };
            reader.readAsDataURL(file);
            this.value = ''; // Reset input
        });

        // Initialize Cropper when modal opens
        document.getElementById('cropModal').addEventListener('shown.bs.modal', () => {
            if (cropper) cropper.destroy();
            cropper = new Cropper(cropImage, {
                aspectRatio: 1,
                viewMode: 1,
                dragMode: 'move',
                autoCropArea: 1,
                background: false
            });
        });

        // Handle Crop & Upload
        $('#crop-confirm-btn').on('click', async function () {
            if (!cropper) return;

            const btn = $(this);
            const originalText = btn.html();
            btn.prop('disabled', true).html('<i class="w-3 h-3 animate-spin mr-1" data-lucide="loader-2"></i> Processing...');
            lucide.createIcons();

            cropper.getCroppedCanvas({
                width: 300,
                height: 300,
                imageSmoothingQuality: 'high'
            }).toBlob(async (blob) => {
                if (!blob) return;

                const CLOUD_NAME = "dlm3iaqjn";
                const UPLO_PRESET = "lms_assignments";
                const formData = new FormData();
                formData.append('file', blob, 'avatar.png');
                formData.append('upload_preset', UPLO_PRESET);

                try {
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);

                    const avatarUrl = data.secure_url;

                    // Update DB
                    const { error } = await client.from('profiles').update({ avatar_url: avatarUrl }).eq('uid', currentUser.id);
                    if (error) throw error;

                    // Update State
                    userProfile.avatar_url = avatarUrl;
                    localStorage.setItem('supabase_profile_cache', JSON.stringify(userProfile));

                    // Update UI
                    $('#header-avatar-container').html(`<img src="${avatarUrl}" class="w-full h-full object-cover">`);
                    $('#profile-avatar-display').html(`<img src="${avatarUrl}" class="w-full h-full object-cover">`);

                    showToast("Profile updated successfully!");
                    cropModal.hide();
                } catch (err) {
                    console.error(err);
                    alert("Upload failed: " + err.message);
                } finally {
                    btn.prop('disabled', false).html(originalText);
                }
            }, 'image/png');
        });

        $('#profile-form').on('submit', async (e) => {
            e.preventDefault();
            const name = $('#profile-name').val();
            const nPass = $('#profile-new-pass').val();
            const cPass = $('#profile-confirm-pass').val();
            const btn = $('#profile-form button');
            btn.prop('disabled', true).text('COMMITTING UPDATES...');

            try {
                if (nPass && nPass !== cPass) throw new Error("Passwords do not match.");

                // Update Profile Table
                const { error: pErr } = await client.from('profiles').update({ name }).eq('uid', currentUser.id);
                if (pErr) throw pErr;

                // Update Auth User
                if (nPass) {
                    const { error: aErr } = await client.auth.updateUser({ password: nPass });
                    if (aErr) throw aErr;
                }

                userProfile.name = name;
                initDashboard(); // Refresh UI headers
                showToast("Profile updated successfully.");
                $('#profile-new-pass, #profile-confirm-pass').val('');
            } catch (err) { alert(err.message); } finally { btn.prop('disabled', false).text('Save Changes'); }
        });



        $('#create-task-form').on('submit', async (e) => {
            e.preventDefault();
            const btn = $('#task-submit-btn');
            const isEditing = !!editingTaskId;
            btn.prop('disabled', true).text('PROCESSING...');

            const dateVal = $('#new-task-date').val();
            let safeDeadline = null;
            if (dateVal) {
                // dateVal is "YYYY-MM-DDTHH:MM" (Local)
                // new Date(dateVal) creates a Date object representing that local time
                // toISOString() converts it to UTC, which is what we want for Supabase
                const d = new Date(dateVal);
                if (!isNaN(d.getTime())) safeDeadline = d.toISOString();
            }

            const taskData = {
                title: $('#new-task-title').val(),
                description: $('#new-task-desc').val(),
                hints: $('#new-task-hints').val(),
                deadline: safeDeadline
            };

            const refFile = document.getElementById('new-task-ref').files[0];

            const executeSave = async (data) => {
                try {
                    console.log("Saving Task:", isEditing ? "UPDATE" : "CREATE", data);
                    if (isEditing) {
                        const { data: updatedData, error } = await client.from('tasks')
                            .update(data)
                            .eq('id', editingTaskId)
                            .select();

                        if (error) throw error;

                        // Strict Verification

                        if (!updatedData || updatedData.length === 0) {
                            throw new Error("Update failed! No rows modified. Check Admin permissions.");
                        }

                        const savedDate = new Date(data.deadline);
                        showToast(`Saved! Local: ${savedDate.toLocaleTimeString()} (Server: ${savedDate.getUTCHours()}:${savedDate.getUTCMinutes() < 10 ? '0' : ''}${savedDate.getUTCMinutes()})`);

                        if (currentTask && currentTask.id === editingTaskId) {
                            currentTask = { ...currentTask, ...data };
                        }
                    } else {
                        const { error } = await client.from('tasks').insert([data]);
                        if (error) throw error;
                        showToast("New task created.");
                    }
                    bootstrap.Modal.getOrCreateInstance(document.getElementById('createTaskModal')).hide();
                    fetchData(); // Refresh list
                    editingTaskId = null; // Clear edit mode
                } catch (err) {
                    console.error("Save Error:", err);
                    alert("System Error: " + err.message);
                } finally {
                    btn.prop('disabled', false).text(isEditing ? 'Update Task' : 'Create Task');
                }
            };

            if (refFile) {
                try {
                    const CLOUD_NAME = "dlm3iaqjn";
                    const UPLO_PRESET = "lms_assignments";
                    const formData = new FormData();
                    formData.append('file', refFile);
                    formData.append('upload_preset', UPLO_PRESET);

                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    const uploadData = await response.json();
                    if (uploadData.error) throw new Error(uploadData.error.message);

                    // WORKAROUND: If editing, try to replace existing reference link if it exists in description
                    // otherwise append.
                    const refHtml = `<br><strong>Reference Asset:</strong> <a href="${uploadData.secure_url}" target="_blank" class="text-indigo-500 hover:underline">View Attachment</a>`;

                    if (taskData.description.includes('Reference Asset:</strong>')) {
                        // Regex to replace the existing link block?
                        // Simple approach: Split and keep top part, add new link
                        // This assumes the link is at the end.
                        const splitMarker = '<br><strong>Reference Asset:</strong>';
                        const parts = taskData.description.split(splitMarker);
                        taskData.description = parts[0] + refHtml;
                    } else {
                        taskData.description = (taskData.description || '') + "\n\n" + refHtml;
                    }

                    await executeSave(taskData);
                } catch (err) {
                    alert("Reference File Error: " + err.message);
                    btn.prop('disabled', false).text(isEditing ? 'Update Task' : 'Create Task');
                }
            } else {
                await executeSave(taskData);
            }
        });

        // AJAX Admin Actions
        window.approveUser = async (uid) => {
            const { data: { session } } = await client.auth.getSession();
            $.ajax({
                url: `${SUPABASE_URL}/rest/v1/profiles?uid=eq.${uid}`,
                type: 'PATCH',
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${session.access_token}`, 'Content-Type': 'application/json' },
                data: JSON.stringify({ status: 'approved' }),
                success: () => fetchUsers()
            });
        };

        window.deleteUser = async (uid) => {
            if (!confirm("Are you sure you want to PERMANENTLY delete this student?")) return;
            if (!client) { showToast("Offline: Cannot delete."); return; }

            try {
                // 1. Attempt RPC call to delete Auth User + Profile
                // (Requires 'delete_user_via_admin' function in Supabase)
                const { error: rpcError } = await client.rpc('delete_user_via_admin', { target_uid: uid });

                if (!rpcError) {
                    showToast("User and Login permanently deleted.");
                } else {
                    // 2. Fallback: Delete Profile Only (Client Side)
                    console.warn("RPC missing, performing soft delete:", rpcError.message);

                    const { error: dbError } = await client.from('profiles').delete().eq('uid', uid);
                    if (dbError) throw dbError;

                    if (rpcError.code === 'PGRST202' || rpcError.message.includes('function not found')) {
                        alert("Profile deleted from Dashboard.\n\nIMPORTANT: To allow this email to register again, you MUST run the 'delete_user_script.sql' in your Supabase SQL Editor.");
                    } else {
                        showToast("Student profile deleted.");
                    }
                }
                fetchUsers();
            } catch (err) {
                console.error("Delete failed:", err);
                showToast("Error deleting user: " + err.message);
            }
        };

        window.approveAllUsers = async () => {
            if (!client) { showToast("Offline: Cannot approve users."); return; }
            const { data: { session } } = await client.auth.getSession();
            // Check if there are any pending users (using cache from fetchUsers)
            const pendingCount = (window.allUsersCache || []).filter(u => u.status === 'pending').length;

            if (pendingCount === 0) {
                showToast("No pending students to approve.");
                return;
            }

            if (!confirm(`Are you sure you want to approve all ${pendingCount} pending students?`)) return;

            const toastId = 'approve-toast-' + Date.now();
            const toast = $(`<div id="${toastId}" class="fixed bottom-10 right-10 bg-indigo-900 text-white px-8 py-4 rounded-2xl shadow-2xl z-[5000] font-black uppercase text-[10px] tracking-widest animate-in slide-in-from-bottom-5 border border-white/10 flex items-center gap-3"><i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Approving ${pendingCount} students...</div>`);
            $('body').append(toast);
            window.safeCreateIcons();

            try {
                // Update all pending users to approved
                const { error } = await client.from('profiles')
                    .update({ status: 'approved' })
                    .eq('status', 'pending');

                if (error) throw error;

                $(`#${toastId}`).remove();
                showToast(`Success! ${pendingCount} students approved.`);
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                fetchUsers();
            } catch (err) {
                console.error(err);
                $(`#${toastId}`).remove();
                showToast("Error: " + err.message);
            }
        };

        window.submitGrade = async (sid) => {
            const g = $(`#grade-${sid}`).val();
            const f = $(`#feedback-${sid}`).val();

            if (!g) {
                showToast("Please enter a grade (0-100).");
                return;
            }

            if (!client) {
                showToast("Offline: Cannot submit grade.");
                return;
            }

            try {
                // 1. Get the submission details first to identify Student & Task
                const { data: currentSub, error: fetchError } = await client
                    .from('submissions')
                    .select('student_id, task_id')
                    .eq('id', sid)
                    .single();

                if (fetchError) throw new Error("Could not find submission details.");

                // 2. Submit the Grade for THIS submission
                const { error: updateError } = await client
                    .from('submissions')
                    .update({
                        grade: parseInt(g),
                        feedback: f,
                        status: 'graded'
                    })
                    .eq('id', sid);

                if (updateError) throw updateError;

                // 3. NUCLEAR CLEANUP: Delete ALL other submissions for this task & student
                const { error: deleteError } = await client
                    .from('submissions')
                    .delete()
                    .eq('student_id', currentSub.student_id)
                    .eq('task_id', currentSub.task_id)
                    .neq('id', sid);

                if (deleteError) console.warn("Cleanup warning:", deleteError);

                // 4. INSTANT LOCAL UPDATE
                // We manually prune the pending/duplicate items from the local cache immediately.
                if (window.allSubmissions) {
                    window.allSubmissions = window.allSubmissions.filter(s => {
                        // Keep if ID matches current (graded)
                        if (String(s.id) === String(sid)) {
                            s.status = 'graded';
                            s.grade = parseInt(g);
                            s.feedback = f;
                            return true;
                        }
                        // Discard if same user+task but different ID
                        if (s.student_id === currentSub.student_id && String(s.task_id) === String(currentSub.task_id)) {
                            return false;
                        }
                        // Keep everything else
                        return true;
                    });
                    // Refresh view immediately with clean data
                    window.renderGrading(window.allSubmissions);
                }

                showToast("Grade saved. Previous versions discarded.");
                fetchData(); // Background sync

            } catch (err) {
                console.error("Grading Error:", err);
                showToast("Error: " + err.message);
            }
        };



        function initChart() {
            const canvas = document.getElementById('performanceChart');
            if (!canvas) return;

            // Fix: Destroy existing chart instance to prevent "Canvas already in use" error
            if (performanceChart) {
                performanceChart.destroy();
                performanceChart = null;
            }

            const ctx = canvas.getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Pending', 'To Do'],
                    datasets: [{
                        data: [0, 0, 1],
                        backgroundColor: ['#10b981', '#f59e0b', '#e2e8f0'],
                        borderWeight: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: { legend: { display: false } },
                    animation: { animateScale: true, animateRotate: true }
                }
            });
        }

        function updateChart() {
            if (!currentUser) return;

            // Ensure chart exists
            if (!performanceChart) initChart();

            if (userProfile.role === 'admin') {
                // --- ADMIN VIEW ---
                // Visualize: Global Graded vs Global Pending (DEDUPLICATED)
                const uniqueSubsMap = new Map();
                (window.allSubmissions || []).forEach(s => {
                    const key = `${s.student_id}_${s.task_id}`;
                    const existing = uniqueSubsMap.get(key);
                    // Keep the NEWER one
                    if (!existing || new Date(s.submitted_at) > new Date(existing.submitted_at)) {
                        uniqueSubsMap.set(key, s);
                    }
                });

                const uniqueSubs = Array.from(uniqueSubsMap.values());
                const graded = uniqueSubs.filter(s => s.status === 'graded').length;
                const pending = uniqueSubs.filter(s => s.status === 'submitted').length;

                if (performanceChart) {
                    performanceChart.data.labels = ['Graded', 'Pending Review', ''];
                    performanceChart.data.datasets[0].data = [graded, pending, 0];
                    // Green for Graded, Amber for Pending, Gray hidden
                    performanceChart.data.datasets[0].backgroundColor = ['#10b981', '#f59e0b', 'transparent'];
                    performanceChart.update();
                }
            } else {
                // --- STUDENT VIEW ---
                const totalTasks = window.allTasks.length || 1;
                const mySubs = window.allSubmissions.filter(s => s.student_id === currentUser.id);

                const completed = mySubs.filter(s => s.status === 'graded').length;
                const submitted = mySubs.filter(s => s.status === 'submitted').length;
                const remaining = window.allTasks.filter(t => !mySubs.some(s => s.task_id === t.id) && (!t.deadline || new Date().getTime() <= new Date(t.deadline).getTime())).length;

                if (performanceChart) {
                    performanceChart.data.labels = ['Completed', 'Pending Review', 'To Do'];
                    performanceChart.data.datasets[0].data = [completed, submitted, remaining > 0 ? remaining : 0];
                    performanceChart.data.datasets[0].backgroundColor = ['#10b981', '#f59e0b', '#e2e8f0'];
                    performanceChart.update();
                }
            }
        }




        window.downloadAllReports = () => { showToast("Initiating batch export..."); /* Implement batch if needed */ };
        $('#user-search').on('input', () => { renderSkeleton('user-table-body', 8, 'list'); fetchUsers(); });

        // --- STUDENT PROGRESS ENCOURAGEMENT SYSTEM ---
        window.checkAndShowEncouragement = async () => {
            // Only for students, not admins
            if (!currentUser || !userProfile || userProfile.role !== 'student') return;

            // Check if already shown today
            const today = new Date().toDateString();
            const lastShown = localStorage.getItem('encouragement_shown_date');
            if (lastShown === today) return; // Already shown today

            // Calculate student progress
            const submissions = (window.allSubmissions || []).filter(s => s.student_id === currentUser.id);
            const gradedSubmissions = submissions.filter(s => s.status === 'graded');
            const totalTasks = window.allTasks ? window.allTasks.length : 0;
            const completionRate = totalTasks > 0 ? (gradedSubmissions.length / totalTasks) * 100 : 0;

            // Calculate average grade
            const avgGrade = gradedSubmissions.length > 0
                ? (gradedSubmissions.reduce((sum, s) => sum + (s.grade || 0), 0) / gradedSubmissions.length)
                : 0;

            // Store progress for dashboard display
            window.studentProgress = {
                completionRate: Math.round(completionRate),
                avgGrade: Math.round(avgGrade * 10) / 10,
                submissionsCount: gradedSubmissions.length,
                totalTasks: totalTasks
            };

            // Determine encouragement level and message
            let message = '';
            let icon = '🎉';
            let level = 'good';

            // Determine encouragement based on metrics
            if (avgGrade >= 85 && completionRate >= 80) {
                message = `🌟 Excellent Progress! You're crushing it! Average Grade: ${avgGrade.toFixed(1)}% | Completed: ${gradedSubmissions.length}/${totalTasks}`;
                level = 'excellent';
            } else if (avgGrade >= 75 && completionRate >= 60) {
                message = `🚀 Great Work! You're doing amazing! Keep it up! Average Grade: ${avgGrade.toFixed(1)}% | ${gradedSubmissions.length} tasks completed`;
                level = 'great';
            } else if (avgGrade >= 60 || completionRate >= 40) {
                message = `💪 Good Progress! You're on the right track. Keep pushing! ${Math.round(completionRate)}% tasks completed`;
                level = 'good';
            } else if (gradedSubmissions.length > 0) {
                message = `📚 Get Started! Complete more tasks to see your progress grow!`;
                level = 'start';
            } else {
                return; // No progress yet, no encouragement needed
            }

            // Mark as shown today
            localStorage.setItem('encouragement_shown_date', today);

            // Show encouragement notification
            setTimeout(() => {
                showEncouragementNotification(message, level);
            }, 1000);
        };

        window.showEncouragementNotification = (message, level = 'good') => {
            // Create notification element
            const notifId = 'encouragement-' + Date.now();
            const bgColor = level === 'excellent' ? 'bg-gradient-to-r from-amber-400 to-orange-400' :
                level === 'great' ? 'bg-gradient-to-r from-green-400 to-emerald-400' :
                    level === 'start' ? 'bg-gradient-to-r from-blue-400 to-cyan-400' :
                        'bg-gradient-to-r from-indigo-400 to-purple-400';

            const textColor = level === 'excellent' || level === 'great' ? 'text-white' : 'text-white';

            // Notification container
            let container = $('#encouragement-container');
            if (container.length === 0) {
                container = $('<div id="encouragement-container" class="fixed top-6 right-6 z-[8000] space-y-3"></div>');
                $('body').append(container);
            }

            const $notif = $(`
                <div id="${notifId}" class="${bgColor} ${textColor} rounded-lg shadow-xl px-6 py-4 animate-in slide-in-from-right-5 fade-in duration-300 flex items-center gap-3 max-w-md">
                    <div class="flex-1 font-semibold text-sm md:text-base">${message}</div>
                    <button onclick="$('#${notifId}').fadeOut(300, function() { $(this).remove(); })" class="text-white hover:opacity-80">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            `);

            container.append($notif);

            // Auto-remove after 6 seconds
            setTimeout(() => {
                $notif.fadeOut(300, function () { $(this).remove(); });
            }, 6000);
        };

        // --- ADVANCED FEATURES: LEARNING LIBRARY ---
        window.learningResources = []; // Removed dummy data

        window.openCreateResourceModal = () => {
            new bootstrap.Modal(document.getElementById('createResourceModal')).show();
            lucide.createIcons();
        };

        window.fetchResources = async () => {
            try {
                // Ensure table exists or handle error gracefully
                const { data, error } = await client.from('resources').select('*').order('created_at', { ascending: false });

                if (error) {
                    console.error("Resource fetch error:", error);
                    showToast("Error loading resources: " + error.message); // Optional: for debugging
                    window.learningResources = [];
                } else {
                    window.learningResources = data || [];
                    // showToast(`Loaded ${window.learningResources.length} resources`); // Debug
                }

                if (window.renderResources) renderResources();
            } catch (err) {
                console.error("Resource fetch fatal error:", err);
                showToast("Fatal Error loading resources: " + err.message);
                window.learningResources = [];
                if (window.renderResources) renderResources();
            }
        };

        $('#resource-upload-form').on('submit', async (e) => {
            e.preventDefault();
            const btn = $('#upload-res-btn');
            btn.prop('disabled', true).text('UPLOADING...');

            const title = $('#res-title').val();
            const subtitle = $('#res-desc').val();
            const category = $('#res-category').val();
            const file = document.getElementById('res-file').files[0];
            const link = $('#res-link').val();

            try {
                let resourceUrl = link;

                // Upload to Cloudinary if file present
                if (file) {
                    const CLOUD_NAME = "dlm3iaqjn";
                    const UPLO_PRESET = "lms_assignments";
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', UPLO_PRESET);

                    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await res.json();
                    if (data.error) throw new Error(data.error.message);
                    resourceUrl = data.secure_url;
                }

                if (!resourceUrl) throw new Error("Please provide a file or a link.");

                const iconMap = { 'video': 'video', 'doc': 'file-text', 'link': 'link' };
                const colorMap = { 'video': 'rose', 'doc': 'indigo', 'link': 'emerald' };

                let finalIcon = iconMap[category] || 'file';
                let finalColor = colorMap[category] || 'slate';

                // Auto-detect PDF
                if ((file && file.name.toLowerCase().endsWith('.pdf')) || (resourceUrl && resourceUrl.toLowerCase().endsWith('.pdf'))) {
                    finalIcon = 'file-text';
                    finalColor = 'rose';
                }

                const { error } = await client.from('resources').insert([{
                    title,
                    subtitle,
                    category,
                    link: resourceUrl,
                    icon: finalIcon,
                    color: finalColor,
                    created_by: currentUser.id
                }]);

                if (error) throw error;

                showToast("Resource uploaded successfully!");
                bootstrap.Modal.getInstance(document.getElementById('createResourceModal')).hide();
                $('#resource-upload-form')[0].reset();
                fetchResources();

            } catch (err) {
                alert("Upload Error: " + err.message);
            } finally {
                btn.prop('disabled', false).text('Upload Resource');
            }
        });

        window.renderResources = (filter = 'all') => {
            const grid = $('#resource-grid').empty();
            const search = $('#resource-search').val().toLowerCase();

            const filtered = window.learningResources.filter(r => {
                const matchesCat = filter === 'all' || r.category === filter;
                const matchesSearch = r.title.toLowerCase().includes(search) || (r.subtitle && r.subtitle.toLowerCase().includes(search));
                return matchesCat && matchesSearch;
            });

            if (!filtered.length) {
                grid.html(`
                        <div class="col-span-full py-16 text-center animate-in fade-in zoom-in duration-500">
                            <div class="w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="rocket" class="w-10 h-10 text-slate-400"></i>
                            </div>
                            <h3 class="text-xl font-black uppercase tracking-tighter text-slate-900 dark:text-slate-200 mb-2">Coming Soon</h3>
                            <p class="text-xs font-bold uppercase tracking-widest text-slate-400 max-w-xs mx-auto">
                                The learning library is currently being curated. Check back later for premium materials.
                            </p>
                        </div>
                    `);
                lucide.createIcons();
                return;
            }

            filtered.forEach(r => {
                let iconDisplay = `<i data-lucide="${r.icon}" class="w-5 h-5"></i>`;

                // Dynamic PDF Fix for display
                if (r.link && r.link.toLowerCase().endsWith('.pdf')) {
                    r.color = 'rose';
                    iconDisplay = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-pdf" viewBox="0 0 16 16">
  <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
  <path d="M4.603 12.087a.8.8 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.7 7.7 0 0 1 1.482-.645 20 20 0 0 0 1.062-2.227 7.3 7.3 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a11 11 0 0 0 .98 1.686 5.8 5.8 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.86.86 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.7 5.7 0 0 1-.911-.95 11.6 11.6 0 0 0-1.997.406 11.3 11.3 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.8.8 0 0 1-.58.029m1.379-1.901q-.25.115-.459.238c-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361q.016.032.026.044l.035-.012c.137-.056.355-.235.635-.572a8 8 0 0 0 .45-.606m1.64-1.33a13 13 0 0 1 1.01-.193 12 12 0 0 1-.51-.858 21 21 0 0 1-.5 1.05zm2.446.45q.226.244.435.41c.24.19.407.253.498.256a.1.1 0 0 0 .07-.015.3.3 0 0 0 .094-.125.44.44 0 0 0 .059-.2.1.1 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a4 4 0 0 0-.612-.053zM8.078 5.8a7 7 0 0 0 .2-.828q.046-.282.038-.465a.6.6 0 0 0-.032-.198.5.5 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822q.036.167.09.346z"/>
</svg>`;
                }

                grid.append(`
                    <div class="v-card p-5 group hover:scale-[1.02] transition-transform cursor-pointer">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-${r.color}-50 dark:bg-${r.color}-900/20 text-${r.color}-600 dark:text-${r.color}-400 rounded-xl flex items-center justify-center shadow-sm">
                                ${iconDisplay}
                            </div>
                            <span class="text-[9px] font-black uppercase tracking-widest px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 text-slate-500">${r.category}</span>
                        </div>
                        <h4 class="font-extrabold text-slate-900 dark:text-slate-200 text-sm mb-1 line-clamp-1">${r.title}</h4>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-4">${r.subtitle || ''}</p>
                        
                        <a href="${r.link}" target="_blank" class="w-full flex items-center justify-center gap-2 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 text-[10px] font-black uppercase tracking-wider text-slate-600 dark:text-slate-300 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                            Access Material <i data-lucide="arrow-right" class="w-3 h-3"></i>
                        </a>
                    </div>
                `);
            });
            lucide.createIcons();
        };



        window.currentResourceFilter = 'all';

        window.filterResources = (cat) => {
            // Radio UI handles visual state automatically
            window.currentResourceFilter = cat;
            renderResources(cat);
        };

        $('#resource-search').on('input', () => renderResources(window.currentResourceFilter));

        // --- NOTIFICATION SYSTEM ---
        // --- NOTIFICATION SYSTEM (FIXED) ---
        window.toggleNotifications = (e) => {
            if (e) e.stopPropagation(); // Prevent immediate close
            const dropdown = $('#notification-dropdown');

            if (dropdown.hasClass('hidden')) {
                dropdown.removeClass('hidden');
                renderNotifications();

                // One-time click handler to close when clicking outside
                $(document).off('click.notif').on('click.notif', function (ev) {
                    if (!$(ev.target).closest('#admin-notif-btn, #notification-dropdown').length) {
                        dropdown.addClass('hidden');
                        $(document).off('click.notif');
                    }
                });
            } else {
                dropdown.addClass('hidden');
                $(document).off('click.notif');
            }
        };

        window.renderNotifications = () => {
            const list = $('#notification-list').empty();

            // CHECK CLEARED STATE
            // User wants previously "Marked Read" items to stay hidden even after refresh
            if (localStorage.getItem('notifications_cleared') === 'true') {
                list.html(`
                        <div class="h-32 flex flex-col items-center justify-center text-slate-400">
                             <div class="w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center mb-2">
                                <i data-lucide="bell-off" class="w-4 h-4 opacity-50"></i>
                             </div>
                             <p class="text-[9px] font-black uppercase tracking-widest opacity-50">No new notifications</p>
                        </div>
                    `);
                lucide.createIcons();
                return;
            }

            // Filter pending submissions
            // DEDUPLICATION: Only count latest submission per task
            const uniquePendingMap = new Map();
            (window.allSubmissions || []).forEach(s => {
                const key = `${s.student_id}_${s.task_id}`;
                const existing = uniquePendingMap.get(key);
                // Keep the NEWER one
                if (!existing || new Date(s.submitted_at) > new Date(existing.submitted_at)) {
                    uniquePendingMap.set(key, s);
                }
            });

            // Only keeping those whose LATEST status is 'submitted' (not graded)
            const pending = Array.from(uniquePendingMap.values())
                .filter(s => s.status === 'submitted');

            // Sort by date desc
            pending.sort((a, b) => new Date(b.submitted_at) - new Date(a.submitted_at));

            if (!pending.length) {
                list.html(`
                        <div class="h-32 flex flex-col items-center justify-center text-slate-400">
                             <div class="w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center mb-2">
                                <i data-lucide="bell-off" class="w-4 h-4 opacity-50"></i>
                             </div>
                             <p class="text-[9px] font-black uppercase tracking-widest opacity-50">No new notifications</p>
                        </div>
                    `);
                lucide.createIcons();
                return;
            }

            pending.forEach(s => {
                const timeAgo = (() => {
                    const mins = Math.floor((new Date() - new Date(s.submitted_at)) / 60000);
                    if (mins < 60) return `${mins}m ago`;
                    const hours = Math.floor(mins / 60);
                    if (hours < 24) return `${hours}h ago`;
                    return `${Math.floor(hours / 24)}d ago`;
                })();

                list.append(`
                        <div onclick="switchTab('grading'); window.toggleNotifications()" class="p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer group transition-colors border border-transparent hover:border-slate-100 dark:hover:border-slate-800">
                            <div class="flex items-start gap-3">
                                <div class="w-8 h-8 rounded-full bg-indigo-50 dark:bg-indigo-900/30 text-indigo-500 flex items-center justify-center shrink-0 border border-indigo-100 dark:border-indigo-900/50">
                                    <i data-lucide="file-text" class="w-4 h-4"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <h5 class="text-[10px] font-black uppercase text-slate-900 dark:text-slate-200 leading-none mb-1 truncate">${s.student_name}</h5>
                                    <p class="text-[9px] text-slate-500 font-medium leading-tight line-clamp-2">Submitted: <span class="text-indigo-500">${s.task_title}</span></p>
                                    <p class="text-[8px] text-slate-400 font-bold uppercase tracking-widest mt-1.5">${timeAgo}</p>
                                </div>
                                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-1.5"></div>
                            </div>
                        </div>
                    `);
            });
            lucide.createIcons();
        };

        window.markAllRead = () => {
            // User requested: "jitne mb hn woh empty hojayen"
            // Visual clear only since we don't have a read_status column yet
            $('#notification-list').empty().html('<div class="text-center py-4 text-[10px] text-slate-400 font-bold uppercase tracking-widest italic">All caught up!</div>');
            $('#notif-badge').addClass('hidden').removeClass('flex').text('');

            // Persist the cleared state so it doesn't come back on refresh
            localStorage.setItem('notifications_cleared', 'true');

            // Update Watermark to suppress current items
            const currentCount = window.lastPendingCountVal || 0;
            localStorage.setItem('notification_watermark', currentCount);

            // Close dropdown after short delay
            setTimeout(() => {
                $('#notification-dropdown').addClass('hidden');
            }, 500);

            showToast("Notifications cleared.");
        };

        // --- ARCADE GAME ENGINE ---
        window.activeGameTimer = null;

        window.startArcadeGame = (gameId) => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (window.activeGameTimer) clearInterval(window.activeGameTimer);

            $('#arcade-menu').addClass('hidden');
            $('#game-stage').removeClass('hidden');
            $('#back-to-menu-btn').removeClass('hidden');
            const container = $('#game-container').empty();

            if (gameId === 'html_master') {
                runHtmlMaster(container);
            } else if (gameId === 'css_speed') {
                runCssSpeed(container);
            } else if (gameId === 'drag_master') {
                runDragMaster(container);
            } else if (gameId === 'js_logic') {
                runJsLogic(container);
            } else if (gameId === 'syntax_balloons') {
                runSyntaxBalloons(container);
            }
        };

        window.showGameFeedback = (text, success, subtext = '') => {
            const theme = success ?
                { bg: 'bg-emerald-500', icon: 'check-circle', text: 'text-emerald-500', bgLight: 'bg-emerald-50 dark:bg-emerald-500/10' } :
                { bg: 'bg-rose-500', icon: 'x-circle', text: 'text-rose-500', bgLight: 'bg-rose-50 dark:bg-rose-500/10' };

            let container = $('#game-feedback-side');
            if (container.length === 0) {
                $('#game-container').append('<div id="game-feedback-side" class="absolute top-4 right-4 z-[100] pointer-events-none flex flex-col gap-3"></div>');
                container = $('#game-feedback-side');
            }

            // Clear previous feedback to keep it clean and professional
            container.empty();

            const id = 'feedback-' + Date.now();
            const $feedback = $(`
                <div id="${id}" class="v-card overflow-hidden w-72 animate-in slide-in-from-right duration-500 shadow-2xl bg-white dark:bg-[#1e293b] border-l-4 ${theme.bg}">
                    <div class="p-4 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full border-2 ${success ? 'border-emerald-500' : 'border-rose-500'} ${theme.bgLight} ${theme.text} flex items-center justify-center shrink-0 shadow-sm transform transition-transform duration-300">
                            <i data-lucide="${theme.icon}" class="w-6 h-6"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-black uppercase tracking-tighter text-sm ${success ? 'text-emerald-600' : 'text-rose-600'}">${text}</div>
                            ${subtext ? `
                                <div class="mt-1.5 pt-1.5 border-t border-slate-100 dark:border-slate-800">
                                    <div class="text-[8px] font-black text-slate-400 uppercase tracking-[0.1em] mb-0.5">Correct Answer:</div>
                                    <div class="text-[11px] font-mono font-bold text-indigo-500 break-all">${subtext.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `);

            container.append($feedback);
            lucide.createIcons();

            setTimeout(() => {
                $feedback.addClass('animate-out fade-out slide-out-to-right duration-500');
                setTimeout(() => $feedback.remove(), 500);
            }, 2000);
        };

        window.clearGameFeedback = () => {
            // No longer needed as they self-destruct, but kept for compatibility
        };

        window.exitArcadeGame = () => {
            if (window.activeGameTimer) clearInterval(window.activeGameTimer);
            $('#game-stage').addClass('hidden');
            $('#arcade-menu').removeClass('hidden');
            $('#back-to-menu-btn').addClass('hidden');
        };



        // --- PROFESSIONAL ARCADE GAME ENGINE ---

        // Mock AJAX Save Function
        async function saveGameScore(gameId, score, maxScore) {
            console.log(`[AJAX] Saving score for ${gameId}: ${score}/${maxScore}`);
            try {
                // Simulate AJAX delay
                await new Promise(r => setTimeout(r, 600));

                // Actual Supabase Insert (Commented to prevent DB errors if table missing)
                /*
                await client.from('game_scores').insert({
                    user_id: currentUser.id,
                    game: gameId,
                    score: score,
                    max_score: maxScore,
                    played_at: new Date()
                });
                */
                showToast("Score Saved via AJAX!");
            } catch (e) {
                console.error("Score save failed", e);
            }
        }

        // ADAPTIVE LEVEL MANAGER (Global)
        function getLevel(gameType) {
            const map = { 'html': 'html_master_level', 'css': 'css_master_level', 'drag': 'drag_master_level', 'js': 'js_logic_level' };
            return localStorage.getItem(map[gameType]) || 'easy';
        }

        async function saveLevel(gameType, score, total) {
            const percentage = (score / total) * 100;
            const current = getLevel(gameType);


            if (percentage >= 80) {
                let newLevel = current;
                if (current === 'easy') newLevel = 'moderate';
                else if (current === 'moderate') newLevel = 'hard';

                if (newLevel !== current) {
                    const map = { 'html': 'html_master_level', 'css': 'css_master_level', 'drag': 'drag_master_level', 'js': 'js_logic_level' };
                    localStorage.setItem(map[gameType], newLevel);
                }

                // ALWAYS DB Update to ensure record exists
                try {
                    const payload = { user_id: currentUser.id };
                    // We use newLevel (if upgraded) or current (if not)
                    // But we must be careful not to overwrite other fields with null 
                    // Upsert with only ONE field might wipe others if we don't select first?
                    // Supabase upsert merges if we don't specify otherwise, but let's be safe.
                    // Actually upsert on a specific ID updates columns provided.

                    if (gameType === 'html') payload.html_level = newLevel;
                    if (gameType === 'css') payload.css_level = newLevel;
                    if (gameType === 'drag') payload.drag_level = newLevel;
                    if (gameType === 'js') payload.js_level = newLevel;

                    await client.from('user_arcade_progress').upsert(payload, { onConflict: 'user_id' });
                } catch (e) { console.error(e); }

                return newLevel !== current;
            } else {
                // Even if they failed, ensure the record exists as "Easy" (or current) 
                // so Admin sees they are active.
                try {
                    const payload = { user_id: currentUser.id };
                    if (gameType === 'html') payload.html_level = current;
                    if (gameType === 'css') payload.css_level = current;
                    if (gameType === 'drag') payload.drag_level = current;
                    if (gameType === 'js') payload.js_level = current; // Fix missing JS map

                    await client.from('user_arcade_progress').upsert(payload, { onConflict: 'user_id' });
                } catch (e) { console.error(e); }
            }
            return false;
        }

        async function syncArcadeProgress() {
            try {
                const { data } = await client.from('user_arcade_progress').select('*').eq('user_id', currentUser.id).maybeSingle();
                if (data) {
                    if (data.html_level) localStorage.setItem('html_master_level', data.html_level);
                    if (data.css_level) localStorage.setItem('css_master_level', data.css_level);
                    if (data.drag_level) localStorage.setItem('drag_master_level', data.drag_level);
                    if (data.js_level) localStorage.setItem('js_logic_level', data.js_level);
                    console.log("[Arcade] Synced Progress: ", data);
                }
            } catch (e) {
                console.warn("[Arcade] Progress sync failed.", e);
            }
        }

        // ADAPTIVE DIFFICULTY CONTENT BANKS
        const htmlQB = {
            easy: [
                { q: "Which tag makes text <b>bold</b>?", a: ["<b>", "<bold>", "<heavy>", "<em>"], r: ["<b>"] },
                { q: "What is the correct tag for a hyperlink?", a: ["<link>", "<a>", "<href>", "<url>"], r: ["<a>"] },
                { q: "Which is the largest heading tag?", a: ["<h6>", "<head>", "<h1>", "<header>"], r: ["<h1>"] },
                { q: "How do you insert an image?", a: ["<img>", "<pic>", "<src>", "<image>"], r: ["<img>"] },
                { q: "Which tag defines an unordered list?", a: ["<ul>", "<ol>", "<list>", "<li>"], r: ["<ul>"] },
                { q: "Line break tag?", a: ["<br>", "<break>", "<lb>", "<newline>"], r: ["<br>"] },
                { q: "Paragraph tag?", a: ["<p>", "<para>", "<text>", "<pg>"], r: ["<p>"] },
                { q: "Smallest heading tag?", a: ["<h1>", "<h6>", "<small>", "<head>"], r: ["<h6>"] },
                { q: "Horizontal rule tag?", a: ["<hr>", "<line>", "<br>", "<tr>"], r: ["<hr>"] },
                { q: "Which tag defines the document title?", a: ["<title>", "<meta>", "<name>", "<head>"], r: ["<title>"] },
                { q: "Correct tag for ordered list?", a: ["<ol>", "<ul>", "<list>", "<dl>"], r: ["<ol>"] },
                { q: "Tag to define a container?", a: ["<div>", "<span>", "<container>", "<block>"], r: ["<div>"] },
                { q: "Which tag is used for input fields?", a: ["<input>", "<text>", "<field>", "<enter>"], r: ["<input>"] },
                { q: "Tag for main content area?", a: ["<main>", "<body>", "<content>", "<root>"], r: ["<main>"] }
            ],
            moderate: [
                { q: "Choose the correct HTML5 element for the main content?", a: ["<article>", "<main>", "<content>", "<body>"], r: ["<main>"] },
                { q: "How do you define an internal style sheet?", a: ["<style>", "<css>", "<script>", "<design>"], r: ["<style>"] },
                { q: "Which attribute is used to specify a unique ID?", a: ["class", "id", "name", "tag"], r: ["id"] },
                { q: "Correct input type for email?", a: ["type='text'", "type='email'", "type='mail'", "format='email'"], r: ["type='email'"] },
                { q: "Which tag is used to define a table row?", a: ["<th>", "<td>", "<tr>", "<table>"], r: ["<tr>"] },
                { q: "Tag for navigation links?", a: ["<nav>", "<links>", "<menu>", "<ul>"], r: ["<nav>"] },
                { q: "Tag for a dropdown list?", a: ["<select>", "<list>", "<dropdown>", "<option>"], r: ["<select>"] },
                { q: "Attribute for external CSS URL?", a: ["href", "src", "link", "rel"], r: ["href"] },
                { q: "Alternative text for image?", a: ["title", "alt", "desc", "src"], r: ["alt"] },
                { q: "Which tag defines a table header?", a: ["<thead>", "<th>", "<head>", "<header>"], r: ["<th>"] },
                { q: "HTML5 tag for sidebar content?", a: ["<aside>", "<sidebar>", "<section>", "<nav>"], r: ["<aside>"] },
                { q: "Attribute to open link in new tab?", a: ["target='_blank'", "new='tab'", "target='new'", "open='window'"], r: ["target='_blank'"] },
                { q: "Which tag defines a form?", a: ["<form>", "<input>", "<submit>", "<field>"], r: ["<form>"] },
                { q: "Valid attribute for <script> src?", a: ["src", "href", "link", "url"], r: ["src"] }
            ],
            hard: [
                { q: "Which input type defines a slider control?", a: ["slider", "range", "controls", "search"], r: ["range"] },
                { q: "Which HTML5 tag is used to specify a footer?", a: ["<footer>", "<bottom>", "<section>", "<end>"], r: ["<footer>"] },
                { q: "What is the correct tag for playing video files?", a: ["<movie>", "<media>", "<video>", "<play>"], r: ["<video>"] },
                { q: "Which attribute specifies that an input field must be filled out?", a: ["validate", "required", "placeholder", "mandatory"], r: ["required"] },
                { q: "Which element describes the structure of a document?", a: ["<meta>", "<head>", "<body>", "<html>"], r: ["<html>"] },
                { q: "Which element is used to draw graphics?", a: ["<svg>", "<canvas>", "<paint>", "<graphic>"], r: ["<canvas>"] },
                { q: "Pattern attribute is used for?", a: ["Validation", "Styling", "Images", "Links"], r: ["Validation"] },
                { q: "Which tag defines an embedded object?", a: ["<embed>", "<object>", "<iframe>", "<all>"], r: ["<embed>", "<object>"] },
                { q: "Tag for result of calculation?", a: ["<output>", "<result>", "<calc>", "<sum>"], r: ["<output>"] },
                { q: "Which meta tag is used for viewport?", a: ["viewport", "responsive", "scale", "dim"], r: ["viewport"] },
                { q: "Tag for independent self-contained content?", a: ["<article>", "<section>", "<div class='post'>", "<aside>"], r: ["<article>"] },
                { q: "Which input attribute specifies a regex?", a: ["pattern", "regex", "validate", "match"], r: ["pattern"] },
                { q: "Tag for grouping options in a select?", a: ["<optgroup>", "<group>", "<category>", "<list>"], r: ["<optgroup>"] },
                { q: "Which tag defines a caption for a <figure>?", a: ["<figcaption>", "<caption>", "<label>", "<title>"], r: ["<figcaption>"] }
            ]
        };

        const cssQB = {
            easy: [
                { task: "Make text red", correct: "color: red;", wrong: ["background: red;", "font-size: red;", "text-color: red;", "font-style: red"], desc: "Change text color" },
                { task: "Center text", correct: "text-align: center;", wrong: ["align: center;", "font-align: center;", "center: true;", "align-self: center;"], desc: "Center alignment" },
                { task: "Bold font", correct: "font-weight: bold;", wrong: ["font-style: bold;", "text-decoration: bold;", "font: bold;", "weight: bold;"], desc: "Thicker text" },
                { task: "Italic text", correct: "font-style: italic;", wrong: ["font-weight: italic;", "text-style: italic;", "italic: true;", "style: italic"], desc: "Slanted text" },
                { task: "Underline text", correct: "text-decoration: underline;", wrong: ["font-style: underline;", "text-style: underline;", "decoration: underline;", "line: bottom;"], desc: "Line below text" },
                { task: "Blue Background", correct: "background-color: blue;", wrong: ["color: blue;", "bg: blue;", "back: blue;", "area: blue;"], desc: "Change background" },
                { task: "Set font size", correct: "font-size: 16px;", wrong: ["text-size: 16px;", "size: 16px;", "font: 16px;", "height: 16px;"], desc: "Text size" },
                { task: "Add border", correct: "border: 1px solid;", wrong: ["outline: 1px;", "stroke: 1px;", "line: 1px;", "box: 1px;"], desc: "Box outline" },
                { task: "Upper case", correct: "text-transform: uppercase;", wrong: ["text-style: uppercase;", "transform: upper;", "font: uppercase;", "caps: true;"], desc: "All caps" },
                { task: "Remove bullet points", correct: "list-style: none;", wrong: ["list: none;", "ul: none;", "bullet: none;", "marker: none;"], desc: "No list markers" },
                { task: "Set width", correct: "width: 100px;", wrong: ["broad: 100px;", "size: 100px;", "inline: 100px;", "w: 100px;"], desc: "Element width" },
                { task: "Set height", correct: "height: 50vh;", wrong: ["tall: 50vh;", "h: 50vh;", "size: 50vh;", "vertical: 50vh;"], desc: "Element height" },
                { task: "Make input required", correct: "required", wrong: ["validate", "mandatory", "need", "check"], desc: "HTML Attribute" }
            ],
            moderate: [
                { task: "Remove underline", correct: "text-decoration: none;", wrong: ["font-style: none;", "text-align: none;", "decoration: none;", "no-underline: true;"], desc: "No decoration" },
                { task: "Add padding", correct: "padding: 10px;", wrong: ["margin: 10px;", "spacing: 10px;", "inner: 10px;", "gap: 10px;"], desc: "Inner spacing" },
                { task: "Circle shape", correct: "border-radius: 50%;", wrong: ["border: circle;", "shape: circle;", "radius: circle;", "round: true;"], desc: "Round corners" },
                { task: "Flex container", correct: "display: flex;", wrong: ["position: flex;", "float: flex;", "layout: flex;", "view: flex;"], desc: "Flexible layout" },
                { task: "Z-Index", correct: "z-index: 10;", wrong: ["index: 10;", "layer: 10;", "level: 10;", "stack: 10;"], desc: "Stack order" },
                { task: "Overflow Hidden", correct: "overflow: hidden;", wrong: ["scroll: hidden;", "clip: hidden;", "view: hidden;", "hide: true;"], desc: "Hide content" },
                { task: "Opacity", correct: "opacity: 0.5;", wrong: ["transparent: 0.5;", "alpha: 0.5;", "visible: 0.5;", "color: 0.5;"], desc: "Transparency" },
                { task: "Box Shadow", correct: "box-shadow: 5px 5px;", wrong: ["shadow: 5px;", "drop-shadow: 5px;", "border-shadow: 5px;", "shade: 5px;"], desc: "Drop shadow" },
                { task: "Gap in Grid", correct: "gap: 1rem;", wrong: ["space: 1rem;", "margin: 1rem;", "gutter: 1rem;", "padding: 1rem;"], desc: "Spacing between items" },
                { task: "Max Width", correct: "max-width: 100%;", wrong: ["width: max;", "limit: 100%;", "bound: 100%;", "clip: 100%;"], desc: "Responsive limit" },
                { task: "Cursor Pointer", correct: "cursor: pointer;", wrong: ["mouse: hand;", "pointer: click;", "click: yes;", "hand: true;"], desc: "Change mouse icon" },
                { task: "Sticky Position", correct: "position: sticky;", wrong: ["display: sticky;", "float: sticky;", "place: sticky;", "attach: sticky;"], desc: "Sticks on scroll" }
            ],
            hard: [
                { task: "Grid layout", correct: "display: grid;", wrong: ["layout: grid;", "position: grid;", "grid: true;", "view: grid;"], desc: "Grid system" },
                { task: "Absolute positioning", correct: "position: absolute;", wrong: ["display: absolute;", "location: absolute;", "place: absolute;", "fixed: absolute;"], desc: "Exact placement" },
                { task: "Hide element", correct: "display: none;", wrong: ["visibility: gone;", "opacity: 0;", "hide: input;", "remove: true;"], desc: "Remove from flow" },
                { task: "Pointer cursor", correct: "cursor: pointer;", wrong: ["mouse: pointer;", "pointer: hand;", "click: true;", "hand: true;"], desc: "Clickable icon" },
                { task: "Transition", correct: "transition: all 0.3s;", wrong: ["animate: 0.3s;", "move: 0.3s;", "change: 0.3s;", "morph: 0.3s;"], desc: "Smooth change" },
                { task: "Keyframes", correct: "@keyframes move {}", wrong: ["@animate move {}", "@motion move {}", "@frame move {}"], desc: "Animation definition" },
                { task: "Media Query", correct: "@media (max-width: 600px)", wrong: ["@screen (width: 600px)", "@view (max: 600px)", "@responsive 600px"], desc: "Responsive rule" },
                { task: "Filter Blur", correct: "filter: blur(5px);", wrong: ["effect: blur(5px);", "style: blur(5px);", "mask: blur(5px);", "fog: 5px;"], desc: "Blur effect" },
                { task: "Flex Center", correct: "justify-content: center;", wrong: ["align: center;", "flex: center;", "place: center;", "content: center;"], desc: "Horizontal center" },
                { task: "Variable Definition", correct: "--main-color: red;", wrong: ["$main-color: red;", "var-main: red;", "@main: red;", "def-color: red;"], desc: "CSS Variable" },
                { task: "Grid Columns", correct: "grid-template-columns: 1fr 1fr;", wrong: ["grid-cols: 2;", "columns: 2;", "layout: 50% 50%;", "division: 1fr;"], desc: "Two equal cols" },
                { task: "Transform Rotate", correct: "transform: rotate(45deg);", wrong: ["rotate: 45deg;", "spin: 45deg;", "turn: 45deg;", "move: rotate(45);"], desc: "Rotate element" },
                { task: "Calculate width", correct: "width: calc(100% - 20px);", wrong: ["width: 100% - 20px;", "calc: 100% - 20px;", "math: 100% - 20px;", "size: calc(100, 20);"], desc: "Dynamic calc" },
                { task: "Style Invalid Input", correct: "border-color: red;", wrong: ["validate: false;", "input: error;", "check: false;", "status: invalid;"], desc: "Error feedback" },
                { task: "Style Valid Input", correct: "border-color: green;", wrong: ["validate: true;", "input: correct;", "check: valid;", "status: valid;"], desc: "Success feedback" },
                { task: "Make input required", correct: "required", wrong: ["validate", "mandatory", "need", "check"], desc: "HTML Attribute" }
            ]
        };

        const dragQB = {
            easy: [
                { code: "&lt;img&gt;", desc: "Embeds an image" },
                { code: "&lt;h1&gt;", desc: "Largest Heading" },
                { code: "&lt;p&gt;", desc: "Paragraph" },
                { code: "&lt;a&gt;", desc: "Hyperlink" },
                { code: "&lt;ul&gt;", desc: "Bulleted List" },
                { code: "&lt;br&gt;", desc: "Line Break" },
                { code: "&lt;div&gt;", desc: "Container" },
                { code: "&lt;span&gt;", desc: "Inline Container" },
                { code: "&lt;button&gt;", desc: "Clickable Button" },
                { code: "&lt;input&gt;", desc: "Input Field" },
                { code: "&lt;table&gt;", desc: "Data Table" },
                { code: "&lt;form&gt;", desc: "User Input & Submit" },
                { code: "&lt;nav&gt;", desc: "Navigation Links" },
                { code: "&lt;footer&gt;", desc: "Bottom Section" }
            ],
            moderate: [
                { code: "color:red;", desc: "Red Text" },
                { code: "margin:0;", desc: "Remove Spacing" },
                { code: ".class", desc: "Class Selector" },
                { code: "#id", desc: "ID Selector" },
                { code: "display:flex;", desc: "Flexbox Layout" },
                { code: "border:1px;", desc: "Standard Border" },
                { code: "padding:10px;", desc: "Inner Spacing" },
                { code: "width:100%;", desc: "Full Width" },
                { code: "text-align:center;", desc: "Center Text" },
                { code: "font-weight:bold;", desc: "Bold Text" },
                { code: "float:left;", desc: "Align Left" },
                { code: "opacity:0;", desc: "Invisible" },
                { code: "cursor:pointer;", desc: "Hand Cursor" },
                { code: "display:none;", desc: "Hide Element" }
            ],
            hard: [
                { code: "z-index:10;", desc: "Stacking Order" },
                { code: "opacity:0.5;", desc: "Semi-transparent" },
                { code: "@media", desc: "Responsive Rule" },
                { code: "transform", desc: "Move/Scale Element" },
                { code: "grid-gap", desc: "Grid Spacing" },
                { code: ":hover", desc: "Mouse Over State" },
                { code: "position:absolute;", desc: "Absolute Pos" },
                { code: "justify-content:center;", desc: "Flex Center" },
                { code: "align-items:center;", desc: "Flex Align" },
                { code: "flex-direction:column;", desc: "Vertical Layout" },
                { code: "box-shadow", desc: "Drop Shadow" },
                { code: "transition", desc: "Smooth Change" },
                { code: "keyframes", desc: "Animation Steps" },
                { code: "filter:blur", desc: "Blur Effect" }
            ]
        };

        const jsQB = {
            easy: [
                { q: "typeof 'Hello'", a: ["string", "text", "str", "object"], r: "string" },
                { q: "2 + '2' = ?", a: ["'22'", "4", "NaN", "Error"], r: "'22'" },
                { q: "Boolean(0)", a: ["false", "true", "null", "undefined"], r: "false" },
                { q: "Which symbol is for comments?", a: ["//", "#", "<!--", "**"], r: "//" },
                { q: "Which declares a constant?", a: ["const", "let", "var", "fixed"], r: "const" },
                { q: "Output of: console.log(5 == '5')", a: ["true", "false", "error", "undefined"], r: "true" },
                { q: "What is NaN?", a: ["Not a Number", "Null", "New Array", "No Action"], r: "Not a Number" },
                { q: "Correct array syntax?", a: ["[]", "{}", "()", "<>"], r: "[]" },
                { q: "Operator for increment?", a: ["++", "+=", "+", "add"], r: "++" },
                { q: "Method to convert to string?", a: ["toString()", "string()", "text()", "toText()"], r: "toString()" }
            ],
            moderate: [
                { q: "[1, 2, 3].length", a: ["3", "2", "4", "undefined"], r: "3" },
                { q: "Which method adds to array end?", a: ["push()", "pop()", "shift()", "add()"], r: "push()" },
                { q: "Output: !true", a: ["false", "true", "undefined", "null"], r: "false" },
                { q: "Correct way to write a function?", a: ["function myFunc() {}", "func myFunc() {}", "def myFunc() {}", "function:myFunc()"], r: "function myFunc() {}" },
                { q: "5 === '5'", a: ["false", "true", "error", "null"], r: "false" },
                { q: "Logical AND operator", a: ["&&", "||", "&", "and"], r: "&&" },
                { q: "Result of 10 % 3?", a: ["1", "3", "0", "10"], r: "1" },
                { q: "Method to remove last array item?", a: ["pop()", "push()", "delete()", "remove()"], r: "pop()" },
                { q: "Which is a valid object?", a: ["{x:1}", "[x:1]", "(x:1)", "<x:1>"], r: "{x:1}" },
                { q: "Keyword for current object?", a: ["this", "self", "me", "obj"], r: "this" }
            ],
            hard: [
                { q: "typeof null", a: ["object", "null", "undefined", "number"], r: "object" },
                { q: "Output: 0.1 + 0.2 === 0.3", a: ["false", "true", "undefined", "NaN"], r: "false" },
                { q: "Which is NOT a loop?", a: ["foreach", "for", "while", "do...while"], r: "foreach" },
                { q: "[...'Hello']", a: ["['H','e','l','l','o']", "'Hello'", "Error", "undefined"], r: "['H','e','l','l','o']" },
                { q: "JSON.parse('{\"a\":1}')", a: ["{a: 1}", "Error", "'{\"a\":1}'", "undefined"], r: "{a: 1}" },
                { q: "What is a Promise?", a: ["Async Operation", "Sync Operation", "Loop", "Array"], r: "Async Operation" },
                { q: "What does 'use strict' do?", a: ["Enforces strict mode", "Fixes bugs", "Runs faster", "Includes library"], r: "Enforces strict mode" },
                { q: "Output: [] == ![]", a: ["true", "false", "error", "undefined"], r: "true" },
                { q: "Event loop manages?", a: ["Async callbacks", "Memory", "Variables", "DOM"], r: "Async callbacks" },
                { q: "Closure involves?", a: ["A function within a function", "Closing window", "Ending loop", "DOM events"], r: "A function within a function" }
            ]
        };

        function runDragMaster(container) {
            const level = getLevel('drag');
            const pool = dragQB[level] || dragQB['easy'];
            // Pick 4 random pairs
            const selected = pool.sort(() => 0.5 - Math.random()).slice(0, 4);

            // Separate Shuffled Arrays
            const draggables = [...selected].sort(() => 0.5 - Math.random());
            const dropzones = [...selected].sort(() => 0.5 - Math.random()); // Actually we keep dropzones sorted or random? Random is harder. Let's keep desc random too.

            let score = 0;

            container.html(`
                <div class="max-w-4xl mx-auto relative">
                     <!-- Floating Feedback Msg -->
                     <div id="drag-msg" class="absolute inset-0 z-50 flex items-center justify-center pointer-events-none hidden"></div>

                    <div class="text-center mb-8">
                         <span class="text-xs font-black text-purple-500 uppercase tracking-widest mb-2 block">Level: ${level.toUpperCase()}</span>
                        <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 mb-2">Code Drag Master</h2>
                        <p class="text-slate-400">Match the code snippets to their definitions.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-12">
                        <!-- Draggables -->
                        <div class="space-y-4">
                            <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Code Blocks</h3>
                            ${draggables.map((item, i) => `
                                <div id="drag-${i}" class="p-4 bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-xl shadow-sm cursor-grab active:cursor-grabbing hover:border-purple-500 transition-all font-mono font-bold text-center text-slate-700 dark:text-slate-200" draggable="true" ondragstart="drag(event)" data-match="${item.code}">
                                    ${item.code}
                                </div>
                            `).join('')}
                        </div>

                        <!-- Drop Zones -->
                        <div class="space-y-4">
                            <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Definitions</h3>
                            ${dropzones.map((item, i) => {
                const colors = ['border-blue-500/30 bg-blue-50/10', 'border-purple-500/30 bg-purple-50/10', 'border-rose-500/30 bg-rose-50/10', 'border-amber-500/30 bg-amber-50/10'];
                return `
                                <div id="drop-${i}" class="p-4 border-2 border-dashed ${colors[i % colors.length]} rounded-xl flex items-center justify-center text-slate-500 dark:text-slate-400 text-sm font-bold min-h-[72px] transition-all relative group" ondrop="drop(event)" ondragover="allowDrop(event)" data-match="${item.code}">
                                    <div class="absolute top-2 left-2 text-[8px] opacity-30 font-black uppercase">Slot 0${i + 1}</div>
                                    <span class="relative z-10 px-4 text-center">${item.desc}</span>
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                </div>
            `);

            showToast(`Adaptivity Active: Difficulty set to ${level.toUpperCase()}`);

            // Drag Functions Global scope (attached to window for HTML attributes)
            window.allowDrop = (ev) => {
                ev.preventDefault();
            };

            window.drag = (ev) => {
                ev.dataTransfer.setData("text", ev.target.id);
                ev.dataTransfer.setData("match", ev.target.getAttribute('data-match'));
            };

            window.drop = (ev) => {
                ev.preventDefault();
                const data = ev.dataTransfer.getData("text");
                const matchCode = ev.dataTransfer.getData("match");
                const dropZone = ev.target.closest('[ondrop]'); // Ensure we hit the zone

                if (!dropZone) return;

                // If zone already has content, ignore
                if (dropZone.classList.contains('bg-emerald-50')) return;

                const targetMatch = dropZone.getAttribute('data-match');
                const draggedEl = document.getElementById(data);

                if (matchCode === targetMatch) {
                    // MATCH!
                    score++;

                    // Style Update
                    dropZone.innerHTML = ``;
                    dropZone.appendChild(draggedEl);
                    $(dropZone).removeClass('border-dashed border-slate-300 text-slate-400').addClass('border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 shadow-inner');
                    $(draggedEl).removeClass('bg-white border-slate-200 cursor-grab').addClass('bg-transparent border-0 cursor-default text-emerald-700 w-full text-lg shadow-none').attr('draggable', 'false');

                    showGameFeedback("Correct!", true);
                    confetti({ particleCount: 20, spread: 50, origin: { y: 0.6 } });

                    if (score === selected.length) {
                        // Background Save
                        saveLevel('drag', score, selected.length).then(leveledUp => {
                            if (window.awardBadge) window.awardBadge('arcade_win');

                            // Delay slightly for feedback to be seen, then show Finalize screen
                            setTimeout(() => {
                                container.html(`
                                    <div class="text-center animate-in zoom-in max-w-md mx-auto bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl">
                                        ${leveledUp ? `<div class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl text-yellow-600 font-black uppercase animate-pulse">?? LEVEL UP TO ${getLevel('drag').toUpperCase()}!</div>` : ''}
                                        <div class="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="check" class="w-10 h-10"></i></div>
                                        <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase">All Matched!</h2>
                                        <div class="flex gap-3 justify-center mt-8">
                                            <button onclick="startArcadeGame('drag_master')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                                <i data-lucide="play" class="w-4 h-4"></i> Play Next
                                            </button>
                                            <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">
                                                Back to Menu
                                            </button>
                                        </div>
                                    </div>
                                `);
                                lucide.createIcons();
                                saveGameScore('drag_master', score, selected.length);
                            }, 1200);
                        }).catch(e => {
                            console.warn("Save failed but continuing...", e);
                            // Fallback if saveLevel throws for some reason
                            setTimeout(() => {
                                container.html(`<div class="text-center">Error in mission completion. Please retry.</div>`);
                            }, 1000);
                        });
                    }
                } else {
                    // WRONG
                    showGameFeedback("Incorrect!", false, targetMatch);
                    $(dropZone).addClass('bg-rose-50 border-rose-500').delay(500).queue(function (next) {
                        $(this).removeClass('bg-rose-50 border-rose-500');
                        next();
                    });
                }
            };

            // No more showDragFeedback locally
        }

        function runHtmlMaster(container) {
            let score = 0;
            // Global timer used
            const timeLeftInit = 15;

            // 1. Determine Difficulty
            const currentLevel = getLevel('html');
            let pool = htmlQB[currentLevel];

            // 2. Randomize & Pick Questions
            const questions = pool.sort(() => 0.5 - Math.random()).slice(0, 6);

            // Visual Level Indicator
            showToast(`Adaptivity Active: ${currentLevel.toUpperCase()}`);

            let qIdx = 0;

            function renderQ() {
                clearInterval(window.activeGameTimer);

                if (qIdx >= questions.length) {
                    // --- GAME OVER SCREEN ---
                    const accuracy = Math.round((score / questions.length) * 100);

                    // SAVE PROGRESSION
                    saveLevel('html', score, questions.length).then(leveledUp => {
                        const nextLevelMsg = leveledUp ? `<div class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl text-yellow-600 font-black uppercase animate-pulse">?? LEVEL UP TO ${getLevel('html').toUpperCase()}!</div>` : '';

                        container.html(`
                            <div class="max-w-md mx-auto bg-white dark:bg-slate-800 rounded-3xl p-8 shadow-2xl border border-slate-100 dark:border-slate-700 text-center animate-in zoom-in duration-300">
                                 ${nextLevelMsg}
                                <div class="w-24 h-24 mx-auto bg-indigo-50 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mb-6">
                                    <i data-lucide="trophy" class="w-12 h-12 text-indigo-500"></i>
                                </div>
                                <h3 class="text-3xl font-black text-slate-900 dark:text-slate-200 mb-2 uppercase tracking-tighter">Mission Complete</h3>
                                <div class="flex justify-center gap-8 my-4">
                                    <div>
                                        <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Score</p>
                                        <p class="text-4xl font-black text-indigo-500">${score}</p>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Accuracy</p>
                                        <p class="text-4xl font-black text-emerald-500">${accuracy}%</p>
                                    </div>
                                </div>
                                
                                <div id="save-status" class="mb-6 text-xs font-bold text-slate-400 italic">Saving Result...</div>
                                
                                <div class="flex gap-3 justify-center">
                                    <button onclick="startArcadeGame('html_master')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4"></i> Next Level
                                    </button>
                                    <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white hover:bg-indigo-700 rounded-xl font-bold shadow-lg shadow-indigo-500/30 transition-all">Back to Menu</button>
                                </div>
                            </div>
                        `);
                        lucide.createIcons();
                        // Save Score to DB (Mock)
                        saveGameScore('html_master', score, questions.length);
                    });

                    return;
                }

                const curr = questions[qIdx];
                let timeLeft = timeLeftInit;

                // Render Question UI
                container.html(`
                    <div class="max-w-2xl mx-auto">
                        <!-- Header / Stats -->
                        <div class="flex justify-between items-center mb-8">
                            <div class="flex items-center gap-3">
                                <span class="px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg text-xs font-black uppercase tracking-wider">Q${qIdx + 1} / ${questions.length}</span>
                                <span class="text-slate-400 text-xs font-bold">Score: ${score}</span>
                            </div>
                            <div class="flex items-center gap-2 text-rose-500 font-mono font-black text-xl">
                                <i data-lucide="timer" class="w-5 h-5"></i> <span id="game-timer">${timeLeft}s</span>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full mb-8 overflow-hidden">
                            <div class="h-full bg-indigo-500 transition-all duration-1000 ease-linear" style="width: 100%" id="timer-bar"></div>
                        </div>

                        <!-- Question Card -->
                        <div class="mb-10 text-center">
                            <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 mb-6 leading-tight">${curr.q}</h2>
                        </div>

                        <!-- Options Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full">
                            ${curr.a.map((opt, i) => {
                    const themes = [
                        { color: 'text-indigo-500', bg: 'bg-indigo-50', border: 'hover:border-indigo-500', icon: 'zap' },
                        { color: 'text-cyan-500', bg: 'bg-cyan-50', border: 'hover:border-cyan-500', icon: 'code' },
                        { color: 'text-purple-500', bg: 'bg-purple-50', border: 'hover:border-purple-500', icon: 'terminal' },
                        { color: 'text-blue-500', bg: 'bg-blue-50', border: 'hover:border-blue-500', icon: 'layers' }
                    ];
                    const t = themes[i % themes.length];
                    return `
                                <button id="opt-${i}" class="group relative p-6 bg-white dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 rounded-2xl ${t.border} hover:shadow-xl transition-all duration-300 text-left flex items-start gap-4" onclick="checkProAns(this, '${opt.replace(/'/g, "\\'")}')">
                                    <div class="w-10 h-10 rounded-xl ${t.bg} dark:${t.bg}/10 ${t.color} flex items-center justify-center shrink-0 font-black text-sm group-hover:scale-110 transition-transform">
                                        <i data-lucide="${t.icon}" class="w-5 h-5"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <span class="block text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1">Option ${String.fromCharCode(65 + i)}</span>
                                        <span class="font-mono text-lg font-bold text-slate-700 dark:text-slate-200 block truncate">${opt.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>
                                    </div>
                                </button>
                            `}).join('')}
                        </div>
                    </div>
                `);

                lucide.createIcons();

                // Start Timer
                window.activeGameTimer = setInterval(() => {
                    timeLeft--;
                    $('#game-timer').text(timeLeft + 's');
                    $('#timer-bar').css('width', `${(timeLeft / timeLeftInit) * 100}%`);

                    if (timeLeft <= 0) {
                        clearInterval(window.activeGameTimer);
                        handleTimeout();
                    }
                }, 1000);

                window.checkProAns = (btn, ans) => {
                    clearInterval(window.activeGameTimer);
                    const isCorrect = curr.r.includes(ans);
                    const $btn = $(btn);

                    // Disable all buttons
                    $('button[id^="opt-"]').prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                    $btn.removeClass('opacity-50 cursor-not-allowed'); // Keep selected opacity full

                    if (isCorrect) {
                        score++;
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-indigo-500').addClass('bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500 ring-4 ring-emerald-500/20');
                        $btn.find('span:first-child').addClass('bg-emerald-100 text-emerald-600');
                        // Confetti for correct answer
                        confetti({ particleCount: 30, spread: 40, origin: { y: 0.6 } });
                        showGameFeedback("CORRECT!", true);
                    } else {
                        // Mark Wrong
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-indigo-500').addClass('bg-rose-50 dark:bg-rose-900/20 border-rose-500 ring-4 ring-rose-500/20');
                        $btn.find('span:first-child').addClass('bg-rose-100 text-rose-600');
                        showGameFeedback("WRONG!", false, curr.r.join(', '));

                        // Highlight Correct One
                        curr.a.forEach((opt, i) => {
                            if (curr.r.includes(opt)) {
                                $(`#opt-${i}`).removeClass('opacity-50').addClass('border-emerald-500 border-dashed');
                            }
                        });
                    }

                    setTimeout(() => {
                        qIdx++;
                        renderQ();
                    }, 1500); // Slower transition to allow reading feedback
                };

                function handleTimeout() {
                    $('button[id^="opt-"]').prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                    showGameFeedback("TIME'S UP!", false, curr.r.join(', '));

                    // Highlight Correct One
                    curr.a.forEach((opt, i) => {
                        if (curr.r.includes(opt)) {
                            $(`#opt-${i}`).removeClass('opacity-50').addClass('border-emerald-500 border-dashed');
                        }
                    });

                    setTimeout(() => {
                        qIdx++;
                        renderQ();
                    }, 2000);
                }

            }
            // Clear overlay on new render just in case
            clearGameFeedback();
            renderQ();
        }

        function runCssSpeed(container) {
            const level = getLevel('css');
            // Ensure pool exists
            const pool = cssQB[level] || cssQB['easy'];
            const questions = pool.sort(() => 0.5 - Math.random()).slice(0, 4);
            let score = 0;
            let qIdx = 0;

            showToast(`Adaptivity Active: Difficulty set to ${level.toUpperCase()}`);

            function render() {
                if (qIdx >= questions.length) {
                    saveLevel('css', score, questions.length).then(leveledUp => {
                        container.html(`
                            <div class="text-center animate-in zoom-in max-w-md mx-auto bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700">
                                ${leveledUp ? `<div class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl text-yellow-600 font-black uppercase animate-pulse">?? LEVEL UP TO ${getLevel('css').toUpperCase()}!</div>` : ''}
                                <div class="w-20 h-20 bg-cyan-100 text-cyan-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="award" class="w-10 h-10"></i></div>
                                <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase mb-4">CSS Stage Complete</h2>
                                <p class="text-slate-500 mb-8 font-bold">Score: ${score}/${questions.length}</p>
                                <div class="flex gap-3 justify-center">
                                    <button onclick="startArcadeGame('css_speed')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4"></i> Next Level
                                    </button>
                                    <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">Back to Menu</button>
                                </div>
                            </div>
                         `);
                        lucide.createIcons();
                        // Mock Save
                        saveGameScore('css_speed', score, questions.length);
                    });
                    return;
                }
                const curr = questions[qIdx];
                const options = [curr.correct, ...curr.wrong].sort(() => 0.5 - Math.random());

                container.html(`
                    <div class="max-w-4xl mx-auto text-center mt-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <span class="text-xs font-black text-cyan-500 uppercase tracking-widest mb-1 block">Task ${qIdx + 1} / ${questions.length}</span>
                        <h2 class="text-2xl font-black text-slate-900 dark:text-slate-200 mb-1 font-mono">${curr.task}</h2>
                        <p class="text-slate-400 text-[10px] font-bold mb-6">${curr.desc}</p>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            ${options.map((opt, i) => {
                    const themes = [
                        { color: 'text-rose-500', bg: 'bg-rose-50', icon: 'palette' },
                        { color: 'text-amber-500', bg: 'bg-amber-50', icon: 'layout' },
                        { color: 'text-emerald-500', bg: 'bg-emerald-50', icon: 'maximize' },
                        { color: 'text-indigo-500', bg: 'bg-indigo-50', icon: 'type' }
                    ];
                    const t = themes[i % themes.length];
                    return `<button id="css-opt-${i}" onclick="checkCss('${opt}', this)" class="p-4 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800 font-mono font-bold hover:border-cyan-500 hover:shadow-xl transition-all text-left flex items-center justify-between group text-xs gap-3">
                                    <div class="w-8 h-8 rounded-lg ${t.bg} dark:${t.bg}/10 ${t.color} flex items-center justify-center shrink-0">
                                        <i data-lucide="${t.icon}" class="w-4 h-4"></i>
                                    </div>
                                    <span class="flex-1 truncate">${opt}</span>
                                    <i data-lucide="chevron-right" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                </button>`
                }).join('')}
                        </div>
                    </div>
                `);
                lucide.createIcons();

                window.checkCss = (ans, btn) => {
                    const $btn = $(btn);
                    // Disable all buttons to prevent double clicks
                    $('button[id^="css-opt-"]').prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                    $btn.removeClass('opacity-50 cursor-not-allowed');

                    if (ans === curr.correct) {
                        score++;
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-cyan-500').addClass('bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500 ring-4 ring-emerald-500/20');
                        showGameFeedback("CORRECT!", true);
                    } else {
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-cyan-500').addClass('bg-rose-50 dark:bg-rose-900/20 border-rose-500 ring-4 ring-rose-500/20');
                        showGameFeedback("WRONG!", false, curr.correct);

                        // Highlight Correct One with high-impact visual
                        options.forEach((opt, i) => {
                            if (opt === curr.correct) {
                                $(`#css-opt-${i}`).removeClass('opacity-50 border-slate-100').addClass('border-emerald-500 border-dashed bg-emerald-50/10');
                            }
                        });
                    }
                    setTimeout(() => {
                        qIdx++;
                        render();
                    }, 1500); // 1.5s is the sweet spot for feedback
                }
            }
            render();
        }

        function runJsLogic(container) {
            const level = getLevel('js');
            const pool = jsQB[level] || jsQB['easy'];
            const questions = pool.sort(() => 0.5 - Math.random()).slice(0, 5);
            let score = 0;
            let qIdx = 0;

            showToast(`Adaptivity Active: Difficulty set to ${level.toUpperCase()}`);

            function render() {
                if (qIdx >= questions.length) {
                    saveLevel('js', score, questions.length).then(leveledUp => {
                        container.html(`
                            <div class="text-center animate-in zoom-in max-w-md mx-auto bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700">
                                ${leveledUp ? `<div class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl text-yellow-600 font-black uppercase animate-pulse">?? LEVEL UP TO ${getLevel('js').toUpperCase()}!</div>` : ''}
                                <div class="w-20 h-20 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="braces" class="w-10 h-10"></i></div>
                                <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase mb-4">JS Lab Complete</h2>
                                <p class="text-slate-500 mb-8 font-bold">Score: ${score}/${questions.length}</p>
                                <div class="flex gap-3 justify-center">
                                    <button onclick="startArcadeGame('js_logic')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4"></i> Next Round
                                    </button>
                                    <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">Back to Menu</button>
                                </div>
                            </div>
                         `);
                        lucide.createIcons();
                        saveGameScore('js_logic', score, questions.length);
                    });
                    return;
                }
                const curr = questions[qIdx];
                const options = curr.a.sort(() => 0.5 - Math.random());

                container.html(`
                    <div class="max-w-2xl mx-auto text-center mt-10 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <span class="text-xs font-black text-yellow-500 uppercase tracking-widest mb-4 block">Snippet ${qIdx + 1} / ${questions.length}</span>
                        <div class="bg-slate-900 text-slate-200 p-6 rounded-xl font-mono text-lg font-bold mb-8 shadow-inner text-left border-l-4 border-yellow-500">
                            ${curr.q}
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${options.map((opt, i) => `
                                <button id="js-opt-${i}" onclick="checkJs(this, '${opt.replace(/'/g, "\\'")}')" class="p-5 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800 font-mono font-bold hover:border-yellow-500 hover:shadow-xl transition-all text-sm group">
                                    <span class="block text-slate-500 dark:text-slate-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors break-words">${opt}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `);

                window.checkJs = (btn, ans) => {
                    const $btn = $(btn);
                    $('button[id^="js-opt-"]').prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                    $btn.removeClass('opacity-50 cursor-not-allowed');

                    if (ans === curr.r) {
                        score++;
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-yellow-500').addClass('bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500 text-emerald-600');
                        showGameFeedback("LOGIC VALID!", true);
                    } else {
                        $btn.removeClass('border-slate-100 dark:border-slate-700 hover:border-yellow-500').addClass('bg-rose-50 dark:bg-rose-900/20 border-rose-500 text-rose-600');
                        showGameFeedback("SYNTAX ERROR!", false, curr.r);
                    }

                    setTimeout(() => {
                        qIdx++;
                        render();
                    }, 1500);
                };
            }
            render();
        }
        // --- NAVIGATION & LAYOUT LOGIC ---
        function runSyntaxBalloons(container) {
            let score = 0;
            let lives = 3;
            window.gameActive = true;
            let spawnRate = 2500;
            let speed = 6000;
            let level = 1;

            // Audio Context for Pop Sound
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioCtx = new AudioContext();

            function playPopSound() {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();

                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.1);

                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            }

            // Phase Data
            const phases = [
                { id: 'html', name: 'Pop HTML Tags!', color: 'orange', valid: ['<div>', '<nav>', '<img>', '<p>', '<ul>', '<form>', '<input>', '<br>', '<hr>', '<span>', '<h1>', '<a>', '<body>', '<head>'] },
                { id: 'css', name: 'Pop CSS Properties!', color: 'cyan', valid: ['color', 'flex', 'grid', 'margin', 'padding', 'width', 'top', 'border', 'z-index', 'display', 'height', 'left', 'font', 'gap'] },
                { id: 'js', name: 'Pop JS Keywords!', color: 'yellow', valid: ['const', 'let', 'var', 'async', 'await', 'if', 'else', 'return', 'map', 'filter', 'class', 'new', 'this', 'try'] }
            ];

            let currentPhaseIdx = 0;
            let currentPhase = phases[0];

            // Inject Keyframes and Balloon Styles
            if ($('#balloon-style').length === 0) {
                $('head').append(`
                <style id="balloon-style">
                    @keyframes floatUp {
                        from { transform: translateY(100%); opacity: 0.8; }
                        to { transform: translateY(-120vh); opacity: 1; }
                    }
                    @keyframes sway {
                        0%, 100% { transform: rotate(-5deg) translateX(-5px); }
                        50% { transform: rotate(5deg) translateX(5px); }
                    }
                    @keyframes burst {
                        0% { transform: scale(1); opacity: 1; }
                        50% { transform: scale(1.5); opacity: 0.8; }
                        100% { transform: scale(2); opacity: 0; }
                    }
                    .balloon-wrapper {
                        position: absolute;
                        cursor: crosshair;
                        user-select: none;
                        will-change: transform;
                        display: flex;
                        flex-direction: column; 
                        align-items: center;
                        justify-content: center;
                        z-index: 20; 
                    }
                    .balloon-body {
                        width: 70px;
                        height: 85px;
                        border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
                        box-shadow: inset -5px -5px 15px rgba(0,0,0,0.1);
                        position: relative;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: transform 0.1s;
                        /* Sway animation will be added inline */
                    }
                    .balloon-body:active { transform: scale(0.95) !important; animation: none !important; }
                    
                    /* Reflection aka Shine */
                    .balloon-body::after {
                        content: '';
                        position: absolute;
                        top: 15%;
                        left: 15%;
                        width: 15px;
                        height: 25px;
                        border-radius: 50%;
                        background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.1));
                        transform: rotate(45deg);
                    }

                    /* The Knot */
                    .balloon-knot {
                        width: 0; 
                        height: 0; 
                        border-left: 6px solid transparent;
                        border-right: 6px solid transparent;
                        border-bottom: 8px solid; 
                        transform: translateY(-2px);
                    }

                    /* The String */
                    .balloon-string {
                        width: 1px;
                        height: 60px;
                        background: rgba(255,255,255,0.6);
                        transform-origin: top;
                    }
                </style>`);
            }

            container.html(`
                 <div class="relative w-full h-[60vh] min-h-[450px] bg-slate-900 rounded-3xl overflow-hidden shadow-2xl border-4 border-slate-800 cursor-crosshair">
                    <!-- HUD -->
                    <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-start z-20 pointer-events-none bg-gradient-to-b from-slate-900/90 to-transparent h-24">
                        <div>
                             <div class="text-[10px] font-black uppercase tracking-widest text-slate-400">Score</div>
                             <div class="text-xl md:text-3xl font-black text-white" id="sb-score">0</div>
                        </div>
                        
                        <!-- Current Objective Display -->
                        <div class="absolute top-4 left-1/2 transform -translate-x-1/2 text-center transition-all duration-300" id="sb-objective-box">
                             <div class="px-4 py-1.5 md:px-6 md:py-2 rounded-full border-2 border-${currentPhase.color}-500 bg-${currentPhase.color}-500/10 backdrop-blur-md shadow-[0_0_20px_rgba(0,0,0,0.3)]">
                                <span class="text-${currentPhase.color}-400 font-black uppercase tracking-widest text-[10px] md:text-xs block mb-0.5">Mission</span>
                                <span class="text-white font-black text-sm md:text-lg uppercase tracking-tight whitespace-nowrap" id="sb-objective-text">${currentPhase.name}</span>
                             </div>
                             <div class="h-1 bg-slate-800 rounded-full mt-2 w-full overflow-hidden">
                                <div id="sb-phase-bar" class="h-full bg-${currentPhase.color}-500 w-0 transition-all duration-[200ms]"></div>
                             </div>
                        </div>

                        <div class="flex gap-2" id="sb-lives">
                             <div class="w-8 h-8 rounded-full bg-rose-500 shadow-lg shadow-rose-500/50"></div>
                             <div class="w-8 h-8 rounded-full bg-rose-500 shadow-lg shadow-rose-500/50"></div>
                             <div class="w-8 h-8 rounded-full bg-rose-500 shadow-lg shadow-rose-500/50"></div>
                        </div>
                    </div>

                    <!-- Game Area -->
                    <div id="sb-field" class="absolute inset-0 z-10"></div>
                    
                    <!-- Start Overlay -->
                    <div id="sb-start" class="absolute inset-0 z-30 flex flex-col items-center justify-center bg-slate-900/95 text-white text-center">
                        <div class="w-16 h-16 md:w-24 md:h-24 bg-sky-500 rounded-full flex items-center justify-center mb-4 md:mb-6 shadow-2xl shadow-sky-500/20"><i data-lucide="aperture" class="w-8 h-8 md:w-12 md:h-12 text-white"></i></div>
                        <h2 class="text-3xl md:text-5xl font-black uppercase tracking-tighter mb-2">Syntax Balloons</h2>
                        <p class="text-slate-400 font-bold mb-6 md:mb-8 max-w-sm text-xs md:text-sm leading-relaxed px-4">Pop the balloons that match the <span class="text-sky-400">Current Mission</span>.<br>Avoid wrong code blocks!</p>
                        <button onclick="window.startBalloonHunt()" class="px-6 py-3 md:px-10 md:py-4 bg-white text-slate-900 rounded-2xl font-black uppercase tracking-[0.2em] hover:scale-105 transition-transform hover:shadow-2xl hover:shadow-white/20 text-xs md:text-base">Start Hunting</button>
                    </div>
                </div>
            `);
            lucide.createIcons();

            // Phase Management
            let phaseProgress = 0; // 0 to 100

            window.startBalloonHunt = () => {
                $('#sb-start').addClass('hidden');
                if (audioCtx.state === 'suspended') audioCtx.resume();
                window.gameActive = true;
                gameLoop();
            };

            const togglePhase = () => {
                currentPhaseIdx = (currentPhaseIdx + 1) % phases.length;
                currentPhase = phases[currentPhaseIdx];

                // Visual Update
                const box = $('#sb-objective-box');
                box.addClass('scale-90 opacity-50'); // pop out

                setTimeout(() => {
                    $('#sb-objective-text').text(currentPhase.name);
                    const html = `
                             <div class="px-4 py-1.5 md:px-6 md:py-2 rounded-full border-2 border-${currentPhase.color}-500 bg-${currentPhase.color}-500/10 backdrop-blur-md shadow-[0_0_20px_rgba(0,0,0,0.3)]">
                                <span class="text-${currentPhase.color}-400 font-black uppercase tracking-widest text-[10px] md:text-xs block mb-0.5">Mission</span>
                                <span class="text-white font-black text-sm md:text-lg uppercase tracking-tight whitespace-nowrap" id="sb-objective-text">${currentPhase.name}</span>
                             </div>
                             <div class="h-1 bg-slate-800 rounded-full mt-2 w-full overflow-hidden">
                                <div id="sb-phase-bar" class="h-full bg-${currentPhase.color}-500 w-0 transition-all duration-[200ms]"></div>
                             </div>`;
                    box.html(html).removeClass('scale-90 opacity-50'); // pop in
                    showToast(`Mission Update: ${currentPhase.name}`);
                }, 300);

                phaseProgress = 0;
            };

            const endGame = (reason) => {
                window.gameActive = false;
                $('#sb-field').empty();

                container.html(`
                    <div class="text-center animate-in zoom-in max-w-md mx-auto bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700">
                        <div class="w-20 h-20 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="skull" class="w-10 h-10"></i></div>
                        <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase mb-4">Study Session Over</h2>
                        <p class="text-slate-500 mb-2 font-bold uppercase tracking-widest text-xs">${reason}</p>
                        <p class="text-4xl font-black text-indigo-500 mb-8">${score}</p>
                        <div class="flex gap-3 justify-center">
                            <button onclick="startArcadeGame('syntax_balloons')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Retry
                            </button>
                            <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">Back to Menu</button>
                        </div>
                    </div>
                 `);
                lucide.createIcons();
                saveGameScore('syntax_balloons', score, 0);
            };

            const updateLives = () => {
                const liveContainer = $('#sb-lives').empty();
                for (let i = 0; i < 3; i++) {
                    if (i < lives) liveContainer.append(`<div class="w-8 h-8 rounded-full bg-rose-500 shadow-lg shadow-rose-500/50"></div>`);
                    else liveContainer.append(`<div class="w-8 h-8 rounded-full bg-slate-800 border-2 border-slate-700"></div>`);
                }
                if (lives <= 0) endGame("Too many syntax errors!");
            };

            const winGame = () => {
                window.gameActive = false;
                $('#sb-field').empty();

                container.html(`
                    <div class="text-center animate-in zoom-in max-w-md mx-auto bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700">
                        <div class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl text-yellow-600 font-black uppercase animate-pulse">?? ALL LEVELS CLEARED!</div>
                        <div class="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="trophy" class="w-10 h-10"></i></div>
                        <h2 class="text-3xl font-black text-slate-900 dark:text-slate-200 uppercase mb-4">Mission Complete</h2>
                        <p class="text-slate-500 mb-2 font-bold uppercase tracking-widest text-xs">You conquered the syntax skies!</p>
                        <p class="text-4xl font-black text-indigo-500 mb-8">${score}</p>
                        <div class="flex gap-3 justify-center">
                            <button onclick="startArcadeGame('syntax_balloons')" class="px-6 py-3 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 rounded-xl font-bold transition-colors flex items-center gap-2">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Play Again
                            </button>
                            <button onclick="exitArcadeGame()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase tracking-widest hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">Back to Menu</button>
                        </div>
                    </div>
                `);
                lucide.createIcons();
                saveGameScore('syntax_balloons', score, 0);
            };

            const spawnEntity = () => {
                if (!window.gameActive) return;

                // Random phase to pick word from
                const randomPhase = phases[Math.floor(Math.random() * phases.length)];
                const word = randomPhase.valid[Math.floor(Math.random() * randomPhase.valid.length)];

                // ESCAPE HTML FOR DISPLAY! (Critical fix for "empty" balloons)
                const displayWord = word.replace(/</g, "&lt;").replace(/>/g, "&gt;");

                // Determine if this is a Target (Correct) or Trap (Wrong)
                const isTarget = (randomPhase.id === currentPhase.id);

                // Styling
                let bgClass = '';
                let knotColor = '';
                if (randomPhase.id === 'html') { bgClass = 'from-orange-400 to-orange-500 text-white'; knotColor = 'border-bottom-color: #f97316'; }
                if (randomPhase.id === 'css') { bgClass = 'from-cyan-400 to-cyan-500 text-white'; knotColor = 'border-bottom-color: #06b6d4'; }
                if (randomPhase.id === 'js') { bgClass = 'from-yellow-400 to-yellow-500 text-slate-900'; knotColor = 'border-bottom-color: #eab308'; }

                // Random Sway Animation Duration
                const swayDur = 2 + Math.random() * 2; // 2s to 4s

                // Wrapper
                const wrapper = $(`<div class="balloon-wrapper"></div>`);

                // Balloon Item (Apply Sway Here)
                const balloon = $(`<div class="balloon-body bg-gradient-to-tr ${bgClass} z-10" style="animation: sway ${swayDur}s ease-in-out infinite alternate"><span class="font-mono font-black text-[11px] drop-shadow-md text-center leading-tight px-1">${displayWord}</span></div>`);

                // Parts
                const knot = $(`<div class="balloon-knot" style="${knotColor}"></div>`);
                const string = $(`<div class="balloon-string"></div>`);

                wrapper.append(balloon);
                wrapper.append(knot);
                wrapper.append(string);

                // Movement (Apply Float Here)
                const leftPos = Math.random() * 80 + 5;
                const dur = (Math.random() * 3000) + speed;

                wrapper.css({
                    left: leftPos + '%',
                    bottom: '-150px',
                    animation: `floatUp ${dur}ms linear forwards`
                });

                // Interaction on the WRAPPER (easier to click)
                wrapper.on('mousedown touchstart', function (e) {
                    if (e.type === 'touchstart') e.preventDefault();
                    e.stopPropagation();
                    if (!window.gameActive) return;

                    if (isTarget) {
                        // Correct!
                        playPopSound();
                        score += 10;
                        phaseProgress += 10;
                        $('#sb-score').text(score);
                        $('#sb-phase-bar').css('width', phaseProgress + '%');

                        // Feedback
                        showGameFeedback("Correct Syntax!", true);

                        // Vfx - Pop Effect
                        const pos = $(this).position();
                        const burst = $(this).clone();
                        burst.css({
                            position: 'absolute',
                            left: pos.left,
                            top: pos.top,
                            margin: 0,
                            'pointer-events': 'none',
                            animation: 'burst 0.2s ease-out forwards'
                        });
                        burst.find('.balloon-body').css('animation', 'none');

                        $('#sb-field').append(burst);
                        setTimeout(() => burst.remove(), 200);

                        $(this).remove();

                        // Check Phase Progress
                        if (phaseProgress >= 100) {
                            if (level >= 3) {
                                winGame();
                            } else {
                                togglePhase();
                                // Speed up slightly
                                speed = Math.max(3000, speed - 200);
                                showToast(`Speed Up! Round ${++level}`);
                            }
                        }
                    } else {
                        // Wrong Type!
                        playPopSound();

                        // Vfx - Pop Effect
                        const pos = $(this).position();
                        const burst = $(this).clone();
                        burst.css({
                            position: 'absolute',
                            left: pos.left,
                            top: pos.top,
                            margin: 0,
                            'pointer-events': 'none',
                            animation: 'burst 0.2s ease-out forwards'
                        });
                        burst.find('.balloon-body').css('animation', 'none');
                        $('#sb-field').append(burst);
                        setTimeout(() => burst.remove(), 200);

                        lives--;
                        updateLives();
                        showGameFeedback(`Wrong! That's ${randomPhase.id.toUpperCase()}`, false);
                        $(this).remove();
                    }
                });

                // Cleanup
                wrapper.on('animationend', function (e) {
                    // Only remove if it's the floatUp animation ending (meaning it went off screen)
                    if (e.originalEvent.animationName === 'floatUp' && this.isConnected) {
                        if (isTarget) {
                            lives--;
                            updateLives();
                            showGameFeedback("Missed one!", false);
                        }
                        $(this).remove();
                    }
                });

                $('#sb-field').append(wrapper);

                if (window.gameActive) setTimeout(spawnEntity, spawnRate);
            };

            function gameLoop() {
                spawnEntity();
            }
        } // END runSyntaxBalloons

        // --- LIVE CODE EDITOR ENGINE ---
        // Debounce Utility
        let debounceTimer;
        window.runCodeDebounced = () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                window.runCode();
            }, 800);
        };

        window.openLiveEditor = () => {
            switchTab('playground');

            // FORCE VISIBILITY: Direct CSS override
            $('#view-playground').removeClass('hidden').css('display', 'flex');

            // Initialize preview if empty
            const preview = $('#code-preview');
            if (preview.length && (preview.attr('srcdoc') === undefined || preview.attr('srcdoc') === '')) {
                runCode();
            }
        };

        window.runCode = () => {
            if (window.awardBadge) window.awardBadge('code_runner');
            const html = $('#code-html').val();
            const css = `<style>${$('#code-css').val()}</style>`;
            const js = `\n<script>\ntry {\n${$('#code-js').val()}\n} catch(err) { console.error(err); }\n<\/script>`;

            const preview = document.getElementById('code-preview');
            const previewDoc = preview.contentDocument || preview.contentWindow.document;

            previewDoc.open();
            previewDoc.write(html + css + js);
            previewDoc.close();
        };

        window.clearCode = () => {
            $('#code-html').val('');
            $('#code-css').val('');
            $('#code-js').val('');
            runCode(); // Clear preview too
        };

        window.toggleEditorPanel = (type) => {
            const panel = $(`#panel-${type}`);
            const btn = $(`#btn-toggle-${type}`);

            if (panel.hasClass('hidden')) {
                panel.removeClass('hidden');
                btn.removeClass('opacity-50 grayscale');
            } else {
                panel.addClass('hidden');
                btn.addClass('opacity-50 grayscale');
            }
        };



        // --- BADGE SYSTEM LOGIC ---
        window.renderBadges = async () => {
            const container = $('#badges-grid');
            container.empty();

            if (!userProfile || userProfile.role !== 'student') {
                container.html(`<div class="col-span-full text-center py-4 text-slate-400 text-xs italic">Badges are only for students.</div>`);
                return;
            }

            // Fetch latest arcade progress if not cached
            let arcade = window.allArcadeProgress ? window.allArcadeProgress.find(p => p.user_id === currentUser.id) : null;
            if (!arcade && client) {
                const { data } = await client.from('user_arcade_progress').select('*').eq('user_id', currentUser.id).maybeSingle();
                arcade = data;
            }

            // Fetch submission stats
            const mySubs = window.allSubmissions ? window.allSubmissions.filter(s => s.student_id === currentUser.id && s.status === 'graded') : [];
            const avgGrade = mySubs.length ? (mySubs.reduce((a, b) => a + b.grade, 0) / mySubs.length) : 0;

            const badges = [
                {
                    id: 'html_master',
                    title: 'HTML Master',
                    desc: 'Reach "Hard" level in HTML Arcade',
                    icon: 'code-2',
                    color: 'orange',
                    unlocked: arcade?.html_level === 'hard'
                },
                {
                    id: 'css_pro',
                    title: 'CSS Pro',
                    desc: 'Reach "Hard" level in CSS Arcade',
                    icon: 'palette',
                    color: 'cyan',
                    unlocked: arcade?.css_level === 'hard'
                },
                {
                    id: 'js_wizard',
                    title: 'JS Wizard',
                    desc: 'Reach "Hard" level in JS Arcade',
                    icon: 'zap',
                    color: 'yellow',
                    unlocked: arcade?.js_level === 'hard'
                },
                {
                    id: 'bug_hunter',
                    title: 'Bug Hunter',
                    desc: 'Score > 500 in Syntax Balloons',
                    icon: 'bug',
                    color: 'rose',
                    // Mock check: If they played Balloons enough to have a level > 1
                    unlocked: (arcade?.syntax_balloons_score > 500) || false
                },
                {
                    id: 'speed_coder',
                    title: 'Speed Coder',
                    desc: 'Complete 5 Speed Challenges',
                    icon: 'timer',
                    color: 'purple',
                    unlocked: (arcade?.css_level === 'moderate' || arcade?.css_level === 'hard') // Mock logic
                },
                {
                    id: 'task_master',
                    title: 'Task Master',
                    desc: 'Complete 10+ Assignments',
                    icon: 'clipboard-check',
                    color: 'emerald',
                    unlocked: mySubs.length >= 10
                },
                {
                    id: 'top_performer',
                    title: 'Top Performer',
                    desc: 'Maintain 90%+ Average Grade',
                    icon: 'star',
                    color: 'indigo',
                    unlocked: avgGrade >= 90 && mySubs.length >= 3
                },
                {
                    id: 'streak_7',
                    title: '7-Day Streak',
                    desc: 'Login for 7 consecutive days',
                    icon: 'flame',
                    color: 'amber',
                    unlocked: false // Placeholder for future logic
                }
            ];

            badges.forEach(b => {
                const opacity = b.unlocked ? 'opacity-100' : 'opacity-40 grayscale';
                const bg = b.unlocked ? `bg-${b.color}-50 dark:bg-${b.color}-900/20` : 'bg-slate-100 dark:bg-slate-800';
                const border = b.unlocked ? `border-${b.color}-200 dark:border-${b.color}-800/50` : 'border-slate-200 dark:border-slate-700';
                const text = b.unlocked ? `text-${b.color}-600 dark:text-${b.color}-400` : 'text-slate-400';
                const lockIcon = b.unlocked ? '' : `<div class="absolute top-2 right-2 text-slate-400"><i data-lucide="lock" class="w-3 h-3"></i></div>`;

                container.append(`
                    <div class="relative p-4 rounded-2xl border ${border} ${bg} ${opacity} transition-all flex flex-col items-center text-center group hover:scale-[1.02]">
                        ${lockIcon}
                        <div class="w-10 h-10 rounded-full bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 flex items-center justify-center mb-3 shadow-sm ${text}">
                            <i data-lucide="${b.icon}" class="w-5 h-5"></i>
                        </div>
                        <h5 class="font-black text-[10px] uppercase tracking-wider text-slate-900 dark:text-slate-200 mb-1">${b.title}</h5>
                        <p class="text-[8px] font-bold text-slate-400 leading-tight">${b.desc}</p>
                    </div>
                `);
            });
            lucide.createIcons();
        };








    </script>

    <!-- SECURITY MODAL (Nuclear Fix) -->
    <div class="modal fade" id="securityModal" tabindex="-1" aria-hidden="true" style="z-index: 10000;">
        <div class="modal-dialog modal-dialog-centered" style="z-index: 10001;">
            <div class="modal-content border-0 shadow-2xl p-0 bg-white" style="border-radius: 20px;">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <span
                                class="text-[9px] font-black bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-lg uppercase tracking-widest">Security
                                Admin</span>
                            <h3 class="text-xl font-black text-slate-900 mt-3 uppercase tracking-tighter leading-none">
                                Review Credentials</h3>
                        </div>
                        <div class="w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-slate-400">
                            <i data-lucide="shield-alert" class="w-6 h-6"></i>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                            <p class="text-[9px] font-bold text-indigo-800 uppercase tracking-widest mb-1">Target
                                Account</p>
                            <p class="text-sm font-black text-indigo-600 flex items-center gap-2"
                                id="reset-target-name">
                                <i data-lucide="user" class="w-3.5 h-3.5"></i> <span>Student Name</span>
                            </p>
                        </div>

                        <div>
                            <label
                                class="text-[9px] font-black uppercase text-slate-400 tracking-widest ml-1 mb-1.5 block">Set
                                Master Password</label>
                            <div class="relative group">
                                <input type="text" id="master-password-input"
                                    class="w-full pl-4 pr-12 py-3.5 bg-slate-50 border border-slate-100 rounded-xl text-sm font-bold text-slate-900 outline-none focus:ring-2 focus:ring-indigo-500 font-mono"
                                    placeholder="Enter new password...">
                                <button onclick="generateRandomPass()"
                                    class="absolute right-2 top-2 p-1.5 text-slate-400 hover:text-indigo-500 hover:bg-slate-200 rounded-lg transition-all">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <div class="flex gap-3 mt-6">
                            <button type="button"
                                class="flex-1 py-3.5 rounded-xl border border-slate-200 text-slate-500 font-bold text-[10px] uppercase tracking-widest hover:bg-slate-50 transition-all"
                                data-bs-dismiss="modal">Cancel</button>
                            <button onclick="confirmPasswordReset()" id="btn-save-pass"
                                class="flex-1 py-3.5 rounded-xl bg-indigo-600 text-white font-black text-[10px] uppercase tracking-widest shadow-lg shadow-indigo-500/20 flex items-center justify-center gap-2 hover:bg-indigo-700 transition-all">
                                <i data-lucide="save" class="w-4 h-4"></i> Update Credentials
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MANUAL SECURITY OVERLAY - FIXED VERSION -->
    <div id="manual-security-overlay"
        class="fixed inset-0 z-[99999] hidden items-center justify-center bg-slate-900/80 backdrop-blur-sm"
        style="display: none;">

        <div class="bg-white dark:bg-[#1e293b] rounded-3xl shadow-2xl w-full max-w-md mx-4 
                        overflow-hidden animate-in zoom-in-95 duration-200">

            <!-- Header -->
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <span class="text-[9px] font-black bg-indigo-50 dark:bg-indigo-900/30 
                                         text-indigo-600 dark:text-indigo-400 px-3 py-1.5 
                                         rounded-lg uppercase tracking-widest">Security Admin</span>
                        <h3 class="text-2xl font-black text-slate-900 dark:text-slate-200 mt-3 
                                       uppercase tracking-tighter leading-none">
                            Reset Credentials
                        </h3>
                    </div>
                </div>

                <!-- Content -->
                <div class="space-y-6">
                    <!-- Target Info -->
                    <div class="p-5 bg-indigo-50 dark:bg-indigo-900/20 rounded-2xl 
                                    border border-indigo-100 dark:border-indigo-900/50">
                        <p class="text-[9px] font-bold text-indigo-800 dark:text-indigo-200 
                                      uppercase tracking-widest mb-1">Target Account</p>
                        <p class="text-base font-black text-indigo-600 dark:text-indigo-400 
                                      flex items-center gap-2">
                            <i data-lucide="user" class="w-3.5 h-3.5"></i>
                            <span id="manual-reset-target">Student Name</span>
                        </p>
                    </div>

                    <!-- Password Input -->
                    <div>
                        <label class="text-[9px] font-black uppercase text-slate-400 
                                          dark:text-slate-500 tracking-widest ml-1 mb-1.5 block">
                            Set Master Password
                        </label>
                        <div class="relative group">
                            <input type="text" id="manual-password-input" class="w-full pl-4 pr-12 py-3.5 bg-slate-50 dark:bg-slate-900 
                                              border border-slate-100 dark:border-slate-800 rounded-xl 
                                              text-sm font-bold text-slate-900 dark:text-slate-100 
                                              outline-none focus:ring-2 focus:ring-indigo-500 
                                              font-mono transition-all" placeholder="Enter new password..."
                                minlength="6">
                            <button type="button" onclick="window.generateRandomPass()" class="absolute right-2 top-2 p-1.5 text-slate-400 
                                               hover:text-indigo-500 hover:bg-slate-200 dark:hover:bg-slate-700
                                               rounded-lg transition-all" title="Generate Random Password">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="flex gap-3 p-5 border-t border-slate-100 dark:border-slate-800">
                <button type="button" onclick="window.closeSecurityOverlay()" class="flex-1 py-4 rounded-xl border-2 border-slate-100 dark:border-slate-800
                                   text-slate-500 font-bold text-[11px] uppercase tracking-widest 
                                   hover:bg-slate-50 hover:text-slate-700 dark:hover:bg-slate-800
                                   transition-all">
                    Cancel Operation
                </button>
                <button type="button" id="btn-save-pass" onclick="window.confirmPasswordReset()" class="flex-1 py-4 rounded-xl bg-indigo-600 text-white font-black 
                                   text-[11px] uppercase tracking-widest shadow-lg shadow-indigo-500/20 
                                   flex items-center justify-center gap-2 hover:bg-indigo-700 
                                   hover:shadow-indigo-500/40 hover:-translate-y-0.5 transition-all">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    Update Credentials
                </button>
            </div>
        </div>
    </div>

    <script>
        // FAILSAFE: Removed aggressive loader removal.
        // We rely on the main initialization logic (8s timeout) to handle this.

        // GLOBAL MOBILE SIDEBAR TOGGLE (Outside initDashboard to guarantee scope)
        // GLOBAL MOBILE SIDEBAR TOGGLE
        // DESKTOP SIDEBAR TOGGLE
        window.toggleSidebarCollapse = function () {
            const sidebar = document.getElementById('main-sidebar');
            const content = document.querySelector('.content-main');
            const icon = document.getElementById('collapse-icon');

            if (sidebar) {
                sidebar.classList.toggle('collapsed');
                const isCollapsed = sidebar.classList.contains('collapsed');

                // Save state
                localStorage.setItem('sidebarCollapsed', isCollapsed);

                // Adjust Content
                if (content) {
                    if (isCollapsed) content.classList.add('expanded');
                    else content.classList.remove('expanded');
                }

                // Rotate Icon
                if (icon) {
                    icon.style.transform = isCollapsed ? 'rotate(180deg)' : 'rotate(0deg)';
                }
            }
        };

        // Initialize Desktop State
        document.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth > 768) {
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                const sidebar = document.getElementById('main-sidebar');
                const content = document.querySelector('.content-main');
                const icon = document.getElementById('collapse-icon');

                if (isCollapsed && sidebar) {
                    sidebar.classList.add('collapsed');
                    if (content) content.classList.add('expanded');
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }
            }
        });

        window.toggleMobileSidebar = function () {
            const sidebar = document.getElementById('main-sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const iconMenu = document.getElementById('icon-menu-mobile');
            const iconClose = document.getElementById('icon-close-mobile');

            if (sidebar && overlay) {
                sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('active');

                // Logic:
                // 1. Open -> Hide Page Logo & Hamburger Button (Sidebar takes over)
                // 2. Close -> Show Page Logo & Hamburger Button

                const isOpen = sidebar.classList.contains('mobile-open');
                const pageLogo = document.getElementById('mobile-logo-container');
                const hamburgerBtn = document.getElementById('mobile-menu-btn');

                if (isOpen) {
                    if (pageLogo) pageLogo.classList.add('opacity-0');
                    if (hamburgerBtn) hamburgerBtn.classList.add('opacity-0', 'pointer-events-none');
                    // FORCE EXPANDED STATE ON MOBILE
                    sidebar.classList.remove('collapsed');
                } else {
                    if (pageLogo) pageLogo.classList.remove('opacity-0');
                    if (hamburgerBtn) hamburgerBtn.classList.remove('opacity-0', 'pointer-events-none');
                }
            }
        };
        // --- ONLINE EXAM SYSTEM ---
        let examQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let examActive = false; // Admin toggle state

        // 1. Initialize Exam View
        async function initExamSystem() {
            if (!currentUser || !userProfile) return;

            // Reset Views
            $('#exam-admin-panel, #exam-admin-results, #exam-student-area, #exam-locked-screen, #exam-start-screen, #exam-interface, #exam-result-card').addClass('hidden');

            if (userProfile.role === 'admin') {
                // Admin View
                $('#exam-admin-panel').removeClass('hidden');
                $('#exam-admin-results').removeClass('hidden');
                fetchExamStatus(); // Check if active
                fetchAdminExamResults();
            } else {
                // Student View
                $('#exam-student-area').removeClass('hidden');
                // Check if already attempted
                const attempted = await checkStudentAttempt();
                if (attempted) {
                    showExamResult(attempted.score, attempted.total_marks, true); // Show previous result
                } else {
                    // Check for ongoing exam resume
                    const savedStart = localStorage.getItem('exam_start_time');
                    // Check for stale session (older than 100 mins)
                    // Exam is 90 mins. If older than 100 mins, they have no time left, so clear it to allow restart.
                    if (savedStart && (Date.now() - parseInt(savedStart) > (100 * 60 * 1000))) {
                        console.log("Clearing stale exam session (Time expired)...");
                        localStorage.removeItem('exam_start_time');
                        localStorage.removeItem('exam_answers');
                        // savedStart is now effectively null for the next check, so we fetch status
                        fetchExamStatus();
                    } else if (savedStart) {
                        $('#exam-interface').removeClass('hidden');
                        examQuestions = generateQuestions();

                        const savedAnswers = localStorage.getItem('exam_answers');
                        if (savedAnswers) userAnswers = JSON.parse(savedAnswers);
                        else userAnswers = {};

                        currentQuestionIndex = 0;
                        renderQuestion();
                        startTimer();
                    } else {
                        fetchExamStatus(); // Check if active to show Start or Lock screen
                    }
                }
            }
        }

        // 2. Fetch Exam Status (Active/Locked)
        async function fetchExamStatus() {
            if (!window.client) return;

            // We'll use a table 'exam_settings' with a row id=1
            const { data, error } = await window.client
                .from('exam_settings')
                .select('is_active')
                .eq('id', 1)
                .single();

            if (data) {
                examActive = data.is_active;
            } else {
                // Default to false if table doesn't exist yet
                examActive = false;
            }

            updateExamUIState();
        }

        function updateExamUIState() {
            const statusBadge = $('#exam-status-badge');
            const toggleBtn = $('#exam-toggle-btn');

            if (examActive) {
                // Admin UI
                statusBadge.removeClass('bg-rose-500/20 text-rose-400 border-rose-500/20')
                    .addClass('bg-emerald-500/20 text-emerald-500 border-emerald-500/20').text('ACTIVE');
                toggleBtn.text('Disable Exam').removeClass('bg-indigo-600').addClass('bg-rose-600 hover:bg-rose-700');

                // Student UI
                if (userProfile.role !== 'admin' && $('#exam-result-card').hasClass('hidden')) {
                    $('#exam-locked-screen').addClass('hidden');
                    $('#exam-start-screen').removeClass('hidden');
                }
            } else {
                // Admin UI
                statusBadge.removeClass('bg-emerald-500/20 text-emerald-500 border-emerald-500/20')
                    .addClass('bg-rose-500/20 text-rose-400 border-rose-500/20').text('LOCKED');
                toggleBtn.text('Enable Exam').removeClass('bg-rose-600 hover:bg-rose-700').addClass('bg-indigo-600 hover:bg-indigo-500');

                // Student UI
                if (userProfile.role !== 'admin' && $('#exam-result-card').hasClass('hidden')) {
                    $('#exam-start-screen').addClass('hidden');
                    $('#exam-locked-screen').removeClass('hidden');
                }
            }
        }

        // 3. Admin Toggle
        window.toggleExamStatus = async () => {
            if (!userProfile || userProfile.role !== 'admin') return;

            const newStatus = !examActive;

            // Upsert to ensure it exists
            const { error } = await window.client
                .from('exam_settings')
                .upsert({ id: 1, is_active: newStatus });

            if (!error) {
                examActive = newStatus;
                updateExamUIState();
                showToast(`Exam ${newStatus ? 'Enabled' : 'Disabled'}`);
            } else {
                console.error(error);
                showToast('Error updating status', 'error');
            }
        };

        // 4. Student Attempt Check
        async function checkStudentAttempt() {
            // Using uid from profiles (assuming currentUser has uid/id consistent with auth)
            // In previous code, currentUser.id is used for chat, but sometimes uid for auth.
            // I'll check what currentUser has. Usually it's from `users` table.
            // Let's assume currentUser.id matches the student_id foreign key or string.
            // Wait, previous chat logic used `currentUser.id`.

            const { data } = await window.client
                .from('exam_results')
                .select('*')
                .eq('student_id', currentUser.id)
                .single();
            return data;
        }

        // 5. Start Exam
        let examTimerInterval;
        const EXAM_DURATION_MS = 60 * 60 * 1000; // 60 minutes for 100 questions

        window.startExam = () => {
            // Set Start Time
            if (!localStorage.getItem('exam_start_time')) {
                localStorage.setItem('exam_start_time', Date.now());
                localStorage.removeItem('exam_answers');
                userAnswers = {};
            }

            $('#exam-start-screen').addClass('hidden');
            $('#exam-interface').removeClass('hidden');

            // Generate Questions
            examQuestions = generateQuestions();

            // Restore answers if resuming (in case startExam is called manually or via resume logic)
            const savedAnswers = localStorage.getItem('exam_answers');
            if (savedAnswers) {
                userAnswers = JSON.parse(savedAnswers);
            }

            currentQuestionIndex = 0;
            renderQuestion();
            startTimer();
        };

        function startTimer() {
            if (examTimerInterval) clearInterval(examTimerInterval);

            const update = () => {
                const startTime = parseInt(localStorage.getItem('exam_start_time'));
                if (!startTime) return;

                const now = Date.now();
                const elapsed = now - startTime;
                const remaining = EXAM_DURATION_MS - elapsed;

                if (remaining <= 0) {
                    clearInterval(examTimerInterval);
                    $('#exam-timer-display').text("00:00").addClass('text-rose-500');
                    alert("Time's up! Submitting your exam now.");
                    submitExam(true);
                    return;
                }

                const totalSeconds = Math.floor(remaining / 1000);
                const m = Math.floor(totalSeconds / 60);
                const s = totalSeconds % 60;
                $('#exam-timer-display').text(`${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`);

                if (remaining < 300000) { // 5 mins warning
                    $('#exam-timer-display').addClass('text-rose-500 animate-pulse');
                } else {
                    $('#exam-timer-display').removeClass('text-rose-500 animate-pulse');
                }
            };

            update();
            examTimerInterval = setInterval(update, 1000);
        }

        // 6. Generate 100 HTML Questions
        function generateQuestions() {
            const allQ = [
                { q: "HTML ka full form kya hai?", options: ["Hyper Text Markup Language", "High Text Machine Language", "Hyper Tool Markup Language", "Hyper Text Machine Language"], correct: 0 },
                { q: "HTML ka use kis liye hota hai?", options: ["Styling", "Programming", "Web page ka structure", "Database"], correct: 2 },
                { q: "HTML file ka extension kya hota hai?", options: [".ht", ".html", ".web", ".doc"], correct: 1 },
                { q: "Root element kaunsa hota hai?", options: ["<head>", "<body>", "<html>", "<title>"], correct: 2 },
                { q: "Page ka title kahan likhte hain?", options: ["<body>", "<meta>", "<title>", "<h1>"], correct: 2 },
                { q: "Heading tags ka range kya hai?", options: ["<h1> to <h3>", "<h1> to <h6>", "<h2> to <h6>", "<h1> to <h5>"], correct: 1 },
                { q: "Paragraph ke liye kaunsa tag hai?", options: ["<para>", "<p>", "<text>", "<pg>"], correct: 1 },
                { q: "Line break ke liye kaunsa tag?", options: ["<lb>", "<br>", "<break>", "<hr>"], correct: 1 },
                { q: "Horizontal line ke liye?", options: ["<br>", "<line>", "<hr>", "<border>"], correct: 2 },
                { q: "Anchor tag ka use?", options: ["Image", "Link", "Form", "Table"], correct: 1 },
                { q: "Link ka address kis attribute me hota hai?", options: ["src", "href", "link", "url"], correct: 1 },
                { q: "New tab me link open karne ke liye?", options: ["open", "blank", "target=\"_blank\"", "new"], correct: 2 },
                { q: "Image ke liye kaunsa tag?", options: ["<image>", "<img>", "<pic>", "<src>"], correct: 1 },
                { q: "Image ka path kis attribute se dete hain?", options: ["href", "src", "alt", "title"], correct: 1 },
                { q: "Image ka alternative text?", options: ["name", "title", "alt", "value"], correct: 2 },
                { q: "HTML comment ka sahi tareeqa?", options: ["// comment", "/* comment */", "<!-- comment -->", "## comment"], correct: 2 },
                { q: "Bold text ke liye?", options: ["<b>", "<strong>", "Dono A aur B", "<bold>"], correct: 2 },
                { q: "Italic text ke liye?", options: ["<i>", "<em>", "Dono A aur B", "<italic>"], correct: 2 },
                { q: "Underline ke liye?", options: ["<u>", "<ul>", "<underline>", "<li>"], correct: 0 },
                { q: "Subscript ke liye?", options: ["<sup>", "<sub>", "<small>", "<big>"], correct: 1 },
                { q: "Superscript ke liye?", options: ["<sub>", "<sup>", "<small>", "<big>"], correct: 1 },
                { q: "Ordered list ka tag?", options: ["<ul>", "<ol>", "<li>", "<list>"], correct: 1 },
                { q: "Unordered list ka tag?", options: ["<ul>", "<ol>", "<li>", "<u>"], correct: 0 },
                { q: "List item ka tag?", options: ["<item>", "<li>", "<list>", "<il>"], correct: 1 },
                { q: "Description list ka main tag?", options: ["<dl>", "<dt>", "<dd>", "<list>"], correct: 0 },
                { q: "Definition term ka tag?", options: ["<dl>", "<dt>", "<dd>", "<li>"], correct: 1 },
                { q: "Definition description ka tag?", options: ["<dl>", "<dt>", "<dd>", "<li>"], correct: 2 },
                { q: "Form banane ka tag?", options: ["<input>", "<form>", "<label>", "<fieldset>"], correct: 1 },
                { q: "Label ka use?", options: ["Styling", "Input ka naam show", "Data store", "Validation"], correct: 1 },
                { q: "Text input ke liye?", options: ["email", "password", "text", "number"], correct: 2 },
                { q: "Email input type?", options: ["mail", "email", "text", "gmail"], correct: 1 },
                { q: "Password input type?", options: ["hidden", "secure", "password", "lock"], correct: 2 },
                { q: "Radio button ka type?", options: ["checkbox", "radio", "select", "option"], correct: 1 },
                { q: "Checkbox ka type?", options: ["check", "tick", "checkbox", "box"], correct: 2 },
                { q: "Mobile number ke liye type?", options: ["phone", "tel", "number", "mobile"], correct: 1 },
                { q: "Textarea ka use?", options: ["Single line text", "Multiple line text", "Image upload", "Dropdown"], correct: 1 },
                { q: "Dropdown banane ka tag?", options: ["<option>", "<select>", "<list>", "<input>"], correct: 1 },
                { q: "Dropdown ke option ka tag?", options: ["<li>", "<option>", "<select>", "<opt>"], correct: 1 },
                { q: "Fieldset ka use?", options: ["Button banana", "Form fields group", "Styling", "Input hide"], correct: 1 },
                { q: "Fieldset ka title?", options: ["<title>", "<label>", "<legend>", "<head>"], correct: 2 },
                { q: "Table banane ka tag?", options: ["<tbl>", "<table>", "<tr>", "<td>"], correct: 1 },
                { q: "Table row ka tag?", options: ["<td>", "<tr>", "<th>", "<row>"], correct: 1 },
                { q: "Table heading cell?", options: ["<td>", "<tr>", "<th>", "<thead>"], correct: 2 },
                { q: "Table data cell?", options: ["<th>", "<td>", "<tr>", "<cell>"], correct: 1 },
                { q: "Table border attribute?", options: ["frame", "border", "cellpadding", "cellspacing"], correct: 1 },
                { q: "Cell ke andar space?", options: ["cellspacing", "cellpadding", "margin", "padding"], correct: 1 },
                { q: "Cells ke darmiyan space?", options: ["border", "cellpadding", "cellspacing", "space"], correct: 2 },
                { q: "Object tag ka use?", options: ["Image", "External resource embed", "Form", "Table"], correct: 1 },
                { q: "Object tag me file path ka attribute?", options: ["src", "data", "href", "link"], correct: 1 },
                { q: "Object tag ka alternate content kyun?", options: ["Styling", "Load fail hone par", "Validation", "Database"], correct: 1 },
                { q: "iframe ka use?", options: ["Image", "Video", "Another webpage show", "Form"], correct: 2 },
                { q: "iframe ka attribute jo URL deta hai?", options: ["href", "src", "link", "path"], correct: 1 },
                { q: "iframe kis cheez ke liye common hai?", options: ["PDF", "Google Maps", "YouTube", "All of these"], correct: 3 },
                { q: "Audio tag ka use?", options: ["Video", "Sound play", "Image", "Text"], correct: 1 },
                { q: "Audio tag ka attribute jo controls show kare?", options: ["play", "show", "controls", "audio"], correct: 2 },
                { q: "Audio file ka common format?", options: [".mp3", ".jpg", ".html", ".css"], correct: 0 },
                { q: "Video tag ka use?", options: ["Audio", "Image", "Video play", "Form"], correct: 2 },
                { q: "Video controls dikhane ke liye?", options: ["play", "show", "controls", "view"], correct: 2 },
                { q: "Video ke liye common format?", options: [".mp4", ".mp3", ".png", ".css"], correct: 0 },
                { q: "Video autoplay ka attribute?", options: ["auto", "play", "autoplay", "start"], correct: 2 },
                { q: "muted attribute ka use?", options: ["Sound increase", "Sound band", "Video stop", "Reload"], correct: 1 },
                { q: "loop attribute ka use?", options: ["Video band", "Repeat play", "Fast", "Pause"], correct: 1 },
                { q: "Form data submit karne ke liye?", options: ["reset", "submit", "button", "send"], correct: 1 },
                { q: "Reset button ka kaam?", options: ["Submit", "Clear form", "Save", "Reload"], correct: 1 },
                { q: "Placeholder ka use?", options: ["Value store", "Hint dikhana", "Label banana", "Hide"], correct: 1 },
                { q: "Required attribute ka use?", options: ["Optional banana", "Field mandatory banana", "Styling", "Hide"], correct: 1 },
                { q: "Name attribute ka kaam?", options: ["Styling", "Data identify", "Size", "Color"], correct: 1 },
                { q: "Select tag kis ke sath use hota hai?", options: ["<li>", "<option>", "<input>", "<label>"], correct: 1 },
                { q: "Audio tag ke andar source ka tag?", options: ["<src>", "<file>", "<source>", "<link>"], correct: 2 },
                { q: "Video tag ke andar source?", options: ["<src>", "<file>", "<source>", "<link>"], correct: 2 },
                { q: "iframe ek ______ element hai", options: ["Form", "Media", "Inline frame", "Block"], correct: 2 },
                { q: "object tag kis type ka content load karta hai?", options: ["External", "Internal", "CSS", "Script"], correct: 0 },
                { q: "HTML case sensitive hoti hai?", options: ["Yes", "No", "Kabhi kabhi", "Attributes only"], correct: 1 },
                { q: "HTML ek ______ language hai", options: ["Programming", "Scripting", "Markup", "Query"], correct: 2 },
                { q: "Meta tag kahan hota hai?", options: ["body", "footer", "head", "html"], correct: 2 },
                { q: "Charset ka kaam?", options: ["Font size", "Encoding batana", "Color", "Layout"], correct: 1 },
                { q: "Viewport ka use?", options: ["SEO", "Responsive design", "Database", "Security"], correct: 1 },
                { q: "iframe me height/width kis liye?", options: ["Style", "Size control", "Color", "Border"], correct: 1 },
                { q: "Audio autoplay attribute?", options: ["auto", "play", "autoplay", "start"], correct: 2 },
                { q: "Video poster attribute ka use?", options: ["Thumbnail image", "Sound", "Caption", "Loop"], correct: 0 },
                { q: "iframe me border remove karne ke liye?", options: ["border", "frameborder=\"0\"", "none", "remove"], correct: 1 },
                { q: "Object tag me width/height?", options: ["Styling", "Size define", "Link", "Validation"], correct: 1 },
                { q: "Form ka method attribute?", options: ["get/post", "send", "push", "fetch"], correct: 0 },
                { q: "Action attribute ka use?", options: ["Styling", "Data submit URL", "Validation", "Hide"], correct: 1 },
                { q: "Label ko input se connect karne ke liye?", options: ["name", "id", "for", "class"], correct: 2 },
                { q: "iframe me sandbox attribute?", options: ["Styling", "Security", "Layout", "Audio"], correct: 1 },
                { q: "Audio loop attribute?", options: ["repeat", "loop", "again", "play"], correct: 1 },
                { q: "Video muted attribute?", options: ["Sound off", "Sound on", "Replay", "Pause"], correct: 0 },
                { q: "Object tag fallback content kab dikhta hai?", options: ["Jab load ho", "Jab fail ho", "Hamesha", "Kabhi nahi"], correct: 1 },
                { q: "iframe ke andar text likha ja sakta hai?", options: ["Yes", "No", "Kabhi kabhi", "CSS se"], correct: 0 },
                { q: "Audio controls attribute?", options: ["show", "controls", "play", "sound"], correct: 1 },
                { q: "Video controls attribute?", options: ["show", "controls", "view", "play"], correct: 1 },
                { q: "Object tag ke andar kis type ka content ho sakta hai?", options: ["Text", "Image", "Media", "All"], correct: 3 },
                { q: "iframe inline element hai ya block?", options: ["Block", "Inline", "Dono", "None"], correct: 1 },
                { q: "Video tag ke sath kis tag ka use hota hai?", options: ["<link>", "<source>", "<img>", "<file>"], correct: 1 },
                { q: "Audio tag kis section me hota hai?", options: ["head", "body", "footer", "meta"], correct: 1 },
                { q: "iframe ka common use?", options: ["Image", "Map", "External page", "All"], correct: 3 },
                { q: "HTML me multimedia tags kaunse hain?", options: ["audio, video", "img, link", "p, h1", "form, input"], correct: 0 },
                { q: "Object tag HTML me kyun use hota hai?", options: ["Styling", "Embed resources", "Layout", "Validation"], correct: 1 },
                { q: "HTML beginners ke liye sabse pehle kya seekhna chahiye?", options: ["JavaScript", "CSS", "HTML structure & basic tags", "Database"], correct: 2 }
            ];

            // Shuffle function to randomize questions
            function shuffle(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [
                        array[randomIndex], array[currentIndex]];
                }
                return array;
            }

            return shuffle(allQ).slice(0, 100);
        }

        // 7. Render Question
        function renderQuestion() {
            const q = examQuestions[currentQuestionIndex];
            $('#current-q-num').text(currentQuestionIndex + 1);
            $('#question-text').text(q.q);

            const progress = ((currentQuestionIndex + 1) / examQuestions.length) * 100;
            $('#exam-progress-bar').css('width', `${progress}%`);

            const container = $('#options-container').empty();
            q.options.forEach((opt, idx) => {
                const isChecked = userAnswers[currentQuestionIndex] === idx;

                // Escape HTML tags in options
                const escapedOpt = opt.replace(/</g, "&lt;").replace(/>/g, "&gt;");

                const el = $(`
                    <label class="group relative flex items-center gap-4 p-5 rounded-2xl border-2 cursor-pointer transition-all duration-200 ${isChecked ? 'border-indigo-500 bg-indigo-50/50 dark:bg-indigo-900/20 shadow-lg shadow-indigo-500/10' : 'bg-white dark:bg-[#1e293b] border-slate-200 dark:border-slate-800 hover:border-indigo-300 dark:hover:border-indigo-700 hover:shadow-md'}">
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center shrink-0 transition-all ${isChecked ? 'border-indigo-500 bg-indigo-500 text-white scale-110' : 'border-slate-300 dark:border-slate-600 group-hover:border-indigo-400'}">
                            ${isChecked ? '<i data-lucide="check" class="w-5 h-5"></i>' : '<span class="text-xs font-bold text-slate-400 group-hover:text-indigo-400">' + String.fromCharCode(65 + idx) + '</span>'}
                        </div>
                        <input type="radio" name="q_opt" value="${idx}" class="hidden" ${isChecked ? 'checked' : ''}>
                        <span class="text-base font-medium text-slate-700 dark:text-slate-200 option-text leading-relaxed group-hover:text-slate-900 dark:group-hover:text-white transition-colors"></span>
                        
                        ${isChecked ? '<div class="absolute inset-0 rounded-2xl ring-2 ring-indigo-500 ring-offset-2 ring-offset-transparent pointer-events-none"></div>' : ''}
                    </label>
                `);
                el.find('.option-text').html(escapedOpt); // Use .html() to render escaped entities correctly

                el.click(() => selectOption(idx));
                container.append(el);
            });

            // Re-initialize icons for the new content
            if (window.lucide) lucide.createIcons();

            $('#btn-prev').prop('disabled', currentQuestionIndex === 0);
            if (currentQuestionIndex === examQuestions.length - 1) {
                $('#btn-next').addClass('hidden');
                $('#btn-submit').removeClass('hidden');
            } else {
                $('#btn-next').removeClass('hidden');
                $('#btn-submit').addClass('hidden');
            }
        }

        window.selectOption = (idx) => {
            userAnswers[currentQuestionIndex] = idx;
            localStorage.setItem('exam_answers', JSON.stringify(userAnswers));
            renderQuestion();
        };

        window.nextQuestion = () => {
            if (currentQuestionIndex < examQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        };

        window.prevQuestion = () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        };

        // 8. Submit Exam
        window.submitExam = async (force = false) => {
            if (!force && !confirm("Are you sure you want to submit? You cannot undo this.")) return;

            clearInterval(examTimerInterval);
            localStorage.removeItem('exam_start_time');
            localStorage.removeItem('exam_answers');

            let score = 0;
            examQuestions.forEach((q, idx) => {
                if (userAnswers[idx] === q.correct) score++;
            });

            const percentage = Math.round((score / examQuestions.length) * 100);
            const passed = percentage >= 40;

            if (window.client && currentUser && userProfile) {
                await window.client.from('exam_results').insert({
                    student_id: currentUser.id,
                    student_name: userProfile.name,
                    score: percentage,
                    total_marks: 100,
                    status: passed ? 'PASS' : 'FAIL'
                });
            }

            showExamResult(percentage, examQuestions.length, false);
        };

        function showExamResult(percentage, total, isHistory) {
            $('#exam-interface').addClass('hidden');
            $('#exam-start-screen').addClass('hidden');
            $('#exam-result-card').removeClass('hidden');

            const passed = percentage >= 40;

            $('#result-score').text(percentage + '%').removeClass('text-emerald-500 text-rose-500').addClass(passed ? 'text-emerald-500' : 'text-rose-500');
            $('#result-message').text(passed ? 'Congratulations! You Passed.' : 'Better luck next time.');

            const icon = passed ? '<i data-lucide="trophy" class="w-12 h-12 text-emerald-600"></i>' : '<i data-lucide="x-circle" class="w-12 h-12 text-rose-600"></i>';
            $('#result-icon-container').html(icon).removeClass('bg-emerald-100 bg-rose-100').addClass(passed ? 'bg-emerald-100' : 'bg-rose-100');

            // Show Download Button if passed
            if (passed) {
                $('#btn-download-cert').removeClass('hidden');
            } else {
                $('#btn-download-cert').addClass('hidden');
            }

            lucide.createIcons();
        }

        // 10. Download Certificate
        window.downloadCertificate = async () => {
            if (!window.jspdf || !window.html2canvas) {
                showToast("Certificate system loading... Please try again in a few seconds.", "error");
                return;
            }

            const container = $('#certificate-container');
            const name = (userProfile && userProfile.name) ? userProfile.name : "Student Name";
            const score = $('#result-score').text();
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            // Generate a random ID for "authenticity"
            const certId = "BBS-HTML-" + new Date().getFullYear() + "-" + Math.floor(1000 + Math.random() * 9000);

            // Populate Data
            $('#cert-student-name').text(name);
            $('#cert-score').text(score);
            $('#cert-date').text(date);
            $('#cert-id').text(certId);

            showToast("Generating Certificate... Please wait.", "info");

            // Create a clone of the certificate for capture
            // This avoids issues with hidden elements or existing transforms
            const originalElement = document.getElementById('certificate-template');
            const clone = originalElement.cloneNode(true);

            // Setup clone for perfect capture
            clone.id = 'certificate-template-clone';
            clone.style.position = 'absolute';
            clone.style.top = '0';
            clone.style.left = '0';
            clone.style.transform = 'none';
            clone.style.margin = '0';
            clone.style.zIndex = '9999';
            clone.style.width = '1123px';
            clone.style.height = '900px';

            // Important: Ensure images in clone are loaded or have correct src
            // The cloneNode(true) copies attributes, but we need to ensure the signature image source is set if it was set via JS
            const originalSig = originalElement.querySelector('#admin-sig-img');
            const cloneSig = clone.querySelector('#admin-sig-img');
            if (originalSig && cloneSig) {
                cloneSig.src = originalSig.src;
            }

            document.body.appendChild(clone);

            // Lock body scroll
            const bodyOverflow = document.body.style.overflow;
            document.body.style.overflow = 'hidden';
            window.scrollTo(0, 0);

            try {
                // Wait for render (fonts, images)
                await new Promise(r => setTimeout(r, 1000));

                const canvas = await html2canvas(clone, {
                    scale: 3, // Higher quality
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    width: 1123,
                    height: 900,
                    scrollX: 0,
                    scrollY: 0,
                    x: 0,
                    y: 0
                });

                const { jsPDF } = window.jspdf;
                // Create PDF with custom dimensions matching the captured canvas aspect ratio
                // Use pixels (or points) to match canvas dimensions 1:1 to avoid cropping
                const pdf = new jsPDF('l', 'px', [1123, 900]);

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();

                const imgData = canvas.toDataURL('image/jpeg', 0.98);
                pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);

                pdf.save(`HTML_Certificate_${name.replace(/[^a-z0-9]/gi, '_')}.pdf`);

                showToast("Certificate downloaded successfully!");
            } catch (err) {
                console.error("Certificate Generation Error:", err);
                showToast("Failed to generate certificate.", "error");
            } finally {
                // Remove clone and restore body
                if (clone && clone.parentNode) {
                    clone.parentNode.removeChild(clone);
                }
                document.body.style.overflow = bodyOverflow;
            }
        };

        // 9. Admin Results
        async function fetchAdminExamResults() {
            if (!userProfile || userProfile.role !== 'admin') return;

            const tbody = $('#exam-results-body');
            tbody.html('<tr><td colspan="4" class="p-4 text-center">Loading...</td></tr>');

            const { data } = await window.client
                .from('exam_results')
                .select('*')
                .order('created_at', { ascending: false });

            if (!data || data.length === 0) {
                tbody.html('<tr><td colspan="4" class="p-4 text-center text-slate-400">No results found.</td></tr>');
                return;
            }

            tbody.empty();
            data.forEach(row => {
                const date = new Date(row.created_at).toLocaleDateString();
                const isPass = row.status === 'PASS';
                const tr = `
                    <tr class="border-b border-slate-50 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50">
                        <td class="p-3 font-bold text-slate-800 dark:text-slate-200">${row.student_name || row.student_id}</td>
                        <td class="p-3 font-black ${isPass ? 'text-emerald-500' : 'text-rose-500'}">${row.score}%</td>
                        <td class="p-3"><span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${isPass ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}">${row.status}</span></td>
                        <td class="p-3 text-xs text-slate-400">${date}</td>
                        <td class="p-3 text-right">
                            <button onclick="resetExamResult('${row.id}', '${row.student_name || 'Student'}')" 
                                    class="p-2 bg-slate-100 hover:bg-rose-100 text-slate-400 hover:text-rose-500 rounded-lg transition-colors" 
                                    title="Reset Result (Allow Retake)">
                                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.append(tr);
            });
            lucide.createIcons();
        }

        window.resetExamResult = async (resultId, name) => {
            if (!confirm(`Are you sure you want to RESET the exam result for ${name}?\n\nThis will delete their current score and allow them to take the exam again.`)) return;

            const { error } = await window.client
                .from('exam_results')
                .delete()
                .eq('id', resultId);

            if (!error) {
                showToast(`Result for ${name} has been reset.`);
                fetchAdminExamResults();
            } else {
                console.error(error);
                showToast('Failed to reset result.', 'error');
            }
        };

        // --- STUDENT COUNT LOGIC ---
        const initStudentCounter = () => {
            const countNode = document.getElementById('total-student-count');
            const target = document.getElementById('user-table-body');

            if (target && countNode) {
                const observer = new MutationObserver(() => {
                    const count = target.children.length;
                    countNode.innerText = `${count} Records`;
                });
                observer.observe(target, { childList: true });
                // Initial set
                countNode.innerText = `${target.children.length} Records`;
            }
        };
        $(document).ready(initStudentCounter);

        // --- SKELETON UI SYSTEM ---
        window.renderSkeleton = (containerId, count = 5, type = 'list') => {
            const container = $(`#${containerId}`);
            if (!container.length) return;

            let html = '';
            if (type === 'list') {
                for (let i = 0; i < count; i++) {
                    html += `
                        <tr class="animate-pulse border-b border-slate-50 dark:border-slate-800">
                            <td class="px-5 py-4"><div class="h-4 bg-slate-100 dark:bg-slate-700 rounded w-32"></div></td>
                            <td class="px-5 py-4 hidden sm:table-cell"><div class="h-4 bg-slate-100 dark:bg-slate-700 rounded w-20 mx-auto"></div></td>
                            <td class="px-5 py-4"><div class="h-4 bg-slate-100 dark:bg-slate-700 rounded w-24 mx-auto"></div></td>
                            <td class="px-5 py-4"><div class="h-4 bg-slate-100 dark:bg-slate-700 rounded w-16 mx-auto"></div></td>
                            <td class="px-5 py-4"><div class="h-5 bg-slate-100 dark:bg-slate-700 rounded-full w-20 mx-auto"></div></td>
                            <td class="px-5 py-4"><div class="h-6 bg-slate-100 dark:bg-slate-700 rounded w-8 ml-auto"></div></td>
                        </tr>`;
                }
            } else if (type === 'card') {
                for (let i = 0; i < count; i++) {
                    html += `
                        <div class="p-5 rounded-xl border border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900 animate-pulse">
                            <div class="flex justify-between items-start mb-4">
                                <div class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800"></div>
                                <div class="w-16 h-5 rounded bg-slate-100 dark:bg-slate-800"></div>
                            </div>
                            <div class="h-4 w-3/4 mb-2 rounded bg-slate-100 dark:bg-slate-800"></div>
                            <div class="h-3 w-1/2 mb-4 rounded bg-slate-100 dark:bg-slate-800"></div>
                            <div class="h-8 w-full rounded-lg bg-slate-100 dark:bg-slate-800"></div>
                        </div>`;
                }
            }
            container.html(html);
        };

    </script>
    <!-- MOBILE BOTTOM NAVIGATION (Refined Design A: Centered Top Indicator + Glow + Fill) -->
    <!-- MOBILE BOTTOM NAVIGATION (Strict Design A - Full Height Glow) -->
    <div id="mobile-nav-bar"
        class="hidden fixed bottom-0 left-0 right-0 z-[9000] h-[72px] bg-white dark:bg-[#0f172a] shadow-[0_-2px_12px_rgba(0,0,0,0.08)] rounded-t-[16px] flex justify-around items-center md:hidden pb-safe">

        <!-- HOME -->
        <button id="mob-nav-dashboard" onclick="switchTab('dashboard')"
            class="mobile-nav-btn active flex-1 relative flex flex-col items-center justify-center h-full pt-2 group">
            <div
                class="active-line absolute top-0 left-[20%] w-[60%] h-[3px] bg-[#1a73e8] dark:bg-indigo-500 rounded-b-[6px]">
            </div>
            <!-- Full Height Glow (Design A Modified) -->
            <div class="active-light absolute top-0 bottom-0 left-[20%] w-[60%] pointer-events-none"></div>
            <i data-lucide="house" class="w-[24px] h-[24px] mb-1 text-[#9aa0a6] transition-all duration-300"></i>
            <span class="text-[11px] text-[#9aa0a6] font-medium transition-colors">Home</span>
        </button>

        <!-- TASKS -->
        <button id="mob-nav-tasks" onclick="switchTab('tasks')"
            class="mobile-nav-btn flex-1 relative flex flex-col items-center justify-center h-full pt-2 group">
            <div
                class="active-line absolute top-0 left-[20%] w-[60%] h-[3px] bg-[#1a73e8] dark:bg-indigo-500 rounded-b-[6px]">
            </div>
            <div class="active-light absolute top-0 bottom-0 left-[20%] w-[60%] pointer-events-none"></div>
            <i data-lucide="clipboard-list"
                class="w-[24px] h-[24px] mb-1 text-[#9aa0a6] transition-all duration-300"></i>
            <span class="text-[11px] text-[#9aa0a6] font-medium transition-colors">Tasks</span>
        </button>

        <!-- RANK -->
        <button id="mob-nav-leaderboard" onclick="switchTab('leaderboard')"
            class="mobile-nav-btn flex-1 relative flex flex-col items-center justify-center h-full pt-2 group">
            <div
                class="active-line absolute top-0 left-[20%] w-[60%] h-[3px] bg-[#1a73e8] dark:bg-indigo-500 rounded-b-[6px]">
            </div>
            <div class="active-light absolute top-0 bottom-0 left-[20%] w-[60%] pointer-events-none"></div>
            <i data-lucide="trophy" class="w-[24px] h-[24px] mb-1 text-[#9aa0a6] transition-all duration-300"></i>
            <span class="text-[11px] text-[#9aa0a6] font-medium transition-colors">Rank</span>
        </button>

        <!-- PLAY -->
        <button id="mob-nav-arcade" onclick="switchTab('arcade')"
            class="mobile-nav-btn flex-1 relative flex flex-col items-center justify-center h-full pt-2 group">
            <div
                class="active-line absolute top-0 left-[20%] w-[60%] h-[3px] bg-[#1a73e8] dark:bg-indigo-500 rounded-b-[6px]">
            </div>
            <div class="active-light absolute top-0 bottom-0 left-[20%] w-[60%] pointer-events-none"></div>
            <i data-lucide="gamepad-2" class="w-[24px] h-[24px] mb-1 text-[#9aa0a6] transition-all duration-300"></i>
            <span class="text-[11px] text-[#9aa0a6] font-medium transition-colors">Play</span>
        </button>

        <!-- ME -->
        <button id="mob-nav-profile" onclick="switchTab('profile')"
            class="mobile-nav-btn flex-1 relative flex flex-col items-center justify-center h-full pt-2 group">
            <div
                class="active-line absolute top-0 left-[20%] w-[60%] h-[3px] bg-[#1a73e8] dark:bg-indigo-500 rounded-b-[6px]">
            </div>
            <div class="active-light absolute top-0 bottom-0 left-[20%] w-[60%] pointer-events-none"></div>
            <i data-lucide="user" class="w-[24px] h-[24px] mb-1 text-[#9aa0a6] transition-all duration-300"></i>
            <span class="text-[11px] text-[#9aa0a6] font-medium transition-colors">Me</span>
        </button>
    </div>
    <!-- CHAT WIDGET START -->


    <script src="assets/js/ui-helpers.js"></script>

    <!-- Chat System Logic Removed -->


    <!-- Hidden Certificate Template -->
    <!-- Google Font for Signature and Computerized ID -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">

    <div id="certificate-container"
        class="fixed top-0 left-0 w-full h-full pointer-events-none opacity-0 z-[-1] overflow-hidden flex items-center justify-center">
        <!-- Optimized A4 Landscape Template (1123x950) with compact sizing -->
        <div id="certificate-template"
            class="w-[1123px] h-[950px] bg-white relative p-12 text-slate-900 shadow-2xl mx-auto flex flex-col justify-between"
            style="transform: scale(0.8); transform-origin: top left;">
            <!-- Border Decoration -->
            <div class="absolute inset-4 border-4 border-double border-indigo-900/20 pointer-events-none"></div>
            <div class="absolute inset-6 border border-indigo-900/10 pointer-events-none"></div>

            <!-- Corner Ornaments (Smaller) -->
            <div class="absolute top-4 left-4 w-12 h-12 border-t-4 border-l-4 border-indigo-600 pointer-events-none">
            </div>
            <div class="absolute top-4 right-4 w-12 h-12 border-t-4 border-r-4 border-indigo-600 pointer-events-none">
            </div>
            <div class="absolute bottom-4 left-4 w-12 h-12 border-b-4 border-l-4 border-indigo-600 pointer-events-none">
            </div>
            <div
                class="absolute bottom-4 right-4 w-12 h-12 border-b-4 border-r-4 border-indigo-600 pointer-events-none">
            </div>

            <!-- Header Section (Compact) -->
            <div class="w-full flex justify-between items-center mb-2 relative z-10 px-4 mt-4">
                <!-- BBS Logo -->
                <div class="flex items-center gap-4">
                    <img src="assets/bbsydp_logo.png" class="h-14 w-auto object-contain drop-shadow-md"
                        alt="BBSHRRDB Logo" crossorigin="anonymous">
                    <div class="text-left">
                        <h1 class="text-lg font-black text-indigo-900 uppercase tracking-widest leading-none mb-0.5">
                            BBSHRRDB LMS V2.0</h1>
                        <p class="text-[9px] font-bold text-indigo-500 uppercase tracking-wider">Benazir Bhutto Shaheed
                            Human Resource Research & Development Board</p>
                        <p class="text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">Government of
                            Sindh</p>
                    </div>
                </div>

                <!-- Institute Logo -->
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <h1 class="text-lg font-black text-slate-800 uppercase tracking-widest leading-none mb-0.5">
                            Super Systech</h1>
                        <p class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Computers Umerkot</p>
                    </div>
                    <!-- Placeholder for Institute Logo -->
                    <img src="assets/institute_logo.png"
                        onerror="this.src='https://ui-avatars.com/api/?name=ST&background=0D8ABC&color=fff&size=128'"
                        class="h-14 w-auto object-contain drop-shadow-md rounded-lg" alt="Institute Logo"
                        crossorigin="anonymous">
                </div>
            </div>

            <!-- Title Section -->
            <div class="text-center mb-2 relative z-10">
                <h2 class="text-5xl font-serif font-bold text-slate-800 mb-2 tracking-tight drop-shadow-sm">Certificate
                    of Completion</h2>
                <!-- Elegant Divider -->
                <div class="flex items-center justify-center gap-4 opacity-60 mt-4">
                    <div class="h-[1px] w-24 bg-slate-400"></div>
                    <div class="w-2 h-2 rotate-45 border border-slate-500 bg-slate-100"></div>
                    <div class="h-[1px] w-24 bg-slate-400"></div>
                </div>
            </div>

            <!-- Body Section -->
            <div class="text-center w-full flex-1 flex flex-col justify-start relative z-10 pt-2">
                <p class="text-xl text-slate-500 font-serif italic mb-2">This is to certify that</p>

                <!-- Student Name with Elegant Underline -->
                <div class="relative inline-block py-2 mb-4 w-full max-w-3xl mx-auto">
                    <h3 id="cert-student-name"
                        class="text-5xl font-black text-indigo-900 font-serif px-8 pb-2 capitalize tracking-wide z-10 relative">
                        Student Name
                    </h3>
                    <div class="w-3/4 h-px bg-slate-300 mx-auto mt-8"></div>
                    <div class="w-1/2 h-px bg-slate-200 mx-auto mt-1"></div>
                </div>

                <p class="text-xl text-slate-500 font-serif italic mb-2">Has successfully completed the certification
                    requirements for</p>

                <!-- Course Box -->
                <div
                    class="my-2 py-2 px-16 bg-white border border-indigo-900/10 rounded-xl shadow-lg shadow-indigo-900/5 inline-block relative overflow-hidden mx-auto">
                    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-indigo-500 to-purple-500">
                    </div>
                    <h4 class="text-3xl font-black text-indigo-900 mb-1 tracking-tight">HTML5 Web Development</h4>
                    <p class="text-indigo-600 font-bold uppercase tracking-widest text-xs">Professional Certification
                        Exam</p>
                </div>

                <div class="flex justify-center gap-16 mt-4">
                    <div class="text-center px-8 py-3 bg-slate-50 rounded-lg border border-slate-100 shadow-sm">
                        <p class="text-[10px] font-bold uppercase text-slate-400 tracking-widest mb-0.5">Score Achieved
                        </p>
                        <p id="cert-score" class="text-3xl font-black text-emerald-600">0%</p>
                    </div>
                    <div class="text-center px-8 py-3 bg-slate-50 rounded-lg border border-slate-100 shadow-sm">
                        <p class="text-[10px] font-bold uppercase text-slate-400 tracking-widest mb-0.5">Date Issued</p>
                        <p id="cert-date" class="text-2xl font-bold text-slate-700 font-serif">Jan 01, 2026</p>
                    </div>
                </div>
            </div>

            <!-- Certificate ID (Moved to Footer Top) -->
            <div class="text-center mb-2 relative z-10">
                <span class="inline-block text-[9px] font-bold text-slate-400 uppercase tracking-widest">Certificate
                    ID:</span>
                <span id="cert-id" class="inline-block text-[10px] text-slate-600 font-bold ml-2"
                    style="font-family: 'Share Tech Mono', monospace;">BBS-HTML-2026-0000</span>
            </div>

            <!-- Footer / Signatures Section -->
            <div class="w-full grid grid-cols-3 gap-8 items-end pt-2 pb-0 relative z-10 px-8">

                <!-- Empty Left Column -->
                <div class="text-center relative">
                    <!-- Intentionally Empty -->
                </div>

                <!-- Seal -->
                <div class="text-center relative z-20 flex justify-center -mb-2">
                    <!-- Verified Stamp Image (Base64) -->
                    <img src="data:image/png;base64,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"
                        alt="Verified Stamp" class="w-36 h-36 opacity-90 rotate-[-5deg]" crossorigin="anonymous">
                </div>

                <!-- Admin Signature (Right Side) -->
                <div class="text-center relative">
                    <div class="h-24 flex items-end justify-center -mb-2">
                        <!-- Image Signature from signature.js -->
                        <img id="admin-sig-img"
                            class="h-24 w-auto object-contain opacity-90 rotate-[-5deg] translate-y-2" alt="Signature"
                            crossorigin="anonymous">
                    </div>
                    <div class="border-t border-slate-300 w-56 mx-auto pt-2">
                        <p class="font-bold text-slate-900 text-lg">System Administrator</p>
                    </div>
                </div>
            </div>

            <!-- Script to Load Signature -->
            <script>
                // Load Admin Signature from window.adminSignature (signature.js)
                document.addEventListener('DOMContentLoaded', () => {
                    const sigImg = document.getElementById('admin-sig-img');
                    if (sigImg && window.adminSignature) {
                        sigImg.src = window.adminSignature;
                    }
                });
                // Also try immediately in case DOM is ready or for re-renders
                (function () {
                    const sigImg = document.getElementById('admin-sig-img');
                    if (sigImg && window.adminSignature) {
                        sigImg.src = window.adminSignature;
                    }
                })();
            </script>

            <!-- Footer Bottom Text -->
            <div class="w-full text-center mt-3 border-t border-slate-100 pt-2 relative z-10 pb-2">
                <p class="text-sm font-bold text-slate-600 uppercase tracking-widest">Super Systech Computers Umerkot
                </p>
                <div class="mt-2">
                    <p class="text-[10px] text-slate-400 italic">This document is electronically generated and serves as
                        an official performance record.</p>
                    <p class="text-[10px] text-slate-400 italic">For verification, please contact BBSHRRDB
                        Administration.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Popup Modal (Advanced Professional) -->
    <div id="feedback-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center bg-slate-900/50 backdrop-blur-md opacity-0 transition-opacity duration-500">
        <div class="relative w-full max-w-lg mx-4 transform scale-95 transition-all duration-500 ease-out group">

            <!-- Ambient Glow Effects -->
            <div
                class="absolute -inset-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-[2rem] blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200">
            </div>

            <!-- Main Card -->
            <div
                class="relative bg-white/95 dark:bg-slate-900/95 backdrop-blur-2xl rounded-[1.8rem] shadow-2xl overflow-hidden border border-white/20 dark:border-slate-700/50 ring-1 ring-black/5">

                <!-- Subtle Grid Pattern Background -->
                <div
                    class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoOTksIDEwMiwgMjQ1LCAwLjA3KSIvPjwvc3ZnPg==')] [mask-image:linear-gradient(to_bottom,white,transparent)]">
                </div>

                <div class="relative px-8 py-12 text-center">
                    <!-- Close Button (Subtle) -->
                    <button onclick="closeFeedbackModal()"
                        class="absolute top-4 right-4 p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors rounded-full hover:bg-slate-100 dark:hover:bg-slate-800">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>

                    <!-- Floating 3D Icon Composition -->
                    <div class="mb-8 relative inline-block">
                        <!-- Glow behind -->
                        <div class="absolute inset-0 bg-indigo-500 blur-2xl opacity-20 animate-pulse"></div>

                        <!-- Main Icon Box -->
                        <div
                            class="relative w-24 h-24 bg-gradient-to-tr from-indigo-500 to-purple-600 rounded-2xl rotate-3 flex items-center justify-center shadow-lg shadow-indigo-500/30 transform transition-transform group-hover:rotate-6 group-hover:scale-105 duration-500">
                            <div
                                class="w-[5.5rem] h-[5.5rem] bg-white dark:bg-slate-900 rounded-xl flex items-center justify-center -rotate-3 shadow-inner border border-white/10">
                                <!-- Gradient Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
                                    fill="none" stroke="url(#icon-gradient)" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-message-square-heart">
                                    <defs>
                                        <linearGradient id="icon-gradient" x1="0" y1="0" x2="1" y2="1">
                                            <stop offset="0%" stop-color="#6366f1" />
                                            <stop offset="100%" stop-color="#ec4899" />
                                        </linearGradient>
                                    </defs>
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                    <path d="M12 11.5 10 9" />
                                    <path d="m14 9-2 2.5" />
                                </svg>
                            </div>
                        </div>

                        <!-- Floating Particles -->
                        <div class="absolute -top-3 -right-5 w-8 h-8 bg-pink-500/20 backdrop-blur-md rounded-lg rotate-12 flex items-center justify-center animate-bounce"
                            style="animation-duration: 3s;">
                            <i data-lucide="heart" class="w-4 h-4 text-pink-500 fill-pink-500"></i>
                        </div>
                        <div class="absolute -bottom-2 -left-6 w-10 h-10 bg-indigo-500/10 backdrop-blur-md rounded-full flex items-center justify-center animate-bounce"
                            style="animation-duration: 4s; animation-delay: 1s;">
                            <i data-lucide="thumbs-up" class="w-5 h-5 text-indigo-500"></i>
                        </div>
                    </div>

                    <!-- Modern Typography -->
                    <h3 class="text-3xl font-black text-slate-900 dark:text-white mb-3 tracking-tight">
                        Your Voice <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-pink-500">Matters</span>
                    </h3>

                    <p
                        class="text-slate-500 dark:text-slate-400 mb-8 text-base leading-relaxed max-w-sm mx-auto font-medium">
                        Help us craft the ultimate learning experience. <br>Your insights drive our innovation.
                    </p>

                    <!-- Visual Star Rating (Engagement Trigger) -->
                    <div
                        class="flex justify-center gap-3 mb-8 opacity-90 group-hover:scale-105 transition-transform duration-500 cursor-default">
                        <i data-lucide="star" class="w-6 h-6 text-amber-400 fill-amber-400 drop-shadow-sm"></i>
                        <i data-lucide="star" class="w-6 h-6 text-amber-400 fill-amber-400 drop-shadow-sm"></i>
                        <i data-lucide="star" class="w-6 h-6 text-amber-400 fill-amber-400 drop-shadow-sm"></i>
                        <i data-lucide="star" class="w-6 h-6 text-amber-400 fill-amber-400 drop-shadow-sm"></i>
                        <i data-lucide="star"
                            class="w-6 h-6 text-slate-200 dark:text-slate-700 fill-slate-200 dark:fill-slate-700"></i>
                    </div>

                    <!-- High-Contrast Action Button -->
                    <a href="https://bbsydp-lms.netlify.app/feedback.html" target="_blank"
                        onclick="closeFeedbackModal()"
                        class="group/btn relative inline-flex items-center justify-center w-full py-4 px-8 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold text-lg rounded-2xl overflow-hidden shadow-xl shadow-indigo-500/20 hover:shadow-indigo-500/40 transition-all transform hover:-translate-y-1">
                        <!-- Shimmer Overlay -->
                        <div
                            class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 dark:via-black/10 to-transparent -translate-x-full group-hover/btn:animate-[shimmer_1.5s_infinite]">
                        </div>

                        <span class="relative flex items-center gap-3">
                            Share Feedback
                            <i data-lucide="arrow-right"
                                class="w-5 h-5 transition-transform group-hover/btn:translate-x-1"></i>
                        </span>
                    </a>

                    <!-- Minimal Secondary Action -->
                    <div class="mt-6">
                        <button onclick="closeFeedbackModal()"
                            class="text-xs font-bold text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300 uppercase tracking-widest transition-colors">
                            Remind Me Later
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Online Users Modal -->
    <div class="modal fade" id="onlineUsersModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content v-card border-t-4 border-emerald-500">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title text-lg font-black uppercase tracking-tighter text-slate-900 dark:text-slate-100">Online Students</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="online-users-list" class="space-y-3 max-h-[300px] overflow-y-auto pr-1">
                        <!-- Injected -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>